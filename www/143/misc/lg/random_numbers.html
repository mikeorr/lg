<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<title>Random Numbers</title>
<link rel="stylesheet" type="text/css" href="../../../lg.css" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
</head>
<body>
<a href="../../../"><img alt="Linux Gazette" src="../../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" /></a><img alt="Tux" src="../../../gx/tux_86x95_indexed.png" id="tux" /><p id="fun">...making Linux just a little more fun!</p><div class='content articlecontent'><a name="top"></a><h3>Random Numbers</h3>
<p>
<b><p>
MNZ [mnzaki at gmail.com]
</p>
</b><br />
<b>Tue, 7 Aug 2007 17:48:20 +0300</b>
</p>

<p>
Hey Gang,
A question about computer "generated" random numbers, in short how
random are they really?
</p>

<p>
I was trying to write this little perl script to play random songs and
I noticed it tends to repeat a certain collection of songs (which
changes everyday, or even every couple of hours). So what's really
happening?
</p>

<p>
Thanks.
<pre>-- 
//MNZ\\
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Thomas Adam [thomas.adam22 at gmail.com]
</p>
</b><br />
<b>Tue, 7 Aug 2007 16:14:16 +0100</b>
</p>

<p>
On 07/08/07, MNZ &lt;mnzaki@gmail.com&gt; wrote:
</p>

<pre>
&gt; Hey Gang,
&gt; A question about computer "generated" random numbers, in short how
&gt; random are they really?
</pre>

<p>
Because random doesn't necessarily mean unique.  And since your list
of songs is finite, so are the bounds of the randomness.
</p>

<p>
-- Thomas Adam
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Rick Moen [rick at linuxmafia.com]
</p>
</b><br />
<b>Tue, 7 Aug 2007 10:11:19 -0700</b>
</p>

<p>
Quoting Thomas Adam (thomas.adam22@gmail.com):
</p>


<pre>
&gt; Because random doesn't necessarily mean unique.
</pre>

<p>
Reminds me:  I heard a marvellous story about a college professor who
would always start the semester of his statistics class with a small 
object lesson:  Two teams of students would volunteer to write series of
digits on the blackboard, with the professor absent from the room.
(The two teams would pick the right or left side based on a coin toss.)
</p>

<p>
One team would write digits from a decent-quality random binary number
generator.  The other would write the same quantity of bits, except
using they thought of personally rather than from a RNG, attempting to
create a random sequence manually.
</p>

<p>
The professor was then called back into the classroom -- and (almost)
unfailingly identify which was the RNG-produced series, and which was
the manually created one.
</p>

<p>
How?  Because practically everyone, asked to produce a random bit sequence
without mechanical help, will shy away from repeating digits far more
often than is likely to happen randomly.  The professor thus needs only
to spot which sequence looks "more random", and that's (almost always)
the one that <em>isn't</em> very random.
</p>

<p>
The larger lesson is that, in <em>genuinely</em> random trials, weird
coincidences, repetitions, and apparent patterns <em>will</em> occur.
Probably.  ;-&gt;
</p>


<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Kapil Hari Paranjape [kapil at imsc.res.in]
</p>
</b><br />
<b>Wed, 8 Aug 2007 06:09:22 +0530</b>
</p>

<p>
Hello,
</p>

<p>
On Tue, 07 Aug 2007, Rick Moen wrote:
</p>

<pre>
&gt; The larger lesson is that, in <em>genuinely</em> random trials, weird
&gt; coincidences, repetitions, and apparent patterns <em>will</em> occur.
&gt; Probably.  ;-&gt;
</pre>

<p>
In fact, figuring out how likely it is that you will find such
"unlikely phenomena" is a win-win thing --- as S. R. S. Varadhan
who wone the Abel prize this year will testify. His work on "Large
deviations" is precisely the study of these "unlikely phenomena".
</p>

<p>
Regards,
</p>

<p>
Kapil.
--
</p>


<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ren&eacute; Pfeiffer [lynx at luchs.at]
</p>
</b><br />
<b>Tue, 7 Aug 2007 17:24:19 +0200</b>
</p>

<p>
Hello!
</p>

<p>
On Aug 07, 2007 at 1748 +0300, MNZ appeared and said:
</p>

<pre>
&gt; Hey Gang,
&gt; A question about computer "generated" random numbers, in short how
&gt; random are they really?
</pre>

<p>
Most random number functions use a pseudo-random number generator
(PRNG) since it is very difficult to create sufficient random number
with deterministic machines. PRNGs use different algorithms. Some of
them are more random than others. Most use an initial value, called the
seed, that gives you a specific sequence of numbers. You can repeat this
sequence by using the same seed before generating random numbers.
</p>

<p>
You could also use cryptographically secure pseudorandom number
generators (CSPRNGs), which can be modified encryption algorithms for
example.
</p>

<p>
Real randomness is best retrieved from physical processes such as
radioactive decay or cosmis radiation. Sound cards can also be used (see
<a href="http://www.mindrot.org/audio-entropyd.html">http://www.mindrot.org/audio-entropyd.html</a> for an example). The
soundchip of the venerable Commodore 64 had an hardware random generator
(white noise is useful for some sound effects). Some even use a lava
lamp and a CCD chip as used in webcams (<a href="http://www.lavarnd.org/">http://www.lavarnd.org/</a>). A
webcam inside a dark cylinder would also do, because CCD sensors show
noise when exposed to "dark light").
</p>

<p>
The Linux kernel uses a mix of algorithms and hardware-induced effects
for the "creation" of randomness.
</p>

<p>
<a href="http://www.random.org/">http://www.random.org/</a> has some more insights into randomness and its
uses (plus some sample of randomness gathered from athmospheric noise,
they even offer subscriptions, as strange as it sounds).
</p>


<pre>
&gt; I was trying to write this little perl script to play random songs and
&gt; I noticed it tends to repeat a certain collection of songs (which
&gt; changes everyday, or even every couple of hours). So what's really
&gt; happening?
</pre>

<p>
I think Perl's rand() function is a wrapper for the random number
function of the C library which in turn contains a simple PRNG with seed
and random number sequences. The effect you have seen may be due to the
PRNG, but if your number of songs is sufficiently low then you might hit
the effect of discretisation. rand() returns fractional numbers. When
creating an integer to address a specific song you lose some randomness
by rounding the random number. It's hard to tell without seeing the
code.
</p>

<p>
You could probably add a counter per song and check if the selected song
was played more than $n times and prefer a song that was played less
times.
</p>

<p>
Best wishes,
Ren&eacute;.
</p>


<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Thomas Adam [thomas.adam22 at gmail.com]
</p>
</b><br />
<b>Tue, 7 Aug 2007 16:37:42 +0100</b>
</p>

<p>
On 07/08/07, Ren&eacute; Pfeiffer &lt;lynx@luchs.at&gt; wrote:
</p>

<pre>
&gt; You could probably add a counter per song and check if the selected song
&gt; was played more than $n times and prefer a song that was played less
&gt; times.
</pre>

<p>
"Collections".  XMMS2 allows for this:
</p>

<p>
<a href="http://wiki.xmms2.xmms.se/index.php/Collections">http://wiki.xmms2.xmms.se/index.php/Collections</a>
</p>

<p>
-- Thomas Adam
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ren&eacute; Pfeiffer [lynx at luchs.at]
</p>
</b><br />
<b>Tue, 7 Aug 2007 18:03:18 +0200</b>
</p>

<p>
On Aug 07, 2007 at 1637 +0100, Thomas Adam appeared and said:
</p>

<pre>
&gt; On 07/08/07, Ren&eacute; Pfeiffer &lt;lynx@luchs.at&gt; wrote:
&gt; &gt; You could probably add a counter per song and check if the selected song
&gt; &gt; was played more than $n times and prefer a song that was played less
&gt; &gt; times.
&gt;=20
&gt; "Collections".  XMMS2 allows for this:
&gt;=20
&gt; <a href="http://wiki.xmms2.xmms.se/index.php/Collections">http://wiki.xmms2.xmms.se/index.php/Collections</a>
</pre>

<p>
Oh, I missed that feature apparently (but I am still "stuck" with
xmms1, too lazy to upgrade).
</p>

<p>
Thanks,
Ren&eacute;.
</p>


<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Kapil Hari Paranjape [kapil at imsc.res.in]
</p>
</b><br />
<b>Wed, 8 Aug 2007 06:24:31 +0530</b>
</p>

<p>
Hello,
</p>

<p>
On Tue, 07 Aug 2007, Ren&eacute; Pfeiffer wrote:
</p>

<pre>
&gt; Real randomness is best retrieved from physical processes such as
&gt; radioactive decay or cosmis radiation.
</pre>

<p>
Actually, it turns out that "real randomness" is hard to verify. [*]
</p>

<p>
The best that one can hope for is "computationally random" which is
to say that no program will be able to distinguish between the given
choices and a "really random" choice in a reasonable amount of time.
</p>

<p>
This is essentially the same as Cryptographic Randomness and recent
results (see the talk by Avi Widgerson at ICM, Madrid last year) 
show that there is strong crypto if and only if there are good
random number generators.
</p>

<p>
Regards,
</p>

<p>
Kapil.
</p>

<p>
[*] This may be counting angels on the head of a pin but if something
cannot be computed then it cannot be experimentally verified and
hence (in the Popperian view) is not science. So one could assert
that Ren&eacute;'s statement quoted above is not scientific :D .
(I duck to avoid thrown shoes and tomatoes as I say this!)
</p>

<p>
--
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ren&eacute; Pfeiffer [lynx at luchs.at]
</p>
</b><br />
<b>Wed, 8 Aug 2007 09:37:02 +0200</b>
</p>

<p>
On Aug 08, 2007 at 0624 +0530, Kapil Hari Paranjape appeared and said:
</p>

<pre>
&gt; On Tue, 07 Aug 2007, Ren&eacute; Pfeiffer wrote:
&gt; &gt; Real randomness is best retrieved from physical processes such as
&gt; &gt; radioactive decay or cosmis radiation.
&gt;=20
&gt; Actually, it turns out that "real randomness" is hard to verify. [*]
</pre>

<p>
Using the words "real" and "reality" without quotes is asking for
trouble. Of course you are perfectly "right". ;)
</p>


<pre>
&gt; The best that one can hope for is "computationally random" which is
&gt; to say that no program will be able to distinguish between the given
&gt; choices and a "really random" choice in a reasonable amount of time.
</pre>

<p>
When attending the lectures about numerical mathematics long ago our
professor greeted us with the following statement: "Forget 0. 0 is a
fiction and only used in theoretical mathematics." Physicists might add
that Nature doesn't use 0 either.
</p>

<p>
So I agree with you about the computational problems. Hardware RNGs are
essentially analog-to-digital and have to omit information (and probably
randomness) by design.
</p>


<pre>
&gt; [...]
&gt; [*] This may be counting angels on the head of a pin but if something
&gt; cannot be computed then it cannot be experimentally verified and
&gt; hence (in the Popperian view) is not science. So one could assert
&gt; that Ren&eacute;'s statement quoted above is not scientific :D .
</pre>

<p>
Well, yes, but I was taking a shortcut (which is rather common when
programming). ;)
</p>

<p>
Best,
Ren&eacute;,
not throwing shoes or tomatoes.
</p>


<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
MNZ [mnzaki at gmail.com]
</p>
</b><br />
<b>Wed, 8 Aug 2007 15:31:53 +0300</b>
</p>

<p>
The collection is 300+ songs, not small enough. I count all the files
in the directory then choose a number from among them randomly (using
rand() and rounding), hmmm not very practical maybe. There is no
actuall "pattern", but it (is alive!) tends to choose a couple of
numbers then "randomly" choose from among them (ie. certain songs get
repeated, then the collection changes). But I think I understand
randomness now (!) so I guess checking if a song was played more than
$n times is a good idea.
</p>

<p>
Anyway, this script wasn't supposed to be put to practical use. But
having it on the rox context menu for directories is pretty cool for
when you are not sure about what you want to listen to. Plus (command
line) mplayer rules :P
</p>

<pre>-- 
//MNZ\\
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>
</b><br />
<b>Wed, 8 Aug 2007 12:21:08 -0400</b>
</p>

<p>
On Wed, Aug 08, 2007 at 03:31:53PM +0300, MNZ wrote:
</p>

<pre>
&gt; The collection is 300+ songs, not small enough. I count all the files
&gt; in the directory then choose a number from among them randomly (using
&gt; rand() and rounding), hmmm not very practical maybe. 
</pre>

<p>
It's not. You tend to lose the edge cases that way. <img src="../gx/smile.png" alt=":)"> There's a nifty
little "random picker" algorithm that I got from Randal Schwartz a while
ago - I don't think he invented it, but it works really well for
choosing a random line from a file:
</p>

<p>
<pre class="code">
perl -we'rand($.) &lt; 1 &amp;&amp; ($pick = $_) while &lt;&gt;; print $pick' file
</pre>
It's not quite as obvious as it could be, but it weights all the lines
equally and works well.
</p>


<pre>
&gt; There is no
&gt; actuall "pattern", but it (is alive!) tends to choose a couple of
&gt; numbers then "randomly" choose from among them (ie. certain songs get
&gt; repeated, then the collection changes). But I think I understand
&gt; randomness now (!) so I guess checking if a song was played more than
&gt; $n times is a good idea.
</pre>

<p>
You could also use a weighted algorithm, changing the weight for a given
song every time it's played. Here's a script with a sample list; it has
a one-second delay between picks so that there will be a delay between
songs - something that usually provided by playing a song.
</p>

<p>
<pre class="code">
#!/usr/bin/perl -w
# Created by Ben Okopnik on Tue Aug  7 22:51:38 EDT 2007
 
@songs = split /\n/, &lt;&lt;"Song_list";
/home/ben/Music/Vladimir Vysotsky - Humor/Mao Zedong.mp3
/home/ben/Music/Sea Shanties/Haul Away Joe Evans And Doherty.mp3
/home/ben/Music/NiN/I'm Afrraid Of Americans.mp3
/home/ben/Music/Sea Shanties/A-Rovin' Richard Burbank.mp3
/home/ben/Music/Elton John - Live in Australia/Madman Across The Water.mp3
/home/ben/Music/Great Big Sea - Road Rage/Hangin' Johnny.mp3
/home/ben/Music/ZZ Top/02. Sharp Dressed Man.mp3
/home/ben/Music/Ken Anoff - A Time To Drum/A Time To Drum.mp3
/home/ben/Music/Great Big Sea - Turn/Captain Wedderburn.mp3
Song_list
 
sub relative_weight {
	my ($weights) = shift;
	my ($total, %dist);
	$total += $_ for values %$weights;
	while (my ($key, $value) = each %$weights){
		$dist{$key} = $value / $total;
	}
	return \%dist;
}
 
sub roll_loaded_dice {
    my ($dist, $rand) = (shift, rand);
	for (keys %$dist){
		return $_ if ($rand -= $dist-&gt;{$_}) &lt; 0;
	}
}
 
$diff = time - 1;
$list{$_} = time - $diff for 0 .. $#songs;
 
for ($c = 2 * @songs; $c--; ){
	sleep 1;
	# $dist = relative_weight(\%list);
	$index = roll_loaded_dice(relative_weight(\%list));
	# Save the new time snapshot
	$list{$index} = 1/(time - $diff);
	print "$songs[$index]\n";
}
</pre>
This "remembers" when you played a given song, giving preference to the
oldest ones.
 
</p>

<pre>
&gt; Anyway, this script wasn't supposed to be put to practical use. But
&gt; having it on the rox context menu for directories is pretty cool for
&gt; when you are not sure about what you want to listen to. Plus (command
&gt; line) mplayer rules :P
</pre>

<p>
Agreed! I'm definitely a fan.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>
</b><br />
<b>Wed, 8 Aug 2007 13:09:03 -0400</b>
</p>

<p>
On Wed, Aug 08, 2007 at 12:21:08PM -0400, Benjamin Okopnik wrote:
</p>

<pre>
&gt; 
&gt;```
&gt; for ($c = 2 * @songs; $c--; ){
&gt; 	sleep 1;
&gt; 	# $dist = relative_weight(\%list);
&gt; 	$index = roll_loaded_dice(relative_weight(\%list));
&gt; 	# Save the new time snapshot
&gt; 	$list{$index} = 1/(time - $diff);
&gt; 	print "$songs[$index]\n";
&gt; }
&gt; '''
</pre>

<p>
Oh, whoops - that last part is a test loop (prints 2x as many random
picks as there are songs in the list.) If you actually want to use it,
you'll probably want to use a command-line argument to decide how many
songs you want from that list, and play the songs as the script picks
them:
</p>

<p>
<pre class="code">
# Command line arg or list length (validate arg as number)
$count = $ARGV[0] =~ /^\d+$/ ? $ARGV[0] : @songs;
 
while ($count--){
   $index = roll_loaded_dice(relative_weight(\%list));
   $list{$index} = 1/(time - $diff);
   # print "$songs[$index]\n";
   system '/usr/bin/mpg123', "$songs[$index]";
}
</pre>
<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
MNZ [mnzaki at gmail.com]
</p>
</b><br />
<b>Wed, 8 Aug 2007 21:01:45 +0300</b>
</p>

<p>
On 8/8/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
</p>

<pre>
&gt; On Wed, Aug 08, 2007 at 03:31:53PM +0300, MNZ wrote:
&gt; &gt; The collection is 300+ songs, not small enough. I count all the files
&gt; &gt; in the directory then choose a number from among them randomly (using
&gt; &gt; rand() and rounding), hmmm not very practical maybe.
&gt;
&gt; It's not. You tend to lose the edge cases that way. <img src="../gx/smile.png" alt=":)"> There's a nifty
&gt; little "random picker" algorithm that I got from Randal Schwartz a while
&gt; ago - I don't think he invented it, but it works really well for
&gt; choosing a random line from a file:
&gt;
&gt; ```
&gt; perl -we'rand($.) &lt; 1 &amp;&amp; ($pick = $_) while &lt;&gt;; print $pick' file
&gt; '''
</pre>


<pre>
&gt; It's not quite as obvious as it could be, but it weights all the lines
&gt; equally and works well.
</pre>

<p>
:-/ I don't get it, but won't the lines at the end have a lower chance
of being picked?
I mean the first line has a 99% chance of getting picked if I
understand rand() correctly. rand(1) has to return a fraction between
0 and 1 right?
I know the other 300 songs/lines still have a chance but much slimmer.
</p>


<pre>
&gt; You could also use a weighted algorithm, changing the weight for a given
&gt; song every time it's played. Here's a script with a sample list; it has
&gt; a one-second delay between picks so that there will be a delay between
&gt; songs - something that usually provided by playing a song.
</pre>
[snip]
</p>

<p>
Neat. I wouldn't actually mind songs being repeated but not at this
rate I'm getting.
</p>


<pre>
&gt; This "remembers" when you played a given song, giving preference to the
&gt; oldest ones.
&gt;
&gt; &gt; Anyway, this script wasn't supposed to be put to practical use. But
&gt; &gt; having it on the rox context menu for directories is pretty cool for
&gt; &gt; when you are not sure about what you want to listen to. Plus (command
&gt; &gt; line) mplayer rules :P
&gt;
&gt; Agreed! I'm definitely a fan.
</pre>

<p>
Note: Sorry about the last E-mail. That was an accident.
</p>

<p>
<p class="editorial">
[[[  Thanks for the heads up, MNZ. I went ahead and deleted it. - Kat  ]]]
</p>

<pre>-- 
//MNZ\\
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>
</b><br />
<b>Wed, 8 Aug 2007 15:04:10 -0400</b>
</p>

<p>
On Wed, Aug 08, 2007 at 09:01:45PM +0300, MNZ wrote:
</p>

<pre>
&gt; On 8/8/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
&gt; &gt; On Wed, Aug 08, 2007 at 03:31:53PM +0300, MNZ wrote:
&gt; &gt; &gt; The collection is 300+ songs, not small enough. I count all the files
&gt; &gt; &gt; in the directory then choose a number from among them randomly (using
&gt; &gt; &gt; rand() and rounding), hmmm not very practical maybe.
&gt; &gt;
&gt; &gt; It's not. You tend to lose the edge cases that way. <img src="../gx/smile.png" alt=":)"> There's a nifty
&gt; &gt; little "random picker" algorithm that I got from Randal Schwartz a while
&gt; &gt; ago - I don't think he invented it, but it works really well for
&gt; &gt; choosing a random line from a file:
&gt; &gt;
&gt; &gt; ```
&gt; &gt; perl -we'rand($.) &lt; 1 &amp;&amp; ($pick = $_) while &lt;&gt;; print $pick' file
&gt; &gt; '''
&gt; 
&gt; &gt; It's not quite as obvious as it could be, but it weights all the lines
&gt; &gt; equally and works well.
&gt; 
&gt; :-/ I don't get it, but won't the lines at the end have a lower chance
&gt; of being picked?
</pre>

<p>
That would be the "not as obvious as it could be" part. <img src="../gx/smile.png" alt=":)"> When I
understood it, I was just tickled pink by the neat algorithm. Here's
how it works:
</p>

<pre>
1. line 1: test 'rand(1)&lt;1' (100% chance: 'rand' always returns &lt;1)
2. line 2: test 'rand(2)&lt;1' (1/2 chance that line 2 will replace $pick)
3. line 3: test 'rand(3)&lt;1' (1/3 chance that line 3 will replace $pick)
...
</pre>
Pretty cool stuff.
</p>


<pre>
&gt; I mean the first line has a 99% chance of getting picked if I
&gt; understand rand() correctly. 
</pre>

<p>
100%, actually. The important thing is the chance of replacement on
every line; it ends up spreading out very fairly.
</p>


<pre>
&gt; rand(1) has to return a fraction between
&gt; 0 and 1 right?
</pre>

<p>
0 =&gt; x &lt; 1
</p>


<pre>
&gt; I know the other 300 songs/lines still have a chance but much slimmer.
</pre>

<p>
Spin it, say, a hundred times and look at the results. <img src="../gx/smile.png" alt=":)">
 
</p>

<pre>
&gt; &gt; You could also use a weighted algorithm, changing the weight for a given
&gt; &gt; song every time it's played. Here's a script with a sample list; it has
&gt; &gt; a one-second delay between picks so that there will be a delay between
&gt; &gt; songs - something that usually provided by playing a song.
&gt; [snip]
&gt; 
&gt; Neat. I wouldn't actually mind songs being repeated but not at this
&gt; rate I'm getting.
</pre>

<p>
Yep. That algorithm doesn't prevent previously-played songs from being
considered; it just decreases their chances of "winning" the roll.
 
</p>

<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
MNZ [mnzaki at gmail.com]
</p>
</b><br />
<b>Wed, 8 Aug 2007 22:11:59 +0300</b>
</p>

<p>
On 8/8/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
</p>

<pre>
&gt; &gt; &gt; ```
&gt; &gt; &gt; perl -we'rand($.) &lt; 1 &amp;&amp; ($pick = $_) while &lt;&gt;; print $pick' file
&gt; &gt; &gt; '''
&gt; &gt;
&gt; &gt; &gt; It's not quite as obvious as it could be, but it weights all the lines
&gt; &gt; &gt; equally and works well.
&gt; &gt;
&gt; &gt; :-/ I don't get it, but won't the lines at the end have a lower chance
&gt; &gt; of being picked?
&gt;
&gt; That would be the "not as obvious as it could be" part. <img src="../gx/smile.png" alt=":)"> When I
&gt; understood it, I was just tickled pink by the neat algorithm. Here's
&gt; how it works:
&gt;
&gt; ``
&gt; 1. line 1: test 'rand(1)&lt;1' (100% chance: 'rand' always returns &lt;1)
&gt; 2. line 2: test 'rand(2)&lt;1' (1/2 chance that line 2 will replace $pick)
&gt; 3. line 3: test 'rand(3)&lt;1' (1/3 chance that line 3 will replace $pick)
&gt; ...
&gt; ''
&gt;
&gt; Pretty cool stuff.
</pre>

<p>
Err but line 300 has a chance of only 1/300 of replacing $pick. Still
don't quite get
it, I'll eventually......
</p>


<pre>
&gt; &gt; I mean the first line has a 99% chance of getting picked if I
&gt; &gt; understand rand() correctly.
&gt;
&gt; 100%, actually. The important thing is the chance of replacement on
&gt; every line; it ends up spreading out very fairly.
&gt;
&gt; &gt; rand(1) has to return a fraction between
&gt; &gt; 0 and 1 right?
&gt;
&gt; 0 =&gt; x &lt; 1
&gt;
&gt; &gt; I know the other 300 songs/lines still have a chance but much slimmer.
&gt;
&gt; Spin it, say, a hundred times and look at the results. <img src="../gx/smile.png" alt=":)">
</pre>

<p>
Already done <img src="../gx/smile.png" alt=":)"> Had to wait another minute before checking my mail.
</p>

<pre>-- 
//MNZ\\
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>
</b><br />
<b>Wed, 8 Aug 2007 15:28:16 -0400</b>
</p>

<p>
On Wed, Aug 08, 2007 at 10:11:59PM +0300, MNZ wrote:
</p>

<pre>
&gt; On 8/8/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
&gt; &gt;
&gt; &gt; Pretty cool stuff.
&gt; 
&gt; Err but line 300 has a chance of only 1/300 of replacing $pick. Still
&gt; don't quite get
&gt; it, I'll eventually......
</pre>

<p>
Yes - but the chances for <em>any</em> line of both being picked and NOT being
replaced are equal. That's the trick to it. 
 
</p>

<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
MNZ [mnzaki at gmail.com]
</p>
</b><br />
<b>Wed, 8 Aug 2007 22:36:09 +0300</b>
</p>

<p>
On 8/8/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
</p>

<pre>
&gt; On Wed, Aug 08, 2007 at 10:11:59PM +0300, MNZ wrote:
&gt; &gt; On 8/8/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
&gt; &gt; &gt;
&gt; &gt; &gt; Pretty cool stuff.
&gt; &gt;
&gt; &gt; Err but line 300 has a chance of only 1/300 of replacing $pick. Still
&gt; &gt; don't quite get
&gt; &gt; it, I'll eventually......
&gt;
&gt; Yes - but the chances for <em>any</em> line of both being picked and NOT being
&gt; replaced are equal. That's the trick to it.
</pre>

<p>
Oh understood finally <img src="../gx/smile.png" alt=":)"> thanks.
</p>


<pre>-- 
//MNZ\\
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Neil Youngman [neil.youngman at youngman.org.uk]
</p>
</b><br />
<b>Wed, 8 Aug 2007 20:30:51 +0100</b>
</p>

<p>
On or around Wednesday 08 August 2007 20:11, MNZ reorganised a bunch of 
electrons to form the message:
</p>

<pre>
&gt; Err but line 300 has a chance of only 1/300 of replacing $pick. Still
&gt; don't quite get
&gt; it, I'll eventually......
</pre>

<p>
Given that there are 300 lines, what chance should it have?
</p>

<p>
Neil
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
MNZ [mnzaki at gmail.com]
</p>
</b><br />
<b>Wed, 8 Aug 2007 22:05:11 +0300</b>
</p>

<p>
On 8/8/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
</p>

<pre>
&gt; On Wed, Aug 08, 2007 at 03:31:53PM +0300, MNZ wrote:
&gt; &gt; The collection is 300+ songs, not small enough. I count all the files
&gt; &gt; in the directory then choose a number from among them randomly (using
&gt; &gt; rand() and rounding), hmmm not very practical maybe.
&gt;
&gt; It's not. You tend to lose the edge cases that way. <img src="../gx/smile.png" alt=":)"> There's a nifty
&gt; little "random picker" algorithm that I got from Randal Schwartz a while
&gt; ago - I don't think he invented it, but it works really well for
&gt; choosing a random line from a file:
&gt;
&gt; ```
&gt; perl -we'rand($.) &lt; 1 &amp;&amp; ($pick = $_) while &lt;&gt;; print $pick' file
&gt; '''
</pre>

<p>
<pre class="code">
#!/usr/bin/perl -w
## MNZ
 
$n = 10000;
 
for(1..$n){
	my ($pick,$i);
	## Line in Question
	rand($i) &lt; 1 &amp;&amp; ($pick = $i) while(++$i &amp;&amp; $i &lt; 6);
	$result{$pick}++ if $pick;
}
 
foreach (keys %result){print "$_: " . $result{$_}/$n*100 . "%\n";}
</pre>
Just couldn't resist. And it does come out pretty even.
<pre>-- 
//MNZ\\
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-random_numbers">Back</a><hr width="50%" align="left" /><p><br /></p></div>
</body>
</html>