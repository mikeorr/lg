<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<title>Help with Bash script</title>
<link rel="stylesheet" type="text/css" href="../../../lg.css" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
</head>
<body>
<a href="../../../"><img alt="Linux Gazette" src="../../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" /></a><img alt="Tux" src="../../../gx/tux_86x95_indexed.png" id="tux" /><p id="fun">...making Linux just a little more fun!</p><div class='content articlecontent'><a name="top"></a><h3>Help with Bash script</h3>
<p>
<b><p>
Chiew May Cheong [chiew_may at hotmail.com]
</p>
</b><br />
<b>Tue, 26 Jun 2007 05:19:29 +0000</b>
</p>

<p>
I have got a bash script called del_level0.sh that runs every Friday
that looks like this:
</p>

<pre>
#!/bin/bash
cd /u1/database/prod/level0
rm *
</pre>
There's a cron entry for this script that runs every Friday:
</p>

<pre>
linux:/usr/local/bin # crontab -l
 
# DO NOT EDIT THIS FILE - edit the master and reinstall.
# (/tmp/crontab.XXXXvi5yHq installed on Tue Jun 26 14:13:04 2007)
# (Cron version V5.0 -- $Id: crontab.c,v 1.12 2004/01/23 18:56:42 vixie Exp $)
0 15 * * 5 /usr/local/bin/del_level0.sh &gt; /dev/null 2&gt;&amp;1
</pre>
Can you help me so that the script runs at 3pm every 2nd and 4th Friday of the month?
</p>

<p>
Thanks.
</p>

<p>
Regards,
</p>

<p>
Chiew May
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-help_with_bash_script">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ramanathan Muthaiah [rus.cahimb at gmail.com]
</p>
</b><br />
<b>Tue, 26 Jun 2007 11:04:05 +0530</b>
</p>

<pre>
&gt; Can you help me so that the script runs at 3pm every 2nd and 4th Friday of
&gt; the month?
</pre>

<p>
Running, "info crontab" or "man crontab", should provide the details.
</p>

<p>
/Ram
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-help_with_bash_script">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Thomas Adam [thomas.adam22 at gmail.com]
</p>
</b><br />
<b>Tue, 26 Jun 2007 06:43:09 +0100</b>
</p>

<p>
On 26/06/07, Chiew May Cheong &lt;chiew_may@hotmail.com&gt; wrote:
</p>

<pre>
&gt; I have got a bash script called del_level0.sh that runs every Friday that
&gt; looks like this:
</pre>


<pre>
&gt; #!/bin/bash
&gt; cd /u1/database/prod/level0
&gt; rm *
</pre>

<p>
Hmm.  Presumably there's no directories under there.  What if the
number of files increases?  The globbing will soon fail after that.
Better off:
</p>

<pre>
find . -type f -print0 | xargs -0 rm
</pre>
That would recurse though.  If you wanted to restrict to that to just
the one directory (which is what the glob would do):
</p>

<pre>
find . -type f -maxdepth 1 -print0 | xargs -0 rm
</pre>

<pre>
&gt; There's a cron entry for this script that runs every Friday:
&gt;
&gt; 0 15 * * 5 /usr/local/bin/del_level0.sh &gt; /dev/null 2&gt;&amp;1
&gt;
&gt; Can you help me so that the script runs at 3pm every 2nd and 4th Friday of
&gt; the month?
</pre>

<p>
Vixie Cron won't let you do this, however, you could do something like this:
</p>

<pre>
3 15 7-14, 21-30 * 5 test 'date +\%a' != Fri ||
/usr/local/bin/del_level0.sh &gt; /dev/null 2&gt;&amp;1
</pre>
The idea here is that we try and restrict the range of dates the 2nd
and 4th Friday in any given month can be in by checking for Fri in
that range.
</p>

<pre>-- 
Thomas Adam
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-help_with_bash_script">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>
</b><br />
<b>Tue, 26 Jun 2007 16:33:58 -0400</b>
</p>

<p>
On Tue, Jun 26, 2007 at 06:43:09AM +0100, Thomas Adam wrote:
</p>

<pre>
&gt; On 26/06/07, Chiew May Cheong &lt;chiew_may@hotmail.com&gt; wrote:
&gt; 
&gt; &gt; There's a cron entry for this script that runs every Friday:
&gt; &gt;
&gt; &gt; 0 15 * * 5 /usr/local/bin/del_level0.sh &gt; /dev/null 2&gt;&amp;1
&gt; &gt;
&gt; &gt; Can you help me so that the script runs at 3pm every 2nd and 4th Friday of
&gt; &gt; the month?
&gt; 
&gt; Vixie Cron won't let you do this, however, you could do something like this:
&gt; 
&gt; ``
&gt; 3 15 7-14, 21-30 * 5 test 'date +\%a' != Fri ||
&gt; /usr/local/bin/del_level0.sh &gt; /dev/null 2&gt;&amp;1
&gt; ''
&gt; 
&gt; The idea here is that we try and restrict the range of dates the 2nd
&gt; and 4th Friday in any given month can be in by checking for Fri in
&gt; that range.
</pre>

<p>
You could also split the job between the script and the cronjob instead
of trying to make it all happen in one place.
</p>

<pre>
# In the crontab
3 15 7-14, 21-30 * 5 /usr/local/bin/del_level0.sh &gt; /dev/null 2&gt;&amp;1
 
# In the script
[ `/bin/date +%a` == 'Fri' ] || exit
</pre>
<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-help_with_bash_script">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Thomas Adam [thomas.adam22 at gmail.com]
</p>
</b><br />
<b>Tue, 26 Jun 2007 23:44:53 +0100</b>
</p>

<p>
On 26/06/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
</p>

<pre>
&gt;
&gt; You could also split the job between the script and the cronjob instead
&gt; of trying to make it all happen in one place.
</pre>

<p>
Yes, you could, but so what?  It's only one line that doesn't do
anything complex, the only real caveat is to remember to escape the
percent signs to the date command.
</p>

<pre>-- 
Thomas Adam
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-help_with_bash_script">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>
</b><br />
<b>Tue, 26 Jun 2007 22:54:53 -0400</b>
</p>

<p>
On Tue, Jun 26, 2007 at 11:44:53PM +0100, Thomas Adam wrote:
</p>

<pre>
&gt; On 26/06/07, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
&gt; &gt;
&gt; &gt; You could also split the job between the script and the cronjob instead
&gt; &gt; of trying to make it all happen in one place.
&gt; 
&gt; Yes, you could, but so what?  It's only one line that doesn't do
&gt; anything complex, the only real caveat is to remember to escape the
&gt; percent signs to the date command.
</pre>

<p>
Which, in my opinion, makes it more complex than it needs to be.
Intermixing two different syntaxes when it's unnecesary does not seem
like a reasonable approach.
</p>

<p>
In the case that I demonstrated, 'cron' does its job and interprets its
own syntax, and Bash does its part; that makes any problems easier to
troubleshoot. Incidentally, the redirect to /dev/null is also most
likely unnecessary - 'cron' doesn't run in a terminal.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-help_with_bash_script">Back</a><hr width="50%" align="left" /><p><br /></p></div>
</body>
</html>