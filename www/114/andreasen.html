
<html>
<head>
<link href="../lg.css" rel="stylesheet" type="text/css" media="screen, projection"  />
<link rel="shortcut icon" href="../favicon.ico" />
<title>Python for scientific use. Part I: Data Visualization LG #114</title>

<style type="text/css" media="screen, projection">
<!--

-->
</style>

<link rel="alternate" type="application/rss+xml" title="LG RSS" href="lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="lg.rdf" />
<link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" />

</head>

<body>


<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
<p id="fun">...making Linux just a little more fun!</p>


<div class="content articlecontent">

<div id="previousnexttop">
<A HREF="lg_bytes.html" >&lt;-- prev</A> | <A HREF="dyckoff.html" >next --&gt;</A>
</div>



<h1>Python for scientific use. Part I: Data Visualization</h1>
<p id="by"><b>By <A HREF="../authors/andreasen.html">Anders Andreasen</A></b></p>

<p>
<h2>Motivation and outline</h2>

<p>A first step towards qualitative understanding and
interpretation of scientific data is visualization of the data.
Also, in order to reach a quantitative understanding, the data
needs to be analyzed, e.g. by fitting a physical model to the data.
The raw data may also require some initial processing in order to
become useful, e.g. filtering, scaling, calibration etc.</p>

<p>Several open source programs for data analysis and visualization
exist: <a href="http://www.gnuplot.info">gnuplot</a>, <a href=
"http://plasma-gate.weizmann.ac.il/Grace/">grace</a>, <a href=
"http://www.octave.org">octave</a>, <a href=
"http://www.r-project.org">R</a>, and <a href=
"http://scigraphica.sourceforge.net/">scigraphica</a>. Each of
these has its own pros and cons. However, it seems like you always
end up using more than one program to cover all the different needs
mentioned above, at least if you don't have the programming
abilities to write your own custom programs using e.g., Fortran or
C.</p>

<p>Recently, I came across <a href=
"http://www.python.org">Python</a> and found it to be a very
powerful tool. In this article, I would like to share my experience
and illustrate that even with basic (or less) programming skills it
is still possible to create some very useful applications for data
analysis and visualization using this language. The article is
centered around a few illustrative examples and covers the
visualization part &mdash; data analysis will be covered in a
future article.</p>

<h2>Python: a brief review</h2>

<p>Python was originally created by Guido van Rossum and is an
interpreted programming language (like e.g. Perl) with a clear and
easy-to-read syntax. You can write stand-alone applications with
Python, but one of it's strengths is its ability to act as glue
between different kinds of programs.</p>

<p>The standard introduction to any programming language is the
<em>Hello world!</em> program. In Python this is generated by first
opening the Python interpreter by typing <code>python</code> on the
command line. Your screen should look something like this:</p>

<pre class="code">
Python 2.3.4 (#1, Jan 21 2005, 11:24:24)
[GCC 3.3.3 20040412 (Gentoo Linux 3.3.3-r6, ssp-3.3.2-2, pie-8.7.6)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt;
</pre>
Then the following code is typed:

<pre class="code">
print "Hello world!"
</pre>

<p>Python code can also be stored in a file e.g. named
<code>script.py</code>. By convention, files containing python code
have a <code>*.py</code> extension. The script can be executed by
typing <code>python script.py</code> on the command line. The
program output will then be written to stdout and appear on the
screen. If the following line is added to the top of the file:</p>

<pre class="code">
#! /usr/bin/python
</pre>

<p>(assuming that the python executable or a symlink to it exists)
and giving the file executable mode with <code>chmod u+x
script.py</code> the script can be executed by typing
<code>./script.py</code> on the command line.</p>

<p>Python comes with many modules, either built-in or available for
separate download and installation. In this article we will use
<a href="http://www.scipy.org">SciPy</a>, which is a very powerful
library of modules for data visualization, manipulation and
analysis. It adds functionality to Python making it comparable to
e.g. octave and matlab.</p>

<h2>Plotting 2-D data</h2>

<h3>Example 1: Plotting x,y data</h3>

<p>The first example illustrates plotting a 2-D dataset. The data
to be plotted is included in the file <a href=
"misc/andreasen/tgdata.dat">tgdata.dat</a> and represents weight
loss (in wt. %) as a function of time. The plotting routine is in
the file <a href="misc/andreasen/tgdata.py.txt">tgdata.py</a> and
the python code is listed below. Line numbers have been added for
readability.</p>

<pre class="code">
     1  from scipy import *
     2
     3  data=io.array_import.read_array('tgdata.dat')
     4  plotfile='tgdata.png'
     5
     6  gplt.plot(data[:,0],data[:,1],'title "Weight vs. time" with points')
     7  gplt.xtitle('Time [h]')
     8  gplt.ytitle('Hydrogen release [wt. %]')
     9  gplt.grid("off")
    10  gplt.output(plotfile,'png medium transparent picsize 600 400')
</pre>

<p>To run the code, download the <a href=
"misc/andreasen/tgdata.py.txt">tgdata.py.txt</a> file, rename it
to <code>tgdata.py</code>, and run it with <code>python
tgdata.py</code>. Besides Python, you also need SciPy and gnuplot
installed. Gnuplot version 4.0 was used throughout this article.
The output of the program is a plot to screen as shown below. 
<!-- 29Apr2005 dsrich The original text of this next sentence was "A hard copy is also made." -->
The plot is also saved to disk as <code>tgdata.png</code> per line
4 above. <!--  --></p>
<img src="misc/andreasen/tgdata.png" alt="2-D TG data" width="600"
height="400">
<p>In line 1, everything from the SciPy module is imported. In order
to make use of the various functions of a module, the module needs
to be imported by adding an <code>import module-name</code> line to
the the python script. In this case it might have been sufficient
to import only the <code>gplt</code> package and the
<code>io.array_import</code> package. In line 3 the
<code>io.array_import</code> package is used to import the data
file <code>tgdata.dat</code> into the variable called
<code>data</code> as an array with the independent variable stored
in column 0 (note that array indices start with 0 as in C unlike
Fortran/Octave/Matlab where it starts at 1) and the dependent
variable in column 1. In line 4 a variable containing the file name
(a string) to which the plot should be stored. In line 6-10 the
<code>gplt</code> package is used as an interface to drive gnuplot.
Line 6 tells gnuplot to use column 0 as x-values and column 1 as
y-values. The notation <code>data[:,0]</code> means: use/print all
rows in column 0. On the other hand <code>data[0,:]</code> refers
to all columns in the first row.</p>
<!-- 29Apr2005 dsrich - This paragraph split from the paragraph above the
previous graphic and moved here (program discussion) for clarity. I am
also assuming that here is referring to the build options of gnuplot 
in his talking about libpng/zlibc/libgd. -->

<p>The gnuplot png option <code>picsize</code> can be a little
tricky. The example shown above works when Gnuplot is built with
<code>libpng + zlib</code>. If you have Gnuplot built with
<code>libgd</code> the required syntax becomes <code>size</code>
and the specified width and height should be comma separated.</p>

<p>In order to plot a file with a different file name, we have to
open the python source in a text editor and manually change the
name of the file to be imported. We also need to change the name of
the file copy if we do not want to overwrite the previous plot.
This is a little tedious. We can easily add this functionality to
our python script by allowing filenames to be passed as command
line arguments. The modified script is called <a href=
"misc/andreasen/tgdata1.py.txt">tgdata1.py</a> and is shown
below.</p>

<pre class="code">
     1  import sys, glob
     2  from scipy import *
     3
     4  plotfile = 'plot.png'
     5
     6  if len(sys.argv) &gt; 2:
     7          plotfile = sys.argv[2]
     8  if len(sys.argv) &gt; 1:
     9          datafile = sys.argv[1]
    10  else:
    11          print "No data file name given. Please enter"
    12          datafile = raw_input("-&gt; ")
    13  if len(sys.argv) &lt;= 2:
    14          print "No output file specified using default (plot.png)"
    15  if len(glob.glob(datafile))==0:
    16          print "Data file %s not found. Exiting" % datafile
    17          sys.exit()
    18
    19  data=io.array_import.read_array(datafile)
    20
    21  gplt.plot(data[:,0],data[:,1],'title "Weight vs. time" with points')
    22  gplt.xtitle('Time [h]')
    23  gplt.ytitle('Hydrogen release [wt. %]')
    24  gplt.grid("off")
    25  gplt.output(plotfile,'png medium transparent picsize 600 400')
</pre>

<p>In the first line we have imported two new modules &mdash;
<code>sys</code> and <code>glob</code> &mdash; in order to add the
desired flexibility. In Python, <code>sys.argv</code> contains the
command line arguments when execution starts.
<code>sys.argv[0]</code> contains the filename of the python script
executed, <code>sys.argv[1]</code> contains the first command line
argument, <code>sys.argv[2]</code> contains the second command line
argument and so on. The <code>glob.glob()</code> function behaves
as <code>ls</code> in *nix environments in that it supplies
filename wildcarding. If no matches are found it returns the empty
list (and thus has a len() of zero), otherwise it contains a list
of matching filenames. The script can be executed with any desired
number of command line arguments. If executed with two arguments
e.g. <code>python tgdata1.py tgdata.dat tgdata1.png</code> the
first argument is the name of the file containing the data to be
plotted, and the second argument is the desired name of the file
copy of the plot.</p>

<p>The script works as follows. A default file name for the hard
copy of the plot is stored in the variable <code>plotfile</code>
(line 4). Then some conditions about the number of given command
line arguments are checked. First, if two or more command line
arguments are given <code>plotfile</code> is overwritten with
argument no. 2 (line 6-7.) Any arguments after the second are
silently ignored. For 1 or more arguments given argument 1 is used
as the data file name (line 8-9). If no command line arguments are
passed, the user is prompted to input the name of the data file
(line 10-12). In case of an invalid file name being used for the
data file the script prints an error message and exits.</p>

<h3>Example 2: Plotting x,y data with error bars</h3>

<p>So far we have shown that the <code>gplt</code> package is easy
to interface with gnuplot and very effective. However, for
scientific use it is often desirable to represent uncertainties for
each data point. Although this is possible in gnuplot the
<code>gplt</code> interface lacks this functionality. Instead we
use the <code>popen</code> package included in the <code>os</code>
module. With <code>popen</code> it is possible connect to the stdin
(or stdout) of a program through a pipe.</p>

<p>The code below (also available in <a href=
"misc/andreasen/xrddata.py.txt">xrddata.py.txt</a>, the data file
is available as <a href=
"misc/andreasen/xrddata.dat">xrddata.dat</a>) more or less shows
how example 1 is reproduced using <code>popen</code> instead of the
<code>gplt</code> package. The major difference is the fact that
with <code>popen</code> it is not necessary to import the data to
be plotted into Python - instead it is read directly by
gnuplot.</p>

<pre class="code">
     1  import os
     2
     3  DATAFILE='xrddata.dat'
     4  PLOTFILE='xrddata.png'
     5  LOWER=35
     6  UPPER=36.5
     7
     8  f=os.popen('gnuplot' ,'w')
     9  print &gt;&gt;f, "set xrange [%f:%f]" % (LOWER,UPPER)
    10  print &gt;&gt;f, "set xlabel 'Diffraction angle'; set ylabel 'Counts [a.u.]'"
    11  print &gt;&gt;f, "plot '%s' using 1:2:(sqrt($2)) with errorbars title 'XRPD data' lw 3" % DATAFILE
    12  print &gt;&gt;f, "set terminal png large transparent size 600,400; set out '%s'" % PLOTFILE
    13  print &gt;&gt;f, "pause 2; replot"
    14  f.flush()
</pre>

<p>The code of example 2 produces the output shown below. The error
bar plot is created with <code>plot 'filename' using 1:2:(sqrt($2))
with errorbars</code> because in <a href=
"misc/andreasen/xrddata.dat">xrddata.dat</a> the standard
deviations are equal to the square root of the y-values. This is a
special case and usually errors are given explicitly as a third
data column in the data file. Thus, an error bar plot is created
with <code>plot 'filename' using 1:2:3 with errorbars</code>.</p>
<img src="misc/andreasen/xrddata.png" alt="2-D XRPD data" width=
"600" height="400">
<h2>Plotting 3D-data</h2>

<h3>Example 3:</h3>

<p>Now we look at how 3-D data can be represented by using a
combination of Python/gnuplot. In order for gnuplot to represent
3-D data it requires that the data is either given by a
mathematical expression or stored in a data file. The data file
should have either a <em>matrix</em>-format where z-values are
given as a matrix with x and y equal to the row and column number,
respectively, corresponding to each z-value or a 3 column format
where each row represents a data triple with x, y, and z given by
the 1., 2., and 3. column respectively. See the <a href=
"http://www.gnuplot.info/docs/gnuplot.html#data-file_">gnuplot
manual</a> for further details.</p>

<p>The data to be represented in a 3-D fashion in this example is
actually a collection of 2-D data files (like the one shown in
example 2). Each data file corresponds to an experiment at a
different time (with 150 s intervals between experiments) so we
have two independent variables and one dependent variable: x(file
number/time), y (diffraction angle),and z(counts) distributed
across several files. This makes the 3-D data not suitable for
plotting &mdash; <em>yet</em>.</p>

<p>The script <a href=
"misc/andreasen/3ddata_1.py.txt">3ddata_1.py</a> shown below finds
all files with a given extension (*.x_y in this case) in the
current working directory and creates a list containing their file
names (line 5, <code>FILELIST</code>). In line 6 the number of data
rows in each file is determined (<code>SIZEX</code>). This
information, including the number of data files, is then used to
construct an array (<code>DATAMATRIX</code>) with a size of
<code>SIZEX</code> by <code>len(FILELIST)</code>. In lines 11-12 we
cycle through the data files copying the second column in datafile
number y is copied to column number y in <code>DATAMATRIX</code>.
The array now holds all z-values. This array is only temporary,
suitable for data processing before the actual data file for the
3-D plotting is written.</p>

<p>In line 14-22 the data file is written in the (x,y,z) format
with x corresponding to time (found by multiplying the file number
with the time step), y corresponding to diffraction angle as given
by <code>TWOTHETA</code>, z corresponding to counts. In this case
we only want to plot the data with diffraction angles between 35-60
(corresponding to data rows 1126-1968). Therefore, only this range
is written to file in order to speed up both the process of writing
to file and the plotting. In line 24-29 gnuplot is fed input using
the <code>popen</code> package.</p>

<pre class="code">
     1  import os, glob
     2  from scipy import *
     3
     4  EXT='*.x_y'
     5  FILELIST=glob.glob(EXT)
     6  SIZEX = len(io.array_import.read_array(FILELIST[0]))
     7  DATAMATRIX = zeros((SIZEX,len(FILELIST)), Float)
     8  TWOTHETA=io.array_import.read_array(FILELIST[0])[:,0]
     9  TIMESTEP=150
    10
    11  for y in range(len(FILELIST)):
    12                  DATAMATRIX[:,y]=sqrt(io.array_import.read_array(FILELIST[y])[:,1])
    13
    14  file = open("3ddata.dat", "w")
    15
    16  for y in range(len(FILELIST)):
    17          for x in range(1126,1968):
    18                  file.write(repr(TIMESTEP*y)+" "\
    19                  +repr(TWOTHETA[x])+" "+repr(DATAMATRIX[x,y]))
    20                  file.write("\n")
    21          file.write("\n")
    22  file.close()
    23
    24  f=os.popen('gnuplot' ,'w')
    25  print &gt;&gt;f, "set ticslevel 0.0 ;set xlabel 'Time [s]'; set ylabel 'Diffraction angle'"
    26  print &gt;&gt;f, "set pm3d; unset surface; set view 60,75; splot '3ddata.dat' notitle"
    27  print &gt;&gt;f, "set terminal png large transparent size 600,400; set out '3ddata_1.png'"
    28  print &gt;&gt;f, "replot"
    29  f.flush()
</pre>

<p>If you wanted to write a 3-D data file in the
<em>matrix</em>-format, lines 14 through 22 can be replaced with
the following code.</p>

<pre class="code">
file = open("3ddata_matrix.dat", "w")
for x in range(SIZEX):
        for y in range(len(FILELIST)):
                file.write(repr(DATAMATRIX[x,y])+" ")
        file.write("\n")
file.close()
</pre>

<p>The 3-D plot produced by the above script is shown below.</p>
<img src="misc/andreasen/3ddata_1.png" alt="3-D (pseudo) XRPD data"
width="600" height="500">
<p>The plot above shows that it can be difficult to produce a 3-D
plot of non-monotonic data that shows all of the details of the
data &mdash; some of the smaller peaks are hidden behind larger
peaks. It is also difficult to see changes in peak positions as a
function of time. In order to bring out these details it is
sometimes better to create a 2-D contour plot by projecting the
z-values down into the x,y plane. This is achieved by replacing
lines 24-29 of <a href=
"misc/andreasen/3ddata_1.py.txt">3ddata_1.py</a> with the code
below (<a href=
"misc/andreasen/3ddata_2.py.txt">3ddata_2.py</a>).</p>

<pre class="code">
f=os.popen('gnuplot' ,'w')
print &gt;&gt;f, "set pm3d map; set palette rgbformulae 30,31,32; set xrange[0:4500]"
print &gt;&gt;f, "set xlabel 'Time [s]'; set ylabel 'Diffraction angle'"
print &gt;&gt;f, "splot '3ddata.dat' notitle"
print &gt;&gt;f, "set terminal png large transparent size 600,500; set out '3ddata.png'"
print &gt;&gt;f, "replot"
f.flush()
</pre>

<p>The contour plot is shown below.</p>

<img src="misc/andreasen/3ddata_2.png" alt="3-D (pseudo) XRPD data"
width="600" height="500">

<p>The 3-D example plots were made with 39 data files, each containing 4096
data rows. The data files are available at this <a
href="http://andr.dk/wiki/index.php/Supplementary_material#Linux_gazette_114">offsite
link</a>, and can be unpacked with <code>tar xvfz 3ddata.tar.gz</code>.
</p>

<h2>Summary</h2>

<p>In this article a few examples have been given in order to
illustrate that Python is indeed a powerful tool for visualization
of scientific data by combining the plotting power of gnuplot with
the power of a real programming language. It should be noted that
all the examples given here could probably have been solved with a
combination of e.g. <code>bash</code>, <code>gawk</code> and
gnuplot. It appears to me that Python is much simpler and the
resulting scripts are more transparent and easy to read and
maintain. If heavy data processing is required the
bash/gawk/gnuplot might also need the added functionality of e.g.
octave. With Python this functionality is in SciPy.</p>

<h2>Suggestions for further reading</h2>

<p>Manuals, Tutorials, Books etc:</p>

<ol>
<li>Guido van Rossum, <em>Python tutorial</em>, <a href=
"http://docs.python.org/tut/tut.html">http://docs.python.org/tut/tut.html</a></li>

<li>Guido van Rossum, <em>Python library reference</em>, <a href=
"http://docs.python.org/lib/lib.html">http://docs.python.org/lib/lib.html</a></li>

<li>Mark Pilgrim, <em>Dive into Python</em>, <a href=
"http://diveintopython.org/toc/index.html">http://diveintopython.org/toc/index.html</a></li>

<li>Thomas Williams &amp; Colin Kelley, <em>Gnuplot - An
Interactive Plotting Program</em>, <a href=
"http://www.gnuplot.info/docs/gnuplot.html">http://www.gnuplot.info/docs/gnuplot.html</a></li>

<li>Travis E. Oliphant, <em>SciPy tutorial</em>, <a href=
"http://www.scipy.org/documentation/tutorial.pdf">http://www.scipy.org/documentation/tutorial.pdf</a></li>

<li>David Ascher, Paul F. Dubois, Konrad Hinsen, Jim Hugunin and
Travis Oliphant, <em>Numerical Python</em>, <a href=
"http://numeric.scipy.org/numpydoc/numdoc.htm">http://numeric.scipy.org/numpydoc/numdoc.htm</a></li>
</ol>

<p>See also <a href=
"http://www.google.com/search?q=Python+&amp;btnG=Google+Search&amp;domains=linuxgazette.net&amp;sitesearch=linuxgazette.net">
previous articles</a> about Python published in <em><a href=
"http://www.linuxgazette.net">LG</a></em>.</p>

<h2>Other graphical libraries for Python</h2>

<p>Gnuplot version 4.0 has been used in the examples throughout
this article. Python also works with other plotting
engines/libraries:</p>

<ol>
<li>Grace, see <a href=
"http://www.idyll.org/~n8gray/code/">http://www.idyll.org/~n8gray/code/</a></li>

<li>PGPLOT, see <a href=
"http://efault.net/npat/hacks/ppgplot/">http://efault.net/npat/hacks/ppgplot/</a></li>

<li>PLplot, see <a href=
"http://www.plplot.org/">http://www.plplot.org/</a></li>

<li>matplotlib, see <a href=
"http://matplotlib.sourceforge.net/">http://matplotlib.sourceforge.net/</a>
(library specifically made for Python)</li>
</ol>


</p>


<!-- *** BEGIN author bio *** -->
<P>&nbsp;
<P>
<!-- *** BEGIN bio *** -->
<hr>
<p>

<img align="left" alt="[BIO]" src="../gx/authors/andreasen.jpg" class="bio">

<em>

<p> Anders has been using Linux for about 6 years. He started out with RH
6.2, moved on to RH 7.0, 7.1, 8.0, Knoppix, has been experimenting a little
with Mandrake, Slackware, and FreeBSD, and is now running Gentoo on his
workstation (no dual boot :-) at work and Debian Sarge on his laptop at
home. Anders has (a little) programming experience in C, Pascal, Bash,
HTML, LaTeX, Python, and Matlab/Octave.  

<p> Anders has a Masters degree in Chemical Engineering and is currently
employed as a Ph.D. student at the Materials Research Department, Ris&ouml;
National Laborary in Denmark. Anders is also the webmaster of <a
href="http://www.risoe.dk/afm/hydrogen">Hydrogen storage at Ris&ouml;</a>.


</em>
<br clear="all">
<!-- *** END bio *** -->

<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2005, Anders Andreasen. Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication license</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 114 of Linux Gazette, May 2005
</p>

</div>


<div id="previousnextbottom">
<A HREF="lg_bytes.html" >&lt;-- prev</A> | <A HREF="dyckoff.html" >next --&gt;</A>
</div>


</div>






<div id="navigation">

<a href="../index.html">Home</a>
<a href="../faq/index.html">FAQ</a>
<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="../contact.html">Contact Us</a>

</div>



<div id="breadcrumbs">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">May 2005 (#114)</a> &gt; 
Article

</div>





<img src="../gx/2003/sit3-shine.7-2.gif" id="tux" alt="Tux"/>




</body>
</html>

