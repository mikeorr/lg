
<html>
<head>
<link href="../lg.css" rel="stylesheet" type="text/css" media="screen, projection"  />
<link rel="shortcut icon" href="../favicon.ico" />
<title>Mailbag LG #131</title>

<style type="text/css" media="screen, projection">
<!--

-->
</style>

<link rel="alternate" type="application/rss+xml" title="LG RSS" href="lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="lg.rdf" />
<link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" />

</head>

<body>

<a href="/">
<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
</a>
<p id="fun">...making Linux just a little more fun!</p>


<div class="content articlecontent">

<div id="previousnexttop">
<A HREF="lg_talkback.html" >next --&gt;</A>
</div>



<h1>Mailbag</h1>


<div class="mb-mailbag">
<hr />
<h2>Mailbag</h2>
<a href="#mailbag.01">Piet Programming</a>
<br />
<a href="#mailbag.02">[TAG] Locking down a Linux box</a>
<br />
<a href="#mailbag.03">Talkback links should CC article author</a>
<br />
<a href="#mailbag.04">Confusion about linux fonts</a>
<br />
<a href="#mailbag.05">FVWM Kiosk - a different approach</a>
<br />
<a href="#mailbag.06">How to convert RedHat9 to Gentoo over SSH on a live system</a>
<br />
<a href="#mailbag.07">State of the anti-spam regime, July 2006 edition</a>
<br />
<a href="#mailbag.08">Wiring a house with ethernet: Success</a>
<br />
<a href="#mailbag.09">Linux driver question</a>
<br />
<a href="#mailbag.10">USB Hard Drives</a>
<br />
<a href="#mailbag.11">New URL for GLUE - Groups of Linux Users Everywhere </a>
<br />
<a href="#mailbag.12">Copyright Notice</a>
<br />
<a href="#mailbag.13">Nullmodem</a>
<br />
<a href="#mailbag.14">The all new Ubuntu.... Did I say something wrong?</a>
<br />
<a href="#mailbag.15">I will nead a little help or more!!!!!!</a>
<br />
<a href="#mailbag.16">Kernel tweaking</a>
<br />
<a href="#mailbag.17">Invisible Read!!</a>
<br />
<a href="#mailbag.18">Port Linux on DSP</a>
<br />
<a href="#mailbag.19">Which process wrote that line into syslog? </a>
<br />
<a href="#mailbag.20">Which process wrote that line into syslog? [2]</a>
<br />
 
</div><div class="mb-mailbag"><hr />
<a name="mailbag.01"></a>
<h3>Piet Programming</h3>
 
 <p>Thomas Adam (thomas at edulinux.homeunix.org) 
 <br /> 
 Mon May 29 18:46:27 PDT 2006</p> 
 <em>Answered by:  Kapil, Pedja, Thomas</em> 
 
<strong>
<p>
Hello,
</p>

<p>
I was reading the esoteric hello-world page <a name="piet.html_1_back"></a><a href="#piet.html_1">[1]</a> when it
mentioned a very
obscure language called piet <a name="piet.html_2_back"></a><a
href="#piet.html_2">[2]</a>.  I have to say I have never heard of
it until now --- little pictures to represent programs.   And they're
colourful.  :D  Go take a look, it's quite clever.
</p>

<p>
-- Thomas Adam
</p>

<p>
<a name="piet.html_1"></a><a href="#piet.html_1_back">[1]</a>
<a href="http://en.wikipedia.org/wiki/Hello_world_program_in_esoteric_languages">http://en.wikipedia.org/wiki/Hello_world_program_in_esoteric_languages</a><br>
<a name="piet.html_2"></a><a href="#piet.html_2_back">[2]</a>
<a href="http://www.dangermouse.net/esoteric/piet.html">http://www.dangermouse.net/esoteric/piet.html</a>
</p>
</strong>


<p>
[Kapil] - How about "Ook!"? That would make all readers of Terry Pratchett
happier.
</p>

<strong>
<p>
[Thomas] - Nah -- I never did like him.   This does look interesting
however:
</p>
</strong>

<blockquote>
<p>
<a href="http://en.wikipedia.org/wiki/Chef_programming_language">http://en.wikipedia.org/wiki/Chef_programming_language</a>
</p>
<p>
<strong>:)</strong>
</p>
</blockquote>

<p>
[Pedja] - If you'd like to see Web or e-mail as spoken by Chef, checkout
Bork Bork Bork extension for Firefox/Thunderbird :) 
</p>

<blockquote>
<p>
<a href="http://www.snert.com/">http://www.snert.com/</a><br>
<a href="https://addons.mozilla.org/firefox/507/">https://addons.mozilla.org/firefox/507/</a>
</p>
</blockquote>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.02"></a>
<h3>[TAG] Locking down a Linux box</h3>
 
 <p>Faber J. Fedor (faber at linuxnj.com) 
 <br /> 
 Sun Jun 11 19:43:05 PDT 2006</p> 
 <em>Answered by:  Francis, Kapil, Thomas</em> 
 
<strong>
<p>
Hey Guys,
</p>

<p>
Well, maybe "locking down" isn't the right phrase but I'm not sure what 
the right phrase is which is why I'm stumped.
</p>

<p>
I want to boot up a Linux box, go into X and run my application, let's
call it FaberOffice, and run nothing else. Nada. Zip.  FaberOffice is to
be the only thing running and the only thing that can run.
</p>

<p>
KDE Kiosk immediately sprang to mind but then I thought it might be
overkill. I'd have to turn off all the KDE applications and the KDE
Desktop functionality (the latter being the reason to use KDE over
straight WMs). I don't need a desktop, I need a window manager. And a
light one at that (Ice is Nice :-).
</p>

<p>
But what am I trying to do with the WM?  Am I replacing the root window
with FaberOffice? Am I simply maximizing the FaberOffice window and
disabling the window decorations and Alt-Tab? Or... :-?
</p>

<p>
I know what I want to do; I just don't know what I need to do.
</p>

<p>
Suggestions?
</p>
</strong>

<p>
[Francis] - What's your understanding of how a typical Linux system boots? 
</p>

<blockquote>
<p>
The short version is init runs and does whatever it says in /etc/inittab,
and that's pretty much it.
</p>

<p>
For an application to run, it is either explicitly listed in inittab, or
started by a program which itself is listed there.  Typically, a program
called "rc" is run, which searches through a specific directory and
runs all scripts found.  Changing the contents of that directory is the
usual way to adjust what runs on boot, without having to edit inittab.
</p>

<p>
So, pick your distribution, trace what it does (most things are shell
scripts, handily enough), and decide where you want to change things.
</p>

<p>
As an example, I'll describe what I recall of a version of a
redhat-derived distro where the intention was to do something similar
to what you describe.
</p>

<p>
In that version, inittab included a call to "prefdm", which chose the
right X display manager to use.  It also checked whether any display
manager at all should be used; the alternative being to run a script to do
a no-interaction login.  I'm not avoiding the specific filenames in order
to be coy; I'm just not certain I remember them exactly, and anyway you
should be able to read through the scripts on your distribution to find
how it does the equivalent.
</p>

<p>
One file "autologin" was a flag to bypass the display manager.
</p>

<p>
Another file "autologin" was the script, and that contained something like
</p>

<pre class="code">
su - $user -c "$(which startx)"
</pre>
<p>
with $user set to be the non-root user as whom the application should run.
</p>

<p>
Depending on the X configuration, "-- -nolisten tcp" may be a useful
addition to the commandline.
</p>

<p>
"startx" above is also a script; you can read it to see what it does.  The
straightforward thing to do is to make a ~$user/.xinitrc file which
runs all of the programs you want.  When the last one exits so does the
X invocation.
</p>

<pre>
&gt; KDE Kiosk immediately sprang to mind but then I thought it might be
&gt; overkill. I'd have to turn off all the KDE applications and the KDE
&gt; Desktop functionality (the latter being the reason to use KDE over
</pre>
<p>
Yes, it's much easier not to turn things on than to go and turn them
off afterwards.
</p>

<pre>
&gt; straight WMs). I don't need a desktop, I need a window manager. And a
&gt; light one at that (Ice is Nice :-).
</pre>
<p>
Are you sure you need a window manager?  You may well -- if your
application uses multiple windows, or if you really want two applications
running, or want any of the facilities the window manager provides.
</p>

<pre>
&gt; But what am I trying to do with the WM?  Am I replacing the root window
&gt; with FaberOffice? Am I simply maximizing the FaberOffice window and
&gt; disabling the window decorations and Alt-Tab? Or... :-?
</pre>
<p>
If you're disabling everything the WM provides, then you possibly don't
need it.  Depending on how much you control the environment, you may be
able to configure the app to start full-screen and never show a second
window.
</p>

<pre>
&gt; I know what I want to do; I just don't know what I need to do.
</pre>
<p>
Forgive me if I'm talking down to you, but you should be very clear
on what the application-startup procedure for your distribution is;
and when it comes to X, you should be very clear on what facility is
provided by X, what by a WM, and what by your application. 
</p>

<p>
With that understanding, you may be able to phrase "what I want to do"
in such a way as to make "what I need to do" obvious.
</p>

<p>
Within reason, you want to aim for the "ps -ef | wc -l" low score.
</p>

<p>
And "netstat -pantu" should have no lines you don't understand.
</p>

<pre>
&gt; Suggestions?
</pre>
<p>
You may also want to consider options within the X config file like
DontZoom, DontZap, and DontVTSwitch.  They may limit confusion for the
user at the cost of limiting convenience for the maintainer.  Of course,
depending on the user's experience, they may instead increase confusion
for the user.
</p>

<p>
Using ~$user/anything as an important file may be unwise if the user
is able to edit files.  For single user, the system xinitrc might be
more appropriate.  You know your system better than I do :-)
</p>

<p>
Don't forget to allow your maintenance guy some means of getting at a
shell prompt without using a screwdriver, if you think that's useful.
</p>
</blockquote>

<p>
[Thomas] - On Mon, Jun 12, 2006 at 11:57:21AM +0100, Francis Daly wrote:
</p>

<blockquote>
<pre>
&gt; What's your understanding of how a typical Linux system boots?
</pre>
<p>
<a href="http://www.hantslug.org.uk/cgi-bin/wiki.pl?LinuxHints/RunLevels">http://www.hantslug.org.uk/cgi-bin/wiki.pl?LinuxHints/RunLevels</a>
</p>

<pre>
&gt; In that version, inittab included a call to "prefdm", which chose the
</pre>
<p>
Yes, which is why Redhat <strong>suck</strong>.  What happens, if for some reason the
display manager couldn't launch?  /etc/inittab would continually try and
respawn it, hence the spurious error messages to the console one used to
find.  It's a stupid way of working.
</p>

<pre>
&gt; "startx" above is also a script; you can read it to see what it does.
&gt; The straightforward thing to do is to make a ~$user/.xinitrc file
&gt; which runs all of the programs you want. When the last one exits so
&gt; does the X invocation.
</pre>
<p>
I'd use ~/.xsession here, since startx will read ~/.xsession in lieu of
~/.xinitrc missing, and has the benefit that some other display managers
honour it.
</p>

<pre>
&gt; Forgive me if I'm talking down to you, but you should be very clear
&gt; on what the application-startup procedure for your distribution is;
</pre>
<p>
I disagree -- and that was never the question asked.  If Faber had wanted
an autologin, he'd have asked for one.  The question was about kiosks and
restricting modes of applications.
</p>
</blockquote>

<p>
[Francis] - On Mon, Jun 12, 2006 at 01:03:32PM +0100, Thomas Adam wrote:
</p>

<blockquote>
<pre>
&gt; On Mon, Jun 12, 2006 at 11:57:21AM +0100, Francis Daly wrote:
&gt; &gt; In that version, inittab included a call to "prefdm", which chose the
&gt; 
&gt; Yes, which is why Redhat <strong>suck</strong>.  What happens, if for some reason the
&gt; display manager couldn't launch?  /etc/inittab would continually try and
&gt; respawn it, hence the spurious error messages to the console one used to
&gt; find.  It's a stupid way of working.
</pre>
<p>
Anything in inittab potentially has the same looping failure mode.  I
haven't examined the Redhat setup to see if it only adds that entry after
it has confirmed that the display manager is currently working.
</p>

<p>
It's a choice Redhat made.  Presumably they decided it was better for them
than the alternatives.  It does make an autologin setup straightforward :-)
</p>

<pre>
&gt; &gt; The straightforward thing to do is to make a ~$user/.xinitrc file
&gt; 
&gt; I'd use ~/.xsession here, since startx will read ~/.xsession in lieu of
&gt; ~/.xinitrc missing, and has the benefit that some other display managers
&gt; honour it.
</pre>
<p>
That'll work too.  The admin can configure the system to work as seen fit.
</p>

<pre>
&gt; &gt; Forgive me if I'm talking down to you, but you should be very clear
&gt; &gt; on what the application-startup procedure for your distribution is;
&gt; 
&gt; I disagree -- and that was never the question asked.  If Faber had wanted
&gt; an autologin, he'd have asked for one.  The question was about kiosks and
&gt; restricting modes of applications.
</pre>
<p>
Fair enough, I was answering a different question to you.
</p>

<p>
You read the question as, approximately, "how do I limit the use of the
user account".  I read it as, approximately, "how do I limit the use of
the system".  Both are valid.  Either or neither could match the original
intention.  Now the OP can pick an answer, or wait for more, or offer a
fuller description of "what I want to do" that will allow us to point at
more specific reading material.
</p>

<p>
To revert to the original problem description, on a straight reading
the answer is a simple "so do that".
</p>

<p>
Do click the FaberOffice icon.  Don't click the nethack icon.  Don't type
"xterm -e wump" into any "run" box.  Don't hit control-alt-backspace and
wonder what just happened.
</p>

<p>
But as that is reasonably obvious, and very silly, it probably isn't the
answer wanted.  And it probably isn't the question intended either.
</p>

<p>
One guess at the OP's intention is "how do I get *someone else* not to
run any other application".  Which becomes "tell <strong>them</strong> 'Do click etc.'".
Which is also reasonably obvious, and also probably not wanted.
</p>

<p>
So there probably needs to be some degree of compulsion or encouragement
in the set-up, depending on whether the user is considered hostile or
inquisitive, or whether they can be relied on not to try to run anything
unwanted.
</p>
</blockquote>

<p>
[Thomas] - It's funny -- I am writing a Kiosk article using FVWM as we speak that's
going to appear in LG.  This may or may not happen now in lieu of this
reply.
</p>

<p class="editorial">[ Thomas' post in this thread was indeed <a
href="../128/adam1.html">turned into an article</a>, in LG 128. -- Kat ]</p>

<strong>
<p>
[Faber]  - On 12/06/06 12:40 +0100, Thomas Adam wrote:
</p>

<pre>
&gt; It's funny -- I am writing a Kiosk article using FVWM as we speak that's
&gt; going to appear in LG.  This may or may not happen now in lieu of this
&gt; reply.
</pre>
<p>
Based on what you've written here, I'm looking forward to the article.
</p>

<pre>
&gt; OK, so this application of yours (FaberOffice) is proprietary I assume,
&gt; since most people would have given the full name of it.  No matter.
</pre>
<p>
What?  You think my ego isn't big enough for me to name applications
after myself?!  O, yea of little faith! :-)
</p>

<pre>
&gt; In the best case, what you'll probably want to do is something like the
&gt; following:
</pre>
<p>
[ lot's of good stuff elided ]
</p>

<pre>
&gt; I hope that at least gives you some ideas to what you can do.  I've
&gt; rambled on a bit -- I hope it helps.
</pre>
<p>
Dude!  You did everything but install t for me!  Thanks.  I'll let you
know how it turns out!
</p>
</strong>

<p>
[Thomas] - On Mon, Jun 12, 2006 at 03:12:50PM -0400, Faber J. Fedor wrote:
</p>

<blockquote>
<pre>
&gt; Based on what you've written here, I'm looking forward to the article.
</pre>
<p>
I probably won't bother with it -- or if I do, it will only be very
similar to what I have written here.  So your question came as a means
for me to write it anyway, it just means it's in the form of TAG, and not
as an article.
</p>

<pre>
&gt; Dude! You did everything but install t for me! Thanks. I'll let you
&gt; know how it turns out!
</pre>
<p>
I'd apperciate that, since I hadn't actually tested any of what I had
written.  :)
</p>
</blockquote>

<p>
[Kapil] -
</p>

<blockquote>
<ol>
<li>You want to run only one application and it's main window should
   run in fullscreen mode. That suggests "ratpoison".</li>
<li>I presume you want the transient windows to emerge with focus in the
   centre of the screen. If your app has transient windows that don't
   behave well with WM_HINTS then you must exclude ratpoison. (For
   example GIMP and ratpoison do not get along).</li>
<li>You want to disable all key-bindings. You might be able to
   configure or hack ratpoison to do that.</li>
<li>Finally you want to disable the running of any other applications.
This suggests that the path be restricted using "rbash" as the shell.</li>

<p>
Another possibility (to ratpoison) is "ion" with minimal features and
modules loaded. You may be able to configure ICEWM or FVWM to do this
as well.
</p>
</blockquote>

<p>
[Thomas] - Eh?  Then ratpoison can't be ICCCM compliant in that case -- or
if it claims to be, then it's deluded.  The ICCCM is quite clear about how
transient window are to be handled.  Note also that WM_HINTS (as an XAtom)
has nothing to do with a window set as transient -- that's what the
"WM_TRANSIENT_FOR(WINDOW)" XAtom details.
</p>

<pre>
&gt; 4. Finally you want to disable the running of any other applications .
&gt; This suggests that the path be restricted using "rbash" as the shell .
</pre>
<p>
Or, as my reply alludes to, just don't allow a terminal emulator to run at
all.
</p>

[Kapil] - On Tue, 13 Jun 2006, Thomas Adam wrote:

<blockquote>
<pre>
&gt; Eh?  Then ratpoison can't be ICCCM compliant in that case -- or if it
&gt; claims to be, then it's deluded.  The ICCCM is quite clear about how
&gt; transient window are to be handled.  Note also that WM_HINTS (as an XAtom)
&gt; has nothing to do with a window set as transient -- that's what the
&gt; "WM_TRANSIENT_FOR(WINDOW)" XAtom details.
</pre>
<p>
Sorry. This is more a case of my mis-prepresentation of "ratpoison"
rather than any faults of "ratpoison" per se. I used the term
"WM_HINTS" without understanding it fully.
</p>

<p>
However, it is a fact that "ratpoison" and "gimp" do not get along---I
do not know enough to assign blame to either or both.
</p>

<pre>
&gt; Or, as my reply alludes to, just don't allow a terminal emulator to run at
&gt; all.
</pre>
<p>
True enough.
</p>

<p>
I looked at your detailed reply to Faber and it looks far more
complete than the half-baked stuff I wrote up. It <strong>is</strong> interesting
to see that FVWM lives up to its promise of being the "one wm to bind
them all".
</p>
</blockquote>

<p>
[Thomas] - On Tue, Jun 13, 2006 at 04:20:28PM +0530, Kapil Hari Paranjape
wrote:
</p>

<blockquote>
<pre>
&gt; Sorry. This is more a case of my mis-prepresentation of "ratpoison"
&gt; rather than any faults of "ratpoison" per se. I used the term
&gt; "WM_HINTS" without understanding it fully.
</pre>
<p>
That's OK.  I won't bore you with the details of how it all works --
that's what the ICCCM attempts to do.  :)
</p>

<pre>
&gt; However, it is a fact that "ratpoison" and "gimp" do not get along---I
&gt; do not know enough to assign blame to either or both.
</pre>
<p>
I actually fired up ratpoison in Xnest to see what all the fuss was about
-- and it seems you're right.  Although interestingly enough, I don't
think this is rapoison's fault -- but GIMP's.  For instance, the "Open"
dialogue window isn't transient.  It <em>ought</em> to be marked as such -- hence
as far as the WM is concerned, it treats it as a normal window.  This is
probably where half of the issues lie.  Because of the way ratpoison
works, it likes to completely consume any pane it's started in, and this
includes the toolbar which looks ugly in this way.
</p>

<pre>
&gt; I looked at your detailed reply to Faber and it looks far more
&gt; complete than the half-baked stuff I wrote up. It <strong>is</strong> interesting to
&gt; see that FVWM lives upto its promise of being the "one wm to bind them
&gt; all".
</pre>
<p>
I suppose.  :)
</p>
</blockquote>
 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.03"></a>
<h3>Talkback links should CC article author</h3>
 
 <p>Thomas Adam (thomas at edulinux.homeunix.org) 
 <br /> 
 Sun Jun 18 08:28:23 PDT 2006</p> 
 <em>Answered by:  Ben</em> 
 
<strong>
<p>
I missed when the talkback parts were setup, but it seems to me that when
the links for it are generated that a CC field should be added to the
respective author's email address as well.  For those authors who do not
provide an email address, or write under the guise of "Anon", then on CC
should be used.
</p>

<p>
Currently, whilst the model in use is quite successful, it does leave any
kudos for the author unnoticed, unless they're subscribed to TAG which is
unlikely for most of the authors we have.
</p>
</strong>

<p>
[Ben] - That would be one of the bits of Python coding that's been on my
stack for a <em>LONG</em> time - but has also been put off for a long time. It
wouldn't be all that hard, but it would expose the authors' email addresses
to spambots, something that is not currently the case. Yes, there would be
large benefits to doing this - for the moment, whenever there's a
worthwhile Talkback followup, I forward it to the authorfrom my mailbox,
screamingly manual and inefficient as it may be - but there's also a
detrimental effect, as well as a need for someone to get their hands grimy
in Python bowels.
</p>

<blockquote>
<p>
This week's classes are done (*WHEW*... especially since we were doing
double the usual, 8 hours of class/welding per day), which means that
I'll have a little brainpower available before the systems crash at the
end of the day. I'll give this a bit of thought while hoping that a
Python-savvy person will volunteer to help with this - as an option, if
nothing else - while I'm cogitating. :)
</p>
</blockquote>

<strong>
<p>
[Thomas]  - Cc Mike Orr -- he's not subscribed to TAG at the moment, but I
hear he knows a little about Python.  ;)
</p>
</strong>
 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.04"></a>
<h3>Confusion about linux fonts</h3>
 
 <p>J. Bakshi (j.bakshi at icmail.net) 
 <br /> 
 Wed Jun 28 01:54:21 PDT 2006</p> 
 <em>Answered by:  Kapil</em> 
 
<strong>
<p>
Dear list,
</p>
 
<p>
I am really confused that where does Linux actually search for fonts ? I
have flipped through my system (debian - sarge) and get two locations 
</p>
 
<p>
1] /etc/fonts  and  2] /usr/share/fonts  where the #1 location has three
html files and #2 has fonts file.
</p>

<p>
I have true-type font server called xfs-xtt. below is the part of fonts
from my XF86config-4
</p>
</strong>

<pre class="code">
Section "Files"
        FontPath        "unix/:7100"         #local font server
        # if the local font server has problems, we can fall back on these
        FontPath        "/usr/lib/X11/fonts/misc"
        FontPath        "/usr/lib/X11/fonts/cyrillic"
        FontPath        "/usr/lib/X11/fonts/100dpi/:unscaled"
        FontPath        "/usr/lib/X11/fonts/75dpi/:unscaled"
        FontPath        "/usr/lib/X11/fonts/Type1"
        FontPath        "/usr/lib/X11/fonts/CID"
        FontPath        "/usr/lib/X11/fonts/Speedo"
        FontPath        "/usr/lib/X11/fonts/100dpi"
        FontPath        "/usr/lib/X11/fonts/75dpi"
EndSection
</pre>
<strong>
<p>
All these location have fonts file. Now when fonts are already
there at /usr/share/fonts then why do we need those above mentioned
font directories ?
</p>

<p>
there is also a hidden folder named <strong>.fonts</strong> in my home directory
</p>

<p>
*xset -q | grep font* shows
</p>
</strong>

<pre class="code">
/usr/lib/X11/fonts/misc,/usr/lib/X11/fonts/100dpi/:unscaled,/usr/lib/X11/fonts/75dpi/:unscaled,
/usr/lib/X11/fonts/Type1,/usr/lib/X11/fonts/Speedo,/usr/lib/X11/fonts/100dpi,/usr/lib/X11/fonts/75dpi,
<em>home/joy</em>.fonts
</pre>
<strong>
<p>so my hidden <strong>.fonts</strong> directory is been searched. but no where 
is /usr/share/fonts . so what is the utility of having /usr/share/fonts ?
</p>

<p>
I am really confused. Can any one solve? Thanks for your time and kindly
CC: to me.
</p>
</strong>

<p>[Kapil] - Only two? Where fonts are searched for depends on which
program is doing the searching and the device for which the fonts are
intended.  Hence there are X fonts, TeX fonts, GhostScript fonts, etc.
which are further divided according to bitmaps or scalable (vector) fonts.
Bitmap fonts are further divided according to resolution.  </p>

<blockquote><p>Hope this clarifies a bit.
</p>
</blockquote>

<p class="editorial">[ <a href="../128/adam.html">Thomas' reply was published in LG 128</a> at Ben's suggestion. His original post and Ben's response have been elided. -- Kat ]</p>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.05"></a>
<h3>FVWM Kiosk - a different approach</h3>
 
 <p>stomfi (stomfi at bigpond.com) 
 <br /> 
 Fri Jul 7 01:06:04 PDT 2006</p> 
 <em>Answered by:  Ben</em> 
 
<strong>
<p>
This is another way of achieving user lock down.
</p>

<p>
Computerbank Queensland (CBQ) in partnership with a Work for the
Dole team implemented a Blue Care Computers for the Third Age
project at Salvin Park in the last 3 months of 2003.
</p>

<p>
This is a short description of the project which uses oroborus as
the kiosk window manager, but which could use FVWM in a similar fashion.
</p>

<p>
I was the coordinator of the project.
</p>
</strong>

<pre class="code">
#################################################################
The users are aged and have limited faculties, although they can all
see. They could easily do the wrong thing and forget what they
learnt from day to day, so the system has to be relatively fool
proof, while still delivering the required applications in a simple
and straightforward manner.

CBQ donated equipment and built a special Linux system for this
project. The installed systems consisted of two separate facilities
in the park.

They are comprised of an Internet, and print server with a simple
masquerade iptables script to the Internet.

The servers use LPD for the printer and a dialup ppp connection.
The clients use cups and have the Internet nameservers in
/etc/resolv.conf.

One site has a server and three clients connected with a 10Mbps hub,
the other a server/client connected by cross over cable to the client.

The servers bring up ppp0 at boot, which stays up till the system is
closed down or rebooted.

The clients are configured with 4 users, being guestx, help, Internet and
letters.  Letters, Internet and help all use oroborus as the backgrounded
window manager which does nothing except display windows. There are no
active key sequences except CTRL-q which normally kills the window manager
but does nothing since it is running in the background. After backgrounding
the window manager the user .xinitrc file execs the required program, ie
gedit letters.txt, firebird help.html and firebird Internet.html.

The user is prompted to print typed letters as they are not saved
past the session.

Closing the program sends the user back to the GDM user login screen.

No files are saved on the clients and gconf and other configuration
files have their ownerships changed so that user session changes
cannot be saved and are forgotton with each new logon.

Guestx is a normal user with a few apps such as GIMP and abiword,
and some games.

None of the user login names have passwords, except guestx whose
password is guestx. This is for the "sophisticated" user just in
case they have one or two.

The Internet home page has pictorial links to news, email, search,
net games, and the off line help. Email is web mail only.

Each client has the mouse keypad accessibility option configured.

All systems run on RedHat which was chosen by the team as it was the
most consistent and robust and had a good selection of end user
apps. Due to performance issues on P1s, Gnome is the guestx window
manager and GDM the logon manager.

The servers are P2s. One is running RedHat 7.3 and the P1 clients
and server/client are running a cut down RedHat 8. RedHat kindly
donated the software to CBQ which we used for this project.

Many thanks go to the work for the dole team for learning the
necessary routines needed to complete this project on time and at a
minimal cost to Blue Care.
###################################################################
</pre>
<strong>
<p>
Hope this shows you a robust way of locking users out of a system.</br>
Kind regards</br>
Tom Russell</br>
</p>
</strong>

<p>
[Ben] - The project sounds interesting, Tom, but I'm a little unclear about
some of the specifics as well as being curious about some of the results.
</p>

<blockquote>
 
<pre>
&gt; #################################################################
&gt; 
&gt; CBQ donated equipment and built a special Linux system for this
&gt; project. The installed systems consisted of two separate facilities
&gt; in the park.
&gt; 
&gt; They are comprised of an Internet, and print server with a simple
&gt; masquerade iptables script to the Internet.
</pre>
<p>
I'm not clear on what you mean by the above. Do you mean that you had a
workstation connected to the Internet via a NAT router, with 'iptables'
used to set up the masquerading?
</p>
 
<pre>
&gt; The servers use LPD for the printer and a dialup ppp connection.
&gt; The clients use cups and have the Internet nameservers in
&gt; /etc/resolv.conf.
&gt; 
&gt; One site has a server and three clients connected with a 10Mbps hub,
&gt; the other a server/client connected by cross over cable to the client.
&gt; 
&gt; The servers bring up ppp0 at boot, which stays up till the system is
&gt; closed down or rebooted.
</pre>
<p>
So, it sounds like you had two dialup lines. Was there a particular
reason that the two kiosks were so different (3 workstations plus a
server versus 1 workstation plus a server)?
</p>
 
<pre>
&gt; No files are saved on the clients and gconf and other configuration
&gt; files have their ownerships changed so that user session changes
                              ^^^^^^^
</pre>
<p>
I presume that means "changed to root" or something similar.
</p>

<pre>
&gt; cannot be saved and are forgotton with each new logon.
&gt; 
&gt; Guestx is a normal user with a few apps such as GIMP and abiword,
&gt; and some games.
&gt; 
&gt; None of the user login names have passwords, except guestx whose
&gt; password is guestx. This is for the "sophisticated" user just in
&gt; case they have one or two.
</pre>
<p>
Presumably, this has the window managed "running in the foreground", to
use your terminology, so that the apps are accessible and can be
individually started - or do you mean something else?
</p>
 
<pre>
&gt; All systems run on RedHat which was chosen by the team as it was the
&gt; most consistent and robust and had a good selection of end user apps.
  ^^^^^^^^^^^^^^^^^^^^^^^^^^
</pre>
<p>
That is, perhaps, an arguable point. :)
</p>

<pre>
&gt; Due to performance issues on P1s, Gnome is the guestx window
&gt; manager and GDM the logon manager.
</pre>
<p>
This seems odd as well. If I was concerned about performance issues, I
would have gone with, say, FVWM or IceWM; Gnome is quite resource-intensive
when compared with either of those (or many other simple WMs.)
</p>
 
<pre>
&gt; Many thanks go to the work for the dole team for learning the
&gt; necessary routines needed to complete this project on time and at a
&gt; minimal cost to Blue Care.
&gt; ###################################################################
</pre>
<p>
Indeed; it sounds quite the public-spirited project, and I'd be
interested to hear more about it. Tom, I'd like to suggest that you
write an article about this for LG - perhaps detailing the larger
surrounding issues (i.e., how Work for the Dole and the Third Age
project came up with this undertaking, how the project was coordinated,
lessons learned, whether there are plans to do more of this kind of
thing in the future, etc.) I believe that our readers would be very
interested to hear about this; I certainly would like to see this
myself.
</p>
</blockquote>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.06"></a>
<h3>How to convert RedHat9 to Gentoo over SSH on a live system</h3>
 
 <p>Suramya Tomar (security at suramya.com) 
 <br /> 
 Thu Jul 20 10:34:06 PDT 2006</p> 
 <em>Answered by:  Rick, Thomas</em> 
 
<strong>
<p>
Found this HOWTO that describes how to take a stock RedHat9 system and 
convert it to Gentoo, remotely over ssh and while it is running.
</p>

<p>
<a href="http://www.darkridge.com/~jpr5/doc/rh-gentoo.html">http://www.darkridge.com/~jpr5/doc/rh-gentoo.html</a>
</p>

<p>
Haven't tried it yet as I don't have access to a RedHat system that I 
can experiment on. But this sounds very interesting. I wonder if its 
possible to convert other Linux OS's to another flavor of linux(Like 
Debian maybe?)
</p>
</strong>

<p>
[Thomas] - Google for 'debtakeover'.
</p>

<p>
[Rick] - Certainly.
</p>

<p>
<a href="http://twiki.iwethey.org/twiki/bin/view/Main/DebianChrootInstall">http://twiki.iwethey.org/twiki/bin/view/Main/DebianChrootInstall</a></br>
<a href="http://www.hadrons.org/~guillem/debian/debtakeover/">http://www.hadrons.org/~guillem/debian/debtakeover/</a></br>
<a href="http://trilldev.sourceforge.net/files/remotedeb.html">http://trilldev.sourceforge.net/files/remotedeb.html</a></br>
<a href="http://www.starshine.org/SysadMoin/DebootstrapInstallation">http://www.starshine.org/SysadMoin/DebootstrapInstallation</a></br>
</p>

<strong>
<p>
[Suramya]  - Thanks for a great set of links, Now I have something to waste
time on over the week...
</p>
</strong>
 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.07"></a>
<h3>State of the anti-spam regime, July 2006 edition</h3>
 
 <p>Rick Moen (rick at linuxmafia.com) 
 <br /> 
 Fri Jul 21 11:37:44 PDT 2006</p> 
 <em>Answered by:  Ben, Martin</em> 
 
<p>
Quoting Benjamin A. Okopnik (ben at linuxgazette.net):
</p>

<pre>
&gt; That's how I figured you were using it, Rick. If you wanted money, you'd
&gt; have said so - I have this feeling that you got over being all shy and
&gt; retiring a while ago. :) I just thought that you might still be in the
&gt; planning/buying stages.
</pre>
<strong>
<p>
The newer machine in question's still, to my way of thinking, pretty nice:
Single-proc PIII/800 or so, VA Linux Systems 2230 2U rackmount chassis,
Intel L440GX+ "Lancewood" motherboard, 1.5TB RAM, 2 x 73GB RAID1 pair
(Linux software RAID) for the important filesystems, 16GB? boot drive,
</p>

<p>
That's pretty snazzy -- for 2001.  ;-&gt;
</p>

<p>
All the filesystems are built, and it's loaded with Debian "etch" 4.0
and a rough cut of all the necessary software, not yet fully configured.
Data files haven't yet been copied over (IIRC).  
</p>

<p>
The last time I worked on it, I'd fetched a new Debian-packaged binary
kernel 2.6.x and blithely <em>removed</em> the previous, believed-bootable 
installed 2.6.x kernel.  And then rebooted, found that I'd just shot
myself in the foot, lost patience / ran out of time, and quit for the
day.  I've not yet gotten back to it, and meantime other things have 
been keeping me away.
</p>

<p>
You know, it's also possible the old box has developed a bad spot of
RAM, or something like that.  Look at this kernel "oops" from
/var/log/messages, which is typical of process blowouts, lately:
</p>
</strong>

<pre class="code">
Jul 21 11:20:38 linuxmafia kernel:  &lt;1&gt;Unable to handle kernel NULL pointer dereference at virtual address 00000004
Jul 21 11:20:38 linuxmafia kernel:  printing eip:
Jul 21 11:20:38 linuxmafia kernel: c0153ca5
Jul 21 11:20:38 linuxmafia kernel: Oops: 0000
Jul 21 11:20:38 linuxmafia kernel: CPU:    0
Jul 21 11:20:38 linuxmafia kernel: EIP:    0010:[prune_icache+53/464] Not tainted
Jul 21 11:20:38 linuxmafia kernel: EFLAGS: 00210213
Jul 21 11:20:38 linuxmafia kernel: eax: 74756564   ebx: 00000000   ecx: 00000006
   edx: 00000004
Jul 21 11:20:38 linuxmafia kernel: esi: fffffff8   edi: 00000000   ebp: 00000383
   esp: c4e0dddc
Jul 21 11:20:38 linuxmafia kernel: ds: 0018   es: 0018   ss: 0018
Jul 21 11:20:38 linuxmafia kernel: Process exim4 (pid: 32387, stackpage=c4e0d000)
Jul 21 11:20:38 linuxmafia kernel: Stack: cb7b3e20 00000000 c4e0dde4 c4e0dde400
000009 c1046310 c025ecd8 00001951 
Jul 21 11:20:38 linuxmafia kernel:        c0153e64 00000383 c01353eb 00000006 00
0001d2 ffffffff 000001d2 00000009 
Jul 21 11:20:38 linuxmafia kernel:        0000001e 000001d2 c025ecd8 c025ecd8 c0
1357bd c4e0de50 000001d2 0000003c 
Jul 21 11:20:38 linuxmafia kernel: Call Trace: [shrink_icache_memory+36/64] [
shrink_cache+379/944] [shrink_caches+61/96]
[try_to_free_pages_zone+98/256] [locate_hd_struct+56/160]
Jul 21 11:20:38 linuxmafia kernel:   [balance_classzone+66/480] [__alloc_pages+3
76/640] [do_anonymous_page+92/256] [handle_mm_fault+119/256] [do_page_fault+456/
1337]
[e100:__insmod_e100_O/lib/modules/2.4.27-2-686/kernel/drivers/net+-687130/96]
Jul 21 11:20:38 linuxmafia kernel:   [process_timeout+0/80] [bh_action+34/64] [t
asklet_hi_action+70/112] [do_IRQ+154/160] [do_page_fault+0/1337] [error_code+52/
60]
Jul 21 11:20:38 linuxmafia kernel: 
Jul 21 11:20:38 linuxmafia kernel: Code: 8b 5b 04 8b 86 08 01 00 00 a8 38 0f 84 
1c 01 00 00 81 fb a8 
</pre>
<strong>
<p>
Off hand, I'm uncertain of the root cause.
</p>
</strong>
<p>
[Martin] - On 21/07/2006 Rick Moen wrote:
</p>

<blockquote>
<pre>
&gt; The newer machine in question's still, to my way of thinking, pretty 
&gt; nice:
&gt; Single-proc PIII/800 or so, VA Linux Systems 2230 2U rackmount 
&gt; chassis,
&gt; Intel L440GX+ "Lancewood" motherboard, 1.5TB RAM, 2 x 73GB RAID1 pair
&gt; (Linux software RAID) for the important filesystems, 16GB? boot drive
</pre>
<p>
Rick do you mean 1.5Gb memory?? ;)  Just thinking that terabytes of 
memory is going a bit OTT...  I also thought that P3's usually only go 
up something like 2Gb memory, not sure off hand though.
</p>
</blockquote>

<strong>
<p>
[Rick]  - D'oh!  Yes, I only <em>wish</em> I had 1.5 TB of RAM.  I'm willing to
accept that even in PC-100.  Just leave it in a brown bag on my doorstep,
please, and nobody need get hurt.  ;-&gt;
</p>

<blockquote>
<p>
Yes, the old box is back online.  Absent-minded members of my household
(myself certainly included) had closed up <em>all</em> the doors leading into the 
garage that is the temporary home of our servers.   Today, my town had
record high temperatures of 35 degrees (95, if using last millennium's
Fahrenheit scale) -- which meant it was probably closer to 40 inside the 
sealed garage.  And the machine simply was unhappy, that way.
</p>

<p>
There will be a fresh backup, soonish -- and I'll devote serious
attention to the long-delayed hardware migration, -and- to creating the
planned server-shelf space in the foundation crawlspace, under my house.
For now, there's also an electric fan blowing additional air at the
server.
</p>

<p>
For the record, anyway, if you see segfaults and kernel oopses, it <em>may</em> 
indicate a runaway heat problem.  I didn't know that, before.
</p>
</blockquote>
</strong>

<p>
[Ben] - One of the laptops that I tested before buying the HP that I have
as my backup machine ran ridiculously hot - I actually got to see the
kernel spit out a "thermal shutdown" message and halt (I didn't realize it
had such a goodie in it until it did that.) During the short time that I
ran it - and I actually tried two different machines of the same make and
model - a number of the sessions terminated either in a thermal cutout or a
segfault.
</p>

<blockquote>
<p>
In general, when I see a segfault that wasn't caused by a known factor
(e.g., a just-compiled, highly experimental kernel), I immediately suspect
either a) bad hardware or b) overtemp conditions. I suppose you could make
the case that b) really resolves to a) - I've always considered memory to
be analog hardware, anyway... It sorta works within parameters when the
moon in in the right phase, but tends to wander outside of them whenever
anything (like the price of pork bellies on the commodities market, or the
percentage of carbon dioxide on Mars) changes.
</p>
</blockquote>



 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.08"></a>
<h3>Wiring a house with ethernet: Success</h3>
 
 <p>Jason Creighton (jcreigh at gmail.com) 
 <br /> 
 Fri Aug 4 23:45:20 PDT 2006</p> 
 <em>Answered by:  Bradley, Jason</em> 
 
<strong>
<p>
Hi Gang,
</p>

<p>
Way back in October of last year, I asked TAG about how to go about
pulling Ethernet in a new house. I pulled all the cable, punched down
the ends and hoped for the best. We moved in early this year, but the
only networking we needed right away was with two, physically adjacent
computers, so I just used a crossover cable.
</p>

<p>
So the Ethernet built into the house was totally untested until last
week when I needed to tie a computer at the other end of the house into
the netowrk. Every single (okay, seven total, but still...) drop worked
correctly on the first try. Maybe I just got lucky. :)
</p>

<p>
Anyway, I just wanted to report success and thank you guys for helping
out. Chalk another one up for TAG.
</p>

</strong>

<p>
[Bradley] - On 8/5/06, Jason Creighton &lt;jcreigh at gmail.com&gt; wrote:
</p>

<blockquote>
<pre>
&gt; [...] Maybe I just got lucky. :)
</pre>
<p>
Maybe, maybe not ;-)
</p>

<p>
I just finished wiring a house for Ethernet as well - the house was
built with three UTP cables running to three of the bedrooms, as well
as a single unused box in the kitchen. After wiring up the RJ45 jacks
in the bedrooms, and pulling a new cable in the kitchen and punching
an RJ45 jack onto that, I now have a decent Ethernet network as well.
</p>

<p>
What sort of terminal arrangement did you use? I used a double-gang
switch box with a 12-port faceplate as a "patch panel" for all of my
lines (for expandability).
</p>
</blockquote>
<strong>
<p>
[Jason] - On Sun, Aug 06, 2006 at 04:16:58PM -0400, Bradley Chapman wrote:
</p>
<blockquote>

<p>
<pre>
&gt; What sort of terminal arrangement did you use? I used a double-gang
&gt; switch box with a 12-port faceplate as a "patch panel" for all of my
&gt; lines (for expandability).
</pre>
</p>

<p>
Very similar to yours, actually. I'm don't have proper patch panel, just
two single-gang<a name="mailbag.xx.wiring.html_1_back"></a><a
href="#mailbag.xx.wiring.html_1">[1]</a> low-voltage wiring boxes coming in
closest with a
wall-mounted 8-port Netgear switch. Were I to do it again, I think I
would:
</p>

<p>
<ol>
	<li>Do everything in the wiring closet in some sort of flush mounted
	wiring box. (I think this is called a "structured wiring box")</li>
	<li>For futureproofing and flexibility, pull two Cat6 drops to every
room
in the house, punch them both down to RJ45, and then use one for
ethernet and one for phone.</li>
</ol>
</p>

<p>
<a name="mailbag.xx.wiring.html_1"></a><a
href="#mailbag.xx.wiring.html_1_back">[1]</a> When you mentioned that you
used a 2-gang box, I thought "why didn't
<strong>I</strong> do that?" D'oh! (I hoping there was some actual reason, like not
being able to find a faceplate for a 2-gang box, but I can't remember
now.)
</p>
</blockquote>
</strong>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.09"></a>
<h3>Linux driver question</h3>
 
 <p>J. Bakshi (j.bakshi at icmail.net) 
 <br /> 
 Sat Aug 5 10:11:01 PDT 2006</p> 
 <em>Answered by:  Karl-Heinz, Peter</em> 
 
<strong>
<p>
Hi list,
</p>

<p>
hope everyone is well here :-)
</p>

<p>
I have a question about linux usb driver. Is there any driver which
allows attaching a serial device to usb port under linux ? My old PI PC has
a serial port so I don't have problem to use JDM programmer (PIC
Programmer). But my new mother board of AMD doesn't have any COM port.
Hence I am looking such an arrangement that I can still use serial devices
by a USB-to-Serial adapter.  But does linux has any driver/feature to
support this ?
</p>

<p>
thanks in advanced.
</p>
</strong>

<p>
[Karl-Heinz] - "J. Bakshi" &lt;j.bakshi at icmail.net&gt; wrote:
</p>

<blockquote>
<pre>
&gt; I have a question about linux usb driver. Is there any driver which allows 
&gt; attaching a serial device to usb port under linux ? 
&gt; [...]
&gt; But does linux has any driver/feature to support this ?
</pre>
<p>
seems so....
</p>

<pre>
/lib/modules/2.6.5-7.111-default/kernel/drivers/usb/serial&gt; ls
belkin_sa.ko        empeg.ko        io_ti.ko   keyspan.ko      kobil_sct.ko pl2303.ko       visor.ko
cyberjack.ko        ftdi_sio.ko     ipaq.ko    keyspan_pda.ko  mct_u232.ko safe_serial.ko  whiteheat.ko
digi_acceleport.ko  io_edgeport.ko  ir-usb.ko  kl5kusb105.ko   omninet.ko usbserial.ko
</pre>
<p>
but from that list I would assume there are usb-to-serial adapter which
are better supported then others -- but maybe safe_serial and usbserial
are a lowest common featureset support? 
</p>
</blockquote>

<p>
[Peter] - The "Edgeport" boxes from <a href="http://www.ionetworks.com/">http://www.ionetworks.com/</a>
seem to enjoy good Linux support from the "io_edgeport" and "io_ti"
drivers:<br>
 <a href="http://www.kroah.com/linux/usb/edgeport/">http://www.kroah.com/linux/usb/edgeport/</a>
</p>

<blockquote>
<p>
Disclaimer: I haven't tried this myself (yet). Instead I'm using an old
"Annex" box from Bay Networks <a href="http://www.ofb.net/~jheiss/annex/">http://www.ofb.net/~jheiss/annex/</a> to access
serial ports over plain old TCP/IP.  Not sure if this would be sufficient
for your purpose, though.
</p>
</blockquote>
 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.10"></a>
<h3>USB Hard Drives</h3>
 
 <p>Bob van der Poel (bvdp at xplornet.com) 
 <br /> 
 Sat Aug 12 19:16:06 PDT 2006</p> 
 <em>Answered by:  Ben, BobV, Faber, Lew</em> 
 
<strong>
<p>
I'm thinking of getting a USB (external) hard drive to use for backup 
purposes. Is there anything to look out for on these, or should I just 
try to get the best dollar/meg deal? I'm thinking that something in the 
150 to 150 meg size would be perfect.
</p>

<p>
I'm assuming that all (most?) of these drives will work just fine with 
Linux :)
</p>

<p>
Thanks.
</p>
</strong>

<p>
[Faber] - On 12/08/06 19:16 -0700, Bob van der Poel wrote: 
</p>

<blockquote>
<pre>
&gt; I'm thinking of getting a USB (external) hard drive to use for backup 
&gt; purposes. 
</pre>
<p>
I bought a USB enclosure for ~50 USD for a HD I already owned and I
recently bought a Maxtor 300G model for ~200 USD. I have had no problems
with either. I use them as everyday storage; the former for /home and
the latter for my mp3s, VMware files and media files.
</p>

<pre>
&gt; Is there anything to look out for on these, or should I just 
&gt; try to get the best dollar/meg deal? I'm thinking that something in
the 
&gt; 150 to 150 meg size would be perfect.
</pre>
<p>
My rule of thumb on buying anything: buy the most expensive thing you
can afford, but don't buy the cheapest thing on the market and don't buy
the most expensive.
</p>

<pre>
&gt; I'm assuming that all (most?) of these drives will work just fine with 
&gt; Linux :)
</pre>
<p>
That's been my experience.  One person emailed me about problems he was
having with a USB enclosure and Linux.  We believe his problem turned
out to be the enclosure was just too cheap(ly made).
</p>
</blockquote>

<p>
[Lew] - I wouldn't know about all or most of these drives, but I <em>suspect</em>
that they will all work with Linux, especially a recent kernel.
</p>

<blockquote>
<p>
A couple of weeks ago, I bought a Vantec NexStar:GX "USB 2.0 External
3.5 inch Hard Drive Enclosure", which I used with an old 60Gb HD that I had
laying around. The drive was correctly recognized by a 2.4.29 kernel, and I
had no problems using it at all.
</p>

<p> 
I'm certain that once I upgrade the drive to a more modern 300Gb
device, the NexStar:GX will make a good external backup medium.
</p>
</blockquote>

<p>
[Ben] - I didn't want to just jump in with "metoo!", but - me too. After
ages of making mental notes to do it Sometime Soon, I finally bought myself
a USB-to-HD adapter and shuffled through my ancient hard drive collection
(ye ghods... some of these things had capacities in the megabyte range.
What year was that, 1920 or so?) Except for several drives that wouldn't
even spin up, I was able to read all of them - and I had quite a variety.
</p>

<blockquote>
<p>
Amusing note: I tend to be a pack rat when it comes to information, and
when I get rid of a machine, I usually keep the HD. Then, at some point
when I've completely forgotten what the hell those things contain, I
work my way through them, copying off stuff that looks interesting and
throwing away the now-ancient hardware. It has been my experience that
whatever drive I'm using at the time is plenty and more than plenty to
hold the contents of all the drives I'd saved until then.
</p>
</blockquote>

<strong>
<p>
[BobV] - Thanks for the comments on this, guys. I was at my not-so-local
Staples earlier today and they had 250gig USB "My Book" drives on for $119
US.  So, I got one. (I really do remember thinking that my first box of
5.25" floppy disks each holding about 160K would be enough storage for the
REST OF MY LIFE).
</p>

<blockquote>
<p>
It works just fine. Reformatted to ext2 FS and got rid of a bunch of 
windows files :)
</p>

<p>
Just copied my base file system over. 92,000 files; 24 gig in about 28 
minutes. No screamer, but no slouch either. And, really, for backups who 
cares about speed.
</p>

<p>
Seems to be very little noise or heat on this. And it has an automatic 
10 minute power-down built in. So, I'll just leave it plugged in.
</p>

<p>
I'll have to see if it will auto-mount, etc. But, I don't see any 
serious problems.
</p>
</blockquote>
</strong>
 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.11"></a>
<h3>New URL for GLUE - Groups of Linux Users Everywhere </h3>
 
 <p>B. E. Irwin (beirwin at shaw.ca) 
 <br /> 
 Sun Aug 13 17:19:10 PDT 2006</p> 
 <em>Answered by:  Rick</em> 
 
<strong>
<p>
I'm trying to track down where &quot;GLUE - Groups of Linux Users
Everywhere&quot; lives now.  As you can see from my email below, this
valuable resource is no longer hosted by LinuxGazette.com.  I recall you
guys started a new LinuxGazette.net (and linked on my site, btw) a while
back.  I searched linuxgazette.net and could not find GLUE.  Do you know
where I might find it?  Is it on linuxgazette.net and I missed it?  A
Google search turned up nothing.
</p>

<p>
Thanks for your help.
</p>
</strong>

<pre class="code">
---------- Forwarded message ----------
Date: Fri, 04 Aug 2006 11:41:36 -0600
From: Keith Daniels &amp;lt;keith@ssc.com&amp;gt;
To: Barbara E. Irwin &amp;lt;beirwin@shaw.ca&amp;gt;
Subject: Re: New URL for GLUE - Groups of Linux Users Everywhere =&amp;gt; Was hosted
     here: http://newglue.linuxgazette.com/

Barbara E. Irwin wrote:
&amp;gt; I am one of the contributors for the Loads of Linux Links project
&amp;gt; (http://loll.sourceforge.net/linux/links/index.html).  We have a link to
&amp;gt; GLUE - Groups of Linux Users Everywhere however, this url is no longer valid 
&amp;gt; Is this link somewhere on Linux Journal?

No, Glue has been discontinued and will not be put back up.  Sorry about that 
but management decided to kill Glue, linuxgazette.com and linuxresources.com.

&amp;gt; 
&amp;gt; FYI, this is a GPL'd database of 5000+ bookmarks of important URLs about
&amp;gt; Linux and the Open Source movement.  It was originally a project started for
&amp;gt; the Victoria Linux Users' Group and is now hosted by SourceForge.
&amp;gt; 
&amp;gt; Thanks for any info. about your link!

I will tell the newsletter editor about your site and he might put it in one of 
the newsletters.


Keith Daniels
--
Webmaster
SSC Publications, Inc.
www.ssc.com

Publishers of:

Linux Journal - www.linuxjournal.com
TUX Magazine  - www.tuxmagazine.com
Doc's IT Garage - www.docsearls.com
A42 - www.A42.com
</pre>
<p>
[Rick] - Greetings, Barbara!
</p>

<blockquote>
<p>
I'd love to see GLUE resurrected<a name="mailbag.xx.glue.html_1_back"></a><a
href="#mailbag.xx.glue.html_1">[1]</a>, and we at Linux Gazette were every
bit as surprised and dismayed to see it disappear (with apparently no
advance notice or consultation with anyone) as you were.  Heck, if I had
the right software for it, I'd even host it on my home aDSL line, though
it would require some effort to prevent it being overrun by comment
spam.
</p>

<p>
<a name="mailbag.xx.glue.html_1"></a><a
href="#mailbag.xx.glue.html_1_back">[1]</a> As opposed to being one of the
ever-growing stable of dead
Linux-community-Web-site URLs that now redirect to the commercial 
www.linuxjournal.com site.  I'm struggling to be polite, here. 
</p>
</blockquote>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.12"></a>
<h3>Copyright Notice</h3>
 
 <p>Mahesh Aravind (ra_mahesh at yahoo.com) 
 <br /> 
 Tue Aug 15 22:02:32 PDT 2006</p> 
 <em>Answered by:  Ben, Rick</em> 
 
<p>
--- Kristian Orlopp &lt;kristianorlopp at web.de&gt; wrote:
</p>

<pre>
&gt; The script <a href="../129/misc/mail/colors.sh">http://linuxgazette.net/129/misc/mail/colors.sh</a> may be a
&gt; modification of the public domain (?) 
&gt; <a href="http://www.linux-magazin.de/Artikel/ausgabe/1997/08/Tips/ls.html">http://www.linux-magazin.de/Artikel/ausgabe/1997/08/Tips/ls.html</a>
&gt; (Farbtest)
&gt; 
&gt; Even if that the script published in linux-gazette is simple I think a
&gt; notice should refer to that page.
</pre>
<strong>
<p>
Kristian,
</p>

<p>
Thanks you very much for pointing out the (striking) similarity between the
scripts.  I think the link you pointed was created in Aug 1997.
</p>

<p>
I really haven't seen/copied that page (Hell, I can't even read German),
but I assure you, that it wasn't my fault.  
</p>


<p>
You can, if you want drop a line to Ben Okopnik and say to include a
copyright notice or something.  And I'll do that if I release a v2 of the
script.
</p>

<p>
I wasn't aware of the page, and I haven't copied anything.  Sorry if I hurt
anyone's feelings...
</p>

<p>
Thank you once again for pointing out the link.  I believe it was rather a
coincidence.
</p>

<p>
-- Mahesh Aravind
</p>
</strong>

<p>
[Ben] - Hi, Kristian -
</p>

<blockquote>
<p>
I'm probably the last guy in the world to ignore a copyright violation
or omit credit for an author - but Mahesh's code, other than the
necessary and obvious common points, is clearly different from the code
you cite. It's true that the output is much the same, but <em>any</em> script
designed to display console colors - and that includes my own version in
the Bash tutorial that I wrote, as well as the later versions that I
wrote in reply to Mahesh's post in the LG Answer Gang - is going to have
a similar-looking output; otherwise, it will have failed in its purpose.
</p>

<p>
If you take a look at the two scripts, even the programming structures
are different - except where they both use the escape codes as detailed
in the Bash-Prompt-HOWTO. If there's any credit that should be given,
both scripts should be crediting that document. :)
</p>

<p>
Again, if I considered it a copyright infringement of any sort, or an
omission of due credit, I would update our archives, even though - as I
often have to explain to people - the change would not propagate to our
mirror sites, since they've already downloaded the published issue. In
this case, however, it's not a matter of credit or copyright, and making
changes in published material without a powerful reason, especially when
those changes will only be seen by a vanishingly small percentage of
people, does not seem reasonable.
</p>
</blockquote>

<p>
[Rick] - I concur.  There's a common misconception that any similarity
shows "copying", and that any "copying" constitutes copyright infringement.
In fact, by law, copyright arises only in the "expressive elements" of a
creative work, first of all.  "Functional elements", e.g., portions of code
that embody the obvious, or only, or required-for-compatibility way of
doing things, are deemed to not be copyrightable at all.  
</p>

<blockquote>
<p>
That aside, if one has copied any substantive amount of something, it's
simple good manners to give acknowledgement -- but that doesn't seem to
apply here, either.  (I should hasten to add that all this was implied
by your wording; I'm just agreeing with you and making the point more
explicit.)
</p>
</blockquote>

<p class="editorial">[ Kristian's response is contained below in Ben's
next post. --Kat ]</p>


<p>
[Ben] - On Thu, Aug 17, 2006 at 12:47:10AM +0200, Kristian Orlopp wrote:
</p>

<blockquote>
<pre>
&gt; Hi !
&gt; 
&gt; &gt; If you take a look at the two scripts, even the programming structures
&gt; &gt; are different - except where they both use the escape codes as detailed
&gt; &gt; in the Bash-Prompt-HOWTO. If there's any credit that should be given,
&gt; &gt; both scripts should be crediting that document. :) &gt; 
&gt; Sorry, I did not want to be captious ;-)
</pre>
<p>
[smile] No problem at all, Kris; I didn't take it that way.
</p>
 
<pre>
&gt; Oh yes, you are right, I studied both codes in a closer way.
&gt; So I just learned the usage of a sequence in bash
&gt; via your "for j in $(seq 40 47)"-construct.
</pre>
<p>
Fun stuff, isn't it? There's a bunch of cool tiny utilities in the
'coreutils' (used to be 'shellutils') package that most people aren't
even aware of; 'seq' is only one of them. Most of them make a shell
programmer's life much, much easier.
</p>
 
<pre>
&gt; We in german say: "lots of ways lead to Rome" :)
</pre>
<p>
We have the same thing in English - except we say "Alle Wege f&uuml;hren
nach Rom". :) <a name="mailbag.12.copyright.html_1_back"></a><a href="#mailbag.12.copyright.html_1">[*]</a>
</p>

<p>
In fact, I figure that's what Alaric said back in 410AD...
</p>
 
<pre>
&gt; I am happy to read lots of scripting-examples, as I am not a programmer.
&gt; Here I want to say "thank you" for your work at linux-gazette.
&gt; I read it since 1999. Very good job !
</pre>
<p>
Thank you! I blame The Answer Gang and our staff and authors. :)
</p>
</blockquote>

<p>
<a name="mailbag.12.copyright.html_1"></a><a href="#mailbag.12.copyright.html_1_back">[*]</a><br>
[Rick] - A mere 401 years after Publius Quinctilius Varus said "D'oh!"
(That was on the occasion of Augustus Caesar losing the ability to count
beyond XVI.)
</p>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.13"></a>
<h3>Nullmodem</h3>
 
 <p>(cssutto at attglobal.net) cssutto at attglobal.net 
 <br /> 
 Wed Aug 16 14:29:11 PDT 2006</p> 
 <em>Answered by:  Kapil, Rick, Thomas</em> 
 
<strong>
<p>
Rick:
</p>

<p>
I looked at your recommendations and the list was long enough to be
confusing.
</p>

<p>
Since I operate from a laptop, it looked like this one might be the
right one for me.
</p>

<pre>
nbSMTP (no-brainer SMTP) 
</pre>
<p>
Is this OK or do you have a better suggestion?
</p>
</strong>

<p>
[Kapil] - Hello,
</p>

<blockquote>
<p>
On Wed, 16 Aug 2006, cssutto at attglobal.net wrote:
</p>

<pre>
&gt; Since I operate from a laptop, it looked like this one might be the
&gt; right one for me.
&gt; 
&gt; nbSMTP (no-brainer SMTP) 
&gt; 
&gt; Is this OK or do you have a better suggestion?
</pre>
<p>
Here is an alternative (which I probably learned from the LinuxMafia
Knowledge Base) which I use:
</p>

<pre class="code">
1. Setup a local MTA (aka sendmail alternative) using any simple to
   configure MTA. Ensure that it is configured <strong>not</strong> to send mail
   to the internet. This is so the system can send you messages if
   it notices some configuration problems etc.

2. In your user account setup msmtp to send mail via different "accounts"
   depending on which network neighbourhood you find yourself in.
</pre>
<p>
This works well for me.
</p>
</blockquote>

<p>
[Rick] - Quoting Kapil Hari Paranjape (kapil at imsc.res.in):
</p>

<blockquote>
<pre>
&gt; Here is an alternative (which I probably learned from the LinuxMafia
&gt; Knowledge Base) which I use:
</pre>
<p>
Heh, what do <em>those</em> guys know?  ;-&gt;
</p>

<pre>
&gt; 1. Setup a local MTA (aka sendmail alternative) using any simple to
&gt;    configure MTA. Ensure that it is configured <strong>not</strong> to send mail
&gt;    to the internet. This is so the system can send you messages if
&gt;    it notices some configuration problems etc.
</pre>
<p>
Reminds me of something that I used to be confused about:  I used to
mistakenly believe that you needed an MTA <em>daemon</em> running in order to 
process purely-local mail such as system automated notices, logfile
analysis, etc.  It turns out you don't:  Just having any MTA able to run
as an on-demand mailer, only long enough to process the mail and then
terminate, is more than good enough.
</p>

<p>
On Debian, this program by default is Exim.  (On 2.2 "potato", it was
Exim3; in recent versions, it's the Exim4 rewrite-from-scratch series.)  
</p>

<p>
As is traditional on Unixes, this program is callable by the name
"sendmail", even though it's not actually the sendmail program at all:
</p>

<pre class="code">
  # ls -l $(which sendmail)
  lrwxrwxrwx 1 root root 5 2006-04-22 08:47 /usr/sbin/sendmail -&gt; exim4
  #
</pre>
<p>
Non-sendmail MTAs such as Exim3, Exim4, Postfix, and Courier-MTA all 
honour all of sendmail's command-line options as well.  Dan Bernstein's 
qmail of course honours only a subset of them, because this is the
easygoing Dan we all know and love.  ;-&gt;
</p>
</blockquote>

<p>
[Rick] - Quoting cssutto at attglobal.net (cssutto at attglobal.net):
</p>

<blockquote>
<pre>
&gt; I looked at your recommendations and the list was long enough to be
&gt; confusing.
</pre>
<p>
It's a bit of an exaggeration to call that <em>recommendations</em>.  That page
is just a compendium of descriptions of all known examples.  I've never 
personally run any of them, and so can't really speak to choice of
nullmailer.
</p>

<pre>
&gt; Since I operate from a laptop, it looked like this one might be the
&gt; right one for me.
&gt; 
&gt; nbSMTP (no-brainer SMTP) 
&gt; 
&gt; Is this OK or do you have a better suggestion?
</pre>
<p>
Looking from a distance, it looks as good as any of the others -- which
is a fancy way of saying "I really don't know, but it's probably worth 
trying."
</p>

<p>
My history with MTAs is as follows:
</p>

<pre class="code">
1.  I started with sendmail, because I was young and foolish.  ;-&gt;

2.  I switched my personal mail machines from sendmail to Exim3
    because it was an emergency rebuild, and Exim3's what came by
    default in then-current releases of Debian, and was dead-easy 
    to configure.

3.  While working as chief sysadmin at $FIRM, a briefly famous 
    professional Linux support and services company in San Francisco 
    that shall go nameless ;-&gt; , I was obliged to administer qmail, 
    and didn't enjoy the experience much.

4.  Upon another rushed rebuild under (again) emergency conditions,
    found myself with a mostly well-functioning Exim4 installation, 
    and tend to not fool with it much because it's a production mail
    system and the Cost Plus rule applies.  ("You break it; you buy it.")
</pre>
<p>
None of those are nullmailers; they're all very full-service MTAs.
</p>
</blockquote>

<p>
[Thomas] - I've always used 'nullmailer' per se ( <a href="http://lists.suse.com/archive/suse-linux-uk-schools/2005-Jan/0049.html">http://lists.suse.com/archive/suse-linux-uk-schools/2005-Jan/0049.html</a> ).
</p>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.14"></a>
<h3>The all new Ubuntu.... Did I say something wrong?</h3>
 
 <p>clarjon1 (clarjon1 at gmail.com) 
 <br /> 
 Wed Aug 23 11:22:59 PDT 2006</p> 
 <em>Answered by:  David</em> 
 
<strong>
<p>
Hey gang!
</p>

<p>
I'm going to keep this as short, and concise, as I can.  Here goes:
</p>

<p>
I got some Ubuntu CDs yesterday!  10 Dapper Drake 6.06 LTS, with 2
sheets of 4 bumper stickers!  Got them from shipit.ubuntu.com
</p>

<p>
Of course, I booted it up... :D  They really improved the look and feel of
it.  Of course, I want to install it, right?  I'm done with gaming for now,
now that most of the games I play (emulators) work good under Linux
natively or via Wine.  So, I start the install program.  For those who have
used breezy badger, you would expect me to use the install CD.  The Dapper
drake allows you to install from the live cd -- Only one CD required to
ship now.  So, I started the install.  It asked me for a language, my
timezone, and then my keyboard layout.  I thought to myself, This is so
easy!  Boy, did I let Murphy and his law come in there.  After the correct
(i.e default) keyboard layout was selected, i clicked next.  And that's the
end of the story.  Not a single error message, the non-greyed out buttons
and text input boxes are still allowing input.  But on that window,
anywhere other than the text input, is the little "i'm thinking" mouse
pointer.  But nothing happens.  The CD isn't being read from, and the swap
partition isn't showing any signs of being used.  Any help would be
appreciated.
</p>

<p>
Thanks!
</p>
</strong>

<p>
[David] - "Over 300 post-release updates have been pre-applied, so that
fewer updates will need to be downloaded after installation, and a number
of bugs in the installation system have been corrected."
</p>

<blockquote>
<p>
I suspect that you may have been bitten by one of the installer bugs.
May I suggest trying a 6.06.1 install?
</p>
</blockquote>

<strong>
<p>
[clarjon1] - Yeah, I think I may have bitten one of the bugs alright.  I've
tried reinstalling with a different keyboard layout, and that seems to have
worked.
</p>
</strong>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.15"></a>
<h3>I will nead a little help or more!!!!!!</h3>
 
 <p>Nico Teiu (nicoleta_teiu at hotmail.com) 
 <br /> 
 Fri Aug 25 08:55:11 PDT 2006</p> 
  
 
<p class="editorial">[ Nico's initial post was embedded in a lot of html
gobbledygook; I hope that the readership will forgive my taking the easy
way out and starting the thread with Neil Youngman's initial response. As a
note to future querents to TAG, please send your inquiries in <b>plain
text</b>, not html. -- Kat ]</p>

<p>
On or around Friday 25 August 2006 16:55, Nico Teiu reorganised a bunch of 
electrons to form the message:
</p>

<pre>
&gt; Hello!
&gt;  
&gt; i'm Nicoleta from Roumania!
</pre>
<p>
Hi Nicoleta
</p>

<p>
I'm Neil from England
</p>

<pre>
&gt; I have a little problem, i wanted to make to partition from C and now it's
&gt; not working anything, my laste operated system does not work, i dont know
&gt; the bios password because i will want to reinstall my windows. 
</pre>
<p>
I'm not sure what the BIOS password has to do with reinstalling Wind0ws, 
unless you're saying it won't boot from CDROM?
</p>

<pre>
&gt; I have a Acer Laptop Travel Mate 552tx.
&gt;  
&gt; I dont know what to do
</pre>
<p>
OK. Start with a clear explanation.
</p>

<p>
Why were you trying to repartition your disk? Were you trying to install 
Linux? 
</p>

<p>
What tools did you use to repartition the system?
</p>

<p>
What error messages do you get when booting the system?
</p>

<p>
Do you want to reinstall Wind0ws alongside Linux, or just restore it to the 
way it was?
</p>

<pre>
&gt; Please help me!!!
</pre>
<p>
We'll try, but this is the Linux Gazette and reinstalling Wind0ws isn't our 
speciality. A Wind0ws support forum may prove more productive?
</p>

<p>
Neil Youngman
</p>

<p class="editorial">[ Nico additionally followed up with e-mail sent solely
to Neil. <strong>Note to future querents:</strong> Please do ensure that your e-mail is sent
to <a href="mailto:tag@lists.linuxgazette.net">tag@lists.linuxgazette.net</a>! -- Kat ]</p>

<p>
On or around Friday 25 August 2006 19:03, Nico Teiu reorganised a bunch of 
electrons to form the message:
</p>

<p>
Nico, please use "reply all" to keep emails going to the whole gang. You've 
got a better chance of getting the help you need if everyone's involved.
</p>

<pre>
&gt; I wanted to make another partition for instaling Linux
</pre>
<p>
Good idea.
</p>

<pre>
&gt; Now i had format my pc with a boot diskete of Wind0ws 98 and i dont know
&gt; how i can install the operating system. I had made the primary partition c,
&gt; so i dont know how to do more from this point I have on a dvd a version of
&gt; Red hat linux
</pre>
<p>
That's still not very clear. 
</p>

<p>
Are you saying you used Wind0ws 98's version of fdisk to repartition it? 
</p>

<p>
Did you defragment the disk first first?
</p>

<p>
Did you reformat any partitions with the format command.
</p>

<p>
Did it have Wind0ws 98 on to start with or a different Wind0ws version?
</p>

<p>
It would have been better to use the tools on the Linux disk to do this.
The 
Wind0ws tools aren't very good. 
</p>

<p>
Assuming that C: took up the whole partition  beforehand, or you know what
the 
partitions were, it may be that putting the partition back to the way they 
were will allow you to boot the old system and start again. If there has
been 
other data written to the partitions then that may not be possible.
</p>

<pre>
&gt; I want to install it because i want to learn linux
&gt; you can help me, on this dvd i have the 3 images of red hat linux
&gt; How can i install it?
</pre>
<p>
Do you want to install just RedHat, or RedHat and Wind0ws? I can offer a 
little help, but the best thing to do is to read the installation.
documentation on the RedHat site and follow the instructions carefully.
</p>

<p class="editorial">[ Again, I've used Neil's response rather than Nico's
html-ful post to TAG. -- Kat ]</p>


<p>
On or around Friday 25 August 2006 19:42, Nico Teiu reorganised a bunch of 
electrons to form the message:
</p>

<pre>
&gt; From:  Neil Youngman &lt;ny at youngman.org.uk&gt;
&gt; &gt;Are you saying you used Wind0ws 98's version of fdisk to repartition it?
&gt;
&gt; yes
&gt;
&gt; &gt;Did you defragment the disk first first?
&gt;
&gt; i dont know
&gt;
&gt; &gt;Did you reformat any partitions with the format command.
&gt;
&gt; i just fallow the steps
</pre>
<p>
Without knowing what steps you followed, it's going to be hard to figure
out 
what happened and how best to fix it.
</p>

''
&gt; &gt;Did it have Wind0ws 98 on to start with or a different Wind0ws version?
&gt;
&gt; I had window 2000
''

<p>
You probably had an NTFS file system, which the Wind0ws 98 tools wouldn't 
recognise. That may complicate things.
</p>

''
&gt; &gt;It would have been better to use the tools on the Linux disk to do this.
&gt; &gt; The Wind0ws tools aren't very good.
&gt;
&gt; i dont know how to get at the linux tools
&gt;
&gt; i can not boot from the cd because i dont have the bios password, and
&gt; floppy is put first there, on my laptopt is working anything in this moment
''

<p>
OK. It sounds as though you need to install Linux with a boot floppy. There 
are instructions at 
</p>

<p>
<a href="https://www.redhat.com/docs/manuals/linux/RHL-9-Manual/install-guide/s1-steps-install-cdrom.html#S2-STEPS-MAKE-DISKS">https://www.redhat.com/docs/manuals/linux/RHL-9-Manual/install-guide/s1-steps-install-cdrom.html#S2-STEPS-MAKE-DISKS</a>
</p>

<pre>
&gt; &gt;Do you want to install just RedHat, or RedHat and Wind0ws? I can offer a
&gt; &gt;little help, but the best thing to do is to read the installation
&gt; &gt;documentation on the RedHat site and follow the instructions carefully.
&gt;
&gt; Yes i will want to insall both, but i will need more Linux
</pre>
<p>
I'm afraid you'll need to ask someone else for help with reinstalling
Wind0ws.
</p>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.16"></a>
<h3>Kernel tweaking</h3>
 
 <p>Benjamin A. Okopnik (ben at linuxgazette.net) 
 <br /> 
 Mon Aug 28 08:46:41 PDT 2006</p> 
 <em>Answered by:  Pedro</em> 
 
<strong>
<p>
----- Forwarded message from Joris Lambrecht &lt;jl_post at telenet.be&gt;
-----
</p>

<p>
Hello tag,
</p>

<p>
As i'm a Debian user for some years and feel at home with this distro i
recently took on the challenge of moving to the testing distro (etch). Thus
reviving a desktop pc wich i had barely used for about 6 months.
</p>

<p>
Admittedly, i took the gorilla approach but hey, it works. And looks to be
one of the better released the Debian team and community is about to
deliver (Dec-2006)
</p>

<p>
But of course, but the kernelimage 2.6.16-2-k7 is preventing the
proprietary nvidia module to load, using m-a to rebuild it from scratch
failed on a 'rivafb   enabled' message. After reinstalling some previously
removed versions of gcc (sigh) that message (rivafb ...) dissapeared but
still the module wouldn't compile. 
</p>

<p>
So i tried to figure out how to disable this part of the kernel without
rebooting. Since i couldn't find any related information to this matter i
figured this is not possible, still somewhere in my memory the idea
persists.
</p>

<p>
As such i'd like to ask you people for a final opinion. Can a root-user
disable certain (external or compiled-in) modules in a running kernel, or
in this kernel at boottime ?
</p>

<p>
And, should you be able to spare the resources, why the plunk won't my
nvidia kernel module compile correctly without giving any other reason than
'could not be built'
</p>


<p>
Best of Regards,
</p>

<p>
Joris
</p>
</strong>

<p>
[Pedro] - Hi Joris,
</p>

<blockquote>
<p>
Talking about modules, if what you are trying to achieve is preventing
a module from loading automatically at boot time, I think there are at
least two things you may do:
</p>

<p>
1) Add a file under /etc/modprobe.d (or modify an existing one), with
the following content:
</p>

<pre>
blacklist &lt;your module name here&gt;
</pre>
<p>
If I have understood correctly, this line prevents the automatic
loading of a module based on its internal alias list. However, the
module may still be manually loaded with a "modprobe &lt;module name&gt;".
</p>

<p>
2) Again, under /etc/modprobe.d, put the following line in a file:
</p>

<pre>
install &lt;your module name here&gt; /bin/true
</pre>
<p>
This effectively disables the module load.
</p>

<p>
Both keywords ("install" and "blacklist") are explained in more detail
in the manual page of modprobe.conf.
</p>
</blockquote>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.17"></a>
<h3>Invisible Read!!</h3>
 
 <p>Vikas Mohan (vikas-m at chintech.org) 
 <br /> 
 Wed Aug 30 15:16:48 PDT 2006</p> 
 <em>Answered by:  Ben, Neil, Thomas</em> 
 
<strong>
<p>
Sir,</br>
             iam trying to emulate a login session.
</p>
 
<p>
             login:&lt;some login&gt;</br>
NOTE-----------------------&gt;password:&lt;the text typed here should not
be 
visible&gt; how to do this with shell script BASH.
</p>

<p>
Please this is my assignment and iam a student.
</p>

<p>your's faithfully,</br>
Vikas Mohan.
</p>
</strong>

<p>
[Ben] - It is indeed <strong>your</strong> assignment, and you <strong>are</strong> a student.
</p>

<blockquote>
<p>
That being the case, why aren't <strong>you</strong> *studying*? The idea of going to
school is for you to gain knowledge; when you try to cheat instead of
actually studying, you waste money, time, and effort - and that includes
other people's as well as your own.
</p>

<p>
Go study, Vikas Mohan from chintech.org <a
name="mailbag.830.invisible.html_1_back"></a><a
href="#mailbag.830.invisible.html_1">[1]</a>. I hope that your professor
reads Linux Gazette and gives you a poor grade in this class for
attempting to cheat; perhaps that will turn out to be the most valuable
part of your current education.
</p>

<p>
<a name="mailbag.830.invisible.html_1"></a><a
href="#mailbag.830.invisible.html_1_back">[1]</a> Chinmaya Institute of
Technology
Govindagiri, Chala
PO Thottada, Kannur 670007
</p>
</blockquote>

<p>
[Neil] - Ben, maybe a small credit is due for honesty here? Or am I being
too nice?
</p>

<blockquote>
<p>
Vikas - 
</p>

<p>
We don't do people's homework here, but we do occasionally point them in
the 
right direction. May I suggest that you read the man page for bash, 
specifically the part relating to the "read" builtin command and it's 
options. (RTFM  is good advice in these situations)
</p>

</blockquote>

<p>
[Ben] - On Thu, Aug 31, 2006 at 01:28:55PM +0100, Neil Youngman wrote:
</p>

<blockquote>
<pre>
&gt; Ben, maybe a small credit is due for honesty here? Or am I being too nice?
</pre>
<p>
You <em>are</em> a nice guy, Neil; me, well, I'm afraid that I see no redeeming
qualities in his request. Instead, I see either 1) a student going down
a bad path, or 2) a proto-skript-kiddie who wants to learn how to fake a
login session in order to steal login info. He clearly knows that it's
all about Bash - but just as clearly, he hasn't troubled himself to look
it up (a Net search with the keywords he used in his email is quite
instructive, BTW.)
</p>

<p>
I'm always happy to help someone with a real question - students
included - but basic stuff like this, where the OP just has to lift a
hand? Nope, no credit from me.
</p>

<p>
There are a bunch of routes to getting the necessary information; heck,
a net search alone turns up thousands of hits. My diagnosis is acute
grade-chasing, severely exacerbated by a laziness infection.
</p>
</blockquote>

<p>
[Thomas] - I assume you're referring to something like the following:
</p>

<blockquote>
<pre>
echo "Input secret: "
stty -echo
read -k key
[ "$key" == "$SomethingElse" ] &amp;&amp; stty echo
</pre>
<p>
Have fun.
</p>
</blockquote>

<p>
[Ben] - Actually, I think it was more like
</p>

<blockquote>
<pre>
echo "Be vewy vewy quiet - I'm hunting GWADES!"
stty --turn_off_the_noise
read --please_please_keep_it_quiet dont_let_anyone_find_out
stty --not_crazy
echo "I didn't study..."|mail -s 'Please fail me!' professor at chintech.org
</pre>
</blockquote>

<p>
[Neil] - Just "read -s key" should do it, if I've read the man page
correctly. 
</p>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.18"></a>
<h3>Port Linux on DSP</h3>
 
 <p>Neil Youngman (ny at youngman.org.uk) 
 <br /> 
 </p> 
  
 <p class="editorial">[ My thanks again to Neil Youngman for his quoting
messages otherwise unreadable to me. -- Kat ]</p>

<p>
On or around Wednesday 30 August 2006 13:59, [,,,] reorganised a bunch of 
electrons to form the message:
</p>

<pre>
&gt; Dear sir:
&gt;         I want port uclinux on freescale's 56800 DSP,can you give some
&gt; advice on how to deal with it and please give some materials on that.
&gt;                                                           Thank you!
</pre>
<p>
That's a very specialised question and I doubt that this list has the 
expertise to answer it. I would suggest trying the ucLinux mailing lists,
see 
<a href="http://www.uclinux.org/maillist/">http://www.uclinux.org/maillist/</a>
</p>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.19"></a>
<h3>Which process wrote that line into syslog? </h3>
 
 <p>Ville (v+tag at iki.fi) 
 <br /> 
 Tue Jun 27 06:37:26 PDT 2006 </p> 
 <em>Answered by:  Ben, Thomas</em> 
 
<strong>
<p>
Hi,
</p>

<p>
On an odd day, these began to pop into /var/log/messages:
</p>
</strong>
<pre>
                Jun 25 05:01:15 servername out of memory [19164^N\213^M at out]
                Jun 25 05:49:06 servername out of memory [25038^N\213^M at out]
                Jun 25 07:01:53 servername out of memory [10600^N\213^M at out]
                Jun 25 07:51:05 servername out of memory [16145^N\213^M at out]
                Jun 25 09:05:53 servername out of memory [24702^N\213^M at out]
                Jun 25 09:56:24 servername out of memory [30349^N\213^M at out]
                Jun 25 11:13:14 servername out of memory [7752^N\213^M at out ]
                Jun 25 12:05:04 servername out of memory [14101^N\213^M at out]
                Jun 25 13:23:53 servername out of memory [23758^N\213^M at out]
                Jun 25 14:17:00 servername out of memory [29815^N\213^M at out]
                Jun 25 15:37:52 servername out of memory [9325^N\213^M at out ]
                Jun 25 16:32:25 servername out of memory [16081^N\213^M at out]
                ....
</pre>
<strong>
<p>
(where 'servername' is the hostname of the server.)
</p>

<p>
Notice the absense of colon (':').
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
That's pretty odd. It looks like a hand-crufted message sent by "logger"
or something similar, not an actual system report (which makes me very,
very suspicious of where it may have come from.) In fact, an error
message from the kernel that dealt with this kind of issue would look
more like this:
</p>

<pre>
Jun 25 05:01:15 localhost kernel: oom-killer: gfp_mask=0x1d6
</pre>
</blockquote> 
 
<strong>
<p>[Ville]  -</p>
<p>
Exactly. I've seen those pesky kernel oom-rambo messages more than I wanted.
This was not it.
</p>

<p>
I had a couple of "usual" suspects, a closed-source UPS monitoring program
which is not exactly robustly coded and a closed-source virus scanner. I
haven't been able to conclusively link them to this problem, though.
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
That is, the kernel <strong>knows</strong> what to do about "out of memory" conditions;
it's not just going to <em>tell</em> you and wait for you to do something about
it. :)
</p>
</blockquote>
 
<strong>
<p>[Ville]  -</p>
<p>
Well, I've found that out the hard way and several other ways. It's just too
easy to have a oom problem. The kernel used to be even worse-behaved,
nowadays it seems to sometimes axe the actual culprit process, not <em>just</em>
innocent bystanders (like in early 2.4 days.) The overcommit setting in
/proc also helps.
</p>
 
<p>
No cronjob (my usual suspect) seemed to fit the bill. Google didn't give an
easy answer.
</p>

<p>
The first number <em>could</em> have been the PID, but then again, it could also be
pure junk. It was probably a shortlived process, or at least it probably
kept /dev/log open only for a short while.
</p>

<p>
This one almost^W drove me nuts. Which process and executable was littering
my syslog? Was there a real emergancy somewhere? It was almost like
receiving bottle mail - pretty hard to answer...
</p>
</strong>


<p>[Ben] -</p>
<blockquote>
<p>
Heh. Yeah, it's sorta like trying to troubleshoot intermittent problems
in electronics. There's more than one e-tech in a padded room due to
those.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
I've done some programming, and it tends to happen there as well. The most
tenacious ones only happen in once a month, with a 3GB data set, in another
country, and when you have it in reproducible state just waiting for a
remote debugger to get set up, the machine <em>must</em> be booted...
</p>

<p>
I did:
</p>
</strong>
<pre class="code">
        [1] grep -rsHU "out of memory \[" /usr/{sbin,bin,local/bin,local/sbin}
</pre>
<strong>            
<p>
==&gt; "out of memory \[" only matched one binary which I was able
    to rule out. "out of memory "  matched 93 files. I couldn't find "@out".
</p>
</strong>
<pre class="code">
        [2] strace -p $(pidof syslogd) -o /root/logi
</pre>
<strong>            
<p>
		and
</p>
</strong>            
<pre class="code">
            tail -f /root/logi | grep "out of memory" | grep writev | while
            read line; do
                  date &gt;&gt; /root/oom-trace
                  fuser -uv /dev/log &gt;&gt; /root/oom-trace
                  POSPID=$(echo $line|sed 's,.*y \[,,; s,\^N.*,,')
                  ps $POSPID &gt;&gt; /root/oom-trace
            done
</pre>
<strong>
<p>
            ==> Does not work, since the second | causes the pipeline
        to be so much buffered that the payload (fuser et al) didn't
        even trigger at the same minute (required several lines of input
        to get triggered).
</p>
</strong>

<p> [Thomas] - </p>
<blockquote>
Of course that won't work.  You want --line-buffered to grep (if you're
version is GNU and supports it) or you can use the 'unbuffer' expect
program, or if you had used awk (which would have greatly reduced your
entire ugly pipeline above), that has the fflush() system call.
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Hmm, how's awk any better than perl I used in the second version (which
<strong>did</strong> get rid of the buffer problem)? I anticipated there was something like
--line-buffered in existence, but, it was quicker to redo it with perl that I
knew was going to work.
</p>
</strong>


<p> [Thomas] - </p>
<blockquote>
YMMV on this.  Choice is such a wonderful thing.
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
The first option got ugly and lengthy incrementally as I added more filters.
Doesn't that ever happen to you? I never meant it to be pretty, I just
wanted to solve the problem...
</p>

<pre class="code">
        [3] strace -p $(pidof syslogd) -o /root/logi
              and
            tail -f /root/logi |
            perl -nle '
              next unless /^writev.*out of memory \[(\d+)/;
              print `date;
              $pospid = $1;
              print "Possible pid = $pospid";
              print `echo \$\$`;
              print `fuser -uv /dev/log`;
              print `ps le $pospid`;
            ' | tee /root/oom-trace
</pre>
<p>
            ==&gt; This one triggered, but as I suspected, fuser was
	    executed too late (the process had already closed /dev/log)
	    and ps likewise (and there's no evidence that $pospid
	    was really <strong>the</strong> pid.).

        [4] Encouraged by 
            <a href="http://www.linux.com/howtos/Secure-Programs-HOWTO/sockets.shtml">http://www.linux.com/howtos/Secure-Programs-HOWTO/sockets.shtml</a>
            I hacked the following
</p>
</strong>

<pre class="code">
--- syslogd.c~  Tue Jun 27 09:38:03 2006
+++ syslogd.c   Tue Jun 27 10:06:02 2006
@@ -1104,8 +1104,33 @@ int main(argc, argv)
 #ifdef SYSLOG_UNIXAF
                for (i = 0; i &lt; nfunix; i++) {
                    if ((fd = funix[i]) != -1 &amp;&amp; FD_ISSET(fd, &amp;readfds)) {
+                       struct ucred cr;
+                       int cl=sizeof(cr);
+                       int ret;
+                       
+                       ret = getsockopt(fd, SOL_SOCKET, SO_PEERCRED, &amp;cr, &amp;cl);
+                       
                        memset(line, '\0', sizeof(line));
                        i = recv(fd, line, MAXLINE - 2, 0);
+                       
+                       dprintf("ret=%i  Peer's pid=%d, uid=%d, gid=%d\n",
+                               ret, cr.pid, cr.uid, cr.gid);
+                       if (ret == 0 &amp;&amp; strstr(line, "out of memory"))
+                       {
+                            char tmp[1024];
+                            int t;
+                            snprintf(tmp, sizeof(tmp), "fuser -vu /dev/log &gt;&gt; /root/syslog.log");
+                            system(tmp);
+                            snprintf(tmp, sizeof(tmp), "ps le %d &gt;&gt; /root/syslog.log", cr.pid);
+                            system(tmp);
+                            memset(tmp, 0, sizeof(tmp));
+                            t = snprintf(tmp, sizeof(tmp),
+                                "ret=%d   Peer's pid=%d, uid=%d, gid=%d\n",
+                                ret, cr.pid, cr.uid, cr.gid);
+                             printchopped(LocalHostName, tmp, t + 1, fd);
+                       }
+                                     
+                                     
                        dprintf("Message from UNIX socket: #%d\n", fd);
                        if (i &gt; 0) {
                                line[i] = line[i+1] = '\0';
</pre>
<strong>
<p>
into sysklogd-1.4.1.
</p>

<p>
	    I thought this was easier than writing an unix domain reader/writer
            proxy to read /dev/log and feed real syslogd.
</p> 

<p>
==&gt; That one triggered, but I only got
</p>
</strong>

<pre class="code">
                ret=0   Peer's pid=0, uid=-1, gid=-1
</pre>
<strong>
<p>
            and naturally, fuser &amp; ps showed nothing interesting. This also
            happened when I tested the hack with
</p>
</strong>

<pre class="code">
                initlog -s "out of memory [foo"
</pre>
<strong>
<p>
Later, the messages stopped appearing.
</p>

<p>
Some notes:
</p>
</strong>

<pre>
  - This was a productiong server =&gt; the most reckless stunts were out of question
  - 2.4.32-rc1 kernel =&gt; hence no dnotify/inotify goodness (nevermind dprobes)
  - getsockopt(SO_PEERCRED) was introduced in 2.2, so that one WAS supposed to 
    work
</pre>
<p>[Ben] -</p>
<blockquote>
<p>
Well, SO_PEERCRED depends on the socket being created by socketpair()
(see 'man 7 socket'); I'm not willing to dig through the syslog code to
find out if that's the case, but it should be easy enough to hack up a
short test prog to see if it works or not.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Sure. The syslogd end just does
</p>
<pre>
  sunx.sun_family = AF_UNIX;
  strcpy(sunx.sun_path, "/dev/log");
  fd = socket(AF_UNIX, SOCK_DGRAM, 0);
  bind(fd, (struct sockaddr*) &sunx, sizeof(sunx.sun_family)+strlen(sunx.sun_path));
</pre>

<p>
Somewhat like
<a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/rzab6/uafunix.htm">http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/rzab6/uafunix.htm</a>
-- no socketpair().
</p>

<p>
The problem of course is that I don't know what the client does - because I
don't know who the client is in this case...
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
[Nod] I suspect that you're out of luck with that approach, then.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
</strong>
<pre>
  - sysklogd-1.4.1-14.legacy.7x (the source code I hacked was sysklogd-1.4.1-19 or 
    so from Debian archive (the first I was able to find)
  - syslogd was NOT accepting crap from network (verified several times, and supported
    by strace - the message came from the /dev/log unix domain socket.)
</pre>
<strong>
<p>
The odds are, I'm never going to find out where the heck they came from. I'm still
rather curious how a real linux admin is supposed solve this sort of thing... I know 
Solaris has dtrace, but unfortunately I couldn't transfer the problem onto Solaris.
</p>
</strong>


<p>[Ben] -</p>
<blockquote>
<p>
I suppose you could try attaching 'strace' to the syslog process, if you
prefer that approach.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
If you mean "strace -o $(pidof syslogd)" I did that in alternatives [1] and
[2]. The only thing I found out was that <em>someone</em> writes the message to
/dev/log and syslogd picks it up from there.
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
Whoops! Sorry, I don't know how I managed to miss that.
</blockquote>

<p>
[Thomas] -
</p>
<blockquote>
Looking at your initial log from /var/log/messages (and assuming that
was an accurate verbatim copy, as opposed to having your editor or some
other program mangle it)
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
I did change the server name to protect the innocent, but nothing else.
</p>
</strong>

<p>
[Thomas] -
</p>
<blockquote>
I would have said it was some weird error
message from a program that the perhaps logger(1) obligingly shunted
there -- this could explain the lack of the rigid structure (c.f. no
colon) you noticed.
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
logger(1) and initlog(1) both seem to add ':' there, but I did not try
all the command line options.
</p>
 
<p>
At this point the alternatives I can think of are 
</p>
</strong>

<pre>
  - writing a kernel module to overwrite connect() syscall with logging variant
  - modifying glibc to do the same (provided the culprit is not statically linked)
  - instrumenting the kernel by some other means (perhaps vai /dev/kmem)
</pre>
<p>[Thomas] -</p>
<blockquote>
Overkill and completely unnecessary.
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
I do realize <em>that</em> (if nothing else) :). 
</p>
</strong>

<p>[Thomas] -</p>
<blockquote>
If you can't reliably reproduce
it, it can be much of a problem.
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
What ever happened to the pioneer spirit of finding out the solution just
for the sake of it? ;-) 
</p>
</strong>

<p>[Thomas] -</p>
<blockquote>
Depends how much time you have on your hands, I suppose.  The output is
indeed not similar to any output I would expect a standard process to
generate -- so either it's a faulty process, or more likely some rogue
process was running on your system.
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
... which is why I initially got curious.
</p>

<p>
What I meant to ask from TAG is, in more general terms, how does one find
out which process/executable responsible for an odd syslog line. I didn't
mean to ask TAG to solve all my problems, sorry if it came out that way.
</p>
</strong>

<p>[Thomas] -</p>
<blockquote>
<p>
"With difficulty" is the answer.  PIDs change each time a process is
spawned, and any kind of persistent data one observes within any of the
log files is a snapshot in time usually.
</p>
</blockquote>


<p>[Ben] -</p>
<blockquote>
<p>
The question is, a snapshot of <em>what</em> time? Ville is definitely trying
the right thing, since part of the SO_PEERCRED definition is "The
returned credentials are those that were in effect at the time of the
call to connect(2)  or  socketpair(2)" - <strong>not</strong> at the time of the call
to 'getsockopt'.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Trying, perhpas, but probably not having enough knowledge to do so :) (See
my other message.)
</p>
</strong>
 
<p>[Thomas] -</p>
<blockquote>
<p>
Since this output is dubious
at best, and points to something which is non-standard (it has to be
since it's not easily identifiable) then you have two choices:
</p>

<p>
- Sit at your computer endlessly rotating logfiles to see if it happens
  again.  (Comes with a health-warning though).
</p>
</blockquote>


<strong>
<p>[Ville]  -</p>
<p>
Hmm, I find myself sitting on the front of computer anyway, and come to
think of it I'm not sure about my health either. But again, that's a
separate question.
</p>
</strong>

<p>[Thomas] -</p>
<blockquote>
<p>
- Use a reporting tool that monitors your /var/log/messages file for any
  occurances of a regexp such that it also generates other data and
  emails you the report.
</p>
</blockquote>
 
<p>[Ben] -</p>
<blockquote>
<p>
Too slow, as his experience so far has shown - and would tell him
nothing useful, since the message itself does not contain a pointer back
to the process. As is indeed the case, sometimes.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Actually, I've been using logcheck and LogWatch. No matter how delirious
this question might sound, it didn't exactly come to me as a revelation in a
premonition dream...
</p>

<p>
LogWatch does generate other data, and logcheck is mostly a filter. Both of
these scan the log files periodically - woefully late to dig any further
information of the then-gone mysterious process.
</p>

<p>
There might be other tools that scan the log file continuously, but I think
they still suffer from the latency I faced in my try [2] in the original
problem report - you just can't execute ps(1) or anything quite fast enough,
the process is already gone then. Remember that both ps and fuser scan
/proc on linux - not exactly lightning fast.
</p>
</strong>


<p>[Thomas] -</p>
<blockquote>
<p>
I'd go with the second choice.  :)  I can't remember off the top of my
head the names of programs which do that, but they do exist (that's some
homework for you to do).  Whether the reporting mechanism suffers from
any latency in terms of the message appearing in /var/log/messages, and
any subsequent data you might reply on thereafter (such as a 'ps'
snapshot) is unclear, you'd have to see.
</p>
</blockquote>


<strong>
<p>[Ville]  -</p>
<p>
Well, I'll have a look, but I do fear that's a dead end. 
</p>

<p>
I <em>think</em> the answer (if any) would have to be something that reliably gets
the information when the process is still connected to /dev/log. That's
exactly what I tried to achieve by hacking syslogd to save the PID of the
process that's at the other end of the /dev/log unix domain socket.
</p>
</strong>

<p>[Thomas] -</p>
<blockquote>
<p>
Going down the root-kit avenue is probably the better option still, even
if you do consider it another question in its own right.
</p>

<p>
Note that you might want to install
some root-kit devices to be sure it's not some h4x0r.
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
Thanks, I did consider that (but that's a separate question...)
</p>
</strong>

<p>[Thomas] -</p>
<blockquote>
<p>
How do you mean? It's something you should look into.
</p>
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
I mean "I am naturally looking into that, but that is a separate question."
</p>

<p>
None of these seem even remotely feasible (expect for, perhaps, the glibc alternative.)
</p>

<p>
Please, hit me with a cluestick!
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
Ville, I don't think that such a cluestick exists; you've definitely got
a Very Large Clue, and have done a bunch of right things in pursuit of
that elusive beast. You may, in fact, win the "most clued querent ever"
award in TAG - [ ... ]
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
... the crucial things to realize of course is that 
 - the MOST clued querents never get to ask TAG, because they already have
   to problem solved
 - the SECONDS MOST clued ones know where to stop and don't bang their heads 
   against the wall endlessly.
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
Sure; my point was that, out of the querents we get, we're most likely
to see a) the completely lost, b) the moderately clued looking for "the
next step", and c) highly clued but with a complex, subtle problem. a)
is fine, b) is interesting, and we don't get enough of it, and c) can be
frustrating by its nature but the search to find the answer is usually
fascinating (where it's not so application/situation/querent specific
that it's of no help to anyone other than the querent.) Your question
manages to pass that hurdle without even ticking the top bar - I see the
answer to it as something that would be very useful to admins and other
system people everywhere.
</p>
</blockquote>

<p>[Ben] -</p>
<blockquote>
 [ ... ] <strong>with</strong> the oak cluster and the maple leaf. It's just
that, given your bug's intermittent (and now completely absent) nature,
there's nothing left to trace.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Exactly. That's the problem.
</p>

<p>
But when you've already walked such a long way, and the rainbow vanishes
and there's no longer a gold pot to hunt -- the only thing you can do is to
look around and try to learn. That's what I was trying to do here. The
actual problem might never show up, but perhaps I'll be just a little more
better-prepared for the next one. I already got to know about grep
--line-buffered (although it is not present in grep-2.4.2-5 I have on the
server), getsockopt(SO_PEERCRED) and its socketpair() limitation. And it got
me thinking about Solaris dtrace which actually now <em>does</em> sound useful.
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
I agree with you, and I appreciate that motivation highly - since I
believe that this is how the best types of learning happen. Being able
to fix the problem is very, very important - but gleaning knowledge of
how to fix the <strong>category</strong> of that kind of problems is miles better than
that, especially if it can be propagated to others.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
It did appears for about two days, perhaps once an hour on average.
</p>

<p>
The system was not that short of memory at that time (it's been much worse
at times), so it might have had something to do with the data the program
was chewing (for example email spam/virus scanner trying to bite a too big
mail.)
</p>
</strong>


<p>[Ben] -</p>
<blockquote>
<p>
As to how I would go about tracing such a bug if it was present on my
system - I think I'd note how often it occurred (often, hopefully), and
start killing all non-essential processes to narrow down the list of
what it could be. Next, I'd see if I could replace the essential
processes with similar programs, one at a time, and look for the
messages to disappear.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
The problem with an oldish production server is, that not all the programs
can be replaced. Thankfully, this box doesn't run Oracle, but for example the
UPS monitoring program has been kind of shaky, but that's the only thing that
talks to this brand of UPSes. A few years ago I did trace an unexplained log
message back to this very software.
</p>

<p>
I actually did something remotely like this. I weeded some spam from the
mail queue and one <strong>large</strong> mail that was generated by a overly keen logger.
That might have caused the problem to disappear, but then again it might be
completely unrelated.
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
You did mention that it's a production server... yeah, but what do you
do with a production server if it's got (e.g.) a rootkit on it? The
answer is the same as with any other system: you take it off-line (in
the case of the server, hopefully by replacing it with a working
machine) and fix it. That part of the scenario doesn't change regardless
of how "critical" that machine is; the problem you're describing
supersedes that critical need, since it implies a far more dangerous
problem than the one on the surface.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
This is a very though call to make. Obviously, even given inifinite time for
system administration you can't just format and redo a server each time
<em>something</em> unexplained happens. Many times, I've traced unexplained events
for hours, and eventually found a perfectly understandable (if not valid)
reason for them. In case of security problems, there's usually also been a
string clue, having looked hard enough. That doesn't mean there's a decisive
clue in all cases, and <strong>that's</strong> when it's hard to decide what to do. Wipe
out and reinstall? Forget about it?
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
It depends on your security policy, of course. Most places don't care
enough about it to do something like that; those that do set up systems
that make the "wipe/reinstall" cycle a trivial, nearly-automatic
procedure and don't consider it a problem to do so.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
I don't agree 100%. I still think it implies a <em>possibility</em> of a far more
dangerous problem. This is about risk management. Obviously the magnitude of
the threat here is very severe, but so is, say, crashing a car on a highway.
If you hear strange sounds from a wheel, you might stop and investigate, but
if you (and mechanics) can't spot the problem and it doesn't happens again,
you might forget about it and go on instead of buying a new car.
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
Not if you're driving a Formula1 car, though. :) At that point, swapping
in a new steering system is essentially a "standard" task; the stakes
are very high, the car is made for it, and "heck, I dunno" is not an
acceptable answer.
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Now, the magnitude <strong>and</strong> the likelihood of the threat vary, but you still must
draw the line somewhere. Even though the Right Thing to do would be to
re-install.
</p>

<p>
(Or at least tell me why getsockopt(SO_PEERCRED) failed...)
</p>
</strong>


<p>[Ben] -</p>
<blockquote>
<p>
Write a test program and let us know. :) 
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
I'll try getsockopt(SO_PEERCRED) on socketpair() vs.
socket()-bind()-listen() a la
</p>

<p>
<a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/rzab6/uafunix.htm">http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/rzab6/uafunix.htm</a><br>
<a href="http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/rzab6/uafunix.htm">http://publib.boulder.ibm.com/infocenter/iseries/v5r4/index.jsp?topic=/rzab6/uafunix.htm</a>
</p>

<p>
and let you know.
</p>
</strong>


<p>[Ben] -</p>
<blockquote>
<p>
Better yet, if you discover a
bug, let the developers know.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
I'm sure it's in my code - this was my first getsockopt(SO_PEERCRED) hack,
afterall. Although there have been bugs: 
<a href="http://www.redhat.com/docs/manuals/enterprise/RHEL-3-Manual/release-notes/as-s390/RELEASE-NOTES-U1-s390-en.html">http://www.redhat.com/docs/manuals/enterprise/RHEL-3-Manual/release-notes/as-s390/RELEASE-NOTES-U1-s390-en.html</a>
</p>
</strong>

<p>[Thomas] -</p>
<blockquote>
<p>
Most likely it was syslogd trying to use that call to ascertain the
user/process who opened the logfile in the first place.
</p>
</blockquote>

<strong>
<p>
[Ville]  -
</p>
<p>
Umh, come again? 
</p>

<p>
I couldn't find getsockopt(... SO_PEERCRED ...) anywhere in the sysklogd
source in the first place [1] -- that's the very reason I added it there. 
</p>

<p>
Thank you for your insights.
</p>

<p>
[1] Most likely because getsockopt(SO_PEERCRED) is linux only, and 
    sysklogd is older that getsockopt(SO_PEERCRED) in linux kernel)
</p>
</strong>

<p class="editorial">[ Some time passes... ]</p>

<strong>
<p>[Ville]  -</p>
<p>
Adding the <a href="http://iki.fi/v/tmp/syslogd-peercred.patch">http://iki.fi/v/tmp/syslogd-peercred.patch</a> snippet to the (small
and well-commented) server example from above:
</p>

<pre class="code">
      sd2 = accept(sd, NULL, NULL);
      if (sd2 &lt; 0)
      {  
         perror("accept() failed");
         break;
      }
      
+      {   
+          struct ucred cr;
+          int cl=sizeof(cr);
+          int ret;
+          
+          ret = getsockopt(sd, SOL_SOCKET, SO_PEERCRED, &amp;cr, &amp;cl);
+          printf("ret=%i  Peer's pid=%d, uid=%d, gid=%d\n",
+                  ret, cr.pid, cr.uid, cr.gid);
+          ret = getsockopt(sd2, SOL_SOCKET, SO_PEERCRED, &amp;cr, &amp;cl);
+          printf("ret=%i  Peer's pid=%d, uid=%d, gid=%d\n",
+                  ret, cr.pid, cr.uid, cr.gid);
+      }


% ./server& ./client     
Ready for client connect().
[3] 12836
ret=0  Peer's pid=12836, uid=1414, gid=100
ret=0  Peer's pid=12837, uid=1414, gid=100
250 bytes of data were received
</pre>
<p>
so it works with socket()-bind()-listen()-accept(), not just with
socketpair(). (To be completely frank, I found socket(7) and unix(7) a tad
vague about these things.) The output does reveal that you need to
getsockopt() that for the accepted connetion.
</p>

<p>
But syslogd.c doesn't do accept(), it just select()'s and then recv()'s.
</p>

<p>
I believe the crucial difference is explained in an syslogd.c comment
</p>

<pre>
    * Changed: unixm is gone, since we now use datagram unix sockets.
    * Hence we recv() from unix sockets directly (rather than
    * first accept()ing connections on them), so there's no need 
    * for separate book-keeping.  --okir
</pre>
<p>
That's probably why it doesn't work.
</p>

<p>
More precisely, the boulder.ibm.com example does
</p>
<pre class="code">
  sd = socket(AF_UNIX, SOCK_STREAM, 0);
whereas syslogd.c does
  socket(AF_UNIX, SOCK_DGRAM, 0);
</pre>
[Ville]  -

<pre>
On Wed, Jun 28, 2006 at 10:53:45AM +0300, you [Ville]  wrote:
> 
> Yes .../lib/ likewise. I actually tried to grep more directories, but I
> concluded it couldn't 100% solve the problem, since "out of memory" string
> occurs in so many places, and the rest might just as well be a random
> argument to sprintf("%s").
</pre>
<p>
But looking closer, I noticed f-prot (one of my usual prime suspects) has 
" [%s]" just above "out of memory" in strings(1) output.
</p>

<p>
One of the first things I tried was in fact sth like
</p>

<pre class="code">
 cat &gt; /usr/local/f-prot/f-prot.WRAP &lt;&lt;END 
 #!/bin/sh

 TMP=/var/tmp/fprot.last.$$
 strace -o $TMP /usr/local/f-prot/f-prot $*

 if grep -q "out of memory" $TMP; then
   free | mutt -a $TMP -s "f-prot out of memory" root
 fi

 rm $TMP
 END

 mv /usr/local/f-prot/f-prot /usr/local/f-prot/f-prot.REAL
 ln -s /usr/local/f-prot/f-prot.WRAP /usr/local/f-prot/f-prot
</pre>
<p>
I trust you realize why that was not a great idea (hint: that's when I last
had an appointment with kernel oom killer...) Eventually I got it right of
course, but it didn't trigger soon, so took it off.
</p>

<p>
(I didn't list this step in the original message, because it was <strong>just</strong> a shot
in the dark, and the results were not so great.)
</p>

<p>
Trying to make f-prot run out of memory _on purpose_ turns out to be
surprisingly difficult. <em>Without</em> purpose, it <strong>really</strong> has not been a
problem in the past. Larger .ZIPs have caused it to wake up kernel oom
rambo, which in turn has killed a lot of innocent daemons. Now, no matter
what I try, I can't seem to get it run oom. 
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
Well, if they have somehow managed to handle the "huge ZIP" problem,
great for them - but, just in case, see the mime-encoded chunk below
(it's a 238-byte long result of double-bzipping 1 <strong>terabyte</strong> of nulls.)
That tends to break most AV filters, so I'm not sending it as an
attachment; you can always decode it and send it to yourself, though. :)
</p>
</blockquote>

<pre>
---------------------------------------------------------------------
--vkogqOf2sHV7VnPd
Content-Type: application/octet-stream
Content-Disposition: attachment; filename="1TB_of_nulls.bz2.bz2"
Content-Transfer-Encoding: base64

QlpoOTFBWSZTWcaRHXYC7Jt//2LxQgjDAWCkcQIIMMBAQABEEUSAYCEACFAAAAC0ADABcABg
NGQ0GEA0A00AAJqqoADQDQA0AYj0JoYDRkNBhANANNAAYFKIWwUohYilELZ65SiFyaZSiF5b
m6UohYpSiF+ylELblKIXjm7tXMUohYYSlELeKUQtHEUohaJSiFkx5ceEpRC9SlELNzylEL6K
UQvwpRC9ilELKUohfZSiFl4ZSiF8ZsMxSiF8ylELRrwlKIWfPyylELjlKIWnThKUQsmnzKUQ
tWjXKUQtf9KUQtf+LuSKcKEhjSI67A==

--vkogqOf2sHV7VnPd--
---------------------------------------------------------------------
</pre>
<strong>
<p>[Ville]  -</p>
<p>
Good idea. I recall ridiculing f-prot with such bombs a few years a go, when
they got some publicity. Back then, f-prot failed miserably (had a meeting
with the kernel oom rambo). But a few years a go, f-prot had trouble even
with 'normal' large .zip's. Now I'm surprised to see how small foot print it
has chewing large archives. They must have done <em>something</em>, although I
admit I had lost hope.
</p>

<p>
To be frank, I was unable to base64 decode your attachment. I did fed it to
'base64 -d', which said
</p> 

<pre>
 base64 1.2
 Copyright 2004, 2005 Simon Josefsson.
 Base64 comes with NO WARRANTY, to the extent permitted by law.
 You may redistribute copies of Base64 under the terms of the GNU
 General Public License.  For more information about these matters,
 see the file named COPYING.
 BZh91AY&amp;SY?v??b???0?@@DD^P?0p^Base64: invalid input

The starting (BZ) is at least right, but bzip2 says:

 base64 -q -d &lt; oo |bzip2 -d &gt; /dev/null
 base64: invalid input

 bzip2: Compressed file ends unexpectedly;
         perhaps it is corrupted?  &#042;Possible&#042; reason follows.
</pre>
<p>
Anyway, I did:
</p>
<pre class="code">
  f=foo
  mkdir $f
  for i in $(seq 1 10); do 
       touch $f/$f$i; 
       perl -e 'truncate "'$f/$f$i'", 1024**2'; 
  done 
  cp ~test-virus.gz foo/foo.gz

  for j in bar zot urf goo zik; do 
      mkdir $j
      zip -9 $j/$j.zip $f/$f* 
      for i in $(seq 2 10); do ln $j/$j.zip $j/$j$i.zip; done
      f=$j
  done
</pre>
<p>
(test-virus.gz contains the standard Eicar test virus in gzipped form.)
</p>

<p>
That should contain 100GB of zero and 10000 virii, if I counted right.
</p>

<p>
Surprisingly enough, it found the test virii:
</p>
<pre>
  test2/zik/zik.zip-&gt;goo/goo5.zip-&gt;urf/urf8.zip-&gt;zot/zot4.zip-&gt;bar/bar9.zip-&gt;foo/foo.gz-&gt;test-virus
  Infection: EICAR_Test_File
  (...)

  f-prot zik/zik.zip | grep -c Infection:
  10000
</pre>
<p>
and only consumed a tad over 6000k while doing so;
</p>

<pre>
12296 test      20   0  6044 6044   400 R    39.7  0.6   0:09 f-prot
                        ^^^^
</pre>
<p>
Since adding more zero seemed to add more cpu time that memory use, I first
went ballistic with the recursion, making it 20 branches wide and 30 levels
deep.
</p> 

<pre class="code">
  f=foo
  mkdir $f
  for i in $(seq 1 10); do
       touch $f/$f-$i;     
       perl -e 'truncate "'$f/$f-$i'", 1024';
  done
  cp ~/test-virus.gz foo/foo.gz
  
  for j in $(seq 1 30); do
      mkdir $j                    
      zip -9 $j/$j-1.zip $f/$f*
      for i in $(seq 2 20); do ln $j/$j-1.zip $j/$j-$i.zip; done
      f=$j                                                   
  done
  zip -9 all.zip $f/$f*
</pre>
<p>
Now, that <strong>must</strong> hurt... (Okay, 20^30 is far less than a googol, still
"much".)
</p>

<p>
With the largest of these, it segfaulted, until I gave it 8m of memory.
With 8m, It happily churned the all.zip (not all of it, since I only have
finite time, but still):
</p>

<pre>
  test2/all.zip-&gt;30/30-10.zip-&gt;29/29-10.zip-&gt;28/28-10.zip-&gt;27/27-10.zip-&gt;26/26-10-&gt;25/25-10.zip
  Infection: EICAR_Test_File
  (...)

  20534 test    18   0  7168 7168   412 R    64.5  0.7   5:33 f-prot
</pre>
<p>
But limiting the memory caused it to segfault, not give an oom message.
</p>

<p>
So if it ever going to oom in a "normal" situation (with the normal
ulimits), it's due to an odd bug, not a pathology in handling recursion.
</p>

<p>
Now, compare that to
</p> 
<pre>
   2393 haldaemo  16   0 72136 3364  636 S  0.0  0.7  14:54.79 hald                                                       
  23738 user      20   5 86908 9736 2504 R  0.3  1.9  14:27.96 xmms                                                       
  15806 user      15   0 30804 1604 1096 S  0.0  0.3  35:14.98 gnome-settings-daemon 
  15866 user      15   0 32168 4016 2820 S  0.7  0.8 744:28.97 gkrellm                                                    
</pre>
<p>
And so on and so on. Not bad from f-prot, I'd say.
</p>

</strong>

<p>[Ben] -</p>
<blockquote>
<p>
You could also try setting 'ulimit' to squeeze f-prot down to a small
footprint and see what that does.
</blockquote>
</p>

<strong>
<p>[Ville]  -</p>
<p>
I've been trying to do that. As I said, with 'addressspace', 'memoryuse'
and 'datasize' limited to 5m , f-prot fails to even load the virus db - if I
up it to 6m, f-prot churns through almost everything.
</p> 
</strong>

<strong>
<p>[Ville]  -</p>
The process 'addressspace',
'memoryuse' and 'datasize' limits seem to have megabyte granularity and with
5m f-prot can't even read the virus db (fails with different message - I'm
not surprised if it doesn't properly check every malloc()) and with 6m, it
happily churns through everything I throw at it. And it can be just one
allocation that triggers the log message, not every allocation that might
fail in it. But I'm still trying. (Oh, the joy of having source code vs. a
closed source program...)

<p>
Thank you for your insights! Much appreciated!
</p>
</strong>

 

</div><div class="mb-mailbag"><hr />
<a name="mailbag.20"></a>
<h3>Which process wrote that line into syslog? [2]</h3>
 
 <p>Ville (v+tag at iki.fi) 
 <br /> 
 Sat Jul 1 13:01:10 PDT 2006</p> 
 <em>Answered by:  Ben</em> 
 
<p class="editorial">[ This thread resulted from an earlier one of the same
name, but covers rather different ground - so it got an entry of its own.
-- Ben ]</p>


<p>[Ben] -</p>
<blockquote>
<p>
Sure; my point was that, out of the querents we get, we're most likely
to see a) the completely lost, b) the moderately clued looking for "the
next step", and c) highly clued but with a complex, subtle problem.
</p>

<p>
a) is fine,
</p> 
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
I can imagine it is - especially, when the querent shows some respect to the
ones who answer and willingness to learn, not just get rid of the problem.
</p> 
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
b) is interesting, and we don't get enough of it,
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
An optimist would perhaps presume that this is because the linux system and
documentation is in such a good shape that a clued person rarely runs into a
dead-end. A pessimist might find other reasons...
</p>
</strong>


<p>[Ben] -</p>
<blockquote>
<p>
and c) can be frustrating by its nature but the search to find the answer
is usually fascinating (where it's not so application/situation/querent
specific that it's of no help to anyone other than the querent.) Your
question manages to pass that hurdle without even ticking the top bar - I
see the answer to it as something that would be very useful to admins and
other system people everywhere.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
If you are in a dead-end, I think you can often (maybe not always) find a
pattern or a generalization of the problem, if you step back and look it
from distance.
</p>

<p>
In this case it is "how do I find which process wrote that line into
syslog", which in turn divides into several other less and more general
questions. While exploring the alternatives to get grip of the problem one
<em>surely</em> find a set of general patterns that can be useful in situations
other than the one at hand. If they are not familiar yet, looking closer to
them might be a valuable - the next time you'll know their possibilities and
limitations right from the start.
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
I agree with you, and I appreciate that motivation highly - since I
believe that this is how the best types of learning happen. Being able
to fix the problem is very, very important - but gleaning knowledge of
how to fix the <strong>category</strong> of that kind of problems is miles better than
that, especially if it can be propagated to others.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Yes, the 'category' metaphor describes quite accurately, what I tried
to say.
</p> 
</strong>


<p>[Ben] -</p>
<blockquote>
<p>
I assume you know about Perl's "$|" variable, then. If you don't,
'perldoc perlvar' will be highly enlightening. :)
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Actually, I do.
</p>

<p>
It was just that with the perl variation, buffering was not a problem, since
there was only one pipe in the equation. In hindsight, it might have been,
and if I had come to think of $|, I would have used it proactively. Good
idea.
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
I will say that Solaris tools for this kind of thing do come to my mind
a bit more readily than anything similar in Linux. For one thing, in
Solaris, you could always just enable BSM (be sure to have LOTS of disk
capacity for logging, though!) and beat on that machine with every
software hammer you've got until it does produce one of those warnings -
then, examine that microsecond-by-microsecond log that BSM produces. You
will <strong>definitely</strong> know who and what did X at Y time. I know that there's
got to be <strong>something</strong> like that for Linux, since I recall hearing that
Linux can pass the DoD "C2" certification - but I don't know what that
app would be.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
BSM sounds fascinating, but perhaps overkill, in case Solaris DTrace is
available...
</p>
 
<p>
	<a href="http://www.sun.com/bigadmin/content/dtrace/">http://www.sun.com/bigadmin/content/dtrace/</a><br>
    <a href="http://users.tpg.com.au/adsln4yb/dtrace.html">http://users.tpg.com.au/adsln4yb/dtrace.html</a><br>
    <a href="http://daemons.net/~matty/articles/solaris.dtracetopten.html">http://daemons.net/~matty/articles/solaris.dtracetopten.html</a><br>
    <a href="http://www.sun.com/software/solaris/howtoguides/dtracehowto.jsp">http://www.sun.com/software/solaris/howtoguides/dtracehowto.jsp</a><br>
</p>

<p>
    I think something like the following DTrace script:
</p>
<pre class="code">
      dtrace -n 'syscall::connect:entry 
                 / arg1-&gt;sun_path == "/dev/log" /
                 { printf("%s %s", execname, copyinstr(arg0)); }'
</pre>
<p>
(Completely untested as I have no Solaris installation around)
</p>

<p>
    would have solved the problem. (Add a time stamp and pid printing to 
    that).
</p>


<p>
There something like that for linux; kprobes &amp; systemtap: <br>
   <a href="http://sourceware.org/systemtap/">http://sourceware.org/systemtap/</a><br>
   <a href="http://www.redhat.com/magazine/011sep05/features/systemtap/">http://www.redhat.com/magazine/011sep05/features/systemtap/</a><br>
(And Frysk, Oprofile and LTT).
</p>

<p>
Systemtap wasn't available for the problem server, though, too old kernel.
</p>

<p>
I gather is would have been something like
</p>
<pre class="code">
   stap -p2 -e 'probe kernel.function("sys_connect") { 
       log "connect /dev/log called: " . 
           execname() . string(pid()) . 
           " at " . string(gettimeofday_s()) }'
</pre>
<p>
to solve the problem with systemtap.
</p> 

<p>
I haven't yet been able to test that, since on the box I first installed
systemtap, I couldn't get it working.
</p>

</strong>

<p>[Ben] -</p>
<blockquote>
<p>
It depends on your security policy, of course. Most places don't care
enough about it to do something like that; those that do set up systems
that make the "wipe/reinstall" cycle a trivial, nearly-automatic
procedure and don't consider it a problem to do so.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
Yes, the cost of reinstall is one crucial variable.
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<p>
Not if you're driving a Formula1 car, though. :) At that point, swapping
in a new steering system is essentially a "standard" task; the stakes
are very high, the car is made for it, and "heck, I dunno" is not an
acceptable answer.
</p>
</blockquote>

<strong>
<p>[Ville]  -</p>
<p>
For Mercedes F1 team it seems to be ;) (I don't know if you follow the F1
series, but Finnish Kimi R&auml;ikk&ouml;inen has been plagued with mechanical
problems for the past few years...)
</p>

<p>
Anyway, I so agree with you on that.
</p>

<p>
One more thing I tried was the LD_PRELOAD trick:
</p>
<pre class="code">
--8&lt;-----------------------------------------------------------------------
/* 
   gcc -shared -ldl -o libwrap_connect.so wrp.c
   LD_PRELOAD=/pth/to/libwrap_connect.so initlog -s "Test"
*/
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt; 
#include &lt;sys/types.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/un.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;


static int same_inode(char* file1, char* file2)
{
    struct stat st1, st2;
    if (stat(file1, &amp;st1) != 0 ||
        stat(file2, &amp;st2))
        return 0;

    return st1.st_dev == st2.st_dev &amp;&amp; 
           st1.st_ino == st2.st_ino;
}

static int read_file(char* file, char* buf, int sz_buf)
{
    int ret;
    FILE* f = fopen(file, "r");
    if (!f) return 0;
    ret = fread(buf, 1, sz_buf, f);
    fclose(f);
    
    return ret;
}
       
int connect(int sockfd, const struct sockaddr *sa, socklen_t addrlen)
{
    struct sockaddr_un* serv_addr = (struct sockaddr_un*)sa;
    if (serv_addr-&gt;sun_family == AF_UNIX &amp;&amp;
        same_inode(serv_addr-&gt;sun_path, "/dev/log"))
    {
        /* Note: should use file locking or at least sth like /tmp/LOG.&lt;pid&gt; 
           here */

        FILE* f = fopen("/tmp/LOG", "a");
        if (f)
        {
             int s;
             time_t t;
             char exename[PATH_MAX] = { 0 };
             char cmdline[512] = { 0 };
             readlink("/proc/self/exe", exename, sizeof(exename));
             s = read_file("/proc/self/cmdline", cmdline, sizeof(cmdline));
             for (--s; s &gt; 0; s--) 
                 if (cmdline[s] == '\0')
                     cmdline[s] = ' ';

             time(&amp;t);
             fprintf(f, "%s\t%s [%d] calling connect(\"/dev/log\")\n\t%s\n",
                     ctime(&amp;t),
                     exename,
                     getpid(),
                     cmdline);
             fclose(f);
        }
    }

    /* N.B. Simply replacing &lt;symbol&gt; with __&lt;symbol&gt; to access the original 
            function doesn't always work. See the output of "nm -D &lt;lib&gt;" to
            check if __&lt;symbol&gt; is available.

            You could do something like

               typedef void (*connect_t)(int sockfd, const struct sockaddr *sa, socklen_t addrlen);
               static connect_t real_connect;
        
               if (!real_connect)
               {
                   real_connect = (connect_t)dlsym(RTLD_NEXT, "connect");
                   if (!real_memcpy) exit(EXIT_FAILURE);
               }

            to reach the original symbol more reliably. */

    return __connect(sockfd, sa, addrlen);
}
--8&lt;-----------------------------------------------------------------------
</pre>
<p>
I got
</p>
<pre>
  Fri Jun 30 09:02:11 2006
          /sbin/initlog [10383] calling connect("/dev/log")
          initlog -s Test
</pre>
<p>
That was actually surprisingly easy to do (for a quick and dirty hack, you
could shorten the above a bit; same_file -&gt; strcmp etc).
</p>

<p>
It gives you a lot of possibilities for debugging, but it also has
downsides:
</p> 

  <p>
   - doesn't work with statically linked executables<br>
   - hard to enable globally<br>
   - doesn't affect daemons that are already running
</p>

<p>
I did have a look at syscall wrapper kernel modules, but since 2.4
sys_call_table hasn't been exported, so that's no longer feasible (and was
<strong>never</strong> encouraged.)
</p>

<p>
I also tried inotify-tools (<a href="http://rohanpm.net/inotify-tools">http://rohanpm.net/inotify-tools</a>), but inotify
doesn't seem to note unix domain socket connect() as file access.
</p>

<p>
As a side-note, a friend of mine tested the viral test.zip I created to
stress F-Prot with a handful of anti-virus programs and sent it to a couple
of anti-virus vendors. While F-Prot actually did pretty well with it, not
all anti-virus programs fared that well. According to him, at least Norman
already fixed up their product somewhat :)
</p>
</strong>


<p>[Ben] -</p>
<blockquote>
<pre>
On Thu, Jul 06, 2006 at 12:02:12PM +0300, Ville wrote:
&gt; On Sat, Jul 01, 2006 at 11:01:10PM +0300, you [Ville] wrote:
&gt; &gt; 
&gt; &gt;    stap -p2 -e 'probe kernel.function("sys_connect") { 
&gt; &gt;        log "connect /dev/log called: " . 
&gt; &gt;            execname() . string(pid()) . 
&gt; &gt;            " at " . string(gettimeofday_s()) }'
&gt; 
&gt; I actually tried this on a Fedora 5 system, and systemtap seems pretty cool
&gt; indeed.
&gt; 
&gt; It requires these:
&gt;    % yum install systemtap kernel-devel
&gt; And 'kprobes' enabled in kernel (Fedora and RHEL have that by default.)
&gt; 
&gt; and after that, you can do 
&gt; 
&gt;    % (sleep 10; mkdir test)&amp;
&gt;    [1] 9086                                         
&gt;    % stap -v -e 'probe kernel.function("sys_mkdir") 
&gt;                  { log("mkdir() called: "); 
&gt;                    log(execname()); 
&gt;                    log(string(pid()));
&gt;                    log(string(gettimeofday_s())); }'
</pre>
<p>
Actually, this is quite similar to the BSM config file - except for the
'log()' syntax. You'd just tell it what to log - reads, writes, etc.
Thanks for writing this up, by the way: that's an end of Linux that I
have never explored, myself, and I'm very, very chuffed to hear that
there's good tools available for it.
</p>
<pre>
&gt; So I definetely could have solved the problem with system tap, if the kernel
&gt; and distro had been new enough.
&gt; 
&gt; The only downside is this:
&gt; 
&gt;    % rpm -qi kernel-debuginfo
&gt;    Name        : kernel-debuginfo             Relocations: (not relocatable)
&gt;    Size        : 1730037086                       License: GPLv2
&gt;                  ^^^^^^^^^^
&gt;    % rpm -qi kernel-devel
&gt;    Name        : kernel-devel                 Relocations: (not relocatable)
&gt;    Size        : 13954129                         License: GPLv2
&gt;                  ^^^^^^^^
</pre>
<p>
Yikes. Well, that's generally the case with leaving all the debug info
in an executable - and, of course, doing it with the kernel verges on
the ridiculous.
</p>

<pre class="code">
r!calc 1730037086-13954129
1716082957
</pre>
<p>
2GB versus 14MB, wow. Pretty impressive. Well, if you go hunting
elephants, you definitely need a big-bore rifle...
</p>
</blockquote>


<strong>
<p>[Ville]  -</p>
<pre>
On Thu, Jul 06, 2006 at 10:48:27AM -0400, you [Benjamin A. Okopnik] wrote:
&gt; &gt;    % (sleep 10; mkdir test)&amp;
&gt; &gt;    [1] 9086                                         
&gt; &gt;    % stap -v -e 'probe kernel.function("sys_mkdir") 
&gt; &gt;                  { log("mkdir() called: "); 
&gt; &gt;                    log(execname()); 
&gt; &gt;                    log(string(pid()));
&gt; &gt;                    log(string(gettimeofday_s())); }'
&gt; 
&gt; Actually, this is quite similar to the BSM config file - except for the
&gt; 'log()' syntax. 
</pre>
<p>
That's very similar to Solaris DTrace (which i gather is slightly newer?)
</p>

<p>
I haven't actually tried it (I have no access to Solaris), but I have
drooled over several praising articles about it (see my earlier mail for
links). It is definetely nice Linux is gaining something similar.
</p>

<pre>
&gt; You'd just tell it what to log - reads, writes, etc. Thanks for writing
&gt; this up, by the way: that's an end of Linux that I have never explored,
&gt; myself, and I'm very, very chuffed to hear that there's good tools
&gt; available for it.
</pre>
<p>
Great :) I thought I was not the only one who hadn't yet explored it.
I won't paste the systemtap URLs again, since you probably spotted them in
my earlier mail.
</p>
<pre>
&gt; &gt;    % rpm -qi kernel-debuginfo
&gt; &gt;    Size        : 1730037086                       License: GPLv2
&gt; &gt;    % rpm -qi kernel-devel
&gt; &gt;    Size        : 13954129                         License: GPLv2
&gt; 
&gt; Yikes. Well, that's generally the case with leaving all the debug info
&gt; in an executable - and, of course, doing it with the kernel verges on
&gt; the ridiculous.
&gt;
&gt; 2GB versus 14MB, wow. Pretty impressive. 
</pre>
<p>
But you need to install <em>both</em> for systemtap. :-P
</p>
<pre>
&gt; Well, if you go hunting elephants, you definitely need a big-bore rifle...
</pre>
<p>
Sure, but it might feel like hunting for a fruit-fly riding a mammoth...
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<pre>
On Thu, Jul 06, 2006 at 09:21:28PM +0300, Ville wrote:
&gt; On Thu, Jul 06, 2006 at 10:48:27AM -0400, you [Benjamin A. Okopnik] wrote:
&gt; &gt; &gt;    % (sleep 10; mkdir test)&amp;
&gt; &gt; &gt;    [1] 9086                                         
&gt; &gt; &gt;    % stap -v -e 'probe kernel.function("sys_mkdir") 
&gt; &gt; &gt;                  { log("mkdir() called: "); 
&gt; &gt; &gt;                    log(execname()); 
&gt; &gt; &gt;                    log(string(pid()));
&gt; &gt; &gt;                    log(string(gettimeofday_s())); }'
&gt; &gt; 
&gt; &gt; Actually, this is quite similar to the BSM config file - except for the
&gt; &gt; 'log()' syntax. 
&gt; 
&gt; That's very similar to Solaris DTrace (which i gather is slightly newer?)
</pre>
<p>
Well, BSM is actually a full-time "recorder" that tracks exactly who
does what and at what time; it's one of the reasons that full-spec C2
systems are such a huge admin load. DTrace has similar capabilities, as
I understand it, but is more of a specific-case troubleshooting tool.
</p>
<pre>
&gt; I haven't actually tried it (I have no access to Solaris), but I have
&gt; drooled over several praising articles about it (see my earlier mail for
&gt; links). It is definetely nice Linux is gaining something similar.
</pre>
<p>
Yeah, DTrace was quite a leap in the state of the art when it first came
out. Again, I don't usually deal with that end of administration myself,
but I agree - it's wonderful to see similar tools made available for
Linux.
</p>
<pre>
&gt; &gt; 2GB versus 14MB, wow. Pretty impressive. 
&gt; 
&gt; But you need to install <em>both</em> for systemtap. :-P
</pre>
<p>
[laugh] Well, disk space is cheap nowadays. I still recall the days when
a 21MB hard drive cost over $200 - i.e., ~$10/MB. At those prices, the
above would have been a problem indeed.
</p>
<pre>
&gt; &gt; Well, if you go hunting elephants, you definitely need a big-bore rifle...
&gt; 
&gt; Sure, but it might feel like hunting for a fruit-fly riding a mammoth...
</pre>
<p>
Ah - the "use a tiny-caliber rifle but <strong>DON'T</strong> miss" scenario. Very
familiar. :)
</p>
</blockquote>


<strong>
<p>[Ville]  -</p>
<pre>
On Thu, Jul 06, 2006 at 09:21:28PM +0300, you [Ville] wrote:
&gt;  
&gt; &gt; &gt;    % rpm -qi kernel-debuginfo
&gt; &gt; &gt;    Size        : 1730037086                       License: GPLv2
&gt; &gt; &gt;    % rpm -qi kernel-devel
&gt; &gt; &gt;    Size        : 13954129                         License: GPLv2
&gt; &gt; 
&gt; &gt; Yikes. Well, that's generally the case with leaving all the debug info
&gt; &gt; in an executable - and, of course, doing it with the kernel verges on
&gt; &gt; the ridiculous.
&gt; 
&gt; &gt; 2GB versus 14MB, wow. Pretty impressive. 
&gt; 
&gt; But you need to install <em>both</em> for systemtap. :-P
</pre>
<p>
Well, as it happens, it seems Roland McGrath, Dave Jones and the other
Fedora kernel fellows have managed to slim down the elephant:
</p>

<p>
<a href="http://kernelslacker.livejournal.com/43037.html">http://kernelslacker.livejournal.com/43037.html</a>
</p>
<pre>
--8&lt;-----------------------------------------------------------------------
                 -debuginfo, now with 86% more awesome!   
Before:

-rwxr-xr-x 1 48 48 693332940 Jun 18 02:53  kernel-debuginfo-2.6.17-1.2136_FC5.i686.rpm

After:

-rwxr-xr-x 11 48 48 163280651 Jul 13 22:24 kernel-debuginfo-2.6.17-1.2396.fc6.i686.rpm
-rwxr-xr-x 11 48 48 27167808 Jul 13 22:07  kernel-debuginfo-common-2.6.17-1.2396.fc6.i686.rpm
-rwxr-xr-x 11 48 48 172196950 Jul 13 22:12 kernel-kdump-debuginfo-2.6.17-1.2396.fc6.i686.rpm
-rwxr-xr-x 11 48 48 163326708 Jul 13 22:18 kernel-PAE-debuginfo-2.6.17-1.2396.fc6.i686.rpm

We'd all be downloading a lot more bits if it wasn't for the efforts of
Roland McGrath on this one.
The amount of change in the kernel specfile isn't as much as I'd feared,
which was one reason I had procrastinated over this (besides constantly
seemed to find something more important to be tackling, like "my kernel
doesn't boot").

It may still need some slight tweaks, but it's getting there. Longterm,
hopefully we can bring down the size of the individual rpms further too.
</pre>
</strong>


<strong>
<p>[Ville]  -</p>
<p>
On Sun, Jul 16, 2006 at 09:26:31PM +0300, you [Ville] wrote:
</p>
<pre>
&gt; &gt; But you need to install <em>both</em> for systemtap. :-P
&gt; 
&gt; Well, as it happens, it seems Roland McGrath, Dave Jones and the other
&gt; Fedora kernel fellows have managed to slim down the elephant
</pre>
<p>
No just that, but now there's a GUI / IDE for systemp as well:<br>
<a href="http://stapgui.sourceforge.net/features.shtml">http://stapgui.sourceforge.net/features.shtml</a>
</p>
</strong>

<p>[Ben] -</p>
<blockquote>
<pre>
On Fri, Jul 21, 2006 at 02:12:47PM +0300, Ville wrote:
&gt; On Sun, Jul 16, 2006 at 09:26:31PM +0300, you [Ville] wrote:
&gt; &gt; &gt; But you need to install <em>both</em> for systemtap. :-P
&gt; &gt; 
&gt; &gt; Well, as it happens, it seems Roland McGrath, Dave Jones and the other
&gt; &gt; Fedora kernel fellows have managed to slim down the elephant
&gt; 
&gt; No just that, but now there's a GUI / IDE for systemp as well:
&gt; http://stapgui.sourceforge.net/features.shtml
</pre>
<p>
I've just been offered an opportunity to be certified as a Solaris-10
"Operating System Internals" instructor (it would require my going to a
week-long, open-skull/install-firehose type of training seminar in
Boston.) A part of the training involves lots of heavy-duty work with
'mdb', 'kmdb', and 'dtrace'. I don't think I'm going to do it - it's not
really my cuppa tea, even though there's theoretically a bunch of money
in it - but having someone who teaches this course and knows Linux take
a look at 'systemtap' would make for a very interesting comparison. I'm
going to see if a quiet word in the right ear will result in anything
publishable... at least eventually, since this class is still three
weeks away.
</p>
</blockquote>

 

</div>

<p class="talkback">
Talkback: <a
href="mailto:tag@lists.linuxgazette.net?subject=Talkback:131/lg_mail.html">Discuss this article with The Answer Gang</a>
</p>

<!-- *** BEGIN author bio *** -->

<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2006, . Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication license</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 131 of Linux Gazette, October 2006
</p>

</div>


<div id="previousnextbottom">
<A HREF="lg_talkback.html" >next --&gt;</A>
</div>


</div>






<div id="navigation">

<a href="../index.html">Home</a>
<a href="../faq/index.html">FAQ</a>
<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="http://lists.linuxgazette.net/mailman/listinfo/">Mailing Lists</a>
<a href="..//jobs.html">Join Us!</a>
<a href="../contact.html">Contact Us</a>

</div>



<div id="breadcrumbs">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">October 2006 (#131)</a> &gt; 
Article

</div>





<img src="../gx/tux_86x95_indexed.png" id="tux" alt="Tux"/>




</body>
</html>

