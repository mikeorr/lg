
<html>
<head>
<link href="../lg.css" rel="stylesheet" type="text/css" media="screen, projection"  />
<link rel="shortcut icon" href="../favicon.ico" />
<title>How To Make a StereoGram with GIMP, Blender and StereoGraph LG #104</title>

<style type="text/css" media="screen, projection">
<!--

-->
</style>

<link rel="alternate" type="application/rss+xml" title="LG RSS" href="lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="lg.rdf" />
<link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" />

</head>

<body>


<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
<p id="fun">...making Linux just a little more fun!</p>


<div class="content articlecontent">

<div id="previousnexttop">
<A HREF="brown.html" >&lt;-- prev</A> | <A HREF="odonovan.html" >next --&gt;</A>
</div>



<h1>How To Make a StereoGram with GIMP, Blender and StereoGraph</h1>
<p id="by"><b>By <A HREF="../authors/kapil.html">Kapil Hari Paranjape</A></b></p>

<p>
<a id="x1-10001"></a>
<h3>1. Introduction</h3>
<center><img src="misc/kapil/stereo2.png" alt="PIC" width=480 height=360>
<br>
<em>Do you see what I see?</em></center>

<p>Single Image Stereograms (SIS) are two-dimensional images that seem to be
three-dimensional; these 3-d images appear to "pop up" (or "pop down") out of 
the printed paper. The amount of training the typical human nervous system 
requires to see such images seems to vary from person to person; it seems to 
help if you are old and myopic! This tutorial is not about <em>that</em>
however; it is about <em>creating</em> the images that will invoke the 3-d 
image in the eye a trained beholder. I will explain how I created such a 
stereogram of (what is to me) a beautiful mathematical entity called <a 
href="http://www.liv.ac.uk/~spmr02/rings/">"Borromean Rings"</a>. The 
techniques described are sufficiently general that readers should be able to 
create their own images. In particular, the reader may want to construct 
<em>a depth map</em> for something else like <a 
href="http://www.cut-the-knot.org/do_you_know/knots.html">a trefoil knot</a> 
or a fish.

<p>The history of how I got interested in stereograms is at the end (see 
section <a href="#x1-70006">6</a>) of this document.

<a id="x1-20001.1"></a>
<p>
<b>1.1 Software Required.</b> If you have a basic <a 
href="http://www.debian.org">Debian</a> setup (with <a 
href="http://www.xfree86.org">XFree86</a>) that is connected to the Internet, 
then all you need to do is execute the following command as <tt>root</tt>:
<pre class="code">apt-get install gimp blender stereograph</pre>

<p>In other words, you need to install the software packages: <em><a 
href="http://www.gimp.org">gimp</a></em>, <em><a 
href="http://www.blender.org">blender</a></em>, and <em><a 
href="http://stereograph.sf.net">stereograph</a></em>, in addition to a basic 
Graphical Desktop (XFree86) installation.

<center><em>All that you want is...</em><br>
<img src="misc/kapil/logos.jpeg" alt="PIC" width=563 height=190>
</center>

<p> You need to start the GUI and then start <em>gimp</em> or <em>blender</em>
running as applications within the GUI. This is usually as simple as starting 
a terminal and typing <tt>gimp</tt> or <tt>blender</tt> as the case may be. 
Depending upon the sophistication of your interface you can probably also get 
them under the "Graphics Applications" menu.

<a id="x1-30002"></a>
<h3>2. Creating the Rings</h3>

<p>The 3-d modelling program <em>Blender</em> is an excellent contribution 
from the NaN Company and the Blender Foundation to the community. It is 
capable of far more than the construction of depth maps as described in this 
document. Excellent tutorials are available on-line, or as downloadable 
documentation. Start at <a href="http://www.blender.org/">the Blender 
community site</a> for more...

<p>We first start <em>blender</em> and create an empty scene in it. This is 
done by typing <tt>Ctrl-X</tt> in blender and accepting the offer to erase 
<em>all</em> objects. This creates a scene with a cube (selected), a camera, 
and a lamp. You can further type <tt>a</tt> twice to select all objects, then 
type <tt>x</tt> to delete all selected objects. Finally, accept the offer to 
erase the cube, lamp, and camera. As a result we become bold adventurers who 
are traveling light without a lamp or camera!

<center> 
<img src="misc/kapil/blank_blender.png" alt="PIC" width=512 height=384> 
<br>
<em>Traveling Light-less</em></center>

<p>We will now (approximately) follow the tutorial given in the section on <a 
href="http://www.blender.org//modules/documentation/htmlI/x9547.html">"DupliFrames"</a>
in <a href="http://www.blender.org//modules/documentation/htmlI/">the 
blender manual</a> to create the "rings".

<p>First press <tt>space</tt> to activate the menu to add objects. Select a 
"Curve" of type "Nurbs circle" and press the <tt>enter</tt> key. Unless you 
have moved the "3-d cursor" in <em>blender</em>,<a href="#footnote1" 
id="footnote1back"><sup>1</sup></a> this should be inserted with its center at 
the origin of the co-ordinate system. Now we scale it by a factor of 2 in the 
<em>y</em> direction by typing <tt>s</tt>, <tt>y</tt>, <tt>2</tt> and entering.
This is the central "path" of the ring.

<center>
<img src="misc/kapil/two_circles_blender.png" alt="PIC" width=512 height=384>
<br>
<em>Follow the circular instruction</em></center>

<p>Next we add the curve that is the "contour" of the surface. Go to the 
object mode by hitting <tt>Tab</tt>. As before, press <tt>space</tt> to  
get the object addition menu, and select another "Curve" of type "Nurbs 
circle". Scale this surface to a reasonable size by typing <tt>s</tt>, 
<tt>0.25</tt>. Finally, to avoid confusion, rename this curve to "contour" by
typing <tt>n</tt>, and then edit the name by selecting it with a left mouse 
button click.

<p>Now we return to object mode with a tab and select the original 
<em>y</em>-stretched circle. Get to the edit menu by typing <tt>F9</tt>. Under 
the menu "Curve and Surface" there is an entry called "BevOb". Select it and 
enter the name of the other curve, i.e. "contour" if you followed the last 
step of the previous paragraph. The <em>y</em>-stretched circle will now be
used as a "path", and the contour will be "extruded" along it making a ring. 
To finish things off, select the "contour" with the right mouse button, grab 
it by typing <tt>g</tt>, and shift it 10 steps to the right and "out of sight" 
of the camera by typing <tt>x</tt> followed by entering <tt>10</tt>.

<center><img src="misc/kapil/ring_blender.png" alt="PIC" width=512 height=384>
<br>
<em>Give me a ring</em></center>

<p>To create the two other copies of the ring we go as follows. First select 
it with the right mouse button and make a linked duplicate by typing 
<tt>Alt-d</tt>. Then rotate it by 90 degrees by typing <tt>r</tt> and entering 
<tt>90</tt>. Shift to the "side view" by typing the <tt>3/PgDn</tt> key on 
the Number-Pad. Again rotate by 90 degrees by typing <tt>r</tt> and entering 
<tt>90</tt>. Now shift to the "front view" by typing <tt>1/End</tt> on the
Number-Pad. Make another copy by typing <tt>Alt-d</tt> and rotate it by 90 
degrees by typing <tt>r</tt> and entering <tt>90</tt>. Go back to the "top 
view" by typing <tt>7/Home</tt> on the Number-Pad and then rotate again by 
90 degrees by typing <tt>r</tt> and entering <tt>90</tt>.

<p>To get a better view of the rings we first place the 3-d cursor at the 
origin. Then type <tt>.</tt> (period or dot) to get the rotations to be about 
the 3-d cursor (which is at the origin). Select all the rings one by one as 
follows: select the first with a right mouse button click and select each of 
the others with a right mouse button click with <tt>Shift</tt> pressed. Now
rotate by 45 degrees around the <em>z</em>-axis by typing <tt>r</tt> followed 
by entering <tt>45</tt>. Then shift to the front view by typing <tt>1/End</tt>
on the Number-Pad; again rotate by 45 degrees, this time around the 
<em>y</em>-axis, by typing <tt>r</tt> and entering <tt>45</tt>. Go back to the 
top view by typing <tt>7/Home</tt> on the Number-Pad and switch to the "solid" 
view by typing <tt>z</tt>.

<center>
<img src="misc/kapil/3rings_blender.png" alt="PIC" width=512 height=384>
<br>
<em>Borromean Rings at last</em></center>

<a id="x1-40003"></a>
<h3>3. Rendering the depth map</h3>

<p>The brain does create a 3-d "feeling" out of the image rendered above but 
it is not really a "pop-up" 3-d image. For that we have to create a depth map 
version of the image. In <em>blender</em> this is done using a texture. A 
texture is attached to a material so we must add material first. 

<p>Type <tt>F5</tt> to obtain the Materials and Textures menu. The select the 
default Material by clicking the button next to the button marked "ADD NEW" 
under the "Material" menu. You may also select a new "Material" with "ADD NEW".
Now, the last menu on the right is the "Textures" menu. If the Default texture 
is already added then there will be a small "tick" mark next to a button that 
says "Tex". Otherwise select the default "Tex" texture with the button next to 
the "ADD NEW" button in <em>this</em> menu; alternatively add a new texture if 
there is none. Now select the leopard-skin" like button that has a 
helper-pop-up which says "Texture buttons". A new set of menus appears. In the 
"Texture" menu in <em>this</em> panel select the "Blend" texture.

<center>
<img src="misc/kapil/texture_blender.png" alt="PIC" width=742 height=194>
<br>
<em>Let it flow...</em></center>

<p>Go back to the "Material" menus and buttons by selecting the red "sphere" 
that has a helper-pop-up which says "Material buttons". Select the "Map 
Input Menu". This menu allows us to select the input data that is used to 
determine the variation in material that forms the texture. Select the "Glob" 
button that makes the "Global" co-ordinates the input data for the texture. 
Further select the first "Z" button (next to the "sizeX" slider). Select the 
blank buttons next to the "sizeY" and "sizeZ" sliders. This says that the 
texture maps the <em>z</em> co-ordinate of the object to the <em>x</em> 
co-ordinate of a linear "blend".

<center>
<img src="misc/kapil/map_input_blender.png" alt="PIC" width=245 height=171>
<br>
<em>If what goes in is right...</em></center>

<p>Now we select what this linear blend is output as. Go to the "Map to" menu 
at the extreme right. Deselect "Col" (for Colour) and select "Emit" in order 
to make the texture emit light in proportion to its <em>z</em> co-ordinate 
(which is the co-ordinate that measures the distance from the camera). We also 
click the "No RGB" button (which sometimes shows up as "No RG" due to lack of 
screen space) so that the blending is just a grayscale from black to white.

<center>
<img src="misc/kapil/material_blender.png" alt="PIC" width=763 height=195>
<br>
<em>The relevant material</em></center>

<p>We still do not have a camera to view this! We should be in the top view, 
if not then shift to it by typing <tt>7/Home</tt> on the Number-Pad. Place the 
3-d cursor at the origin (make sure it <em>is</em> the origin in all views!). 
Now add a camera with <tt>space</tt> and then select "Camera" in the menu that 
appears. Go the front view and raise the camera 10 steps in the <em>z</em> 
direction by typing <tt>g</tt> followed by <tt>z</tt> and then entering 
<tt>10</tt>. We need to set the background to a uniform dark gray. You will 
notice a new set of menus. Click the numbers next to "HoR", "HoG" and "HoB" in 
the "World" menu and set these to "0.1" by entering <tt>0.1</tt>. If you type 
<tt>F12</tt> now you will see a depth map which we need to tweak just a little
more.

<p>First of all we improve the rendering. Type <tt>F10</tt> to bring the 
"Render" menu. In this menu deselect the "Shado(w)", "EnvMa(p)" and "Gamma" 
buttons. Select the rendering to at least "75%" in order to see things more 
clearly. Most importantly click the "OSA" (for the over-sampling/anti-aliasing)
which will cause the rings to be smoother. Finally select the output format in 
the "Format" menu to be "Targa Raw" instead of "Jpeg" (the default). Also 
click the "BW" button since we know the output is a grayscale.

<center>
<img src="misc/kapil/render_blender.png" alt="PIC" width=754 height=193>
<br>
<em>Render it with a Blender</em></center>

<p>This will give a reasonable depth map. However, you may wish to improve it 
a bit more. I felt the "black" in the rings was too dark and so I made the 
material emit a little more light by increasing the "Emit" slider in the 
"Shaders" menu up to <em>0.2</em>. Further, the "ofsX" slider was brought up 
to <em>0.3</em> and the "sizeX" slider was taken down to <em>0.7</em>.

<center><img src="misc/kapil/base.png" alt="PIC" width=480 height=360>
<br>
<em>All rings are gray at night</em></center>

<p>When you are satisfied with the rendering, go to the "File" near the top 
left corner of the <em>blender</em> window and "Save Image". You may want to 
"Save" the <tt>.blend</tt> file as well. I will assume below that you have 
saved the image as <tt>borromean.tga</tt>; moreover, I will assume that the 
image is of size 640x480 which is the default size.

<a id="x1-50004"></a>
<h3>4. Creating the background texture</h3>

<p>The GNU Image manipulation program is an absolutely marvelous program. I can
(and have) played with it for hours! We will put this very versatile program to
the limited use of creating a nice background texture for the stereographic
image.

<p>We open <em>gimp</em>. With the "File" menu or by typing <tt>Ctrl-n</tt> we 
create a canvas of size 640x480. One way to quickly create a texture of the 
type we need is to select the "Fill" tool from the "Tools" menu or by typing 
<tt>B</tt>. Then choose a nice <em>flat</em> pattern like "Leopard", "Rain" or 
"Sky". From the "Tool Options" dialog we then select "Pattern Fill" and fill 
the canvas with this pattern.

<center><img src="misc/kapil/texture_gimp.png" alt="PIC" width=512 height=331>
<br>
<em>A leopard-skin pill-box</em></center>

<p>Now save the pattern as <tt>texture.png</tt> using the "File" menu or using
<tt>Ctrl-S</tt>.

<a id="x1-60005"></a>
<h3>5. Using stereograph</h3>

<p>The <tt>stereograph</tt> command line program can generate a number of 
different types of stereograms. Even transparent ones that contain two images 
in one! We will create a rather simple stereogram with the command:
<pre class="code">
stereograph -R -a -t texture.png -b borromean.tga -o stereo.png</pre>

<p>A brief explanation of these options is in order. The <tt>-t</tt> option 
clearly indicates the file that contains the texture while the <tt>-b</tt> 
option indicates the file that contains the depth map; finally the <tt>-o</tt>
options indicates where the output should go. The <tt>-a</tt> options tells
<em>stereograph</em> to enable <a 
href="http://en.wikipedia.org/wiki/Anti-aliasing">"anti-aliasing"</a> and the 
<tt>-R</tt> option is an experimental one to get rid of "artefacts".

<center><img src="misc/kapil/stereo.png" alt="PIC" width=480 height=360>
<br>
<em>A three ring circus, perhaps</em></center>

<p> If you find it difficult to "see" stereograms you can add the option 
<tt>-A</tt> which will put two triangles in the image that will assist the 
viewing. That's it! The file 
<a href=misc/kapil/stereo.png><tt>stereo.png</tt></a> is a stereogram image 
file. You can view it with your favourite image viewing software or you
can even open it in <tt>gimp</tt> to view it.

<a id="x1-70006"></a>
<h3>6. Afterword</h3>

<p>I first learnt about Single Image Stereograms (SIS--which are also known 
commercially as MagicEye(TM) images) because of the gift to me by my sibling of
a MagicEye book. Initially I appreciated the beautiful textures that were on 
the glossy pages of this book, but could not verify the claim of the creators 
that there were three-dimensional images that would "pop out" of the page. One 
day my aged ancestor chanced to see the cover of the book and said something 
like "What a strange elephant!" It is only then that I tried to see the images 
and was successful (Thom's <em>morphogenesis</em> sometimes acts extremely
locally).

<p>There are <a href="http://en.wikipedia.org/wiki/Stereogram">numerous 
sources</a> of information (especially on the World Wide Web) on how these 
images "work". On reading these and attempting to create some on my own it
became clear to me that the GNU Image Manipulation Program <tt><a 
href="http://www.gimp.org">GIMP</a></tt> is an excellent program to create 
the textures. For a while there was also a <tt>GIMP</tt> plugin which would
create the SIS images from a texture and a depth map. This was replaced quite 
soon with the excellent <tt><a 
href="http://stereograph.sf.net">stereograph</a></tt> program. However, for a 
long while I could find no reasonable way to create the depth maps short of 
writing a program for each such map or some other form of "hacking". Whenever, 
I looked at 3-d scene creating software the mention of "raytracing", 
"textures", "lighting" and "rendering" would confuse me terribly--I'm a 
mathematician and not a physicist after all! Another barrier was the fact 
that the most popular such software <tt><a 
href="http://www.povray.org">povray</a></tt> was considered "non-free" by 
Debian. I had no wish to invest time and effort learning to use a program that 
could perhaps become unavailable to me at some point in the future.

<p>Sometime last year I chanced upon <a 
href="http://www.blender.org"><tt>blender</tt></a>, <a 
href="http://www.blender.org/modules/documentation">its excellent manual</a>, 
and more than a few <a 
href="http://www.blender3d.org/cms/Tutorials.243.0.html">tutorials</a> for it. 
Thanks to the documentation, the terms above acquired a "real"
mathematical meaning. Indeed it became clear to me that <tt>blender</tt> could 
become for 3-d drawing what <tt><a href="http://www.xfig.org">xfig</a></tt> 
already was for 2-d. Since the latter was already on my list of great graphics 
tools I decided to learn <tt>blender</tt> at the next available opportunity. 
This opportunity was the decision of our Institute (IMSc) to create a logo for 
itself through a "contest". While the logo "material"-ised quite nicely with 
(and without!) <tt>blender</tt> I still could not get the depth maps that I 
was looking for. It was only by repeatedly reading the <tt>blender</tt> manual 
for explanations on "lighting", "material", "texture" and "rendering" that I 
finally chanced upon the method that is described here.

<p>The end result has been this tutorial on creating a 3-d SIS image of the 
Borromean Rings. Since writing this I have learnt from the <a 
href="http://www.linuxartist.org/3d.php">"Linux Artist"</a> site that there 
are many more 3-d drawing tools like <tt>blender</tt>.

<p>As a teacher who comes from a family of teachers I cannot prevent myself 
from giving a few exercises:

<dl>
<dt><b>Beyond the Event Horizon:</b>
<dd>Make your own stereogram of something else using some other Open Source 
tools. There's More Than One Way To Do It!
<dt><br><b>Non-Mathematical:</b>
<dd>Find all the references to artists of the 70's, 80's and 90's in this 
text.
<dt><br><b>Mathematical:</b>
<dd>Find out more about Borromean rings, trefoil knots, Nurbs and other 
mathematical entities mentioned in the text.
</dl>
   
<hr>
Footnote:
<p>
<a href="#footnote1back" id="footnote1">1.</a> In other words, don't even
<em>touch</em> your mouse unless you really need to go somewhere!


</p>


<!-- *** BEGIN author bio *** -->
<P>&nbsp;
<P>
<!-- *** BEGIN bio *** -->
<hr>
<p>
<img align="left" alt="[BIO]" src="../gx/authors/kapil.jpg" class="bio">
<em>

Kapil Hari Paranjape has been a ``hack''-er since his punch-card days.
Specifically, this means that he has never written a ``real'' program.
He has merely tinkered with programs written by others. After playing
with Minix in 1990-91 he thought of writing his first program---a
``genuine'' *nix kernel for the x86 class of machines. Luckily for him a
certain L. Torvalds got there first---thereby saving him the trouble
(once again) of actually writing code. In eternal gratitude he has spent
a lot of time tinkering with and promoting Linux and GNU since those
days---much to the dismay of many around him who think he should
concentrate on mathematical research---which is his paying job. The
interplay between actual running programs, what can be computed in
principle and what can be shown to exist continues to fascinate him.

</em>
<br clear="all">
<!-- *** END bio *** -->

<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2004, Kapil Hari Paranjape. Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication license</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 104 of Linux Gazette, July 2004
</p>

</div>


<div id="previousnextbottom">
<A HREF="brown.html" >&lt;-- prev</A> | <A HREF="odonovan.html" >next --&gt;</A>
</div>


</div>






<div id="navigation">

<a href="../index.html">Home</a>
<a href="../faq/index.html">FAQ</a>
<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="../contact.html">Contact Us</a>

</div>



<div id="breadcrumbs">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">July 2004 (#104)</a> &gt; 
Article

</div>





<img src="../gx/2003/sit3-shine.7-2.gif" id="tux" alt="Tux"/>




</body>
</html>

