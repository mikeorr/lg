<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<title>Mailbag</title>
<link rel="stylesheet" type="text/css" href="../../../lg.css" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
</head>
<body>
<a href="../../../"><img alt="Linux Gazette" src="../../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" /></a><img alt="Tux" src="../../../gx/tux_86x95_indexed.png" id="tux" /><p id="fun">...making Linux just a little more fun!</p><div class='content articlecontent'><a name="top"></a><h3>ip forwarding/ ip masquerading???</h3>
<p>
<b>CDT IS Administrator Cpl Room [jroom.hq at defenceacademy.mod.uk]</b><br />
<b>Wed, 13 Dec 2006 13:28:11 -0000</b>
</p>

<p>
Hi,
</p>

<p>
I'm totally new to Linux and IT fullstop, so please teach me to suck
eggs!!  I have been asked to build a Linux (server) firewall it is to
sit between a small part of our LAN and the rest of the LAN.  The small
part of the network is called GB and is on192.*.*.2, it goes straight
into the firewall eth0 192.*.*2.  Eth1 is 10.*.*.1, now whatever I do I
cannot get the GB to see the rest of the network, I have enabled ip
forwarding.  I've tried a couple of things, 'iptables -t nat -A
POSTROUTING -i eth1 -o eth0 -j MASQUERADE' this came back saying
POSTROUTING and -i couldn't be used togeather!  When i took -i out I got
an error saying 'invalid argument'.
</p>

<p>
Regards,
</p>

<p>
John
</p>

<p>
Email: jroom.hq@da.mod.uk
</p>


<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-ip_forwarding_ip_masquerading">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b>Neil Youngman [ny at youngman.org.uk]</b><br />
<b>Wed, 13 Dec 2006 15:01:15 +0000</b>
</p>

<p>
On or around Wednesday 13 December 2006 13:28, CDT IS Administrator Cpl Room 
reorganised a bunch of electrons to form the message:
</p>

<pre>
&gt; Hi,
&gt;
&gt; I'm totally new to Linux and IT fullstop, so please teach me to suck
&gt; eggs!!  I have been asked to build a Linux (server) firewall it is to
&gt; sit between a small part of our LAN and the rest of the LAN.  The small
&gt; part of the network is called GB and is on192.*.*.2, it goes straight
&gt; into the firewall eth0 192.*.*2.  Eth1 is 10.*.*.1, now whatever I do I
&gt; cannot get the GB to see the rest of the network, I have enabled ip
&gt; forwarding.  I've tried a couple of things, 'iptables -t nat -A
&gt; POSTROUTING -i eth1 -o eth0 -j MASQUERADE' this came back saying
&gt; POSTROUTING and -i couldn't be used togeather!  When i took -i out I got
&gt; an error saying 'invalid argument'.
</pre>

<p>
I haven't set up a firewall using iptable, so I can only suggest that  
<a href="http://www.netfilter.org/documentation/HOWTO/NAT-HOWTO.html">http://www.netfilter.org/documentation/HOWTO/NAT-HOWTO.html</a> looks like a 
helpful document.
</p>

<p>
You might also want to look into smoothwall as an option?
</p>

<p>
Neil Youngman
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-ip_forwarding_ip_masquerading">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b>Thomas Adam [thomas.adam22 at gmail.com]</b><br />
<b>Wed, 13 Dec 2006 15:13:18 +0000</b>
</p>

<p>
On Wed, 13 Dec 2006 15:01:15 +0000
Neil Youngman &lt;ny@youngman.org.uk&gt; wrote:
</p>


<pre>
&gt; On or around Wednesday 13 December 2006 13:28, CDT IS Administrator
&gt; Cpl Room reorganised a bunch of electrons to form the message:
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; I'm totally new to Linux and IT fullstop, so please teach me to suck
&gt; &gt; eggs!!  I have been asked to build a Linux (server) firewall it is
&gt; &gt; to sit between a small part of our LAN and the rest of the LAN.
&gt; &gt; The small part of the network is called GB and is on192.*.*.2, it
&gt; &gt; goes straight into the firewall eth0 192.*.*2.  Eth1 is 10.*.*.1,
&gt; &gt; now whatever I do I cannot get the GB to see the rest of the
&gt; &gt; network, I have enabled ip forwarding.  I've tried a couple of
&gt; &gt; things, 'iptables -t nat -A POSTROUTING -i eth1 -o eth0 -j
&gt; &gt; MASQUERADE' this came back saying POSTROUTING and -i couldn't be
&gt; &gt; used togeather!  When i took -i out I got an error saying 'invalid
&gt; &gt; argument'.
&gt; 
&gt; I haven't set up a firewall using iptable, so I can only suggest
&gt; that <a href="http://www.netfilter.org/documentation/HOWTO/NAT-HOWTO.html">http://www.netfilter.org/documentation/HOWTO/NAT-HOWTO.html</a>
&gt; looks like a helpful document.
&gt; 
&gt; You might also want to look into smoothwall as an option?
</pre>

<p>
Smoothwall express 3 is due to be released any moment now (the ISO is
built).  AF2 has been released, as has CF.   
</p>

<p>
(Shameless plug, but they pay my wages, so...)  :P
</p>

<p>
I note the OP works for the MOD -- I'd recommend Advanced Firewall in
that case if it's anything seriously public-facing.  Express (which is
the GPL version) has some very nice features to it.
</p>

<p>
-- Thomas Adam
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-ip_forwarding_ip_masquerading">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b>Benjamin A. Okopnik [ben at linuxgazette.net]</b><br />
<b>Wed, 13 Dec 2006 10:08:33 -0600</b>
</p>

<p>
Hi, John -
</p>

<p>
You're probably unaware of this, but you sent your message in HTML
format. This doubled the size of your message without any benefit in
return, and will create extra work for our Mailbag editor.
</p>

<p>
Please change your mailer's settings to stop it from doing this. For
more info, please see &lt;<a href="http://expita.com/nomime.html">http://expita.com/nomime.html</a>&gt;.
</p>

<p>
On Wed, Dec 13, 2006 at 01:28:11PM -0000, CDT IS Administrator Cpl Room wrote:
</p>

<pre>
&gt; 
&gt;    Hi,
&gt; 
&gt;    I'm totally new to Linux and IT fullstop, so please teach me to suck eggs!!
&gt;    I have been asked to build a Linux (server) firewall it is to sit between a
&gt;    small part of our LAN and the rest of the LAN.  The small part of the
&gt;    network is called GB and is on192.*.*.2, it goes straight into the firewall
&gt;    eth0 192.*.*2.  Eth1 is 10.*.*.1, now whatever I do I cannot get the GB to
&gt;    see the rest of the network, I have enabled ip forwarding.  I've tried a
&gt;    couple of things, 'iptables -t nat -A POSTROUTING -i eth1 -o eth0 -j
&gt;    MASQUERADE' this came back saying POSTROUTING and -i couldn't be used
&gt;    togeather!  When i took -i out I got an error saying 'invalid argument'.
</pre>

<p>
My question would be "why are you fighting an unnecessary battle in the
first place?" The traditional way to set up a segmented LAN is to use
the same RFC-1918 address range (i.e., <em>either</em> 10.0.0.0/8 or
192.168.0.0/16) and split it up using subnet masks. This allows for easy
routing (and lots less typing if you're setting up DNS, as well. <img src="../gx/smile.png" alt=":)">
</p>

<p>
Doing the former allows you to use hubs or switches; doing it the way
you are requires a router. Of course, your requirement for a firewall
supercedes all of that (i.e., you need a router anyway), but making the
original job harder than it needs to be is rather pointless.
</p>

<p>
In any case, if you want to route from one segment to the other, here's
a possible option. I'm going to pick class C (/24) as a random netmask
for your segment; modify at will, of course. Note that this is untested
code: it should work, but no guarantees.
</p>

<pre>
# Flush the current set of rules - start 'F'resh
iptables -F
# Masquerade anything coming from the specified network
iptables -t nat -I POSTROUTING -j MASQUERADE -s 192.168.0.0/24
# Forward packets coming <strong>from</strong> 
iptables -I FORWARD -d 192.168.0.0/24 -j ACCEPT
# Forward packets going <strong>to</strong> 
iptables -I FORWARD -s 192.168.0.0/24 -j ACCEPT
</pre>
Do, of course, remember to enable forwarding in the first place:
</p>

<pre>
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</pre>
<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-ip_forwarding_ip_masquerading">Back</a><hr width="50%" align="left" /><p><br /></p></div>
</body>
</html>
