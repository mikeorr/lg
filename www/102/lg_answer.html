
<html>
<head>
<link href="../lg.css" rel="stylesheet" type="text/css" media="screen, projection"  />
<link rel="shortcut icon" href="../favicon.ico" />
<title>The Answer Gang LG #102</title>

<style type="text/css" media="screen, projection">
<!--

-->
</style>

<link rel="alternate" type="application/rss+xml" title="LG RSS" href="lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="lg.rdf" />
<link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" />

</head>

<body>


<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
<p id="fun">...making Linux just a little more fun!</p>


<div class="content articlecontent">

<div id="previousnexttop">
<A HREF="lg_tips.html" >&lt;-- prev</A> | <A HREF="dennis.html" >next --&gt;</A>
</div>



<h1>The Answer Gang</h1>

<p>
<center>
        <img src="../gx/dennis/qbubble.gif" alt="(?)"                           
	                border="0" align="left">
	<img src="../gx/dennis/bbubble.gif" alt="(!)"                           
	                border="0" align="right"><BR>
<STRONG>By Jim Dennis, Karl-Heinz Herrmann, Breen, Chris, and...
        (<a href="../tag/bios.html">meet the Gang</a>) ...
	        the Editors of <i>Linux Gazette</i>...
		        and 
			<a href="../tag/ask-the-gang.html">You</a>! 
</STRONG>
<P>

<center><p>
<br>We have guidelines for <a href="../tag/ask-the-gang.html">asking</a> and <a
href="../tag/members-faq.html">answering</a> questions.  Linux questions only, please.
</STRONG>
<br><em><font color="#7F0000">We make <b>no guarantees</b> about answers, but you can be <b>anonymous</b> on request.</font></em>
<br>See also: The Answer Gang's 
<a href="../tag/kb.html">Knowledge Base</a>
and the <i>LG</i> 
<a href="http://linuxgazette.net/search.html">Search Engine</a>
</center>
<br></p></center>

<HR>
<!-- BEGIN message -->
<H3>Contents:</H3>
<dl>
<dt><a href="#tag/greeting"
	><strong>&para;: Greetings From Heather Stern</strong></A></dl>

<DL>
<!-- index_text begins -->
<dt><A HREF="#tag.1"
	><img src="../gx/dennis/qbub.gif" height="28" width="50"
	  alt="(?)" border="0"
	><strong>Redhat + scsi RAID = Excedrin headache #459</strong></a>
<dt><A HREF="#tag.2"
	><img src="../gx/dennis/qbub.gif" height="28" width="50"
	  alt="(?)" border="0"
	><strong>howto</strong></a>
<dt><A HREF="#tag.3"
	><img src="../gx/dennis/qbub.gif" height="28" width="50"
	  alt="(?)" border="0"
	><strong>Wireless networking</strong></a>
<!-- index_text ends -->
</DL>
<!--     .~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.     -->
<A NAME="tag/greeting"><HR WIDTH="75%" ALIGN="center"></A>
<H3 align="left"><img src="../gx/dennis/hbubble.gif" 
	height="50" width="60" alt="(&para;) " border="0"
	>Greetings from Heather Stern</H3>
<!-- begin hgreeting -->
<P><STRONG>
Greetings dear readers, and welcome once more to the wild and whacky world of The Answer Gang.
Sorry the workshop's a mess.  Even sorrier we took so long to clear out the sawdust and get these bits to you.   However, I hope you find the threads a little more readable.
</STRONG></P>
<P><STRONG>
Which brings me to thoughts of the next battle ahead.  Upgradability has always been something I care about; thence my careful management of my distros, whichever they are, and a particular fondness for <A HREF="http://www.debian.org/">Debian</A>'s apt-get feature. (I look forward to trying
<a href="http://linux.duke.edu/projects/yum/">yum</a>
when I have Copious Free Time<SUP>tm</SUP> to try Fedora, and recommend
<a href="http://www.linux-mandrake.com/cooker/urpmi.html">urpmi</a>
to Mandrake fans.) Still, the main thing that gives any distro is the policies its maintainers apply.  RPM based distros are unique because of how the dependencies are laid out - if they're good, installs of new software - even source based softare, are easy, and if not, then upgrades are just hellish.  In other words, these maintainers... <EM>they</EM> are your sysadmin, until you take the reins in your hands to do it yourself - and even then, the tools they make handiest to help you with that also apply policy, at least about where the control files go.
</STRONG></P>
<P><STRONG>
As Linux is increasingly being taken up by people who care about what they're going to do with it, rather than folks who really care what their OS is at all under the hood - this is getting more important.  The paper zines have been muttering under their breath for years "not ready for the enterprise" - what they mean is we dunno, as in Ghostbusters, "who ya gonna call?"
</STRONG></P>
<P><STRONG>
Nobody claims that's the problem anymore, all the big names are well known and pretty much Joe User have now heard of mailing lists and blogs.  Still they resist, so the next chain to yank is "it's too hard to switch" - oops, GUI and web admin interfaces abound. Can't lean on that one too much anymore.  What else?  Well, change manaegement is the real problem - a problem about people, not about technology - and that's about policy.
</STRONG></P>
<P><STRONG>
But what about when your fought-for-and-won distro of choice changes its policies?  What if you don't like them anymore?  Whoops.  Of course the mswin folk have dealt with the changing winds from Redmond every other season, but we've grown rather fond of having a choice... and it upsets our applecart when the spirit of a distro changes.  I've watched it over the years.  <A HREF="http://www.slackware.org/">Slackware</A> was one of the earliest distros at all - only had 3 or 4 competitors and you may not have even heard of them if you're new to the game - and being a distro proper made life easy.  Slackware has its loyal followers everywhere - but you won't find them saying it's because they wanted to have their hand held, no way.  <A HREF="http://www.redhat.com/">Red Hat</A> put together the system for the ordinary guy, the average Joe... and around the time those <A HREF="http://www.caldera.com/">Caldera</A> people were looking good for a good standing in the business world, decided that was their new definition of Joe.  Their trend toward the business world has gone so far they will barely accept money from Joe's buddy out here on the street anymore.  What? and have to answer his phone calls??  They run and hide.  Much more fun to accept money by the industrial size barrel for the occasional call now and then from a corporate contact.  The community that had grown to be fond of them takes this two ways:
</STRONG></P>

<p><Strong><ol>
<LI>a personal challenge, after all the whole <EM>point</EM> of the GPL and other free licenses is for projects to continue when the original folk bail on it;


<LI>vote with their feet, especially if any other policies of basic set up are annoying them. There's a lot more distros to pick from now, maybe it's time to go shopping.

</ol></Strong></p>
<P><STRONG>
That's where the
<a href="http://fedora.redhat.com/">Fedora</a>
plan came in.  Of course, I've got my clients, and I heard diddly squat from them about the
<a href="http://www.fedoralegacy.org/">Fedora Legacy</a>
project - to keep RH consumer distros in security patches at least; lots more about considering the offers of Progeny or other consulting vendors to keep them in good health.  Fedora's lifeblood will be the people who took the challenge seriously and though their first burst of energy was a painful birth, I think the kid's coming along nicely.
</STRONG></P>
<P><STRONG>
Mind you, the Linux users of the tinkering spirit, with their off brand distros
and literally a pile of Debian derivitives, are not safe from the winds of
change - they need to learn to set their sails too.  The Debian project just
went through a vote that changed some minor wording in their core document, the
Debian Social Contract... and oh, the flame wars that have arisen if one
interprets the new word they chose a bit more broadly.  It's not that bad
folks, it just isn't - but people who thought they were standing on solid
ground got mildly dizzy when the bandwagon shifted even a little bit.  The
purists who want to know that "free means free" will feel a bit happier setting
sail this way.  Those who wail that it may vastly slow down the Sarge release are probably wrong;  yeah, it's slow but what <EM>I</EM> have learned to view as signs of impending release with the next few months - breakage for brief times now and then of core dependencies and thence the install of core packages - have been happening of late, and I've just learned to keep an ear flapping in the wind for the howling of their
<a href="http://bugs.debian.org/">Bug Tracking System</a>
entries.  The <EM>really</EM> painful ones get FAQ status in freenode's #debian channel by being listed in the topic you read as you enter. Luckily they also get dealt with rather quickly, but I wouldn't exactly update via cronjob these days; I like to keep a closer eye on things.
</STRONG></P>
<P><STRONG>
That's just a couple of examples.  Now that the word "Linux" gets a few less glassy stares I also hear the hiss of people zipping their hand back with burnt fingers everywhere.  The good news is there are at least as many varieties of burn cream as there are hot stoves to touch or hot sidewalks to stroll along.  The bad news - good news in disguise - is there are so many choices!
</STRONG></P>
<P><STRONG>
That's the way it is in the Open Source world, though, folks.  For anything big enough - the world is their beta tester.  If we aren't - then the result will not be up to a world of users.  Take your choice when to take a plunge - but Summer is here.  Enjoy your time at poolside, soak in some rays or lay the Sunblock 2000 as thick as you feel you need to in all its designer colors - but the time will come to dive in.  Serves millions.  Enjoy.
</STRONG></P>

<!-- end hgreeting -->
<!--     .~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.     -->
<A NAME="tag.1"><HR WIDTH="75%" ALIGN="center"></A>
<!-- begin 1 -->
<H3 align="left"><img src="../gx/dennis/qbubble.gif" 
	height="50" width="60" alt="(?) " border="0"
	>Redhat + scsi RAID = Excedrin headache #459</H3>


<p><strong>From Faber Fedor 
</strong></p> 
<p></strong></p>

<p align="right"><strong>Answered By:  Faber Fedor, Benjamin A. Okopnik, Kapil Hari Paranjape, Jim Dennis
</strong></p>
<P><STRONG>
Hey Gang,
</STRONG></P>
<P><STRONG>
I've got a problem that I've fixed three other times in different
enviroments, but this time it's driving me nuts.
</STRONG></P>
<P><STRONG>
The short of it is this:  I've got a newly upgraded RedHat 9 on a PII
400 MHz box running RAID 5 using LSI Logic MegaRAID 500 SCSI.  When the
system boots, I get the following panic:
</STRONG></P>

<pre><strong>    creating boot device
    creating root device
    mounting root filesystem
    mount: error 6 mounting ext3
    pivotroot: pivot_root(/sysroot,/sysroot/initrd) failed: 2
    umount /initrd/proc failed: 2
    Freeing unused kernel memory: 132K freed
    Kernel panic: No init found.  Try passing init= option to kernel
</strong></pre>
<P><STRONG>
Yes, the scsi drive is recognized and the appropriate drivers are loaded
(I did a
mkinitrd --preload scsi_mod --preload sd_mod initrd.scsi &lt;kernel image&gt;
and verified that the modules were included in the initrd by mounting
it). I also verified that the root filesystem is indeed ext3 (btw, how
does the system know if the filesystem is of a particular type before it
gets to <TT>/etc/fstab?</TT> I haven't figured that out yet) and it was clean.
</STRONG></P>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
Presumably by reading the partition table and doing a little string
comparison, just as "file" does.
</blockQuote>
<P><STRONG>
<IMG SRC="../gx/dennis/qbub.gif" ALT="(?)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
From what I was able to google, one person said that the journal might
have been trashed (fixed with fsck) and another said that there was no
corresponding device in the initrd, which is true.  But do I need to
create a device for the <TT>/dev/sda</TT> in the initrd and if so, how?
</STRONG></P>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
I've found that a lot of headaches can be avoided by simply deleting the
journal when there's a related problem. There can be much darkness of
the spirit and wailing and rending of clothes otherwise.
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Faber] 
Yes, it's a bash script called linuxrc.  It looks pretty
straightforward:
</blockQuote>

<blockquote><pre>#!/bin/bash

echo "Loading scsi_mod.o module"
insmod /lib/scsi_mod.o
echo "Loading sd_mod.o module"
insmod /lib/sd_mod.o
echo "Loading ncr53c8xx.o module"
insmod /lib/ncr53c8xx.o
echo "Loading jbd.o module"
insmod /lib/jbd.o
echo "Loading ext3.o module"
insmod /lib/ext3.o
echo Mounting /proc filesystem
mount -t proc /proc /proc
echo Creating block devices
mkdevices /dev
echo Creating root device
mkrootdev /dev/root
echo 0x0100 &gt; /proc/sys/kernel/real-root-dev
echo Mounting root filesystem
mount -o defaults --ro -t ext3 /dev/root /sysroot
pivot_root /sysroot /sysroot/initrd
umount /initrd/proc
</pre></blockquote>

<font color="red"><blockquote><em>So straight forward that they're not even using 'modprobe'!
 -- Thomas Adam</em></blockquote></font>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
Saaay... that looks interesting. What's that "mkdevices" bit, and how
does it know which devices to "mk"? That's assuming that the lack of an
appropriate device is the problem. I'd also add a "-v" to all those
"insmod" invocations, just for grins - and maybe kill those "echo"
lines.
</blockQuote>
<P><STRONG>
<IMG SRC="../gx/dennis/qbub.gif" ALT="(?)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Any other suggestion for fixing this are welcome.  As I've said, I've
fixed three other <A HREF="http://www.redhat.com/">Red Hat</A>/SCSI problems within the past few weeks ( 1.
boot off of an IDE and mount the scsi, 2. upgrade to Red Hat 9, or 3.
preload modules in initrd) but short of reinstalling the OS, I can't
figure out what to try next.
</STRONG></P>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
"pivotroot", IIRC, is only necessary if you want to do an "initrd"-type
boot, where you fire up a RAMdisk, boot off that, then mount your
partition on '<TT>/</TT>' as ext3, and away you go. Mind you, this is all from
memory - it's been a long time since I did this myself, and the only
reason for doing it was that I wanted to try a <A HREF="http://www.debian.org/">Debian</A>-precompiled
kernel. These days, I just make an ext3 partition from the start.
However, you're talking SCSI, so it looks like you're stuck with doing
it that way - unless you stick a small IDE HD in there just for booting.
</blockQuote>
<blockQuote>
What I'd run into previously is, "mkinitrd" actually uses "<TT>/etc/fstab</TT>"
when building the image. I ended up having to tweak "<TT>/etc/fstab</TT>" to make
it fit the machine I was building it for - as opposed to the one on
which it was being built - and then untweak it after running "mkinitrd".
</blockQuote>
<P><STRONG>
<IMG SRC="../gx/dennis/qbub.gif" ALT="(?)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
I've tried that as well. 
<IMG SRC="../gx/dennis/unsmily.gif" ALT=":-(" 
		height="24" width="20" align="middle">
</STRONG></P>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
Argh. Well... let's peel it back as much as we can. It's been a mort of
years since I've dealt with SCSI HDs, so I don't know how helpful this
will be, though.
</blockQuote>
<blockQuote>
First off, I'd go ahead and pop in a Knoppix CD, boot with it, and see
if I can detect/mount/read the SCSI - and I would watch carefully to see
just how different the SCSI-related messages are during the process
(i.e., do you need to try a different module?) Then, I'd make sure that
the "<TT>/etc/lilo.conf</TT>" on the SCSI is trying to do The Right Thing (you
<em> are  </em> using LILO, right?) - no IDE-specific stuff in there, "root",
"boot", etc. are set to the correct values (not an "hdX" in the
place...) and re-run "lilo -v" just to see what the output is and make
sure that it's properly set. I'd walk through the "initrd" setup to make
sure that there's nothing odd in there, and particularly check that ROOT
in "<TT>/etc/mkinitrd/mkinitrd.conf</TT>" is explicitly set (I just remembered
having a problem with that default "probe" setting at one point; my
current one says 'ROOT="<TT>/dev/hda1</TT> ext3"'.) Also, take a look at
"<TT>/etc/mkinitrd/modules</TT>".
</blockQuote>
<blockQuote>
Nothing else comes to mind at the moment.
</blockQuote>
<P><STRONG>
<IMG SRC="../gx/dennis/qbub.gif" ALT="(?)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
The partition table holds filesystem information? I didn't see anything
in the list of types in fdisk.
</STRONG></P>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
Sorry, I should have expanded that. The kernel would read the partition
table, jump to the location indicated by it, and do a string comparison
on the info it finds there - mind you, I don't <EM>know</EM> that that's what
it does, but it would seem like a simple way to do it. However,
"mkinitrd" also reads "<TT>/etc/fstab</TT>", so that might me how it's done.
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Faber] 
It seems RH doesn't have an <TT>/etc/mkinitrd</TT> directory or files.
</blockQuote>
<blockQuote>
What I'm looking at is the
</blockQuote>

<blockquote><pre>echo 0x0100 &gt; /proc/sys/kernel/real-root-dev
</pre></blockquote>
<blockQuote>
If I read this right, it's saying the real-root-dev is device major
number 01 and minor 00 which is ram0 (so maybe Kapil was right about Red
Hat using two ramdisks?  but I see only one pivot_root. :-?)  I'm going
to change it to read
</blockQuote>

<blockquote><pre>echo 0x802 &gt; /proc/sys/kernel/real-root-dev
</pre></blockquote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
I assume you mean something like
</blockQuote>

<blockquote><pre>disk = /dev/sda
  bios = 0x80
disk = /dev/hda
  bios = 0x81
</pre></blockquote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
That would be pretty standard stuff. You could get really wild and
describe the geometry of "<TT>/dev/sda</TT>" (see the LILO manual), but I don't
know that it would be helpful.
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Kapil] 
I had a look at RedHat's mkinitrd script also. RedHat's procedure
seems to be pretty straightforward (no jumping through hoops here
<IMG SRC="../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle">).
The key to understanding the above script is "man nash".
</blockQuote>
<blockQuote>
Both mkdevices and mkrootdev are builtin commands for nash. Quoting from
the man page:
</blockQuote>

<TABLE WIDTH="95%" BORDER="1" BGCOLOR="#FFFFCC"><TR><TD>
<p align="center">...............</p>

<blockquote><pre>       mkdevices path
                     Creates device files for all of the block devices
		     listed in /proc/partitions in the directory  spec-
		     fied by path.

       mkrootdev path
                     Makes  path  a  block inode for the device which
		     should be mounted as root. To determine this device
                     nash uses the device suggested by the root= kernel
		     command line  argument (if  root=LABEL  is  used
		     devices  are  probed to find one with that label).
		     If no root= argument is available, /proc/sys/ker-
	             nel/real-root-dev provides the device number.
</pre></blockquote>
<p align="center">...............</p>
</TD></TR></TABLE><blockQuote>
Note that the line <EM>after</EM> the mkrootdev business is setting a "dummy"
"real-root-dev" so just replacing "0x100" by "0x810" or some such is not
likely to work.
</blockQuote>
<blockQuote>
By the way, I always thought that the way to invoke pivot_root was
</blockQuote>
<blockQuote>
cd new_root
pivot_root . old_root
exec chroot next_command
But RedHat's script seems to bypass the "change directory" step...
</blockQuote>
<blockQuote>
Hope this helps
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
That smells like it is talking about some sort of RAM based file system
(CRAMFS perhaps?) which is certainly unlikely to be an ext3 filesystem.
</blockQuote>
<blockQuote>
In other words your problem may not be with the SCSI disk and its ext3
file system at all! I don't know RH's boot procedure but some of these
distro boot images have some intermediate "RAM disk" in addition to the
initrd and do two pivot_roots!
</blockQuote>
<blockQuote>
If you want to stick with the distro's boot procedure,
your best bet is to examine this procedure in detail.
</blockQuote>
<blockQuote>
0. Check the boot command line.
</blockQuote>
<blockQuote>
1. Open up the initrd image and look at linuxrc.
</blockQuote>
<blockQuote>
Having looked at 0 and 1 for a number of distro's I have come to the
conclusion that either the guys who produce these distro boot images
do too many drugs or they are taking care of some really unusual
eventualities or both 
<IMG SRC="../gx/dennis/smily.gif" ALT=":-)" 
		height="24" width="20" align="middle">
</blockQuote>
<blockQuote>
I seem to remember that it's either CRAMFS or something like that; I'm
sure Heather knows more about it than I do. It's a "pull yourself up by
your bootstraps" kind of thing: you boot a RAM-based ext2
mini-"partition" (which mounts as "<TT>/</TT>"), which then loads the appropriate
ext3 modules, mounts your actual partition, and "pivots" "<TT>/</TT>" to it.
</blockQuote>
<blockQuote>
The usual reason is to avoid having to recompile the kernel - it makes
more sense for RH, etc. to make ext3, jfs, jffs, reiserfs, etc. modules
and let you choose which one you want to use, but the price is having to
mess with the "initrd"<TT>/</TT>"pivot_root" stuff. I just compile ext3 right in,
and never have to mess with it. SCSI, of course, is a different sort of
animal altogether.
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Faber] 
Well, you can have alook at this one.  
<IMG SRC="../gx/dennis/smily.gif" ALT=":-)" 
		height="24" width="20" align="middle"> The relevant parts are:
</blockQuote>

<blockquote><pre>echo Creating root device
mkrootdev /dev/root
echo 0x0100 &gt; /proc/sys/kernel/real-root-dev
echo Mounting root filesystem
mount -o defaults --ro -t ext3 /dev/root /sysroot
</pre></blockquote>
<blockQuote>
I don't see anything there that would screw up because of a SCSI disk,
but then again, I don't know what <TT>/proc/sys/kernel/real-root-dev</TT> is for,
so I'm off to find out...
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
Anybody have an idea how 0x0100 would relate to
device numbers, or whatever else "<TT>/proc/sys/kernel/real-root-dev</TT>" is
supposed to hold? I suspect that the above is the RAMdisk, though, and
that whatever is defined as the device for "pivot_root" to "pivot" to is
what matters.
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [JimD]
</blockQuote>
<blockQuote>
<TT>/proc/sys/kernel/real-root-dev</TT> is documented in
.../src/linux/Documentation/initrd.txt
</blockQuote>
<blockQuote>
Quoting therefrom:
</blockQuote>

<TABLE WIDTH="95%" BORDER="1" BGCOLOR="#FFFFCC"><TR><TD>
<p align="center">...............</p>
<blockQuote><BLOCKQuote>
It works by mounting the "real" root device (i.e. the one set with rdev
in the kernel image or with root=... at the boot command line) as the
root file system when linuxrc exits. The initrd file system is then
unmounted, or, if it is still busy, moved to a directory <TT>/initrd</TT>, if
such a directory exists on the new root file system.
</BLOCKQuote></blockQuote>
<blockQuote>
In order to use this mechanism, you do not have to specify the boot
command options root, init, or rw. (If specified, they will affect
the real root file system, not the initrd environment.)
</blockQuote>
<blockQuote>
If <TT>/proc</TT> is mounted, the "real" root device can be changed from within
linuxrc by writing the number of the new root FS device to the special
file <TT>/proc/sys/kernel/real-root-dev</TT>, e.g.
</blockQuote>
<blockQuote><CODE>
# echo 0x301 &gt;/proc/sys/kernel/real-root-dev
</CODE></blockQuote>
<blockQuote>
Note that the mechanism is incompatible with NFS and similar file
systems.
</blockQuote>
<blockQuote>
This old, deprecated mechanism is commonly called "change_root",
while the new, supported mechanism is called "pivot_root".
</blockQuote><p align="center">...............</p>
</TD></TR></TABLE>
<blockQuote>
As Ben suggests this look like <TT>/dev/ram0</TT> (The ramdisk) which seems
wrong.  I'd look back through the <TT>/linuxrc</TT> to figure out what logic
it's using to arrive at this point.  I'm guessing that it's not loading
or detecting the intended rootfs (hardware) and this value is the
result of a default that wasn't over-written by any more appropriate
case.
</blockQuote>
<HR width="10%" align="left">
<font color="red"><blockquote><em>Faber cheerfully reported back....
 -- Thomas Adam</em></blockquote></font>
<P><STRONG>
<IMG SRC="../gx/dennis/qbub.gif" ALT="(?)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Here's what I think is happening:
</STRONG></P>
<P><STRONG><BLOCKQuote>
(the relevant parts of initrd/linuxrc)
</BLOCKQuote></STRONG></P>

<pre><strong>echo Creating root device
mkrootdev /dev/root
echo 0x0100 &gt; /proc/sys/kernel/real-root-dev
echo Mounting root filesystem
mount -o defaults --ro -t ext3 /dev/root /sysroot
pivot_root /sysroot /sysroot/initrd
umount /proc/initrd
</strong></pre>
<P><STRONG>
create the root device
attach the (ram0) ram disk to it
mount the ram disk to <TT>/sysroot</TT>
change the system root from the initrd to the ram0 disk
umount initrd
</STRONG></P>
<P><STRONG>
Now, that jives with the initrd on my local )non-scsi) box.  The
question is: is this correct behaviour for a scsi box?  If so, why is
the failure occuring at mounting the ramdisk?  The mount error, IIRC, is
"no such device".
</STRONG></P>
<P><STRONG>
I was never able to fix my client's system to boot off of the SCSI drive
no matter how I mucked with initrd.  It was a lot of fun however and I
learned more about initrd than is probably necessary. 
<IMG SRC="../gx/dennis/smily.gif" ALT=":-)" 
		height="24" width="20" align="middle">
</STRONG></P>
<P><STRONG>
In the end, we reinstalled RH9 from scratch.  We took advantage of the
new install to reconfigure some partitions and stuff, so all was not a
total waste.
</STRONG></P>
<P><STRONG>
Interesting side note(s): the RH installer would not let us use LILO
and the SCSI MBR.  I could use the MBR of hda or sda1, but not the way I
wanted it.  So I went with GRUB.
</STRONG></P>
<P><STRONG>
After playing with GRUB, I must say I like it, but it has one really
weird feature. All of the documentation says that GRUB refers to the
first IDE drive as (hd0,0) and the fist SCSI drive as (sd0,0). Not on
this system!  It took me two hours (for shame!) to figure out that the
SCSI drive is (hd0,0) and the first IDE drive is (hd1,0).  If anyone
knows why, I'd love to hear it.
</STRONG></P>
<P><STRONG>
Now all I have to do is recreate two years worth of customizations on
this box.  Good thing I have a <EM>very</EM> understanding client. 
<IMG SRC="../gx/dennis/smily.gif" ALT=":-)" 
		height="24" width="20" align="middle">
</STRONG></P>

<!-- end 1 -->
<!--     .~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.     -->
<A NAME="tag.2"><HR WIDTH="75%" ALIGN="center"></A>
<!-- begin 2 -->
<H3 align="left"><img src="../gx/dennis/qbubble.gif" 
	height="50" width="60" alt="(?) " border="0"
	>howto</H3>


<p><strong>From Guy Milliron 
</strong></p> 
<p></strong></p>

<p align="right"><strong>Answered By:  Benjamin A. Okopnik, Jim Dennis
</strong></p>
<P><STRONG>
I've googled for an answer to my question, just it's too obscure for me to
figure out I guess...
</STRONG></P>
<P><STRONG>
I'm attempting to install a new software on my RHL box.  Anyhow, it's calling
a program called fping (Which is pretty interesting itself, a round-robin
style ping <A HREF="http://www.fping.com"
	>http://www.fping.com</A> ).  It says it needs to run as root (which I
won't allow the calling program to run as, or needs to be "setuid".
</STRONG></P>
<P><STRONG>
As Ricki Ricardo would say "Splain Lucy Splain!"
</STRONG></P>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
For that, see "perldoc splain" for more info. 
<IMG SRC="../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle"> Although it's not quite
smart enough to help you this time...
</blockQuote>

<blockquote><pre>ben@Fenrir:~$ ls -l `which ping`
-rwsr-xr-x    1 root     root        15244 2001-11-18 17:29 /bin/ping
</pre></blockquote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
"ping" has always been SUID; it needs to be in order to use ICMP - which
is what "ping" does. It's a weird security model ("ICMP can be
dangerous, so we'll lock it away under root privilege... but then we'll
make the ICMP generator SUID so everybody can use it.") Some old, hoary,
scarred and scared sysadmins remove the SUID bit from "ping" so you have
to "su" in order to use it... but note that the users <em>  will  </em> complain.
My guess is, user complaints are the reason that the situation exists.
Of course, they could have made "ping" use TCP instead of ICMP, but then
we'd be violating &lt;Tevye the Milkman mode&gt;TRADITION!&lt;/TtMm&gt;.
</blockQuote>
<blockQuote>
There actually are some valid reasons for sticking with ICMP, but
they're not unique to it, and are mostly doable with TCP. TCP "ping",
IMO, would be a Good Thing and support a better security model.
</blockQuote>

<blockquote><pre># Net::Ping uses TCP by default
perl -MNet::Ping -wle'print"Host is ",Net::Ping-&gt;new()-&gt;ping(shift)?"up":"down"' localhost
</pre></blockquote>
<blockQuote>
&lt;shrug&gt;
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Jim] 
"setuid" is a special bit in the UNIX permissions.  You can make your
program SUID with a command like (as root):
</blockQuote>
<blockQuote><CODE>
chown root.bin `which fping` &amp;&amp; chmod u+s `which fping`
</CODE></blockQuote>
<blockQuote>
... assuming fping in own your PATH.
</blockQuote>
<blockQuote>
You can be a little safer using commands like:
</blockQuote>
<blockQuote><CODE>
chmod root.$TRUSTEDGROUP `which fping`; chmod 4550 `which fping`
</CODE></blockQuote>
<blockQuote>
... where you create a group (such as 'staff' or 'trusted') which which
will be allowed to execute this program. Then you associate this
program with that group and mark it so that the owner and members of
the associated group are permitted to read and execute the SUID
program.
</blockQuote>
<blockQuote>
Thus if there is an exploitable bug in the program (a way to "trick" it
into doing things it's not intended to do with it's root privileges)
then only the owner (who's already root) and the members of the trusted
group can attempt to exploit the vulnerability.
</blockQuote>
<blockQuote>
This is very basic UNIX systems administration practice that should be
taught to ALL UNIX and Linux system administration professions in their
first term.  There is not difference between UNIX and Linux in this
regard.
</blockQuote>
<blockQuote>
Note that SUID and SGID only applies to binaries --- NOT to scripts.
Perl has a special helper application (sperl) which allows it to
handle SUID (and SGID?) Perl scripts.  It would be wise to associate
sperl with a trusted group and make it non-world executable (as my
second command example shows).  You can make as many trusted groups
as you like.
</blockQuote>
<blockQuote>
Note that SUID and SGID are the most basic forms of privilege
delegation in UNIX and Linux.  They allow you to write a program which
acts as an agent, allowing one group of users to access some resource
in a controlled and limited way (through the agent).  If the program
(and the libraries against which it is linked) are bug free (or
"sufficiently robust") then this is a safe means of giving everyone or
specific groups access to some protected resource.  In the case of
fping that resource is a lower level form of access to one or more of
your networking interfaces.  In other cases a program might be SGID
"games" to allow it to update a file of high scores.
</blockQuote>
<blockQuote>
Because the likelihood of vulnerability rises dramatically as the size
and complexity of a program increases, it is considered best practice
to make SUID and SGID programs as small as possible --- often splitting
the "agent" portion of the code into a small helper application that is
called by the larger application.
</blockQuote>
<blockQuote>
A general purpose "SUID" wrapper program is called sudo.  It allows you
to maintain a list (even a network wide list) of users (and hostnames)
and a precise list of programs, options that each user or group are
permitted to run and precisely who these programs will effective run
as.  (There are several similar programs like super, caliph, and runas).
sudo is the most commonly used choice among professional sysadmins.
You control its configuration via <TT>/etc/sudoers</TT> (using the visudo
wrapper to edit that; and to check your syntax as you save and exit).
</blockQuote>
<blockQuote>
Naturally I would suggest you make a sudoers group, associate sudo
with that, and mark its mode to 4550 (SUID and non-world-executable)
as I explained before.  This will help limit the number of users that
could exploit any bug found in sudo itself.  Luckily sudo is one of the
more widely audited bits of code on the Internet.  Unfortunately it's
also sufficiently well known and widespread that any cracker that does
find a bug in it; or manages to pass out a trojaned copy of it, will
gain LOTs of access using it (though they need to get to a local shell
account first).
</blockQuote>
<blockQuote>
So it is with <EM>all</EM> SUID and SGID programs.  If the agent is
"vulnerable" it can become a confused deputy and give unfettered access
to all resources owned by a given user or associated with a given
group.  (Obviously unfettered access to the root UID is also complete
control of a normal UNIX or Linux system).
</blockQuote>
<blockQuote>
You can search your entire system for SUID and SGID files with a
command like:
</blockQuote>

<blockquote><pre> 	find / -type f -perm +6000 -ls
</pre></blockquote>
<blockQuote>
... this will find all SUID and SGID <EM>files</EM>.  The SUID bit is
meaningless on directories (at least under Linux and most forms of
UNIX --- so far) and the SGID bit has some special semantics on Linux
and BSD systems (which I've explained in other articles):
</blockQuote>
<blockQuote><BLOCKQuote>
<A HREF="http://linuxgazette.net/issue64/lg_tips64.html#tips/18"
	>http://linuxgazette.net/issue64/lg_tips64.html#tips/18</A>
</BLOCKQuote></blockQuote>
<blockQuote>
The SUID/SGID files are also meaningless on device nodes, FIFOs (named
pipes) and unix domain sockets; as well as "regular" non-executable
files and most scripts (text executables).  All of the permissions bits
are generally ignored on symlinks.
</blockQuote>

<!-- end 2 -->
<!--     .~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.~~.     -->
<A NAME="tag.3"><HR WIDTH="75%" ALIGN="center"></A>
<!-- begin 3 -->
<H3 align="left"><img src="../gx/dennis/qbubble.gif" 
	height="50" width="60" alt="(?) " border="0"
	>Wireless networking</H3>


<p><strong>From Ben Okopnik 
</strong></p> 
<p></strong></p>

<p align="right"><strong>Answered By:  Benjamin Okopnik, Jason Creighton, Thomas Adam
</strong></p>
<P><STRONG>
Hi, all -
</STRONG></P>
<P><STRONG>
I've finally had a chance to test out the wireless Ethernet on my
laptop - in fact, I'm sitting at the local airport right next to their
Air Port (that's a joke, dammit. You're s'posed to laugh.) The problem
is, the speeds that I'm getting in Linux and Wind0ws are <EM>wildly</EM>
disparate, with Linux being on the losing end. Of course, I have no way
to measure the exact speed in Wind0ws (other than maybe downloading a
large file and doing a little math), but the connection properties say
"11Mbps" and "Quality: excellent", and the Web pages <em>  snap  </em> onto the
screen like I've never seen before. Linux... [sigh] I've seen it get as
high as 29kB/S during an "apt-get" operation, and Web pages crawl.
</STRONG></P>
<P><STRONG>
I'm using "ndiswrapper" (possibly part of the problem - like everything
else on this damned Acer, the hardware (Intel PRO/Wireless LAN 2100) is
unsupported), so my whole initialization sequence goes like this:
</STRONG></P>

<pre><strong># ndiswrapper-specific stuff
modprobe ndiswrapper
loadndisdriver 8086 1043 /lib/windrivers/w70n51.sys /lib/windrivers/w70n51.inf

iwconfig wlan0 mode Managed
# Looking for a public access point
iwconfig wlan0 essid default
ifconfig wlan0 up

# get an IP via DHCP
pump -i wlan0
</strong></pre>
<P><STRONG>
"ifconfig wlan0" says:
</STRONG></P>

<pre><strong>wlan0     Link encap:Ethernet  HWaddr 00:04:23:72:F5:DC
          inet addr:X.X.X.XXX  Bcast:YY.Y.Y.YYY  Mask:255.255.255.0
          inet6 addr: fe80::204:23ff:fe72:f5dc/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:55417 errors:0 dropped:0 overruns:0 frame:0
          TX packets:34901 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:81279617 (77.5 MiB)  TX bytes:2375903 (2.2 MiB)
          Interrupt:11 Memory:d0000000-d0000fff
</strong></pre>
<P><STRONG>
Even my old trick of searching for the "parm" string in the module
doesn't produce anything useful:
</STRONG></P>

<pre><strong>strings ndiswrapper.ko | grep parm
parm=if_name:Network interface name (default: wlan0)
parm=proc_uid:The uid of the files created in /proc (default: 0).
parm=proc_gid:The gid of the files created in /proc (default: 0).
</strong></pre>
<P><STRONG>
Change the MTU, maybe? Invoke "iwconfig" in some different way? Or am I
just stuck with it?
</STRONG></P>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Thomas] 
If you haven't done so already, Ben, make sure you have disabled apci from
the kernel:
</blockQuote>
<blockQuote><BLOCKQuote>
linux noapic
</BLOCKQuote></blockQuote>
<blockQuote>
at the LILO prompt (by then you knew that 
<IMG SRC="../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle">)
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Jason] 
Doesn't "modinfo" do the same thing?
</blockQuote>

<blockquote><pre>~$ modinfo sb
filename:    /lib/modules/2.4.20/kernel/drivers/sound/sb.o
description: "Soundblaster driver"
author:      &lt;none&gt;
license:     "GPL"
parm:        io int, description "Soundblaster i/o base address (0x220,0x240,0x260,0x280)"
parm:        irq int, description "IRQ (5,7,9,10)"
parm:        dma int, description "8-bit DMA channel (0,1,3)"
parm:        dma16 int, description "16-bit DMA channel (5,6,7)"
parm:        mpu_io int, description "Mpu base address"
parm:        type int, description "You can set this to specific card type"
parm:        sm_games int, description "Enable support for Logitech soundman games"
parm:        esstype int, description "ESS chip type"
parm:        acer int, description "Set this to detect cards in some ACER notebooks"
parm:        isapnp int, description "When set to 0, Plug &amp; Play support will be disabled"
parm:        isapnpjump int, description "Jumps to a specific slot in the driver's PnP table. Use the source, Luke."
parm:        multiple int, description "When set to 0, will not search for multiple cards"
parm:        pnplegacy int, description "When set to 1, will search for a legacy SB card along with any PnP cards."
parm:        reverse int, description "When set to 1, will reverse ISAPnP search order"
parm:        uart401 int, description "When set to 1, will attempt to detect and enable the mpu on some clones"
~$
</pre></blockquote>
<P><STRONG>
<IMG SRC="../gx/dennis/qbub.gif" ALT="(?)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Is ACPI such an all-around evil thing that you recommend turning it off
in all cases? It just doesn't seem relevant here, unless you have info
to the contrary.
</STRONG></P>

<font color="#000066"><blockquote><IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Heather] I caution against confusing APIC (some sort of feature which SMP
processors all do, some uniprocessors happen to do, and some
CPU/motherboard combinations make poor Tux give up on herring for
Lent) with ACPI (which is what APM might be is you divided it into a few
levels of suspend then told each device to deal with sleepiness
themselves - kind of neat from an object oriented point of view, but
somewhat annoying to someone who just wants to be able to close the
lid safely without knowing why it works).  Both have their moments...
and their times to be set on fire 
<IMG SRC="../gx/dennis/unsmily.gif" ALT=":(" 
		height="24" width="20" align="middle">
</blockquote></font>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Thomas] 
It is a complete nightmare from start to finish. It interferes with
everything. Whenever you get a HW problem such as this, I would always
look at seeing if turning it off solves it.
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
Well! That's quite the characterization.
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Thomas] 
Humour me, at least. Then you can slowly remove your sunglasses and tell
me to think again 
<IMG SRC="../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle">
</blockQuote>
<blockQuote>
<IMG SRC="../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Ben] 
I was actually asking in a spirit of inquiry, not doubting you. It's
just these sunglasses make everyone suspicious. 
<IMG SRC="../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle">
</blockQuote>
<blockQuote>
I'll check it out - should be back on in a few minutes.
</blockQuote>
<P><STRONG>
<IMG SRC="../gx/dennis/qbub.gif" ALT="(?)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Just tried it. The Wi-Fi and the Bluetooth lights now stay on
permanently (can't be turned off), and the speed is a bit lower if
anything (I'm copying a movie file from idgames, and it's running about
26kB/S.)
</STRONG></P>
<!-- end 3 -->
<P> <hr> </p>
<div id="articlefooter">
<H5 align="center">This page edited and maintained by the Editors
        of <I>Linux Gazette</I>
<br><a href="http://linuxgazette.net/copying.html"
        >Copyright &copy;</a> its authors, 2004
<BR>Published in issue 102 of <I>Linux Gazette</I> May 2004</H5>
<H6 ALIGN="center">HTML script maintained by
        <A HREF="mailto:star@starshine.org">Heather Stern</a> of
        Starshine Technical Services,
       <A HREF="http://www.starshine.org/">http://www.starshine.org/</A>
</H6>
</div>

</p>


<!-- *** BEGIN author bio *** -->
<P>&nbsp;
<P>

<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2004, . Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication license</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 102 of Linux Gazette, May 2004
</p>

</div>


<div id="previousnextbottom">
<A HREF="lg_tips.html" >&lt;-- prev</A> | <A HREF="dennis.html" >next --&gt;</A>
</div>


</div>






<div id="navigation">

<a href="../index.html">Home</a>
<a href="../faq/index.html">FAQ</a>
<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="../contact.html">Contact Us</a>

</div>



<div id="breadcrumbs">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">May 2004 (#102)</a> &gt; 
Article

</div>





<img src="../gx/2003/sit3-shine.7-2.gif" id="tux" alt="Tux"/>




</body>
</html>

