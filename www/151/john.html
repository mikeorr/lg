<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="utf-8" xml:lang="utf-8">
<head>
<title>gDesklets: Beauty with a Purpose LG #151</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../lg.css" type="text/css" media="screen, projection"  />
<link rel="alternate" type="application/rss+xml" title="LG RSS" href="lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="lg.rdf" />
<!-- link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" / -->
<link rel="shortcut icon" href="../favicon.ico" />

<style type="text/css" media="screen, projection">
<!--

-->
</style>

</head>
<body>

<a href="../">
<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
</a>
<p id="fun">...making Linux just a little more fun!</p>

<div id="navigation">
<table summary="masthead" width="100%">
<tr>
<td align="center" colspan="3" style="font-size: 10px; font-weight: bold">
<a href="../index.html">Home</a>
<a href="http://linuxgazette.net">Main Site</a>
<a href="../faq/index.html">FAQ</a>

<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="http://lists.linuxgazette.net/mailman/listinfo/">Mailing Lists</a>
<a href="../jobs.html">Join Us!</a>
<a href="../contact.html">Contact Us</a>

<hr width="99%" style="border: 1px inset #000033">
</td>
</tr>
<tr>
<td width="40%" align="left" style="font-size: 10px; font-weight: bold">
The Free International Online Linux Monthly
</td>
<td width="20%" align="center" style="font-size: 10px; font-weight: bold">
ISSN: 1934-371X
</td>
<td width="40%" align="right" style="font-size: 10px; font-weight: bold">
Main site: <a href="http://linuxgazette.net">http://linuxgazette.net</a> 
</td>
</table>
</div>


<div id="breadcrumbs1">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">June 2008 (#151)</a> &gt; 
Article

</div>

<div class="articlecontent1">
<div class="content">

<div id="previousnexttop">
<A HREF="dokopnik.html" >&lt;-- prev</A> | <A HREF="melinte.html" >next --&gt;</A>
</div>

<h1>gDesklets: Beauty with a Purpose</h1>
<p id="by"><b>By <a href="../authors/john.html">Maxin B. John</a></b></p>


<h3>A Quest for Beauty</h3>
<p>
gDesklets provides a bunch of easy-to-use yet eye-pleasing applications for
the GNU/Linux desktop. Mini-applications called <em>desklets</em> can be
developed and executed for the desktop to meet specific needs. Since
gDesklets is known to work on KDE and XFCE, along with GNOME, it can
provide an enchanting look to the Linux Desktop.
</p>

<h3>Installing gDesklets</h3>

<p>
In the case of Debian Etch or Ubuntu 7.xx, installation of gDesklets is
as easy as
</p>

<pre>
apt-get install gdesklets
</pre>

<p>For Fedora users, add the 'freshrpms' repository to the list of
repositories for yum. For that, create a 'freshrpm.repo' file in your
/etc/yum.repos.d/ directory. The content of the file should be:</p>

<pre>
[freshrpms]
name=FreshRPMs for Fedora Core $releasever - $basearch
baseurl=http://ayo.freshrpms.net/fedora/linux/$releasever/$basearch/freshrpms
enabled=1
gpgcheck=1
gpgkey=http://freshrpms.net/RPM-GPG-KEY-freshrpms
</pre>

<p>
Now, issue the command
</p>

<pre>
yum install gdesklet
</pre>

<p>
This will install gDesklets on your machine.
</p>

<p>
For other distributions, source code for the latest gDesklets can be
downloaded from <a
href="http://www.gdesklets.de/">http://www.gdesklets.de/</a> <a
href="#1"><strong>[1]</strong></a>. Following the steps listed below will
install gDesklets onto your machine:
</p>

<pre>
wget http://www.gdesklets.de/files/gDesklets-0.35.4.tar.bz2
tar jxvf gDesklets-0.35.4.tar.bz2 
cd gDesklets-0.35.4
./configure
make
make install
</pre>

<p class="editorial">
[ When installing software from source, please make sure to never run
the steps <tt>tar x ...</tt>, <tt>./configure</tt> and <tt>make</tt>
as <tt>root</tt>. Always use a non-privileged user account for these
steps. -- Ren&eacute; ]
</p>

<p>
We can invoke the gDesklets program by issuing the command "gdesklet" in
the shell, or by selecting gDesklets via <tt>Applications -&gt; accessories
-&gt; gDesklets</tt>. However, remember to start it as an ordinary user -
you won't be able to invoke gDesklets as the "root" user. Some desklets to
be used with gDesklets can be downloaded from the <a
href="http://www.gdesklets.de/?q=desklet/browse">gDesklets Web site</a>.
The downloaded desklets can be installed into your system with the help of
the gDesklet manager application; to install them, just drag and drop the
downloaded *.tar.gz files on the gDesklets manager icon.
</p>

<p>
<img src="misc/john/gdesklets_shell.jpg" alt="gdesklets shell" width="640" height="480">
</p>

<h3>The gDesklets Framework</h3>

<p>
gDesklets is implemented in Python, which is an interpreted,
interactive, object-oriented, extensible programming language.
The gDesklets' framework looks like this:</p>

<p>
<img src="misc/john/framework.png" alt="gdesklets framework" width="400" height="134">
</p>

<ol>
<li> A daemon runs in the background as a server, providing a socket
for communication. Clients connect to the socket to give instructions to
the daemon, which is responsible for loading and running applets.  </li>
<li>
The user interface of applets is defined by ADL, a simple yet
powerful XML-based language.</li>
<li>
The XML-defined user interface can be brought to life with inline scripts -
i.e., Python scripts that are directly written into the XML or imported
there to be executed in a secure sandbox.</li>
<li>The libdesklets library can be used to assist implementation
of sandboxed Python scripting. Sandboxed scripting code uses controls to
access otherwise unreachable data. Basically, they provide a controlled
way to access data outside the sandbox.</li>
</ol>

<h3>A gDesklet Hello, World</h3>

<p>
The main advantages of Python lie in its clarity and ease of use. Since
gDesklets is written in Python, it is both elegant and simple.
</p>

<p>
Now, let's create our very first desklet. The file structure of an ordinary
gDesklet is:</p>

<pre>
hello.tar.gz:
  -&gt;hello/
  -&gt;hello/helloworld.display
  -&gt;hello/hello.png
</pre>

<p>
(The content of 'hello.display' is available <a href="misc/john/hello.display">here</a>.)</p>

<p>
<img src="misc/john/removal.jpg" alt="gdesklets framework" width="640" height="480">
</p>

<p>
The meta tag contains information about your desklet - e.g., the name of
the author, name of the desklet, the version, etc. - which can be viewed in
the gDesklets manager application. The meta tag is optional for every
desklet; the preview file ("hello.png", in this case) is also optional.

<p>To create our desklet and load it in the gDesklet manager
application, perform the following steps:</p>

<pre class="code">
mkdir hello
cp helloworld.display hello
cp hello.png hello
tar czvf hello.tar.gz hello
</pre>

<p>
Now, the desklet is ready for use and can be loaded into the gDesklets
manager.  After installation, it can be removed by simply clicking on the
desklet and choosing the 'remove' option.</p>

<h3>Using the Controls in gDesklets</h3>

<p>
The controls in gDesklets allow your inline scripts access to any kind of
data with the help of the 'gdesklets' library. This mechanism maintains the
integrity and security of the sandbox scripting environment which is the
backbone of the gDesklets. In effect, controls help to share the
functionality among desklets without duplicating it. Let's create another
simple gDesklet that uses a control to show the second-by-second load
average of the processor.
</p>

<P>
The content of processor.display is available <a href="misc/john/processor.display">here</a>.</p>

<p>
The control tag loads a particular control by the cited interface, and
binds it to the cited ID. The first step in using the control in your
desklet is to find the control's unique interface identity. For the
System interface, which provides information like CPU load, network
statistics, memory statistics, etc., the unique interface string is
<tt>ISystem:4zcicmk4botcub7iypo46t2l7-2</tt>. The corresponding unique interface
string for each control is obtained from the gDesklets manager
application, by browsing through the controls installed in the system.
</p>

<p>
Then pack the processor desklet, just like we did before:
</p>

<pre>
processor.tar.gz:
  -&gt;processor/
  -&gt;processor/processor.display
</pre>

<p>
Now the processor desklet is ready for deployment via the gDesket
manager application. See our desklet in action:
</p>

<p>
<img src="misc/john/processor.jpg" alt="Controls in Gdesklets" width="640" height="480">
</p>

<h3>Plotting the Network Usage Graph</h3>

<p>
The plotter element in gDesklets allows us to generate graphs of various
data such as processor usage, free memory available, network speed, etc. in
real time on our desktop. Now, let's dare to plot a real-time graph that
shows the number of incoming packets on our eth0 network interface.
</p>

<p>
(The content of netspeed.display is available <a href="misc/john/netspeed.display">here</a>.)
</p>

<p>
Now, as usual, create the desklet (netspeed.tar.gz) using the netspeed.display file.
</p>

<pre>
netspeed.tar.gz:
  -&gt;netspeed/
  -&gt;netspeed/netspeed.display
</pre>

<h3> Let's create our own control</h3>

<p>
The real power of gDesklets lies in the fact that the user can extend its
capabilities by writing his or her own controls. Controls are Python
classes derived from the Control base class and from the interfaces they
implement. Now, let's see how to roll a simple control of our own. Since
the control needs to be verified, we will also write a small desklet that
uses our "home-made" control.  </p>

<p>
Most of the controls live in <tt>/usr/lib/gdesklets/Controls</tt>. We'll
create an 'ntp' directory there, and create a control to retrieve the
precise time by contacting an NTP server. The Network Time Protocol is a
protocol used for synchronizing the clocks of computer systems over
packet-switched, variable-latency data networks. Through the gDesklet
control and desklet, we will contact the Red Hat NTP server
(0.fedora.pool.ntp.org), fetch the time, and display it on the desktop.
Please note that this desklet won't be syncing the clocks; it will be just
displaying the precise time on the desktop.</p>

<p>
The control directory has to include all interface files from which the
control inherits. Usually, the filenames of interface files start with
an "I" - so here the name of the interface file is Intp.py. The
__init__.py is a mandatory file for a control. Every property in the
interfaces must be implemented by creating appropriate property objects.
</p>

<p> 
The directory structure of a simple control (here, <tt>ntp</tt>) looks like this:
</p>

<pre>
ntp/
  Intp.py
  __init__.py

</pre>

<p>
The Intp.py file is:
</p>

<pre>
from libdesklets.controls import Interface, Permission

class Intp(Interface):
    ntp_time = Permission.READ

</pre>

<p>
The __init__.py file is:
</p>

<pre>
from libdesklets.controls import Control

from Intp import Intp
from socket import *
import struct
import sys
import time

class ntp(Control, Intp):

    def __init__(self):
        Control.__init__(self)
	pass
    def __get_time(self):
     	Server = ''
	EPOCH = 2208988800L
	Server = '0.fedora.pool.ntp.org'
	client = socket( AF_INET, SOCK_DGRAM )
	data = '\x1b' + 47 * '\0'
       	client.sendto( data, ( Server, 123 ))
       	data, address = client.recvfrom( 1024 )
       	if data:
        	t = struct.unpack( '!12I', data )[10]
           	t -= EPOCH
          	return time.ctime(t)
    ntp_time=  property(__get_time, doc = "the current time")     

def get_class():
	return ntp
</pre>

<p>
The interface identifiers are made up of a human-readable name given by
the interface's author and a random-looking string. That string is
based on a checksum of the interface, and is affected by any changes to
the interface, except for changes in comments in the desklet code. The
gDesklets manager program will auto-generate the interface identifier for
each control, so we don't have to worry about the interface identifier for
our NTP control.
</p>

<p>
<img src="misc/john/ntp.jpg" alt="NTP Control" width="640" height="480">
</p>

<p>
<a href="misc/john/ntptest.display">Verification program</a> for our control.
</p>

<p>
Then, pack the processor desklet, like this:
</p>

<pre>
ntptest.tar.gz:
  -&gt;ntptest/
  -&gt;ntptest/ntptest.display
</pre>

<p>Now the processor desklet as well as the control is ready for use.</p> 

<h3>Conclusion</h3>

<p>
gDesklets is an answer to those who complain that Linux is a geek's
operating system; it adds spice to the capabilities of Linux by combining
beauty and purpose on the Linux desktop. It also makes life a bit easier
for the common GNU/Linux desktop user.  </p>

<h3>Reference</h3>

<p>
The main source of information about gDesklets is <a
href="http://www.gdesklets.de/">http://www.gdesklets.de/</a>.
The Developer's Book is available at <a
href="http://develbook.gdesklets.de/book.html">http://develbook.gdesklets.de/book.html</a>.</p>

<hr>
<a name="1"></a>
<p> [1] <span class="editorial">Rick Moen comments</span>:  This is
called fetching an "upstream tarball", as opposed to a maintained
package tailored for the user's Linux distribution, and in my considered
view should be a last-resort method of installing any significant
software, if one is absolutely certain that no package from or for one's
distribution exists.  There are several compelling reasons for this
preference, and I detailed them <a href="http://linuxgazette.net/118/weatherwax.html#1">a few years ago</a>,
when this matter last came up.</p>




<script type='text/javascript'>
digg_url = 'http://linuxgazette.net/151/john.html';
digg_title = 'gDesklets: Beauty with a Purpose';
digg_bodytext = '<p> gDesklets provides a bunch of easy-to-use yet eye-pleasing applications for the GNU/Linux desktop. Mini-applications called <em>desklets</em> can be developed and executed for the desktop to meet specific needs. Since gDesklets is known to work on KDE and XFCE, along with GNOME, it can provide an enchanting look to the Linux Desktop. </p> ';
digg_topic = 'linux_unix';
</script>
<script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>


<p class="talkback">
Talkback: <a
href="mailto:tag@lists.linuxgazette.net?subject=Talkback:151/john.html">Discuss this article with The Answer Gang</a>
</p>

<!-- *** BEGIN author bio *** -->
<!-- *** BEGIN bio *** -->
<hr>
<p>
<img align="left" alt="Bio picture" src="../gx/2002/note.png" class="bio">

<!-- 
If the author has sent his pic, save it to the right directory
and enable the line below.

<img align="left" alt="Bio picture" src="../gx/authors/pic.jpg" class="bio">

-->

<em>

<p>
I am an ardent fan of GNU/Linux from India. I admire the power,
stability and flexibility offered by Linux. I must thank my guru, Mr.
Pramode C. E., for introducing me to the fascinating world of Linux.
</p>

<p>
I have completed my Masters in Computer Applications from Govt.
Engineering College, Thrissur (Kerala, India) and am presently working at
Ushus Technologies, Thiruvananthapuram, India, as a Software Engineer.
</p>

<p>
In my spare time, you can find me fiddling with Free Software, free
diving into the depths of Ashtamudi Lake, and practicing Yoga. My other
areas of interest include Python, device drivers, and embedded
systems.
</p>


</em>
<br clear="all">
<!-- *** END bio *** -->


<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2008, Maxin B. John. Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication License</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 151 of Linux Gazette, June 2008
</p>

</div>

<div id="previousnextbottom">
<A HREF="dokopnik.html" >&lt;-- prev</A> | <A HREF="melinte.html" >next --&gt;</A>
</div>

</div>
</div>

<script src="http://www.google-analytics.com/urchin.js"
type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1204316-1";
urchinTracker();
</script>







<img src="../gx/tux_86x95_indexed.png" id="tux" alt="Tux"/>

</body>
</html>

