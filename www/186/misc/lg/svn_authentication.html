<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'
		 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml' lang='utf-8' xml:lang='utf-8'>
<head>
<title>SVN authentication</title>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
<link rel='stylesheet' type='text/css' href='../../../lg.css' />
</head>
<body>
<a href="../../../"><img alt="Linux Gazette" src="../../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" /></a><img alt="Tux" src="../../../gx/tux_86x95_indexed.png" id="tux" /><p id="fun">...making Linux just a little more fun!</p><div class='content articlecontent'><a name="top"></a><h3>SVN authentication</h3>
<p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Wed, 16 Mar 2011 16:49:29 -0400</b>
</p>

<p>
Hi, all -
</p>

<p>
I'm hoping that someone here has experience in setting up SVN. I'm
running into several issues in setting it up for LG... frankly, it's
mostly my own mental state more than anything else; 'buffer full' at the
moment. Unsurprising, after a couple of weeks of full-time training
course development, setting up LG in its new home, and learning a new
language during all that. My brain is pretty cooked, and I desperately
need a break. I'm just hoping that someone here has a shortcut; it
shouldn't be that difficult, really.
</p>

<p>
What I'd like to do is set it up so that I don't have to create a system
account for everyone who needs SVN access. We don't even need web access
to the repo; we just need our editors and proofreaders to authenticate
via whatever mechanism SVN uses, pull a copy of the repo, and check
their work back in whenever they're done with it.
</p>

<p>
Any help - and the best of all possible world would be an offer like
"I'd be happy to do it for you!" - would be <strong>very</strong> welcome.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Henry Grebler [henrygrebler at optusnet.com.au]
</p>

<p>

</p>
</b><br />
<b>Thu, 17 Mar 2011 09:05:52 +1100</b>
</p>

<p>
Hi Ben,
</p>


<p>
--&gt;Any help - and the best of all possible world would be an offer like
--&gt;"I'd be happy to do it for you!" - would be <strong>very</strong> welcome.
</p>

<p>
I'd be happy to do it for you. To try, anyway.
</p>

<p>
I assume you can give me access. If I think about it, I already have
access. Maybe.
</p>

<p>
If I think about it some more, I already have the access you say you
want to give. So what am I missing?
</p>

<p>
My qualifications are that I have never done it before. And then, when
I think about it a little harder, I think I have. 
</p>

<p>
	help subversion
</p>

<p>
Not much. Try other machine. Now that's better! Ok, I have done it
before. Not for use outside the company, but networks are networks.
</p>

<p>
Perhaps you should contact me directly (outside TAG) and we can
discuss it further. Then I can say:
</p>

<p>
	What do you see?
	What do you want to see?
</p>

<p>
Or am I being a shameless self-promoter?
</p>


<p>
Cheers,
Henry
</p>

<p>
<em>                                             </em>
TAG mailing list
TAG@lists.linuxgazette.net
<a href='http://lists.linuxgazette.net/listinfo/tag'>http://lists.linuxgazette.net/listinfo/tag</a>
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Wed, 16 Mar 2011 22:51:34 -0400</b>
</p>

<p>
Hi, Henry -
</p>

<p>
On Thu, Mar 17, 2011 at 09:05:52AM +1100, Henry Grebler wrote:
</p>

<pre>
&gt; 
&gt; Hi Ben,
&gt; 
&gt; 
&gt; --&gt;Any help - and the best of all possible world would be an offer like
&gt; --&gt;"I'd be happy to do it for you!" - would be <strong>very</strong> welcome.
&gt; 
&gt; I'd be happy to do it for you. To try, anyway.
&gt; 
&gt; I assume you can give me access. If I think about it, I already have
&gt; access. Maybe.
</pre>

<p>
Remember the part where I said "move LG into its new home"? It's been
rehosted at a VPS.
</p>

<p>
[sigh] It's at times like these that a CMS, with a built-in versioning
system, etc. begins to sound appealing.  Maintaining the rather rickety
and somewhat cumbersome lashup that the LG production system has become
can be rather wearying.
 
</p>

<pre>
&gt; If I think about it some more, I already have the access you say you
&gt; want to give. So what am I missing?
</pre>

<p>
Now that you've reminded me, I've created an account for you there
(henry@linuxgazette.net), with your SSH key already installed.
 
</p>

<pre>
&gt; Perhaps you should contact me directly (outside TAG) and we can
&gt; discuss it further.
</pre>

<p>
Will do.
</p>


<pre>
&gt; Then I can say:
&gt; 
&gt; 	What do you see?
&gt; 	What do you want to see?
&gt; 
&gt; Or am I being a shameless self-promoter?
</pre>

<p>
You <em>are</em> shameless! But that's not the only reason we like you... <img src="../gx/smile.png" alt=":)">
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Wed, 16 Mar 2011 23:13:50 -0400</b>
</p>

<p>
On Wed, Mar 16, 2011 at 11:50:30PM +0100, jmanel wrote:
</p>

<pre>
&gt; Hi,
&gt;    Some time ago i worked for a firm that every task was for yesterday
&gt; and I remember having to install a subversion. I don't remember doing
&gt; any other thing that follow instructions from a readme or similar.
&gt;       Sorry, but no clue with the problem. I could try doing it remotely.
</pre>

<p>
Hi, Josep; thanks for your offer. That's a great way to start here -
welcome to TAG! - but between Dave Richardson and Henry Grebler, two of
the highly-competent folks that we have here, I suspect that it's
handled.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Dumont Jean [chaneau at gmail.com]
</p>

<p>

</p>
</b><br />
<b>Thu, 17 Mar 2011 13:36:57 +0100</b>
</p>

<p>
Le 16/03/11 21:49, Ben Okopnik a =E9crit :
</p>

<pre>
&gt; Hi, all -
&gt; =
</pre>

<p>
Hi
</p>

<p>
The easiest way is to ask Apache to validate your users
</p>

<p>
Something along the lines:
</p>

<p>
&lt;VirtualHost xx.xx.xx.xx:80&gt;
 ServerName your.server.name # no need to explain
 DocumentRoot /var/www/ # does not matter won't be used
 RewriteEngine on # to go to the right url
 RewriteRule ^/$ /svn [L,R] # this one
</p>

<p>
# You can read the repositoory anonymously but not write to it
</p>

<p>
 &lt;Location /svn&gt;
  DAV svn # turn the dav mode on
  SVNPath /your/svnroot #
  SVNIndexXSLT /svnindex.xsl # to customize the look
  AuthType Basic # no need to explain
  AuthName "Subversion repository" # whatever
  AuthUserFile /etc/subversion/password # Apache must be able to read it
  &lt;LimitExcept GET PROPFIND OPTIONS REPORT&gt;
   Require valid-user
  &lt;/LimitExcept&gt;
 &lt;/Location&gt;
</p>

<p>
# next an example with no access except when authentified
</p>

<p>
&lt;Location /svn/documents&gt;
  DAV svn
  SVNPath /svn-root-private
  SVNIndexXSLT /svnindex.xsl
  AuthType Basic
  AuthName "Subversion Documents repository"
  AuthUserFile /etc/subversion/password-docs
  Require valid-user
 &lt;/Location&gt;
</p>

<p>
&lt;/VirtualHost&gt;
</p>


<p>
You can then create your users with htpasswd and no need to have systems
users
</p>

<p>
HTH
</p>

<p>
Good day and keep doing the fantastic job with LG
</p>

<p>
-- =
</p>


<p>
HTH
<em>                                             </em>
TAG mailing list
TAG@lists.linuxgazette.net
<a href='http://lists.linuxgazette.net/listinfo/tag'>http://lists.linuxgazette.net/listinfo/tag</a>
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Thu, 17 Mar 2011 09:02:24 -0400</b>
</p>

<p>
Hi, Dumont -
</p>

<p>
On Thu, Mar 17, 2011 at 01:36:57PM +0100, Dumont Jean wrote:
</p>

<pre>
&gt; Le 16/03/11 21:49, Ben Okopnik a écrit :
&gt; &gt; Hi, all -
&gt; &gt; 
&gt; Hi
&gt; 
&gt; The easiest way is to ask Apache to validate your users
</pre>

<p>
[snip]
</p>

<p>
That would be a terrific answer - a shortcut of exactly the sort that I
asked for - if it did what we need it to do. I may be wrong, but I
don't think it does. My fault for not clarifying this, but I've been
doing it for so long that it just seemed like "the obvious thing"; it's
clearly not.
</p>

<p>
The LG editing process all happens at the command line; every pass goes
something like this:
</p>

<p>
svn update      # Get the latest changes
vi STATUS       # Mark an article as "out for editing/proofing"
svn commit      # Check STATUS back in
vi article.html # Edit the article
vi STATUS       # Update article status
svn commit      # Check it all back in
</p>

<p>
Apache isn't involved anywhere; neither is WebDAV. Configuring Apache
would be pretty simple; learning about WebDAV, etc. would be yet another
major task to take on - which just isn't in the cards. And having
everyone relearn a new method of doing this... like I said, at that
point, a CMS starts to look really good. <img src="../gx/smile.png" alt=":)">
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Thu, 17 Mar 2011 09:47:30 -0400</b>
</p>

<p>
On Thu, Mar 17, 2011 at 02:20:17PM +0100, Dumont Jean wrote:
</p>

<pre>
&gt; 
&gt; Well you asked for a solution where you do not have to create system
&gt; users the alternative is to use ssh with key authentication but unless
&gt; you are prepared to set up some LDAP I don't think you can do it without
&gt; creating users
</pre>

<p>
OK; thanks for that overview (I'm ignorant enough of the whole SVN
system that I didn't realize that.)
 
</p>

<pre>
&gt; We do use subversion on a daily basis with dozens of users having
&gt; different access rights to different parts of the repository and it's
&gt; very easy to set-up and maintain.
&gt; 
&gt; And we use no graphical client at all if I must make a commit I just do
&gt; 
&gt; (this is my last commit)
&gt; 
&gt; svn ci -m 'Modified the schema to create an index for the categories'
</pre>

<p>
Oh, OK - that <em>is</em> exactly the kind of interaction that we need. 
 
</p>

<pre>
&gt; Sorry if I misunderstood your first request.
</pre>

<p>
Maybe you didn't. <img src="../gx/smile.png" alt=":)"> Although I'm still not clear on how Apache
interacts with SVN to provide authentication, and I have no experience
or even the slightest knowledge about DAV.
</p>

<p>
I think that given the time constraints (the LG publishing cycle begins
in just three days), I may be best off doing what I did previously, when
I had no root access to the host account: that is, setting up SVN-only
access via SSH using a single account for everyone. Having had a night
of sleep has helped a bit with the mental burn-out, and I <em>just</em> might
be able to handle that.
</p>

<p>
(I do have a pretty decent cure for that burnout, sitting just a few
hundred yards away from me - I just bought a beautiful Yamaha Virago
1100 bike that rides like a dream. But, well, responsibilities. Dammit.)
</p>

<p>
<a href='http://motoprofi.com/motospecspictures/yamaha/xv_1100_virago-1995.html'>http://motoprofi.com/motospecspictures/yamaha/xv_1100_virago-1995.html</a>
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Thu, 17 Mar 2011 09:53:01 -0400</b>
</p>

<p>
Hey there, Arslan!
</p>

<p>
On Thu, Mar 17, 2011 at 06:21:12PM +0500, Arslan Farooq wrote:
</p>

<pre>
&gt; Hi
&gt; 
&gt;     like I said, at that point, a CMS starts to look really good. <img src="../gx/smile.png" alt=":)">
&gt; 
&gt; I make websites in Joomla. But version control is not built-in in it.
</pre>

<p>
WordPress has it, but then WordPress has <em>everything</em>. It's the ultimate
kitchen-sink - and that's just the default configuration. <img src="../gx/smile.png" alt=":)"> I've been
doing sites in it, and although I've had to write my own plugins a
couple of times, the usual answer is "it's already in there."
</p>

<p>
A friend has recommended TextPattern, and I've been very impressed with
what I've seen so far. Minimalist, clean approach and <em>fast.</em> The only
problem is, it doesn't produce static HTML (only a couple of CMSes do.)
If I found one that was as clean as TextPattern <em>and</em> produced static
HTML, I'd have shifted the production system to it long ago.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Dumont Jean [chaneau at gmail.com]
</p>

<p>

</p>
</b><br />
<b>Thu, 17 Mar 2011 15:14:00 +0100</b>
</p>

<p>
Le 17/03/11 14:47, Ben Okopnik a =E9crit :
</p>

<p>
Ok, I must not assume that my explanations are clear (english is not my
first language nor my second so I'll try harder)
</p>

<p>
Subversion has no concept of authentication, so you must put in place
some mechanism to authenticate your users
</p>

<p>
Usually you do that with a shell access using ssh and you put your users
in a group which has write access to the physical path of your repository.
</p>

<p>
The url for the commit is something like this
</p>

<p>
svn ci svn+ssh...
</p>

<p>
That's one way to do it
</p>

<p>
The downside is that you have to give to your users shell access to your
server although you can strictly restrict what they can do with ssh +
pam options (but once again this is not trivial)
</p>

<p>
Another approach is to use Apache as a authentication proxy, all you
have to do is enable the dav module and put your users in a file which
Apache can read
</p>

<p>
the url for the commit is thus
</p>

<p>
svn ci <a href='https://myserver/myrepository'>https://myserver/myrepository</a>
</p>

<p>
The downside is that you will be obliged to use username + password
which will force you to use ssl on Apache if security is to be considered.
</p>

<p>
There is a third approach, you could set up a CA or obtain a certificate
and distribute client certificates to your users.
</p>

<p>
Here, as we live in Belgium, we use our EID (Identity card delivered by
the Belgian Government, we don't have a governement but we still have
the cards ;-) ) and in fact I also used my FSFE card to authenticate myself.
</p>

<p>
So there are numerous choices to choose from but by far Apache is the
easiest to implement if you don't want to create system users of course.
</p>

<p>
-- =
</p>

<p>
Jean
<em>                                             </em>
TAG mailing list
TAG@lists.linuxgazette.net
<a href='http://lists.linuxgazette.net/listinfo/tag'>http://lists.linuxgazette.net/listinfo/tag</a>
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at okopnik.com]
</p>

<p>

</p>
</b><br />
<b>Thu, 17 Mar 2011 12:22:31 -0400</b>
</p>

<p>
On Thu, Mar 17, 2011 at 03:14:00PM +0100, Dumont Jean wrote:
</p>

<pre>
&gt; Le 17/03/11 14:47, Ben Okopnik a écrit :
&gt; 
&gt; Ok, I must not assume that my explanations are clear (english is not my
&gt; first language nor my second so I'll try harder)
</pre>

<p>
Jean, your English is excellent. I can only imagine myself having to do
this in French, and... well, I learned enough (Canadian) French after a
week in Montreal to order a "breuvage" (rather than a ""boisson"), but I
doubt that it would get me through SVN and Apache authentication. <img src="../gx/smile.png" alt=":)">
</p>

<p>
Thank you for making the effort!
 
</p>

<pre>
&gt; Subversion has no concept of authentication, so you must put in place
&gt; some mechanism to authenticate your users
&gt; 
&gt; Usually you do that with a shell access using ssh and you put your users
&gt; in a group which has write access to the physical path of your repository.
&gt; 
&gt; The url for the commit is something like this
&gt; 
&gt; svn ci svn+ssh...
&gt; 
&gt; That's one way to do it
</pre>

<p>
I <em>think</em> that I've got this running at this point. Maybe. I've tested
it as much as I could (more on this in a bit), but here's what I did:
</p>

<p>
1) Created a 'gazette' system account.
2) Added all the SSH pubkeys to ~gazette/.ssh/authorized_keys in the
"command" SSH format - i.e.,
</p>

<p>
command="svnserve -t --tunnel-user=joe",no-pty ssh-dss AAAAB3NzaC1kc3MAAACBAKOCcqOj4...
</p>

<p>
This does not allow logging in, but it does allow SVN transactions over
SSH.
</p>

<p>
3) Tested it from several locations, using not only my own credentials
but those of other LG staffers:
</p>

<p>
SVN_SSH='/usr/bin/ssh -l gazette -i /tmp/id_dsa.pub' svn checkout svn+ssh://linuxgazette.net/var/svn/linuxgazette.net lg_svn
</p>

<p>
Seems fine so far. Obviously, once the working copy is on your machine,
you don't need to type out all of the above - mostly, this requires
setting the SVN_SSH variable - but it <em>should</em> all be back to normal.
</p>

<p>
Oh, right - I still need to check out uploading. [sigh] Brain <em>still</em>
not all there. I think I'm going to take a break and go bend the bike
around some hairpin turns for a few hours.
</p>

<p>
Jean, even if your "only" contribution here were to be a sounding board,
you've really helped out. Again, thank you!
</p>


<p>
Ben
<pre>-- 
                       OKOPNIK CONSULTING
        Custom Computing Solutions For Your Business
Expert-led Training | Dynamic, vital websites | Custom programming
  443-250-7895   <a href='http://okopnik.com'>http://okopnik.com</a>   <a href='http://twitter.com/okopnik'>http://twitter.com/okopnik</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Fri, 18 Mar 2011 09:12:06 -0400</b>
</p>

<p>
On Thu, Mar 17, 2011 at 10:52:56PM +0100, Marcello Romani wrote:
</p>

<pre>
&gt; Il 17/03/2011 14:02, Ben Okopnik ha scritto:
&gt; &gt;
&gt; &gt;The LG editing process all happens at the command line; every pass goes
&gt; &gt;something like this:
&gt; &gt;
&gt; &gt;svn update      # Get the latest changes
&gt; &gt;vi STATUS       # Mark an article as "out for editing/proofing"
&gt; &gt;svn commit      # Check STATUS back in
&gt; &gt;vi article.html # Edit the article
&gt; &gt;vi STATUS       # Update article status
&gt; &gt;svn commit      # Check it all back in
&gt; 
&gt; Ben, the workflow you listed above can be performed regardless of
&gt; how the svn client accesses the repository (yes subversion is THAT
&gt; good <img src="../gx/smile.png" alt=":-)">
</pre>

<p>
I'd kinda gathered that. <img src="../gx/smile.png" alt=":)">
</p>


<pre>
&gt; If the working copy is on the same host where the repository files
&gt; reside then the svn client can read and write them directly, without
&gt; any middleware inbetween.
</pre>

<p>
Unfortunately, this is where the problem comes in. If it was on the same
host, then that would presume that everybody works on that same host...
and thus has an account on it, right? <img src="../gx/smile.png" alt=":)">
</p>

<p>
In any case, it's all serviceable at this point - at least as far as all
the testing I've done indicates. The only thing that's left is setting
up the rsync server and the FTP server... and that's just going to have
to wait. My time is pretty thoroughly commited for the next couple of
weeks. FTP, I might be able to sneak in - it's a pretty trivial task,
and one I'm thoroughly familiar with; rsync, on the other hand, isn't,
and I just don't have the time to study all the pertinent issues.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Fri, 18 Mar 2011 10:06:00 -0400</b>
</p>

<p>
On Fri, Mar 18, 2011 at 08:30:11AM +0100, Dumont Jean wrote:
</p>

<pre>
&gt; 
&gt; Yes the solution you posted yesterday will work, I just see two flaws in
&gt; it, first you <em>do</em> have a system user albeit a single one
</pre>

<p>
Oh, it wasn't a religious issue: I wasn't going to kill myself if I had
to set up so much as one single user account. <img src="../gx/smile.png" alt=":)"> I just didn't like the
idea of having to set up all those just to provide SVN access. Besides,
that's a non-login account anyway, which takes away all the maintenance
headaches.
</p>


<pre>
&gt; second this
&gt; is a solution that can't scale beyond a few contributors, I guess that
&gt; the management of the public keys alone would rapidly turn into a nightmare.
</pre>

<p>
I'm not sure why you'd think that; I'll never have to do anything more
complicated than copy and paste the "command section" of a line and then
add the user's key. I've never had a reason to revoke anyone's SVN
access, but if I ever did, deleting one line would do it. I suppose I
could quickly crank out a GUI that would help me manage it... but I
don't even see a reason to do that; it's pretty basic as it is.
 
</p>

<pre>
&gt; And besides how do you know who has committed? Just so you can put the
&gt; blame on somebody when everything is broken??
</pre>

<p>
That <strong>is</strong> the one downside of this approach - but now that we've given
up on flogging and hanging for the first offense, it's not quite as
important as it used to be. <img src="../gx/smile.png" alt=":)"> Mostly, we rely on people to note who
they are in the SVN comments; i.e.
</p>

<pre>
Finished editing knuth.html; checking out wirth.html next.
 -- HLMencken
</pre>

<p>
It's always worked fine (although I suspect we're going to see a few
"Horace Greely" entries and maybe a "Max Perkins" or two in there now
that I've said this. <img src="../gx/smile.png" alt=":)"> If that ever becomes important - well, it's a
lot easier to go from a nominally-working system to an improved one
rather than making it all work from scratch. This gives us at least the
basic functionality, which is good enough for the moment.
 
</p>

<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at okopnik.com]
</p>

<p>

</p>
</b><br />
<b>Fri, 18 Mar 2011 21:42:01 -0400</b>
</p>

<p>
Hi, Henry -
</p>

<p>
On Sat, Mar 19, 2011 at 11:53:01AM +1100, Henry Grebler wrote:
</p>

<pre>
&gt; 
&gt; Ben wrote:
&gt; 
&gt; --&gt;In any case, it's all serviceable at this point - at least as far as all
&gt; --&gt;the testing I've done indicates. The only thing that's left is setting
&gt; --&gt;up the rsync server and the FTP server... and that's just going to have
&gt; 
&gt; rsync server? I must have missed something. I don't recall hearing
&gt; anything about an rsync server.
</pre>

<p>
Those are two of the ways, aside from HTTP, in which we make our
archives available to our mirrors (and anyone else who wants them.)
</p>

<p>
<a href='../../../ftpfiles/'>http://linuxgazette.net/ftpfiles/</a>
</p>

<p>
Normally, we would have all of the above available via rsync as well -
but we don't, at the moment.
</p>


<pre>
&gt; Look, it's not intended as a criticism. And what keeps running around
&gt; in my brain (for more than just this reason) is the old saw, "When
&gt; you're up to your ass (arse) in alligators (crocodiles), it's easy to
&gt; forget that the initial objective was to drain the swamp."
</pre>

<p>
The original objective was to set up LG so that we can provide all the
services we used to. 'rsync' has been a problem for quite a while,
because our previous hosting arrangement turned out to have a policy
<strong>prohibiting</strong> rsync along with any other daemons. Therefore, bye-bye
former hosting arrangement.
</p>


<pre>
&gt; I guess if you had the time to spec out everything you want, you'd
&gt; pretty much have cracked most of your problems.
</pre>

<p>
Actually, I've listed all that's left. Setting everything up was a
pretty major undertaking, but it's almost done. /Viva Linux!/
</p>


<pre>
&gt; Since you have ssh access, you don't actually need an rsync server.
</pre>

<p>
I'm afraid you're operating from a false perspective, Henry; the purpose
of rsync in this case is not to give <em>us</em> access - it's to provide
access for the world.
</p>


<pre>
&gt; You can do whatever you need with simple rsync over ssh. I'm also not
&gt; clear why you need an rsync server and an ftp server. Don't they do
&gt; about the same thing (with different amounts of security)? And doesn't
&gt; rsync do everything ftp does, only as well or better?
</pre>

<p>
FTP is what some people use to download our archives - and it's there
for the same reason as rsync. No security issue obtains, since it's all
anonymous access.
 
</p>

<pre>
&gt; What I think I'm missing is what was it in what existed previously
&gt; that you feel is unsatisfactory? What problems are you trying to
&gt; solve?
</pre>
                                                  vvvvvvvvvv
Nothing. Which is why I'm trying to bring up this new system up to speed. 
                                                  ^^^^^^^^^^
<img src="../gx/smile.png" alt=":)">
</p>


<pre>
&gt; My next thought goes along these lines. It seems that you have had a
&gt; change of venue forced upon you.
</pre>

<p>
Nope. I saw a net gain to rehosting LG, and put in the effort to get it
done.
</p>


<pre>
&gt; I would advise caution; and recommend a two-step approach. (Especially
&gt; because, as I understand it, there is no fall-back.) Having been
&gt; forced to move, simply aim for replication. Make improvement a
&gt; subsequent objective. That approach buys you time. Act in haste,
&gt; repent at leisure.
</pre>

<p>
It's done. The bridge is long burned, the ashes and the remains of the
main span have fallen into the fast-flowing river below and been swept
downstream. Furthermore, the fires are out - there isn't even any
residual heat left.  Birds have built nests in the charred remains;
winter has come and gone, and a new generation of hatchlings is cracking
the shells peering out at the world, and uttering hungry cries.
</p>

<p>
The point you're talking about, in other words, is long past. <img src="../gx/smile.png" alt=":)">
</p>


<pre>
&gt; You said something about having to get the next edition of LG out. If
&gt; you start messing with the (production) environment at such a crucial
&gt; time, you might end up with paradise;
</pre>

<p>
Nonono. The production environment needed to be brought into working
order; thus, the desperate need for SVN. Now that it's up, the
production environment <em>is</em> in working order.
</p>


<pre>
&gt; 	O, that way madness lies; let me shun that;
&gt; 	No more of that.
&gt; 		- King Lear.
</pre>

<p>
...
</p>

<pre>
  Thou think'st 'tis much that this contentious storm
  Invades us to the skin: so 'tis to thee;
  But where the greater malady is fix'd,
  The lesser is scarce felt. Thou'ldst shun a bear;
  But if thy flight lay toward the raging sea,
  Thou'ldst meet the bear i' the mouth.
</pre>

<p>
The raging sea is stilled, and the only remaining bears are quite small
and rather inoffensive. <img src="../gx/smile.png" alt=":)">
 
</p>

<pre>
&gt; Of course, I've probably missed something crucial.
</pre>

<p>
Minor details, is all. <img src="../gx/smile.png" alt=":)">
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Francis Daly [francis at daoine.org]
</p>

<p>

</p>
</b><br />
<b>Sat, 19 Mar 2011 15:46:15 +0000</b>
</p>

<p>
On Fri, Mar 18, 2011 at 10:06:01AM -0400, Ben Okopnik wrote:
</p>

<pre>
&gt; On Fri, Mar 18, 2011 at 08:30:11AM +0100, Dumont Jean wrote:
</pre>

<p>
Hi there,
</p>

<p>
Unlike the ftp and rsync mails, this one is not from any experience, but
purely from manual-reading. So assume the appropriate amount of salt...
</p>

<p>
[re-added from earlier Ben-mail]
</p>


<pre>
&gt; here's what I did:
&gt; 
&gt; 1) Created a 'gazette' system account.
&gt; 2) Added all the SSH pubkeys to ~gazette/.ssh/authorized_keys in the
&gt; "command" SSH format - i.e.,
&gt; 
&gt; command="svnserve -t --tunnel-user=joe",no-pty ssh-dss AAAAB3NzaC1kc3MAAACBAKOCcqOj4...
&gt; 
&gt; This does not allow logging in, but it does allow SVN transactions over
&gt; SSH.
</pre>


<pre>
&gt; &gt; And besides how do you know who has committed? Just so you can put the
&gt; &gt; blame on somebody when everything is broken??
&gt; 
&gt; That <strong>is</strong> the one downside of this approach
</pre>

<p>
What you've set up seems to be pretty much by the book -- the book being
<a href='http://svnbook.red-bean.com/'>http://svnbook.red-bean.com/</a> -- and according to (my reading of) chapter 6
"Server Configuration", section "svnserve, a Custom Server", subsections
"svnserve over a tunnel" and "Controlling the invoked command", what
you have done should Just Work:
</p>

<p>
"""
the --tunnel-user option tells svnserve to assume that the named argument
is the authenticated user. Without --tunnel-user, it would appear as
though all commits were coming from the one shared system account.
"""
</p>

<p>
(A bit further down, there is an extra note
</p>

<p>
"""
To give the user as little permission as possible, you may want to
specify a number of restrictive options immediately after the command:
</p>

<p>
  command="svnserve -t --tunnel-user=harry",no-port-forwarding,no-agent-forw
  arding,no-X11-forwarding,no-pty TYPE1 KEY1 harry@example.com
"""
</p>

<p>
all on one line; but possibly the sshd_config already enforces the
no-*-forwarding rule for the gazette user.)
</p>

<p>
So if you test with two different ssh keys, and modify a file each time,
then a later "svn log" should (hopefully) show that two different users
had been there.
</p>

<p>
Theory is a wonderful thing, of course; and what is present now is
presumably working well enough for the immediate need; and Copious Free
Time is just over the next horizon; so it's not worth spending more
effort now on checking all this.
</p>

<p>
But maybe it's already perfect.
</p>

<p>
Cheers,
</p>

<p>
	f
<pre>-- 
Francis Daly        francis@daoine.org
<em>                                             </em>
TAG mailing list
TAG@lists.linuxgazette.net
<a href='http://lists.linuxgazette.net/listinfo/tag'>http://lists.linuxgazette.net/listinfo/tag</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at okopnik.com]
</p>

<p>

</p>
</b><br />
<b>Sat, 19 Mar 2011 12:01:43 -0400</b>
</p>

<p>
On Fri, Mar 18, 2011 at 07:52:43PM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; On 3/18/2011 6:12 AM, Ben Okopnik wrote:
&gt; &gt; 
&gt; &gt; In any case, it's all serviceable at this point - at least as far as all
&gt; &gt; the testing I've done indicates. The only thing that's left is setting
&gt; &gt; up the rsync server and the FTP server...
&gt; 
&gt; Rsync is set up and working as it was originally.
</pre>

<p>
Joey, you're terrific! Thank you!
 
</p>

<pre>
&gt; Entire archive
&gt; 
&gt; rsync -azv linuxgazette.net::lg-all /HTTP_ROOT
&gt; 
&gt; Exclude FTP files
&gt; 
&gt; rsync -azv --exclude /ftpfiles/ linuxgazette.net::lg-all /HTTP_ROOT
&gt; 
&gt; Only FTP files
&gt; 
&gt; rsync -azv linuxgazette.net::lg-ftp /FTP_ROOT
</pre>

<p>
I've updated our ftpfiles/README.mirrors. I'll leave the pleasure of
notifying our mirror sites to you. <img src="../gx/smile.png" alt=":)">
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Sat, 19 Mar 2011 12:20:10 -0400</b>
</p>

<p>
On Sat, Mar 19, 2011 at 03:46:15PM +0000, Francis Daly wrote:
</p>

<pre>
&gt; On Fri, Mar 18, 2011 at 10:06:01AM -0400, Ben Okopnik wrote:
&gt; &gt; 
&gt; &gt; command="svnserve -t --tunnel-user=joe",no-pty ssh-dss AAAAB3NzaC1kc3MAAACBAKOCcqOj4...
&gt; &gt; 
&gt; &gt; This does not allow logging in, but it does allow SVN transactions over
&gt; &gt; SSH.
&gt; 
&gt; &gt; &gt; And besides how do you know who has committed? Just so you can put the
&gt; &gt; &gt; blame on somebody when everything is broken??
&gt; &gt; 
&gt; &gt; That <strong>is</strong> the one downside of this approach
&gt; 
&gt; What you've set up seems to be pretty much by the book -- the book being
&gt; <a href='http://svnbook.red-bean.com/'>http://svnbook.red-bean.com/</a> -- and according to (my reading of) chapter 6
&gt; "Server Configuration", section "svnserve, a Custom Server", subsections
&gt; "svnserve over a tunnel" and "Controlling the invoked command", what
&gt; you have done should Just Work:
&gt; 
&gt; """
&gt; the --tunnel-user option tells svnserve to assume that the named argument
&gt; is the authenticated user. Without --tunnel-user, it would appear as
&gt; though all commits were coming from the one shared system account.
&gt; """
</pre>

<p>
Hmm, odd - we've been doing this "--tunnel-user" stuff for a year now,
and the logs have always just read "gazette". It makes sense, but I
guess something else is needed to make it work.
 
</p>

<pre>
&gt; (A bit further down, there is an extra note
&gt; 
&gt; """
&gt; To give the user as little permission as possible, you may want to
&gt; specify a number of restrictive options immediately after the command:
&gt; 
&gt;   command="svnserve -t --tunnel-user=harry",no-port-forwarding,no-agent-forw
&gt;   arding,no-X11-forwarding,no-pty TYPE1 KEY1 harry@example.com
&gt; """
&gt; 
&gt; all on one line; but possibly the sshd_config already enforces the
&gt; no-*-forwarding rule for the gazette user.)
</pre>

<p>
Heh, you've caught me. I snipped all that stuff just so I wouldn't have
to wrap the line; it's actually
</p>

<p>
command="svnserve -t --tunnel-user=xxx",no-port-forwarding,no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa AAAAB3Nza [...]
 
</p>

<pre>
&gt; So if you test with two different ssh keys, and modify a file each time,
&gt; then a later "svn log" should (hopefully) show that two different users
&gt; had been there.
</pre>

<p>
Hmm? I don't quite get this. Everybody does indeed use their own SSH
key.
 
</p>

<pre>
&gt; Theory is a wonderful thing, of course; and what is present now is
&gt; presumably working well enough for the immediate need; and Copious Free
&gt; Time is just over the next horizon; so it's not worth spending more
&gt; effort now on checking all this.
&gt; 
&gt; But maybe it's already perfect.
</pre>

<p>
Not quite yet - having the log be stamped with the right name would be
quite nice albeit not 100% necessary - but it's all definitely workable.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Sat, 19 Mar 2011 22:12:04 -0400</b>
</p>

<p>
On Sat, Mar 19, 2011 at 03:49:41PM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; 
&gt; Ben,
&gt; 
&gt; You may want to update the following link too.
&gt; 
&gt; <a href='../../../faq/mirrors-faq.html'>http://linuxgazette.net/faq/mirrors-faq.html</a>
</pre>

<p>
Right; thanks for the reminder. Done.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Sat, 19 Mar 2011 13:20:54 -0400</b>
</p>

<p>
On Sat, Mar 19, 2011 at 02:47:51PM +0000, Francis Daly wrote:
</p>

<pre>
&gt; 
&gt; In case it is still useful:
&gt; 
&gt; for anonymous read-only ftp access to world-readable files below one
&gt; specific directory, "install vsftpd" is probably a good starting point.
</pre>

<p>
Yep; that's what I've been using on my other systems - including my
laptop, which I use as a fallback server for when a classroom setup at a
client's place falls apart. A nice minimum chroot environment in there,
too. I should probably write an article someday, when I'm not swamped.
 
</p>

<pre>
&gt; The default compile-time defaults disallow authenticated (system user)
&gt; login, and disallow any uploading, and disallow getting a file without o+r
&gt; set, and disallow any access outside the ftp-user home directory. An empty
&gt; /etc/vsftpd.conf will probably do most of what you want.
</pre>

<p>
Mostly, what was needed was
</p>

<p>
listen=YES
anonymous_enable=YES
write_enable=NO
anon_upload_enable=NO
anon_root=/var/www/linuxgazette.net/ftpfiles/
</p>

<p>
The last one isn't in the conffile (which is rather silly), and is kinda
hard to find in the docs, but I remembered it from the last time I set
up an anonymous FTP server.
</p>

<p>
Which is up and running now. <img src="../gx/smile.png" alt=":)"> So the LG system is now happily working
in every particular - although there will be much tweaking, fiddling,
gnashing of teeth, and wailing unto the uncaring universe in the future.
But it's all good. <img src="../gx/smile.png" alt=":)">
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-svn_authentication">Back</a><hr width="50%" align="left" /><p><br /></p></div>
</body>
</html>