<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="utf-8" xml:lang="utf-8">
<head>
<title>HAL: Part 1 Preliminaries LG #183</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../lg.css" type="text/css" media="screen, projection"  />
<link rel="alternate" type="application/rss+xml" title="LG RSS" href="../lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="../lg.rdf" />
<!-- link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" / -->
<link rel="shortcut icon" href="../favicon.ico" />

<style type="text/css" media="screen, projection">
<!--

-->
</style>

</head>
<body>

<a href="../">
<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
</a>
<p id="fun">...making Linux just a little more fun!</p>

<div id="navigation">
<table summary="masthead" width="100%">
<tr>
<td align="center" colspan="3" style="font-size: 10px; font-weight: bold">
<a href="../index.html">Home</a>
<a href="http://linuxgazette.net">Main Site</a>
<a href="../faq/index.html">FAQ</a>

<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="http://lists.linuxgazette.net/listinfo.cgi">Mailing Lists</a>
<a href="../jobs.html">Join Us!</a>
<a href="../contact.html">Contact Us</a>

<hr width="99%" style="border: 1px inset #000033">
</td>
</tr>
<tr>
<td width="40%" align="left" style="font-size: 10px; font-weight: bold">
The Free International Online Linux Monthly
</td>
<td width="20%" align="center" style="font-size: 10px; font-weight: bold">
ISSN: 1934-371X
</td>
<td width="40%" align="right" style="font-size: 10px; font-weight: bold">
Main site: <a href="http://linuxgazette.net">http://linuxgazette.net</a> 
</td>
</table>
</div>


<div id="breadcrumbs1">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">February 2011 (#183)</a> &gt; 
Article

</div>

<div class="articlecontent1">
<div class="content">

<div id="previousnexttop">
<A HREF="grebler.html" >&lt;-- prev</A> | <A HREF="hoogland.html" >next --&gt;</A>
</div>

<h1>HAL: Part 1 Preliminaries</h1>
<p id="by"><b>By <a href="../authors/grebler.html">Henry Grebler</a></b></p>

<pre>
	    Happy families are all alike; every unhappy family is
	    unhappy in its own way.

        <a href="http://www.quotationspage.com/quote/27719.html">Leo Tolstoy, "Anna Karenina", Chapter 1, first line</a>	
	        Russian mystic &amp; novelist (1828 - 1910)
</pre>


<h3>Introduction</h3>

<p>

Most flavours of Unix/Linux/BSD are broadly alike. But they are often
subtly different (sometimes, not so subtly).
</p>

<p>
At the moment, I work in an environment where I have inherited a large
number of Unix-like machines. The platforms include mainly CentOS
and Solaris, but I've seen references to FreeBSD and others. When I
have to work on a machine, I want to concentrate on <b>what</b> I have
to do, not <b>how</b> to do it.
</p>

<p>
In the past, I have worked on different platforms for other reasons.
One company I worked for supported several different Unix-like
platforms: Solaris, AIX, HP-UX, IRIX, SCO; all considered to be
flavours of Unix, yet all different.
</p>

<p>
That's part of the reason for having an abstraction layer: to work in
an environment which allows me to be unconcerned about the specific
details of the underlying platform.
</p>

<p>
Another reason is to provide myself with a toolkit of commands that
conveniently perform common tasks.
</p>

<p>
In the very early days, I was trying to smooth the transition from
DEC's VMS to Unix.
</p>

<p>
Ultimately, HAL is an aspiration. Probably, it can never be achieved,
in part because it is aimed at a moving target. Operating systems keep
evolving; and I keep searching for the ultimate environment. As long as
these change, there will be a requirement to modify or refine my
HAL.
</p>

<h3>Motivation and Direction</h3>

<p>
A reader has asked for more information on my HAL. Perhaps he did not
expect as much as he is going to get. I'm going to try to juggle
keeping things interesting with a how-to which will allow people to
create their own PAL (Platform Abstraction Layer).
</p>

<p>
If you want to run HAL exactly as I do, I don't mind. I just don't
think it makes much sense. First, as no two people are exactly alike,
I suspect no other person would be completely comfortable in my world.
</p>

<p>
Second, as I trawled through my HAL recently in preparation for making
it available, I discovered to my horror how much obsolete material I
had accumulated over 20 years. There are scripts there I don't even
remember writing.
</p>

<p>
I don't know how far I will take this, but I suspect there will be
several articles. Unfortunately, there's a bit of a learning curve.
Consequently, this episode is likely to be a little disappointing. But,
if you stay with me, I think you'll find the next episodes much more
rewarding.
</p>

<p>

<h3>Look and Feel</h3>
</p>

<p>
What does it feel like to live in my world? Here's how it begins:
</p>

<p>
<pre class="code">
HAL_ROOT/GO.sh 
Starting .bash_profile
Start .bash_profile
. /home/henryx/henry/HAL_ROOT/HAL_HOME/.bashrc
Starting .bashrc
Setting up for UTS
bash: /home/henryx/henry/HAL_ROOT/HAL_HOME/scripts/Uts_setup: No such
file or directory
GNUTAR set to tar. Use export GNUTAR=xxx to change.
End of .bashrc
source .login_sh
Starting .login_sh
Dropping '/opt/firefox' from PATH 'coz it don't exist.
Dropping '/opt/thunderbird' from PATH 'coz it don't exist.
Dropping '~/bash' from PATH 'coz it don't exist.
Dropping '/home/henryx/bin' from PATH 'coz it don't exist.
Dropping '/usr/local/bin' from PATH 'coz it's already in the PATH.
Dropping '/usr/sbin' from PATH 'coz it's already in the PATH.
Dropping '/usr/local/sbin' from PATH 'coz it's already in the PATH.
Dropping '/sbin' from PATH 'coz it's already in the PATH.
ls: ./.ENV./Xserver.*: No such file or directory
No Xserver file. Setting DISPLAY from hostname.
DISPLAY = freew.t-s-f.com.au:0.0
Warning: TERMINFO not set
Setting FONTPATH to /opt/optimation/fonts
Invoking bash
Starting .bashrc
Setting up for UTS
bash: /home/henryx/henry/HAL_ROOT/HAL_HOME/scripts/Uts_setup: No such
file or directory
GNUTAR set to tar. Use export GNUTAR=xxx to change.
End of .bashrc
<b>freew:~-20:40:29-bash$</b>
</pre>

<p>
Some quick observations.
</p>

<p>
Usually, if I've set up my environment, when I log in, I get pretty
much what you see above. I'll take you through it a little later.
However, for the purpose of this exercise, I've arranged that someone
could log in as themselves, unpack a package containing my HAL and
simply invoke a single command to jump into my world.
</p>

<p>
That's what you see in the first line.
</p>

<p>
I usually log in as <tt>henryg</tt> but I've created a special account
<tt>henryx</tt> which has none of my HAL by default, so that I can be
as like a vanilla user as possible. I then run <b>GO.sh</b> to invoke
HAL.
</p>

<p>
Next you'll notice that my world is quite chatty. When I first
encountered Unix - in 1985 - I read somewhere that Unix commands do
their work silently. I've never been comfortable with that, perhaps
because I'd previously worked for a computer marketing company, Prime.
When we were to do presentations to prospects, the Branch Manager
would say, "Tell 'em what you're gonna tell 'em; tell 'em; then tell
'em what you've told 'em."
</p>

<p>
I want my world to do it; and tell me that it has done it.
</p>

<p>
I'm not clear why people want commands to execute silently. I've seen
too many examples of things going wrong silently. Perhaps, in the early
days of Unix, when interaction occurred on a Teletype - slow, noisy
and consuming paper - silent made sense. But now?
</p>

<p>
Mind you, one needs balance. Too much output and one will miss
important messages in the chatter. The above is starting to get too
noisy.
</p>

<p>
I suppose, also, that the verbosity of the output reflects who I am. I
may have few faults :-), but I'll admit to a tendency to prolixity.
</p>

<p>
I've noticed a few errors in the above. These relate to elements of my
HAL that I have started to weed out because they are so old and no
longer the least bit relevant. I'm going to leave them for the moment,
for several reasons. It will confirm for you that I am human; and as
fallible as any other human. 
</p>

<p>
It will show that things don't have to be perfect to be good. In fact,
as Ben says, and as I've written before, perfect can be the enemy of
good.
</p>

<p>
One can aspire to perfection. Perhaps one ought to aspire to
perfection. I've spent a lot of time in the business world. Every
choice must be weighed up in terms of cost/benefit. Even in the
non-business world, there are limited resources. The time I spend
cleaning up my examples has to be weighed against the time I spend
writing this explanation. I am not blessed with unlimited time.
</p>

<p>
Even if I'm not in business, in the end, it's a business decision.
</p>




<h3>A walk through the setup</h3>

<p>
The script <b>GO.sh</b> creates an environment similar to that of a
user who has logged in. It is near enough if one is on a platform that
uses bash. 
</p>

<ul>
	In my login-time script, <b>.login_sh</b>, there is code to
	search for the best shell. In the early days, my login shell
	could be sh or csh; the script would search in various places
	for bash or ksh and, if one were found, promote my
	environment.
</ul>

<p>
<b>GO.sh</b> invokes bash explicitly because every Linux comes with
bash. If you prefer some other shell, you will have to adjust some
scripts.
</p>

<pre>
	When bash is invoked as an interactive login shell ..., it
	first reads ... /etc/profile [then] looks for ~/.bash_profile
	...

		-- from the BASH(1) man page
</pre>

<p>
So the first thing you see above is the invocation of
<b>~/.bash_profile</b>. My <b>~/.bash_profile</b> explicitly sources 
<b>$HOME/.bashrc</b>. It then explicitly sources <b>.login_sh</b>.
</p>

<p>
This perhaps leads to some redundancy, where some scripts are invoked
twice. But, better some redundancy than that a script be omitted.
</p>

<p>
You will see messages indicating the invocation and termination of
these scripts in the messages above.
</p>

<h3>The Startup Scripts</h3>

Here is a map of the scripts involved in startup and how they are
invoked. If there is no path, the scripts are relative to $HOME.

<pre class="code">
.bash_profile
	. $HOME/.bashrc
	        source ~/bash/csh-compat
	        source ~/.ENV./.cshrc_bash
		        source $HOME/scripts/Uts_setup
	        source ~/.ENV./.kshrc_bash
			`$HOME/.ENV./set_gnutar.sh`
	source .login_sh
		`$HOME/.ENV./.login.set_terminal`
		. $HOME/.ENV./.login$xxx.optimation_sh
		. $HOME/.ENV./.login.`uname`
		. /tmp/HMGUSESHELL
</pre>

Here's what they do (in brief):

<pre class="code">
.bash_profile	login-time startup file for bash

		wrapper; basically, gets things going

.bashrc		Bourne Again SHell init file

		configures tty settings
		sets various path variables, other environment variables
		defines some "su" functions
		defines many aliases
		displays my motd (message of the day)

csh-compat	C-shell compatibility package

.cshrc_bash	a script file to be shared between csh and bash

		mainly aliases

Uts_setup	specific to an old project

.kshrc_bash	a script file to be shared between ksh and bash

		mainly functions

set_gnutar.sh	set GNUTAR environment variable 

.login_sh	login time setups

		tty settings
		Set PATH
		Set other paths
		Set DISPLAY
		Platform-specific settings
		work-specific settings
		Calculate shell to use

</pre>


<h3>The Rest of the Login Messages</h3>


<p>
The message <i>Setting up for UTS</i> (followed by an error message)
dates back to 1991; it's obsolete, referring to a project I was
working on back then.
</p>


<p>
The line beginning <i>GNUTAR</i> dates back to 1995 when I was working
on machines which had rather feeble versions of <b>tar</b>. Where
possible, I would assign the environment variable <i>GNUTAR</i> to
refer to a more feature-rich version of tar, usually, GNU tar.
<i>GNUTAR</i> was used in several functions.
</p>

<p>
We then have several <i>Dropping</i> messages. These come from
<b>.login_sh</b>. Since different flavours of Unix had software in
different places, I used to set the PATH variable to every possible
place on every possible platform. I then realised that this was
dreadfully inefficient (probably while trawling through a Solaris
truss output). So I changed the logic. I set another variable to every
possible path; then tested if the path actually existed on the current
platform before adding it to <b>PATH</b>. Those that didn't were
dropped.
</p>

<p>
The next 3 lines refer to my search for an appropriate DISPLAY variable.
</p>

<p>
Finally, there are a couple of messages to do with other environment
variables.
</p>

<h3>Wrap Up</h3>

<p>
That's probably enough for Part 1.
</p>

<p>
In subsequent episodes I hope to walk you through various parts of my
HAL, stopping along the way to examine various bits in some detail.
</p>

<p>
For now, if I've done my job, you ought to be able to <a
href="misc/grebler/HAL_ROOT.tar.gz">obtain the package</a>, unpack it and invoke it
- and find yourself in my world.
</p>

<p>
I'm not suggesting that you want to live in my world, but you might
find bits that you like and can use for yourself.
</p>



<br clear="all" />

<table align='center' cellspacing='10'>
<tr>
<td>
<script type='text/javascript'>
digg_url = 'http://linuxgazette.net/183/grebler1.html';
digg_title = 'HAL: Part 1 Preliminaries';
digg_bodytext = '<p>  Most flavours of Unix/Linux/BSD are broadly alike. But they are often subtly different (sometimes, not so subtly). </p> ';
digg_topic = 'linux_unix';
</script>
<script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
</td>
<td>
<a name="fb_share" type="box_count" href="http://www.facebook.com/sharer.php">Share</a>
<script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script>
</td>
<td>
<a href="http://twitter.com/home?status=Currently%20reading:%20http://linuxgazette.net/183/grebler1.html%20at%20Linux%20Gazette%20%23linuxgazette" title="Click to share this post on Twitter"><img src="../gx/twitter.png" width="50" height="85" border="0"></a>
</td>
</tr>
</table>


<p class="talkback">
Talkback: <a
href="mailto:tag@lists.linuxgazette.net?subject=Talkback:183/grebler1.html">Discuss this article with The Answer Gang</a>
</p>

<!-- *** BEGIN author bio *** -->
<hr>
<p>
<img align="left" alt="[BIO]" src="../gx/authors/grebler.jpg" class="bio">
</p>

<em>
<p>
Henry has spent his days working with computers, mostly for computer
 manufacturers or software developers. His early computer experience
 includes relics such as punch cards, paper tape and mag tape. It is
 his darkest secret that he has been paid to do the sorts of things he
 would have paid money to be allowed to do. Just don't tell any of his
 employers. 
</p>

<p>
He has used Linux as his personal home desktop since the family got its
 first PC in 1996. Back then, when the family shared the one PC, it was a
 dual-boot Windows/Slackware setup. Now that each member has his/her own
 computer, Henry somehow survives in a purely Linux world.
</p>

<p>
He lives in a suburb of Melbourne, Australia.
</p>



</em>

<br clear="all">


<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2011, Henry Grebler. Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication License</a>
unless otherwise noted in the body of the article.
<!-- Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc. -->
</p>

<p>
Published in Issue 183 of Linux Gazette, February 2011
</p>

</div>

<div id="previousnextbottom">
<A HREF="grebler.html" >&lt;-- prev</A> | <A HREF="hoogland.html" >next --&gt;</A>
</div>

</div>
</div>

<script src="http://www.google-analytics.com/urchin.js"
type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1204316-1";
urchinTracker();
</script>







<img src="../gx/tux_86x95_indexed.png" id="tux" alt="Tux"/>

</body>
</html>

