<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<title>Cursor Appearance in the Linux Console LG #137</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../lg.css" type="text/css" media="screen, projection"  />
<link rel="alternate" type="application/rss+xml" title="LG RSS" href="lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="lg.rdf" />
<link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" />
<link rel="shortcut icon" href="../favicon.ico" />

<style type="text/css" media="screen, projection">
<!--

-->
</style>

</head>
<body>

<a href="../">
<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
</a>
<p id="fun">...making Linux just a little more fun!</p>

<div id="navigation">
<table summary="masthead" width="100%">
<tr>
<td align="center" colspan="3" style="font-size: 10px; font-weight: bold">
<a href="../index.html">Home</a>
<a href="http://linuxgazette.net">Main Site</a>
<a href="../faq/index.html">FAQ</a>

<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="http://lists.linuxgazette.net/mailman/listinfo/">Mailing Lists</a>
<a href="../jobs.html">Join Us!</a>
<a href="../contact.html">Contact Us</a>

<hr width="99%" style="border: 1px inset #000033">
</td>
</tr>
<tr>
<td width="40%" align="left" style="font-size: 10px; font-weight: bold">
The Free International Online Linux Monthly
</td>
<td width="20%" align="center" style="font-size: 10px; font-weight: bold">
ISSN: 1934-371X
</td>
<td width="40%" align="right" style="font-size: 10px; font-weight: bold">
Main site: <a href="http://linuxgazette.net">http://linuxgazette.net</a> 
</td>
</table>
</div>


<div id="breadcrumbs1">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">April 2007 (#137)</a> &gt; 
Article

</div>

<div class="articlecontent1">
<div class="content">

<div id="previousnexttop">
<A HREF="lg_bytes.html" >&lt;-- prev</A> | <A HREF="lazar.html" >next --&gt;</A>
</div>

<h1>Cursor Appearance in the Linux Console</h1>
<p id="by"><b>By <a href="../authors/anonymous.html">Anonymous</a></b></p>



<p>
Escape sequences to control the cursor appearance in the
Linux console (text, no X11) are yet to be included in the
manpage on console_codes, but they are tentatively documented
in the file
</p>

<p>
    /usr/src/linux/Documentation/VGA-softcursor.txt
</p>

<p>
This article is mainly an interpreted version of the file
above, with examples added. The file was written in 1999;
if you read it, you'll understand why it needs interpretation.
</p>

<p>
The following files are also relevant:
</p>

<p>
    /usr/src/linux/drivers/char/vt.c<br>
    /usr/src/linux/include/linux/console-struct.h
</p>

<p>
the first of which is, unfortunately, quite tough to
digest.
</p>


<h3>(1) Hardware vs. Software Cursor</h3>

<p>
The Linux cursor is, by default, the normal PC text-mode
cursor. It looks like a short blinking underscore, whitish on
black, with weak contrast in daylight. This is the hardware
cursor, i.e., it is generated by the hardware.
</p>

<p>
However, Linux has the ability to manipulate the cursor
appearance using, e.g., a software-generated non-blinking full
block cursor. This is done with the escape sequence
</p>

<pre class="code">
    \e[?p1;p2;p3;c
</pre>

<p>
where \e is the escape character, and p1, p2 and p3 are
parameters. The last semi-colon is optional. It is used here
to tell the sequence closing letter 'c' from the
parameters. If you omit any of the parameters, they will
default to zero. Only decimals are accepted, and you will
never get an error: your input is going to be restrained to
the valid range.
</p>

<p>
Each console can have its own custom softcursor.
</p>


<h3>(2) Parameters</h3>

<p>
Parameter 3 sets the colour bits in the VGA adapter's
register, parameter 2 toggles the colour bits, and setting
goes before toggling. What that means in practice we'll have
to find out.
</p>

<p>
Parameter 1 specifies cursor size as follows:
</p>

<pre>
0   default
1   invisible
2   underscore
3   lower_third
4   lower_half
5   two_thirds
6   full block
</pre>

<p>
The size refers to the character cell at the cursor. As an
example, issuing
</p>

<pre class="code">
    echo -e "\e[?3c"
</pre>

<p>
from the command line will turn the cursor into a thick
underscore, reclaiming one third of the character cell.
</p>

<p>
Values 7-15 are also accepted, but they give the same as 6.
The cursor default is defined in console-struct.h as the
underscore, so, by default, value 0 is same as value 2.
</p>

<p>
If the first parameter is less than 16, parameters 2 and 3
will be set to 0, and you get the hardware cursor, whitish on
black. If visible, it will blink.
</p>

<p>
As for size, the good news is that parameter 1 really works.
The bad news is that parameter 2 and 3 depend in part on VGA
peculiarities likely to be implemented differently from
graphic adapter to graphic adapter. It can be assumed that
the kernel contributors were coding according to the
official VGA standard, but that rarely used VGA
specifications are implemented in a non-standard way.
</p>

<p>
A softcursor is obtained setting parameter 1 to 16. Values
17-31 are same as 16. A softcursor is a non-blinking full
block in some colour.
</p>

<p>
For instance, let's try
</p>

<pre class="code">
echo -e "\e[?16c"
</pre>

<p>
We see nothing. How come? Very simple - the cursor is now a
block of one full character cell. Parameter 2 and 3 are
missing, so they default to 0. That block uses colour 0,
which is black. Black on black, gives what? That's what you
are seeing.
</p>

<p>
Lesson learnt: if we want to see the softcursor, we must
specify parameter 2 and 3 in a suitable way. Let's try
again:
</p>

<pre class="code">
echo -e "\e[?16;0;16c"
</pre>

<p>
You can go through the entire range of colours (0-7), leaving
the second parameter at 0 and setting the third parameter to
a multiple of 16, or rather a multiple with factor 1-7.
Factor 0 already taught us a lesson. Only dim colours will
obtain.
</p>

<p>
So far, so good. We can get a blinking cursor in differing
sizes; its colour will be the foreground colour in the
console. We can get a non-blinking cursor in (dim)
colours, independently of foreground and background colours
in the console.
</p>


<h3>(3) Surprises</h3>

<p>
The values you enter for parameter 1 are reduced modulo 32.
That means 0-31, 32-63, 64-95 ... are the same. However:
</p>

<pre class="code">
48-63   (range 16-31 plus 32)
	gives a softcursor using the console foreground colour,
	making the character at the cursor invisible

112-127 (range 16-31 plus 32 plus 64)
	gives a softcursor using the console foreground colour
	but allowing the character at the cursor to be read
</pre>

<p>
Try the following:
</p>

<pre class="code">
    (i)     echo -e "\e[?48c"
    (ii)    echo -e "\e[?112c"
</pre>

<p>
Note that you are not specifying parameters 2 and 3. If you
do, the parameters will apply.
</p>

<p>
Also note that a bold foreground colour will be dimmed when
used as background by the softcursor. So if you changed the
console default to bold white on black, both (i) and (ii)
will give a dim white non-blinking block.
</p>

<p>
If you try to get some interesting cursor just firing off
wild parameters, be assured that your options are limited,
and you will be wasting plenty of time for nothing.
Essentially, what you have got to remember is:
</p>

<p>
    parameter 3 determines the softcursor background,<br>
    parameter 2 determines the softcursor foreground.
</p>

<p>
This rule, however, is not 100% correct, since parameter 3
does affect the dim/bold status of the foreground. For
instance, let's try the range 64-79 with parameter 2 fixed
at 0. The softcursor background is in this case red. What
changes when the parameter runs through the range 64-79 is
how the character at the cursor shows up.
</p>

<p>
We are starting from the defaults dim white on black and
issue
</p>

<pre class="code">
    echo -e "\e[?16;0;64c"
</pre>

<p>
The cursor background is red; the character at the cursor is
dim white. We go up from 64 to 71, and the result is the
same. However, for 72-79, the character at the cursor is
turned bold; we have bold white on red.
</p>

<p>
The result is simple: with parameter 2 fixed at 0, parameter
3 will have
</p>

<pre class="code">
    dim  foreground for  16*k + l    (l is 0-7)
    bold foreground for  16*k + l    (l is 8-15)
</pre>

<p>
where k runs from 1-7.
</p>

<p>
Fine, but what if we keep parameter 3 fixed and let
parameter 2 run? In our example, we keep parameter 3 at 64,
and let parameter 2 go through 1-15. The result is cursor
foreground in different colours, while the background does
not change.
</p>

<p>
This is the maximum you can aspire to. The softcursor's own
foreground and background can be different from foreground
and background in the console, showing you four colours at
all times.
</p>


<h3>(4) Delusions</h3>

<p>
You have dutifully read VGA-softcursor.txt, and something
caught your attention. Apparently, with the softcursor you
can
</p>

<pre>
    [ ... ] highbright the cursor character and still keep the original
    hardware cursor visible.
</pre>

<p>
Well, no - or at least, it depends. The authors were not
aware that their hardware was behaving its own way. Compare
with the following, where the author clearly warns that what
he is saying applies to his ATI Mach 64 card:
</p>

<pre>
    echo -e '\033[?18;255;8c' -- .... if this doesn't get your
    attention, I don't know what will... (nonblinking 'transparent'
    block... blinking the character it's over - over an underline
    that blinks at twice the rate....)
</pre>

<p>
Source:<br>
<a href="http://lists.ibiblio.org/pipermail/baslinux/2006-April/010157.html">http://lists.ibiblio.org/pipermail/baslinux/2006-April/010157.html</a>
</p>


<h3>(5) Mystery</h3>

<p>
Are we done yet? That would seem to be the case, but for a
crash I experienced recently.
</p>

<p>
A small text-mode application crashed, and left behind a
console with white on black and a blinking cursor underscore. 
That blinking underscore was red; yes, it was red!
</p>

<p>
Now, there is absolutely no trace on the Web of a hardware
cursor with its own very private colour. Of course, I cannot
prove it, but, after a couple of hours googling, I would take
any bet. Furthermore, the official wisdom states:
</p>

<pre>
    On the standard VGA, the [hardware] cursor color is obtained
    from the foreground color of the character that the cursor is
    superimposing. On the standard VGA, there is no way to modify
    this behavior.
</pre>

<p>
Source: FreeVGA Project<br>
<a href="http://www.stanford.edu/class/cs140/projects/pintos/specs/freevga/vga/textcur.htm">http://www.stanford.edu/class/cs140/projects/pintos/specs/freevga/vga/textcur.htm</a>
</p>

<p>
So here is my request for support:
</p>

<ul>
<li> -  Has anybody ever seen a console (text, no X11) with a
        hardware underscore blinking in its own distinct colour?

<li> -  If so, were you able to reproduce it?
</p>

<p>
Please write to The Answer Gang at the <em>Linux Gazette</em>
('Talkback' link, below). 
</p>



<p class="talkback">
Talkback: <a
href="mailto:tag@lists.linuxgazette.net?subject=Talkback:137/anonymous.html">Discuss this article with The Answer Gang</a>
</p>

<!-- *** BEGIN author bio *** -->
<!-- ============================================================= -->
<!-- *** BEGIN bio *** -->
<hr>

<p>
<img ALIGN="LEFT" ALT="Bio picture" SRC="../gx/2002/note.png" class="bio">
<em>

A. N. Onymous has been writing for LG since the early days - generally by
sneaking in at night and leaving a variety of articles on the Editor's
desk. A man (woman?) of mystery, claiming no credit and hiding in
darkness... probably something to do with large amounts of treasure in an
ancient Mayan temple and a beautiful dark-eyed woman with a snake tattoo
winding down from her left hip. Or maybe he just treasures his privacy. In
any case, we're grateful for his contribution.<br>
 -- Editor, Linux Gazette

</em>
<br CLEAR="all">

<!-- *** END bio *** -->

<!-- ============================================================= -->


<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2007, Anonymous. Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication License</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 137 of Linux Gazette, April 2007
</p>

</div>

<div id="previousnextbottom">
<A HREF="lg_bytes.html" >&lt;-- prev</A> | <A HREF="lazar.html" >next --&gt;</A>
</div>

</div>
</div>

<script src="http://www.google-analytics.com/urchin.js"
type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1204316-1";
urchinTracker();
</script>







<img src="../gx/tux_86x95_indexed.png" id="tux" alt="Tux"/>

</body>
</html>

