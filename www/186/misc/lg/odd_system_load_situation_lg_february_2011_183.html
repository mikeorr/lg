<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'
		 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml' lang='utf-8' xml:lang='utf-8'>
<head>
<title>Odd system load situation, LG February 2011 (#183)</title>
<meta http-equiv='Content-Type' content='text/html; charset=utf-8' />
<link rel='stylesheet' type='text/css' href='../../../lg.css' />
</head>
<body>
<a href="../../../"><img alt="Linux Gazette" src="../../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" /></a><img alt="Tux" src="../../../gx/tux_86x95_indexed.png" id="tux" /><p id="fun">...making Linux just a little more fun!</p><div class='content articlecontent'><a name="top"></a><h3>Odd system load situation, LG February 2011 (#183)</h3>
<p>
<b><p>
Ben Okopnik [ben at okopnik.com]
</p>

<p>

</p>
</b><br />
<b>Thu, 10 Feb 2011 08:47:21 -0500</b>
</p>

<p>
Hi, Hans-Peter -
</p>

<p>
On Mon, Feb 07, 2011 at 06:52:06PM -0500, hanspetersorge@aim.com wrote:
</p>

<pre>
&gt; Hi Ben,
&gt; 
&gt; I just read the thread - no idea how to append..
</pre>

<p>
Just send your message to The Answer Gang (tag@lists.linuxgazette.net),
and we'll add it to the next issue. I've cc'd this response there, so
it'll get used that way.
 
</p>

<pre>
&gt; My 2-cents:  USB is being polled.
</pre>

<p>
You're probably right - and very likely, it's getting polled very
rapidly, given the task. I'm not sure what could be done about that -
some kernel setting, perhaps?
 
</p>

<pre>
&gt; strace -p ....  might give you some clues too.
</pre>

<p>
The question is, what would I attach it to? 'rsync' wouldn't make a
whole lot of sense, since it's not involved in USB polling.
</p>


<p>
Ben
<pre>-- 
                       OKOPNIK CONSULTING
        Custom Computing Solutions For Your Business
Expert-led Training | Dynamic, vital websites | Custom programming
  443-250-7895   <a href='http://okopnik.com'>http://okopnik.com</a>   <a href='http://twitter.com/okopnik'>http://twitter.com/okopnik</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-odd_system_load_situation_lg_february_2011_183">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Mulyadi Santosa [mulyadi.santosa at gmail.com]
</p>

<p>

</p>
</b><br />
<b>Fri, 11 Feb 2011 00:33:14 +0700</b>
</p>

<p>
Hi Ben...
</p>

<p>
On Thu, Feb 10, 2011 at 20:47, Ben Okopnik &lt;ben@okopnik.com&gt; wrote:
</p>

<pre>
&gt; You're probably right - and very likely, it's getting polled very
&gt; rapidly, given the task. I'm not sure what could be done about that -
&gt; some kernel setting, perhaps?
</pre>

<p>
Might be two things IMHO:
1. the kernel module itself...quite likely the "usb-storage". From
modinfo, I think you need to thinker "delay_use" parameter during
insmod/modprobe
</p>

<p>
2. your desktop environment setting...I am not sure which setting
control the polling...I usually just rely to "powertop" and whenever
it yields "turn on USB auto suspend", I simply agree and press the
correspondent shortcut button.
</p>

<p>
If my assumption is wrong, feel free to adjust <img src="../gx/smile.png" alt=":)">
</p>


<pre>
&gt;&gt; strace -p .... =A0might give you some clues too.
&gt;
&gt; The question is, what would I attach it to? 'rsync' wouldn't make a
&gt; whole lot of sense, since it's not involved in USB polling.
</pre>

<p>
in that sense, rsync might do poll by either calling poll() or  the
new epoll(). Blocking wait should use select() AFAIK. Not sure about
futex()...it's kinda fast lock so it might fall into non blocking lock
thus closer to polling characteristic IMHO.
</p>

<p>
Your call Ben... <img src="../gx/smile.png" alt=":)">
</p>

<p>
-- =
</p>

<p>
regards,
</p>

<p>
Mulyadi Santosa
Freelance Linux trainer and consultant
</p>

<p>
blog: the-hydra.blogspot.com
training: mulyaditraining.blogspot.com
<em>                                             </em>
TAG mailing list
TAG@lists.linuxgazette.net
<a href='http://lists.linuxgazette.net/listinfo.cgi/tag-linuxgazette.net'>http://lists.linuxgazette.net/listinfo.cgi/tag-linuxgazette.net</a>
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-odd_system_load_situation_lg_february_2011_183">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at okopnik.com]
</p>

<p>

</p>
</b><br />
<b>Fri, 11 Feb 2011 07:24:05 -0500</b>
</p>

<p>
[Please CC tag@lists.linuxgazette.net on these emails; that'll make
things easier. Thanks!]
</p>

<p>
On Fri, Feb 11, 2011 at 10:43:00AM +0100, Hans-Peter Sorge wrote:
</p>

<pre>
&gt; Hi Ben,
&gt; 
&gt; To reflect on "full back backup": Does it include /proc, /var and
&gt; /media/USB (the backup itself<img src="../gx/smile.png" alt=":-)">?
</pre>

<p>
[laugh] I've been working with computers for quite a while now - getting
onto 30 years - and that class of mistake isn't one I'm likely to make.
I was backing up /home and /var/{mail,svn,www} - that's it.
</p>


<p>
Ben
<pre>-- 
                       OKOPNIK CONSULTING
        Custom Computing Solutions For Your Business
Expert-led Training | Dynamic, vital websites | Custom programming
  443-250-7895   <a href='http://okopnik.com'>http://okopnik.com</a>   <a href='http://twitter.com/okopnik'>http://twitter.com/okopnik</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-odd_system_load_situation_lg_february_2011_183">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]
</p>

<p>

</p>
</b><br />
<b>Fri, 11 Feb 2011 07:39:47 -0500</b>
</p>

<p>
Hey, Mulyadi -
</p>

<p>
On Fri, Feb 11, 2011 at 12:33:14AM +0700, Mulyadi Santosa wrote:
</p>

<pre>
&gt; Hi Ben...
&gt; 
&gt; On Thu, Feb 10, 2011 at 20:47, Ben Okopnik &lt;ben@okopnik.com&gt; wrote:
&gt; &gt; You're probably right - and very likely, it's getting polled very
&gt; &gt; rapidly, given the task. I'm not sure what could be done about that -
&gt; &gt; some kernel setting, perhaps?
&gt; 
&gt; Might be two things IMHO:
&gt; 1. the kernel module itself...quite likely the "usb-storage". From
&gt; modinfo, I think you need to thinker "delay_use" parameter during
&gt; insmod/modprobe
</pre>

<p>
Ah. Great; didn't know about that one. Hmm, I wonder if running 'nice -n
12' or so with 'rsync' would improve things?
 
</p>

<pre>
&gt; 2. your desktop environment setting...I am not sure which setting
&gt; control the polling...I usually just rely to "powertop" and whenever
&gt; it yields "turn on USB auto suspend", I simply agree and press the
&gt; correspondent shortcut button.
</pre>

<p>
Wow, I'm learning about all kinds of nifty gadgets from you. I'd never
heard of 'powertop'. Cool - thanks!
</p>

<p>
According to powertop, 'ehci_hcd:usb1, uhci_hcd:usb2, ath,
i915@pci:0000:00:02.0, HDA Intel' is one of the two top "causes for
wakeups" (the only thing higher than that is tick_sched_timer.) That's
definitely an eye-opener. The suggestion it gives - what a clever
gadget! - is to increase the "VM dirty writeback" and to turn on USB
auto suspend. Bingo! Did that.
 
</p>

<pre>
&gt; If my assumption is wrong, feel free to adjust <img src="../gx/smile.png" alt=":)">
&gt; 
&gt; &gt;&gt; strace -p ....  might give you some clues too.
&gt; &gt;
&gt; &gt; The question is, what would I attach it to? 'rsync' wouldn't make a
&gt; &gt; whole lot of sense, since it's not involved in USB polling.
&gt; 
&gt; in that sense, rsync might do poll by either calling poll() or  the
&gt; new epoll(). Blocking wait should use select() AFAIK. Not sure about
&gt; futex()...it's kinda fast lock so it might fall into non blocking lock
&gt; thus closer to polling characteristic IMHO.
</pre>

<p>
OK - selecting just those in stracing rsync might make sense. I've just
bought another backup drive (2TBs are getting cheap, woohoo!), so I'm
going to get another chance to do all of this again very soon now.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href='http://LinuxGazette.NET'>http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-odd_system_load_situation_lg_february_2011_183">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Mulyadi Santosa [mulyadi.santosa at gmail.com]
</p>

<p>

</p>
</b><br />
<b>Fri, 11 Feb 2011 23:23:30 +0700</b>
</p>

<p>
Hi Ben <img src="../gx/smile.png" alt=":)">
</p>

<p>
On Fri, Feb 11, 2011 at 19:39, Ben Okopnik &lt;ben@linuxgazette.net&gt; wrote:
</p>

<pre>
&gt; Wow, I'm learning about all kinds of nifty gadgets from you. I'd never
&gt; heard of 'powertop'. Cool - thanks!
</pre>

<p>
Ok, let's say you owe me...so actually you owe really bunch of thanks
to Arjan van de Ven @ Linux division of Intel corp <img src="../gx/smile.png" alt=":)"> AFAIK he single
handedly created it, at least initially <img src="../gx/smile.png" alt=":)">
</p>

<p>
My ruleof thumb so far: wanna lower power consumption? use powertop <img src="../gx/smile.png" alt=":)">
it's a monitoring + tweaker.... <img src="../gx/smile.png" alt=":)">
</p>


<pre>
&gt; According to powertop, 'ehci_hcd:usb1, uhci_hcd:usb2, ath,
&gt; i915@pci:0000:00:02.0, HDA Intel' is one of the two top "causes for
&gt; wakeups" (the only thing higher than that is tick_sched_timer.) That's
&gt; definitely an eye-opener.
</pre>

<p>
ahem, so IMHO your system might be busy either:
- checking something in USB
- sending data or reading data to i915 Intel graphic card
- or....you're probably currently playing a music <img src="../gx/smile.png" alt=":)">
</p>

<p>
AFAIK, it's quite typical to see that kind of pattern...but one way or
another...if some of them are on the same data bus, that might explain
the situation of slower data transfer in rsync (crowded bus)
</p>


<pre>
&gt;The suggestion it gives - what a clever
&gt; gadget! - is to increase the "VM dirty writeback" and to turn on USB
&gt; auto suspend. Bingo! Did that.
</pre>

<p>
Nice <img src="../gx/smile.png" alt=":)"> !
</p>

<pre>
&gt; OK - selecting just those in stracing rsync might make sense. I've just
&gt; bought another backup drive (2TBs are getting cheap, woohoo!), so I'm
&gt; going to get another chance to do all of this again very soon now.
</pre>

<p>
Probably you need to try eSATA...?
</p>

<p>
-- 
regards,
</p>

<p>
Mulyadi Santosa
Freelance Linux trainer and consultant
</p>

<p>
blog: the-hydra.blogspot.com
training: mulyaditraining.blogspot.com
<em>                                             </em>
TAG mailing list
TAG@lists.linuxgazette.net
<a href='http://lists.linuxgazette.net/listinfo.cgi/tag-linuxgazette.net'>http://lists.linuxgazette.net/listinfo.cgi/tag-linuxgazette.net</a>
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-odd_system_load_situation_lg_february_2011_183">Back</a><hr width="50%" align="left" /><p><br /></p></div>
</body>
</html>