<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="utf-8" xml:lang="utf-8">
<head>
<title>What Really Matters or The Counting Article LG #181</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../lg.css" type="text/css" media="screen, projection"  />
<link rel="alternate" type="application/rss+xml" title="LG RSS" href="../lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="../lg.rdf" />
<!-- link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" / -->
<link rel="shortcut icon" href="../favicon.ico" />

<style type="text/css" media="screen, projection">
<!--

-->
</style>

</head>
<body>

<a href="../">
<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
</a>
<p id="fun">...making Linux just a little more fun!</p>

<div id="navigation">
<table summary="masthead" width="100%">
<tr>
<td align="center" colspan="3" style="font-size: 10px; font-weight: bold">
<a href="../index.html">Home</a>
<a href="http://linuxgazette.net">Main Site</a>
<a href="../faq/index.html">FAQ</a>

<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="http://lists.linuxgazette.net/listinfo.cgi">Mailing Lists</a>
<a href="../jobs.html">Join Us!</a>
<a href="../contact.html">Contact Us</a>

<hr width="99%" style="border: 1px inset #000033">
</td>
</tr>
<tr>
<td width="40%" align="left" style="font-size: 10px; font-weight: bold">
The Free International Online Linux Monthly
</td>
<td width="20%" align="center" style="font-size: 10px; font-weight: bold">
ISSN: 1934-371X
</td>
<td width="40%" align="right" style="font-size: 10px; font-weight: bold">
Main site: <a href="http://linuxgazette.net">http://linuxgazette.net</a> 
</td>
</table>
</div>


<div id="breadcrumbs1">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">December 2010 (#181)</a> &gt; 
Article

</div>

<div class="articlecontent1">
<div class="content">

<div id="previousnexttop">
<A HREF="brownss.html" >&lt;-- prev</A> | <A HREF="jangir.html" >next --&gt;</A>
</div>

<h1>What Really Matters or The Counting Article</h1>
<p id="by"><b>By <a href="../authors/grebler.html">Henry Grebler</a></b></p>


<pre>
	Now it happened that Kanga had felt rather motherly that
	morning, and Wanting to Count Things - like Roo's vests, and
	how many pieces of soap there were left, and the two clean
	spots in Tigger's feeder.
	 -- A. A. Milne, The House at Pooh Corner
</pre>

<p>
I'm responsible for a farm of Linux and Unix machines. I'm still
coming to terms with all the computers in my domain. There's the usual
panoply of servers: DNS, DHCP, email, web servers, and file servers, plus
computers which provide the infrastructure for the organisation:
accounts, HR, administration, etc. The list goes on.
</p>

<p>
Seemingly rare these days, my desktop runs Linux. From my homebase, I
ssh into one server or another as I go about my daily duties.
</p>

<p>
I also have a laptop, but is sits to one side on my desk. Its main
purpose is to play music while I wage an endless war with the backup
system. Put tapes in; take tapes out; curse the tape drive, the
jukebox, and the rotten software. Rinse and repeat.
</p>

<p>
My desktop is set up exactly as I like it. The entire range of my HAL
(Henry Abstraction Layer) is available. On most of the servers on the
internal network, this is also true. Typically they mount my home
directory from the file server, the home directory which is repository
to the things that matter to me.
</p>

<table width='30%' border='1' align='right' hspace='25'>
<tr><td style='padding: 10px 20px; font-size: 90%; background-color: skyblue;'>
<p>
As I reread this article, I wondered what is in my HAL these days.
Quite educational. Here's the summary:
</p>

<pre>
	170 aliases		alias | wc
	 56 envars		env | wc
	 93 local vars		set | grep '^[^ ]*=' | wc
	 65 functions		set | fgrep ' ()' | wc
	159 shell scripts	files ~/scripts/*.sh | wc
	964 help files		ls ~/help*/help_* | grep -v "~$" | wc
</pre>

<p>
The lesson for me is that many of these have passed their use-by date.
I haven't used them in yonks and I can't even remember what they were
for. I think it might be time for a big clean up.
</p>

<p>
Also, to be perfectly honest, some of the help files are repeated in
different directories. When I used:
</p>

<pre>
	ls ~/help*/help_* | grep -v "~$" | \
		awk -F / '{print $NF}' | sort -u | wc
</pre>

<p>
the number shown was only 812.
</p>
</td></tr>
</table>

<p>
It's a bit like being at home. There are vastly more clothes than I
usually wear. But they're in a cupboard somewhere and easily
accessible. When the seasons change, so does my wardrobe.
</p>

<p>
There are also several servers which do not have access to the file
server. These are typically Internet-facing servers like the external
DNS, our Internet web presence, FTP. Also, the way the organisation is
structured, there are some semi-autonomous islands, groups of
computers that have an independent file server.
</p>

<p>
Arguably, I should install a mirror of my home directory on the file
servers for the islands. Perhaps in the fullness of time I will.  In the
meantime, I have been forced to focus on what's important.
</p>

<p>
If you live in a GUI world, I doubt that what follows will interest
you.
</p>

<p>
My desktop runs a windowing system (OLVWM, for what it's worth). But
apart from the almost mandatory browser (Firefox), the GUI for the
backup system and the occasional XPDF, the purpose of the windowing
system is to run oodles of xterms. How many in an oodle? I'm glad you
asked.
</p>

<pre>
	psa | grep xterm | wc
	    177    5298   34702
</pre>

<p>
I guess I'm running 177 xterms at the moment. Some are local to my
desktop. Just to check:
</p>

<pre>
	psa | grep -w ssh | wc
	     44     574    4260
</pre>

<p>
That's 44 ssh sessions to remote machines. There should be many more,
but many of the servers time me out. So, many of the xterms were sshed
into a server and are now sitting back at the bash prompt on my
desktop.
</p>

<p>
A crude count can be obtained thus:
</p>

<pre>
	psa | grep xterm | grep unix | wc
	     82    2501   16251
</pre>

<p>
That suggests another 38 have been used to get onto another server and
have been timed out. Sometimes I have more than one xterm to a single
server. (The reason the command works is that most of our Unix/Linux
servers have "unix" as the first part of their name. It is but a crude
approximation.)
</p>

<p>
I've tried to live with what's available on any particular machine.  And,
at a pinch, I can do it. But I find myself thinking too much about
<strong>how</strong> to do something, and not enough about
<strong>what</strong> I want to do next.
</p>

<p>
When you plan a holiday, you don't usually expect to take your entire
wardrobe. Typically, you will only be gone a few weeks; with a bit of
luck, the weather at your destination will be a single season. For me,
the hope is that it will be summer: I only need to pack underwear,
shorts and T shirts.
</p>

<p>
But whatever you decide to do, you are forced to focus on what's
important. Is it worth the extra effort to carry a second pair of
shoes? Do I really need a dressing gown? (No!)
</p>

<p>
After several months, it turns out that what I really need when I
visit these alien machines is just four things. I've put these four
things in a file; and I've dedicated one of my xterms to displaying
the file. Here's the part that's relevant:
</p>

<pre>
------------------------------------------------------------------------
        PS1='\[\033[1m\]\h:\w-\t-bash\$\[\033[0m\]\n\$ '
dth () 
{ 
    case $1 in 
        +*)
            lines=-`echo $1 | cut -c2-`;
            shift
        ;;
    esac;
    ls -lat "$@" | head $lines
}
        alias p=pushd
        alias bdx='builtin dirs |tr " " "\012" |awk "{print NR-1, \$0}"'
------------------------------------------------------------------------
</pre>

<p>
When I visit a limited machine, after starting bash if necessary, I
can add this small part of my HAL with a simple triple-click-drag,
move the mouse, middle-button.
</p>

<p>
It's a curious collection of commands. If you'd asked me six months
ago to list the 4 most important components in my HAL, I might have
guessed one or two of these, at most.
</p>

<p>
So here's what they do and why they are so important.
</p>


<h3>The prompt</h3>

<p>
Here is the standard prompt on one of our machines:
</p>

<pre>
	[root@venus ~]#
</pre>

<p>
What does it tell me? Very little.
</p>

<p>
Here is the prompt after I have set PS1:
</p>


<pre>
	<strong>venus:~-21:33:16-bash#</strong>
	#
</pre>

<p>
First of all, it is bold. It constantly fascinates me that others seem
not to care about this. If I issue a command that produces an
indeterminate amount of output (like ls), with the speed of computers
and communications these days, the output appears in a twinkling. All
I can see is a screenfull of stuff. Where does the output of the last
command start? What about the command before that?
</p>

<p>
Because my prompt is bold and deliberately quite long, it's almost as
if I had ruled a line before each command. The last command (or any
before it) are easy for the eye to locate. If there were half-way
decent colours available, I might be tempted to use colours.
</p>

<p>
Did I mention that the prompt is quite long? If you look closely,
you'll notice that it's actually a two-line prompt. The commands are
typed on the second line, starting at the third character from the
left of the screen.
</p>

<p>
I choose not to have the prompt tell me which user I am running as.
It's either henry or root, and the # means root; otherwise it would be
$ and mean henry.
</p>

<p>
It has been pointed out to me that it is redundant to have "bash" in
the prompt, and I agree. Eventually, I will fix that; but so far it has
not caused me sufficient inconvenience to bother.
</p>

<p>
I prefer "venus:" to "@venus". Look what happens if I cd to somewhere
else:
</p>

<pre>
	p /var/log
	venus:/var/log-21:45:40-bash#
</pre>

<p>
With my mouse, I can select the prompt before the hyphen and use it in
another xterm (one on my desktop) as part of the scp to transfer files
between the server and my desktop. For example:
</p>

<pre>
	scp -p venus:/var/log/syslog /tmp
</pre>

<p>
It's not just a matter of less typing, though I welcome that; it
increases accuracy. Across machines, as in scp, you don't get file
completion.
</p>

<p>
The last part of the prompt is the time. Apart from constantly
providing me with the time, it also provides automatic (albeit crude)
timing for commands. How long did that last copy take? Look at the
time before it started, estimate how long it took to type the command,
subtract from the time in the prompt when it finished.
</p>

<p>
Where it is often valuable is in telling me when a command finished. In
this case, the indicated time is totally accurate. Why is that
important?
</p>

<p>
Well, first you have to understand that I am constantly being
interrupted all day long. That comes with the territory. So I want to
check, did I copy the relevant file before I sent the email? No. Well
that explains why that didn't work. I'd better do it again.
</p>

<p>
Perhaps not of all this is important to others. Perhaps none of it is.
It sure is important to me. That prompt has evolved over the last 20
years.
</p>


<h3>The Function</h3>

<p>
What's more important: underwear or shorts? Food or drink? It's
probably a silly question; if you need both, they're both important.
</p>

<p>
So, also, the function is every bit as important as the prompt.
</p>

<p>
This function is my most used command. What does it do? In essence it
lists the 10 most recent entries in a directory.
</p>

<p>
When I list a directory (think /etc or /var/log), the <strong>last</strong> thing I
want to know is how many files are there. I'm not interested in
anything that has been there for a long time. That's just dross and
distraction.
</p>

<p>
What I want to know is what has changed recently?
</p>

<p>
If all I wanted out of dth was what I have described in the summary, I
could have got by with an alias (almost). And for many years I did.
But, since it's my most used command, I got fancier.
</p>

<p>
Sometimes I want to see the first 15 entries. I can enter
</p>

<pre>
	dth +15
</pre>

<p>
and it will list the first 15 entries *and* set the current default to
15. The next time I enter dth without a plus-arg, I'll get 15 entries
instead of 10. Of course, I can set it back with
</p>

<pre>
	dth +10 yada yada
</pre>

<p>
There's one other fringe benefit. On some systems, by default,
`ls' is aliased to `ls --color=tty'.
</p>

<p>
I'm not sure exactly why, but when I use dth I don't see those
annoying and largely unreadable colours; I get standard black and
white. Of particular joy to me, I don't ever have to see blinking red.
</p>

<p class='editorial'>
[ Piping the output of 'ls' into anything else makes 'ls' drop the
highlighting, etc. - since it's possible that those control characters
could "confuse" the downstream program. Clever gadget, that 'ls'. -- Ben ]
</p>

<p>
In my opinion, those few lines pack a powerful punch.
</p>


<h3>The aliases</h3>

<p>
I may as well discuss them together since they complement each other.
</p>

<p>
Instead of "cd" I prefer "pushd". And I prefer it even more if I can
get away with typing just "p".
</p>

<p>
For those not familiar, I can do no better than quote bash's help:
</p>

<pre>
------------------------------------------------------------------------
	builtin help pushd
pushd: pushd [dir | +N | -N] [-n]
    Adds a directory to the top of the directory stack, or rotates
    the stack, making the new top of the stack the current working
    directory.  With no arguments, exchanges the top two directories.
    
    +N  Rotates the stack so that the Nth directory (counting
        from the left of the list shown by `dirs', starting with
        zero) is at the top.
    
    -N  Rotates the stack so that the Nth directory (counting
        from the right of the list shown by `dirs', starting with
        zero) is at the top.
    
    -n  suppress the normal change of directory when adding directories
        to the stack, so only the stack is manipulated.
    
    dir adds DIR to the directory stack at the top, making it the
        new current working directory.
    
    You can see the directory stack with the `dirs' command.
------------------------------------------------------------------------
</pre>

<p>
I visit a server and usually land in my home directory if I log in as
me, root's home directory (usually /root) if I log in as root.
Typically I visit several directories.
</p>

<pre>
	p /etc
	...
	p /var/log
</pre>

<p>
If all I'm doing is bouncing between those two directories, I can just
use "p" without args. Then I visit several more directories. Pretty
soon I have a large stack. As the man said, "You can see the directory
stack with the `dirs' command".
</p>

<p>
	Well, actually, *I* can't. Long ago, I defined a function
	"dirs" which lists only the directories in the current
	directory. So I have to use:
</p>

<pre class="code">
------------------------------------------------------------------------
	builtin dirs
/p6/home/henryg/Mail/footy /p6/home/henryg/Mail/bv /p6/home/henryg/Mail/personal /p6/home/henryg/Mail/IBM /p6/home/henryg/Mail/lg /p6/home/henryg/Mail/dmo /p6/home/henryg/Mail/theatre /p6/home/henryg/Mail/spam /p6/home/henryg/Mail/mark /p6/home/henryg/Mail/tsf /p6/home/henryg/Mail/Savicky /p6/home/henryg/Mail/sav /p6/home/henryg/Mail/mh_etc /p6/home/henryg/Mail/jen
------------------------------------------------------------------------
</pre>

<p>
You see what's wrong with that picture? First it's one l-o-n-g line.
And second, are you really going to count your way to the directory
you want?
</p>

<p>
Enter "bdx", which displays the list and the number needed to get to a
particular item:
</p>


<pre>
------------------------------------------------------------------------
	bdx
0 /p6/home/henryg/Mail/footy
1 /p6/home/henryg/Mail/bv
2 /p6/home/henryg/Mail/personal
3 /p6/home/henryg/Mail/IBM
4 /p6/home/henryg/Mail/lg
5 /p6/home/henryg/Mail/dmo
6 /p6/home/henryg/Mail/theatre
7 /p6/home/henryg/Mail/spam
8 /p6/home/henryg/Mail/mark
9 /p6/home/henryg/Mail/tsf
10 /p6/home/henryg/Mail/Stephen
11 /p6/home/henryg/Mail/sav
12 /p6/home/henryg/Mail/mh_etc
13 /p6/home/henryg/Mail/jen
------------------------------------------------------------------------
</pre>

<p>
If I want to get to /p6/home/henryg/Mail/spam, I just need to enter
</p>

<pre>
	p +7
</pre>

<p>
[Don't reach for you emails just yet.]
</p>

<pre>
	... one learns a thing best by teaching it.
		-- John Barth, "The Sot-Weed Factor"
</pre>

<p>
And so it has been for me. Perhaps I wrote bdx long before bash got
smarter. I'd hate to think that I went to all the trouble when I could
simply have done
</p>

<pre>
	alias bdx='builtin dirs -v'
</pre>

<p>
However, in writing this article (claiming to be a teacher of sorts) I
have learnt more about the subject.
</p>


<h3>Conclusion</h3>

<p>
(Not in the sense of "drawing a conclusion", more in the vein of "coming to
the end") So there you have it. This is the way I pack my bags if I have to
travel ultra-light; and these are the reasons why.
</p>

<br clear="all" />

<table align='center' cellspacing='10'>
<tr>
<td>
<script type='text/javascript'>
digg_url = 'http://linuxgazette.net/181/grebler.html';
digg_title = 'What Really Matters or The Counting Article';
digg_bodytext = '<p> I\'m responsible for a farm of Linux and Unix machines. I\'m still coming to terms with all the computers in my domain. There\'s the usual panoply of servers: DNS, DHCP, email, web servers, and file servers, plus computers which provide the infrastructure for the organisation: accounts, HR, administration, etc. The list goes on. </p> ';
digg_topic = 'linux_unix';
</script>
<script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>
</td>
<td>
<a name="fb_share" type="box_count" href="http://www.facebook.com/sharer.php">Share</a>
<script src="http://static.ak.fbcdn.net/connect.php/js/FB.Share" type="text/javascript"></script>
</td>
<td>
<a href="http://twitter.com/home?status=Currently%20reading:%20http://linuxgazette.net/181/grebler.html%20at%20Linux%20Gazette%20%23linuxgazette" title="Click to share this post on Twitter"><img src="../gx/twitter.png" width="50" height="85" border="0"></a>
</td>
</tr>
</table>


<p class="talkback">
Talkback: <a
href="mailto:tag@lists.linuxgazette.net?subject=Talkback:181/grebler.html">Discuss this article with The Answer Gang</a>
</p>

<!-- *** BEGIN author bio *** -->
<hr>
<p>
<img align="left" alt="[BIO]" src="../gx/authors/grebler.jpg" class="bio">
</p>

<em>
<p>
Henry has spent his days working with computers, mostly for computer
 manufacturers or software developers. His early computer experience
 includes relics such as punch cards, paper tape and mag tape. It is
 his darkest secret that he has been paid to do the sorts of things he
 would have paid money to be allowed to do. Just don't tell any of his
 employers. 
</p>

<p>
He has used Linux as his personal home desktop since the family got its
 first PC in 1996. Back then, when the family shared the one PC, it was a
 dual-boot Windows/Slackware setup. Now that each member has his/her own
 computer, Henry somehow survives in a purely Linux world.
</p>

<p>
He lives in a suburb of Melbourne, Australia.
</p>



</em>

<br clear="all">


<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2010, Henry Grebler. Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication License</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 181 of Linux Gazette, December 2010
</p>

</div>

<div id="previousnextbottom">
<A HREF="brownss.html" >&lt;-- prev</A> | <A HREF="jangir.html" >next --&gt;</A>
</div>

</div>
</div>

<script src="http://www.google-analytics.com/urchin.js"
type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1204316-1";
urchinTracker();
</script>







<img src="../gx/tux_86x95_indexed.png" id="tux" alt="Tux"/>

</body>
</html>

