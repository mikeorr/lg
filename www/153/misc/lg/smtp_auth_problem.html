<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'
		 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml' lang='utf-8' xml:lang='utf-8'>
<head>
<title>SMTP Auth Problem</title>
<meta http-equiv='Content-Type; charset=utf-8' />
<link rel='stylesheet' type='text/css' href='../../../lg.css' />
</head>
<body>
<a href="../../../"><img alt="Linux Gazette" src="../../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" /></a><img alt="Tux" src="../../../gx/tux_86x95_indexed.png" id="tux" /><p id="fun">...making Linux just a little more fun!</p><div class='content articlecontent'><a name="top"></a><h3>SMTP Auth Problem</h3>
<p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Sat, 05 Jul 2008 09:28:38 -0700</b>
</p>

<p>
Hi all,
</p>

<p>
I am administering a e-mail server running RHEL 5 with sendmail 8.13 and
using dovecot imap most of the users are going to need to be able to
send mail from their laptops and i have no idea what network they will
be utilizing. After looking at
<a href="http://www.joreybump.com/code/howto/smtpauth.html">http://www.joreybump.com/code/howto/smtpauth.html</a> and following the
guide there I was able to get authenticated relay enabled.
</p>

<p>
I am using saslauthd and never created sasl passwords but
following the guide at <a href="http://www.joreybump.com/code/howto/smtpauth.html">http://www.joreybump.com/code/howto/smtpauth.html</a>
was able to get it working. now after 6 months of no problem and then
the other day changed my password to a stronger one now I cannot relay
from anywhere.
</p>

<pre>
[root@linuxamd ~]# sasldblistusers2
listusers failed
[root@linuxamd ~]#
[root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong>
0: NO "authentication failed"
</pre>

<p>
is this my problem?
</p>

<p>
All accounts are stored in /etc/passwd saslauthd is running and I
performed a restart of saslauthd with out any errors.
</p>

<p>
I have tried with both kmail and thunderbird. My usual settings are tls
if available and and smtp auth with username and password I thought at
first that this was the problem it was using the old password so I
removed the default smtp server settings and removed the passwords. So
it would force me to manually enter the password again I did this while
on another network and tried to send with no success. As soon as I
disconnected from the neighboring lan and connected to the local lan it
took and sent but I am unsure if it is using auth it seems like it is
only sending because its on my lan how would I verify the authentication
process is working at all? I am not certain exactly how saslauthd
works and have seen nothing unusual in my logs. Thunderbird simply times
  out when I try to send from other networks and tells me to check my
network settings.
</p>

<p>
Thanks in advance,
</p>

<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Sat, 05 Jul 2008 12:26:03 -0700</b>
</p>

<p>
Joey Prestia wrote:
</p>

<pre>
&gt; Hi all,
&gt; 
&gt; I am administering a e-mail server running RHEL 5 with sendmail 8.13 and
&gt; using dovecot imap most of the users are going to need to be able to
&gt; send mail from their laptops and i have no idea what network they will
&gt; be utilizing. After looking at
&gt; <a href="http://www.joreybump.com/code/howto/smtpauth.html">http://www.joreybump.com/code/howto/smtpauth.html</a> and following the
&gt; guide there I was able to get authenticated relay enabled.
&gt; 
&gt; I am using saslauthd and never created sasl passwords but
&gt; following the guide at <a href="http://www.joreybump.com/code/howto/smtpauth.html">http://www.joreybump.com/code/howto/smtpauth.html</a>
&gt; was able to get it working. now after 6 months of no problem and then
&gt; the other day changed my password to a stronger one now I cannot relay
&gt; from anywhere.
&gt; 
&gt; 
&gt; [root@linuxamd ~]# sasldblistusers2
&gt; listusers failed
&gt; [root@linuxamd ~]#
&gt; [root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong>
&gt; 0: NO "authentication failed"
&gt; 
&gt; is this my problem?
&gt; 
&gt; All accounts are stored in /etc/passwd saslauthd is running and I
&gt; performed a restart of saslauthd with out any errors.
&gt; 
&gt; I have tried with both kmail and thunderbird. My usual settings are tls
&gt; if available and and smtp auth with username and password I thought at
&gt; first that this was the problem it was using the old password so I
&gt; removed the default smtp server settings and removed the passwords. So
&gt; it would force me to manually enter the password again I did this while
&gt; on another network and tried to send with no success. As soon as I
&gt; disconnected from the neighboring lan and connected to the local lan it
&gt; took and sent but I am unsure if it is using auth it seems like it is
&gt; only sending because its on my lan how would I verify the authentication
&gt; process is working at all? I am not certain exactly how saslauthd
&gt; works and have seen nothing unusual in my logs. Thunderbird simply times
&gt;   out when I try to send from other networks and tells me to check my
&gt; network settings.
&gt; 
</pre>

<p>
A little additional info. I have tried telnet from my lan to my mail
server port 25 and no problem and when I try from outside it it just
sits there until it times out. I thought this was weird, although all I
   did was change a password. On attempt to send mail from outside I see
no activity in /var/log/maillog except my logging into dovecot imap no
sendmail auth attempt at all.
</p>

<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Sat, 5 Jul 2008 17:56:39 -0400</b>
</p>

<p>
On Sat, Jul 05, 2008 at 12:26:03PM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; 
&gt; A little additional info. I have tried telnet from my lan to my mail
&gt; server port 25 and no problem and when I try from outside it it just
&gt; sits there until it times out. I thought this was weird, although all I
&gt;    did was change a password. On attempt to send mail from outside I see
&gt; no activity in /var/log/maillog except my logging into dovecot imap no
&gt; sendmail auth attempt at all.
</pre>

<p>
This sounds like one of those times when you have to drop the "but I
only changed X!" premise and start afresh, as if you didn't know
anything about the causes of the problem.
</p>

<p>
The above telnet problem says, or strongly implies, that you've got
something completely unrelated to passwords or SASL; perhaps you have a
firewall running that blocks ports 23 and 25. Try that assumption, and
see where that takes you. 'netcat' is your friend when it comes to
troubleshooting this kind of problems.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Sat, 05 Jul 2008 15:17:52 -0700</b>
</p>

<p>
Ben Okopnik wrote:
</p>

<pre>
&gt; On Sat, Jul 05, 2008 at 12:26:03PM -0700, Joey Prestia wrote:
&gt;&gt; A little additional info. I have tried telnet from my lan to my mail
&gt;&gt; server port 25 and no problem and when I try from outside it it just
&gt;&gt; sits there until it times out. I thought this was weird, although all I
&gt;&gt;    did was change a password. On attempt to send mail from outside I see
&gt;&gt; no activity in /var/log/maillog except my logging into dovecot imap no
&gt;&gt; sendmail auth attempt at all.
&gt; 
&gt; This sounds like one of those times when you have to drop the "but I
&gt; only changed X!" premise and start afresh, as if you didn't know
&gt; anything about the causes of the problem.
&gt; 
&gt; The above telnet problem says, or strongly implies, that you've got
&gt; something completely unrelated to passwords or SASL; perhaps you have a
&gt; firewall running that blocks ports 23 and 25. Try that assumption, and
&gt; see where that takes you. 'netcat' is your friend when it comes to
&gt; troubleshooting this kind of problems.
&gt; 
</pre>

<pre>
[joey@linuxamd ~]$ netstat -tuna
Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address               Foreign Address
     State
tcp        0      0 127.0.0.1:2208              0.0.0.0:*
     LISTEN
tcp        0      0 0.0.0.0:21                  0.0.0.0:*
     LISTEN
tcp        0      0 0.0.0.0:631                 0.0.0.0:*
     LISTEN
tcp        0      0 0.0.0.0:25                  0.0.0.0:*
     LISTEN
tcp        0      0 0.0.0.0:3551                0.0.0.0:*
     LISTEN
tcp        0      0 127.0.0.1:2207              0.0.0.0:*
     LISTEN
tcp        1     44 192.168.200.101:25          68.14.243.59:37435
     CLOSING
tcp        0      0 :::993                      :::*
     LISTEN
</pre>

<p>
I know I can and am still recieving mail as this is the machine i am
using. I never made any changes to iptables.  I would think that since
telnet is not working to port 25 I shouldn't be receiving mail right at
least from any where outside my lan?
</p>

<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ren&eacute; Pfeiffer [lynx at luchs.at]

</p>
</b><br />
<b>Sun, 6 Jul 2008 00:21:59 +0200</b>
</p>

<p>
On Jul 05, 2008 at 1756 -0400, Ben Okopnik appeared and said:
</p>

<pre>
&gt; [...]
&gt; The above telnet problem says, or strongly implies, that you've got
&gt; something completely unrelated to passwords or SASL; perhaps you have a
&gt; firewall running that blocks ports 23 and 25. Try that assumption, and
&gt; see where that takes you. 'netcat' is your friend when it comes to
&gt; troubleshooting this kind of problems.
</pre>

<p>
Yes, and I'd add a healthy dose of tethereal/tshark/tcpdump to see what
server and client are talking about. It's been ages since I did this
configuration with Sendmail and unfortunately I cannot remember how I
did this (my backups might, I'll have a look on Monday).
</p>

<p>
Best,
Ren&eacute;.
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Sat, 5 Jul 2008 21:29:59 -0400</b>
</p>

<p>
On Sat, Jul 05, 2008 at 03:17:52PM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; Ben Okopnik wrote:
&gt; &gt; On Sat, Jul 05, 2008 at 12:26:03PM -0700, Joey Prestia wrote:
&gt; &gt;&gt; A little additional info. I have tried telnet from my lan to my mail
&gt; &gt;&gt; server port 25 and no problem and when I try from outside it it just
&gt; &gt;&gt; sits there until it times out. I thought this was weird, although all I
&gt; &gt;&gt;    did was change a password. On attempt to send mail from outside I see
&gt; &gt;&gt; no activity in /var/log/maillog except my logging into dovecot imap no
&gt; &gt;&gt; sendmail auth attempt at all.
&gt; &gt; 
&gt; &gt; This sounds like one of those times when you have to drop the "but I
&gt; &gt; only changed X!" premise and start afresh, as if you didn't know
&gt; &gt; anything about the causes of the problem.
&gt; &gt; 
&gt; &gt; The above telnet problem says, or strongly implies, that you've got
&gt; &gt; something completely unrelated to passwords or SASL; perhaps you have a
&gt; &gt; firewall running that blocks ports 23 and 25. Try that assumption, and
&gt; &gt; see where that takes you. 'netcat' is your friend when it comes to
&gt; &gt; troubleshooting this kind of problems.
&gt; &gt; 
&gt; 
&gt; [joey@linuxamd ~]$ netstat -tuna
&gt; Active Internet connections (servers and established)
&gt; Proto Recv-Q Send-Q Local Address               Foreign Address
&gt;      State
&gt; tcp        0      0 127.0.0.1:2208              0.0.0.0:*
&gt;      LISTEN
&gt; tcp        0      0 0.0.0.0:21                  0.0.0.0:*
&gt;      LISTEN
&gt; tcp        0      0 0.0.0.0:631                 0.0.0.0:*
&gt;      LISTEN
&gt; tcp        0      0 0.0.0.0:25                  0.0.0.0:*
&gt;      LISTEN
&gt; tcp        0      0 0.0.0.0:3551                0.0.0.0:*
&gt;      LISTEN
&gt; tcp        0      0 127.0.0.1:2207              0.0.0.0:*
&gt;      LISTEN
&gt; tcp        1     44 192.168.200.101:25          68.14.243.59:37435
&gt;      CLOSING
&gt; tcp        0      0 :::993                      :::*
&gt;      LISTEN
&gt; 
&gt; I know I can and am still recieving mail as this is the machine i am
&gt; using. 
</pre>

<p>
I can easily visualize a situation in which this wouldn't mean much.
E.g., if you have (as is often the case on large corporate networks) a
mailhost sitting on your "border" and talking only to the hosts
inside... oh, whoops - I just realized that I just strayed off into
la-la land (blame this horrendous sinus infection that I'm battling as a
result of having had a camera shoved what felt like several miles up my
nose.) Didn't you mention SSL and IMAP? That would be either 465 for
SMTP over SSL, or 993 (IMAP over SSL), not 25. What happens when you try
to telnet to 993?
</p>


<pre>
&gt; I never made any changes to iptables.  I would think that since
&gt; telnet is not working to port 25 I shouldn't be receiving mail right at
&gt; least from any where outside my lan?
</pre>

<p>
993 is running; that's a route where mail can come in.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Sat, 05 Jul 2008 19:05:01 -0700</b>
</p>

<p>
Ben Okopnik wrote:
</p>

<pre>
&gt; On Sat, Jul 05, 2008 at 03:17:52PM -0700, Joey Prestia wrote:
&gt;&gt; Ben Okopnik wrote:
&gt;&gt;&gt; On Sat, Jul 05, 2008 at 12:26:03PM -0700, Joey Prestia wrote:
&gt;&gt;&gt;&gt; A little additional info. I have tried telnet from my lan to my mail
&gt;&gt;&gt;&gt; server port 25 and no problem and when I try from outside it it just
&gt;&gt;&gt;&gt; sits there until it times out. I thought this was weird, although all I
&gt;&gt;&gt;&gt;    did was change a password. On attempt to send mail from outside I see
&gt;&gt;&gt;&gt; no activity in /var/log/maillog except my logging into dovecot imap no
&gt;&gt;&gt;&gt; sendmail auth attempt at all.
&gt;&gt;&gt; This sounds like one of those times when you have to drop the "but I
&gt;&gt;&gt; only changed X!" premise and start afresh, as if you didn't know
&gt;&gt;&gt; anything about the causes of the problem.
&gt;&gt;&gt;
&gt;&gt;&gt; The above telnet problem says, or strongly implies, that you've got
&gt;&gt;&gt; something completely unrelated to passwords or SASL; perhaps you have a
&gt;&gt;&gt; firewall running that blocks ports 23 and 25. Try that assumption, and
&gt;&gt;&gt; see where that takes you. 'netcat' is your friend when it comes to
&gt;&gt;&gt; troubleshooting this kind of problems.
&gt;&gt;&gt;
&gt;&gt; [joey@linuxamd ~]$ netstat -tuna
&gt;&gt; Active Internet connections (servers and established)
&gt;&gt; Proto Recv-Q Send-Q Local Address               Foreign Address
&gt;&gt;      State
&gt;&gt; tcp        0      0 127.0.0.1:2208              0.0.0.0:*
&gt;&gt;      LISTEN
&gt;&gt; tcp        0      0 0.0.0.0:21                  0.0.0.0:*
&gt;&gt;      LISTEN
&gt;&gt; tcp        0      0 0.0.0.0:631                 0.0.0.0:*
&gt;&gt;      LISTEN
&gt;&gt; tcp        0      0 0.0.0.0:25                  0.0.0.0:*
&gt;&gt;      LISTEN
&gt;&gt; tcp        0      0 0.0.0.0:3551                0.0.0.0:*
&gt;&gt;      LISTEN
&gt;&gt; tcp        0      0 127.0.0.1:2207              0.0.0.0:*
&gt;&gt;      LISTEN
&gt;&gt; tcp        1     44 192.168.200.101:25          68.14.243.59:37435
&gt;&gt;      CLOSING
&gt;&gt; tcp        0      0 :::993                      :::*
&gt;&gt;      LISTEN
&gt;&gt;
&gt;&gt; I know I can and am still recieving mail as this is the machine i am
&gt;&gt; using. 
&gt; 
&gt; I can easily visualize a situation in which this wouldn't mean much.
&gt; E.g., if you have (as is often the case on large corporate networks) a
&gt; mailhost sitting on your "border" and talking only to the hosts
&gt; inside... oh, whoops - I just realized that I just strayed off into
&gt; la-la land (blame this horrendous sinus infection that I'm battling as a
&gt; result of having had a camera shoved what felt like several miles up my
&gt; nose.) Didn't you mention SSL and IMAP? That would be either 465 for
&gt; SMTP over SSL, or 993 (IMAP over SSL), not 25. What happens when you try
&gt; to telnet to 993?
&gt; 
&gt;&gt; I never made any changes to iptables.  I would think that since
&gt;&gt; telnet is not working to port 25 I shouldn't be receiving mail right at
&gt;&gt; least from any where outside my lan?
&gt; 
&gt; 993 is running; that's a route where mail can come in.
&gt; 
&gt; 
</pre>

<pre>
[root@linuxamd ~]# telnet localhost 993
Trying 127.0.0.1...
Connected to localhost.localdomain (127.0.0.1).
Escape character is '^]'.
ehlo localhost
Connection closed by foreign host.
</pre>

<p>
When I went and changed the line in /etc/sysconfig/saslauthd that says
AUTH=pam  to AUTH=shadow and restarted saslauthd I was able to:
</p>

<pre>
[root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong> -s smtp
0: OK "Success."
</pre>

<p>
After this I tried and got on another lan to try to send and failed 
several times. So I tried:
</p>

<pre>
[root@linuxamd ~]# telnet localhost 25
Trying 127.0.0.1...
Connected to localhost.localdomain (127.0.0.1).
Escape character is '^]'.
220 linuxamd.com ESMTP Sendmail 8.13.8/8.13.8; Sat, 5 Jul 2008 18:55:50 
-0700
ehlo localhost
250-linuxamd.com Hello localhost.localdomain [127.0.0.1], pleased to 
meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-STARTTLS
250-DELIVERBY
250 HELP
help auth
214-2.0.0 AUTH mechanism [initial-response]
214-2.0.0       Start authentication.
214 2.0.0 End of HELP info
starttls
220 2.0.0 Ready to start TLS
auth plain am9leQ0k
Connection closed by foreign host.
</pre>

<p>
Which is kind of confusing so I changed the saslauthd parameter back to 
its original value not wanting to perhaps screw something up and 
restarted saslauthd and found out that
</p>

<pre>
[root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong>
0: NO "authentication failed"
[root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong> -s smtp
0: OK "Success."
</pre>

<p>
I must specify the service (these little things are real important!)
So I am back to the drawing board or to scouring search engines and 
finding very little out there.
</p>


<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Sun, 6 Jul 2008 01:41:01 -0400</b>
</p>

<p>
On Sat, Jul 05, 2008 at 07:05:01PM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; &gt; 
&gt; &gt; 993 is running; that's a route where mail can come in.
&gt; 
&gt; [root@linuxamd ~]# telnet localhost 993
&gt; Trying 127.0.0.1...
&gt; Connected to localhost.localdomain (127.0.0.1).
&gt; Escape character is '^]'.
&gt; ehlo localhost
</pre>

<p>
No point in that, since you didn't see a welcome banner. Since I don't
have any experience troubleshooting IMAP over SSL, I'm going to put
'telnet' in a box marked "maybe or maybe not", and suggest switching
over to a tool designed for the job - 'swaks'. Note that you'll also
need to install 'libnet-ssleay-perl' if you want to do TLS.
</p>

<p>
<pre class='code'>
ben@Tyr:~$ swaks -a -tls -q HELO -s linuxgazette.net -au ben -ap '&lt;&gt;'
=== Trying linuxgazette.net:25...
=== Connected to linuxgazette.net.
&lt;-  220 genetikayos.com ESMTP Sendmail 8.12.11.20060308/8.12.11; Sat, 5 Jul 2008 21:20:05 -0700
 -&gt; EHLO localhost
&lt;-  250-genetikayos.com Hello 83.sub-70-220-99.myvzw.com [70.220.99.83], pleased to meet you
&lt;-  250-ENHANCEDSTATUSCODES
&lt;-  250-PIPELINING
&lt;-  250-8BITMIME
&lt;-  250-SIZE
&lt;-  250-DSN
&lt;-  250-ETRN
&lt;-  250-AUTH GSSAPI
&lt;-  250-STARTTLS
&lt;-  250-DELIVERBY
&lt;-  250 HELP
 -&gt; STARTTLS
&lt;-  220 2.0.0 Ready to start TLS
=== TLS started w/ cipher DHE-RSA-AES256-SHA
 ~&gt; EHLO localhost
&lt;~  250-genetikayos.com Hello 83.sub-70-220-99.myvzw.com [70.220.99.83], pleased to meet you
&lt;~  250-ENHANCEDSTATUSCODES
&lt;~  250-PIPELINING
&lt;~  250-8BITMIME
&lt;~  250-SIZE
&lt;~  250-DSN
&lt;~  250-ETRN
&lt;~  250-AUTH GSSAPI LOGIN PLAIN
&lt;~  250-DELIVERBY
&lt;~  250 HELP
 ~&gt; QUIT
&lt;~  221 2.0.0 genetikayos.com closing connection
=== Connection closed with remote host.
</pre>

<p>
You should be able to do something similar and see what's going on.
</p>


<pre>
&gt; When I went and changed the line in /etc/sysconfig/saslauthd that says
&gt; AUTH=pam  to AUTH=shadow and restarted saslauthd I was able to:
&gt; 
&gt; 
&gt; [root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong> -s smtp
&gt; 0: OK "Success."
</pre>

<p>
So, it seems like you had/have two problems going at the same time -
some sort of networking issue (as demonstrated by the connection
timeouts) and an authentication issue (as demonstrated by the auth
failure with 'testsaslauthd'.)
 
</p>

<pre>
&gt; After this I tried and got on another lan to try to send and failed 
&gt; several times. So I tried:
&gt; 
&gt; [root@linuxamd ~]# telnet localhost 25
&gt; Trying 127.0.0.1...
&gt; Connected to localhost.localdomain (127.0.0.1).
&gt; Escape character is '^]'.
&gt; 220 linuxamd.com ESMTP Sendmail 8.13.8/8.13.8; Sat, 5 Jul 2008 18:55:50 
&gt; -0700
&gt; ehlo localhost
&gt; 250-linuxamd.com Hello localhost.localdomain [127.0.0.1], pleased to 
&gt; meet you
&gt; 250-ENHANCEDSTATUSCODES
&gt; 250-PIPELINING
&gt; 250-8BITMIME
&gt; 250-SIZE
&gt; 250-DSN
&gt; 250-ETRN
&gt; 250-STARTTLS
&gt; 250-DELIVERBY
&gt; 250 HELP
</pre>

<p>
[blink] Pardon me... but where is your '250-AUTH DIGEST-MD5 GSSAPI
etc' line? This server is very loudly NOT saying "I support the AUTH
command." So you can't use one. See the LG example, above, for what I
mean.
</p>


<pre>
&gt; help auth
&gt; 214-2.0.0 AUTH mechanism [initial-response]
&gt; 214-2.0.0       Start authentication.
&gt; 214 2.0.0 End of HELP info
&gt; starttls
&gt; 220 2.0.0 Ready to start TLS
&gt; auth plain am9leQ0k
&gt; Connection closed by foreign host.
</pre>

<p>
Perhaps giving it a command that it explicitly said it can't handle
caused it to give up?
 
</p>

<pre>
&gt; Which is kind of confusing so I changed the saslauthd parameter back to 
&gt; its original value not wanting to perhaps screw something up and 
&gt; restarted saslauthd and found out that
&gt; 
&gt; [root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong>
&gt; 0: NO "authentication failed"
&gt; [root@linuxamd ~]# testsaslauthd -u joey -p <strong>******</strong> -s smtp
&gt; 0: OK "Success."
</pre>

<p>
That may be saying "I can connect via SMTP - which doesn't require an
authentication method - but I can't via SMTP-AUTH, which does." Which we
already knew.
 
</p>

<pre>
&gt; I must specify the service (these little things are real important!)
</pre>

<p>
I wonder what the default service is? Whatever it is, it's clearly
failing.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Sun, 06 Jul 2008 10:29:58 -0700</b>
</p>

<p>
Ben Okopnik wrote:
</p>


<pre>
&gt; ```
&gt; ben@Tyr:~$ swaks -a -tls -q HELO -s linuxgazette.net -au ben -ap '&lt;&gt;'
&gt; === Trying linuxgazette.net:25...
&gt; === Connected to linuxgazette.net.
&gt; &lt;-  220 genetikayos.com ESMTP Sendmail 8.12.11.20060308/8.12.11; Sat, 5 Jul 2008 21:20:05 -0700
&gt;  -&gt; EHLO localhost
&gt; &lt;-  250-genetikayos.com Hello 83.sub-70-220-99.myvzw.com [70.220.99.83], pleased to meet you
&gt; &lt;-  250-ENHANCEDSTATUSCODES
&gt; &lt;-  250-PIPELINING
&gt; &lt;-  250-8BITMIME
&gt; &lt;-  250-SIZE
&gt; &lt;-  250-DSN
&gt; &lt;-  250-ETRN
&gt; &lt;-  250-AUTH GSSAPI
&gt; &lt;-  250-STARTTLS
&gt; &lt;-  250-DELIVERBY
&gt; &lt;-  250 HELP
&gt;  -&gt; STARTTLS
&gt; &lt;-  220 2.0.0 Ready to start TLS
&gt; === TLS started w/ cipher DHE-RSA-AES256-SHA
&gt;  ~&gt; EHLO localhost
&gt; &lt;~  250-genetikayos.com Hello 83.sub-70-220-99.myvzw.com [70.220.99.83], pleased to meet you
&gt; &lt;~  250-ENHANCEDSTATUSCODES
&gt; &lt;~  250-PIPELINING
&gt; &lt;~  250-8BITMIME
&gt; &lt;~  250-SIZE
&gt; &lt;~  250-DSN
&gt; &lt;~  250-ETRN
&gt; &lt;~  250-AUTH GSSAPI LOGIN PLAIN
&gt; &lt;~  250-DELIVERBY
&gt; &lt;~  250 HELP
&gt;  ~&gt; QUIT
&gt; &lt;~  221 2.0.0 genetikayos.com closing connection
&gt; === Connection closed with remote host.
&gt; '''
&gt; 
&gt; You should be able to do something similar and see what's going on.
&gt; 
&gt; [blink] Pardon me... but where is your '250-AUTH DIGEST-MD5 GSSAPI
&gt; etc' line? This server is very loudly NOT saying "I support the AUTH
&gt; command." So you can't use one. See the LG example, above, for what I
&gt; mean.
</pre>

<p>
Oh, I had it configured to use tls then auth I got the system to
authenticate by this means
<a href="http://qmail.jms1.net/test-auth.shtml">http://qmail.jms1.net/test-auth.shtml</a> once again on the local network
though and could not reproduce it elsewhere here is what transpired with
some details obscured
</p>

<pre>
[joey@linuxamd ~]$ openssl s_client -starttls smtp -crlf -connect
127.0.0.1:25
 
[truncated]
 
---
220 linuxamd.com ESMTP Sendmail 8.13.8/8.13.8; Sat, 5 Jul 2008 20:05:27
-0700
ehlo localhost
250-linuxamd.com Hello localhost.localdomain [127.0.0.1], pleased to
meet you
250-ENHANCEDSTATUSCODES
250-PIPELINING
250-8BITMIME
250-SIZE
250-DSN
250-ETRN
250-AUTH LOGIN PLAIN
250-DELIVERBY
250 HELP
auth plain XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
235 2.0.0 OK Authenticated
</pre>

<p>
It will authenticate on the local network but should every where and I
have tried 3 e-mail clients in numerous configurations to try to get it
working and still cant send but from the local network?
</p>

<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Sun, 6 Jul 2008 19:41:19 -0400</b>
</p>

<p>
On Sun, Jul 06, 2008 at 10:29:58AM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; Ben Okopnik wrote:
&gt; 
&gt; &gt; [blink] Pardon me... but where is your '250-AUTH DIGEST-MD5 GSSAPI
&gt; &gt; etc' line? This server is very loudly NOT saying "I support the AUTH
&gt; &gt; command." So you can't use one. See the LG example, above, for what I
&gt; &gt; mean.
&gt; 
&gt; Oh, I had it configured to use tls then auth I got the system to
&gt; authenticate by this means
&gt; <a href="http://qmail.jms1.net/test-auth.shtml">http://qmail.jms1.net/test-auth.shtml</a> once again on the local network
&gt; though and could not reproduce it elsewhere here is what transpired with
&gt; some details obscured
&gt; 
&gt; [joey@linuxamd ~]$ openssl s_client -starttls smtp -crlf -connect
&gt; 127.0.0.1:25
&gt; 
&gt; [truncated]
&gt; 
&gt; ---
&gt; 220 linuxamd.com ESMTP Sendmail 8.13.8/8.13.8; Sat, 5 Jul 2008 20:05:27
&gt; -0700
&gt; ehlo localhost
&gt; 250-linuxamd.com Hello localhost.localdomain [127.0.0.1], pleased to
&gt; meet you
&gt; 250-ENHANCEDSTATUSCODES
&gt; 250-PIPELINING
&gt; 250-8BITMIME
&gt; 250-SIZE
&gt; 250-DSN
&gt; 250-ETRN
&gt; 250-AUTH LOGIN PLAIN
&gt; 250-DELIVERBY
&gt; 250 HELP
&gt; auth plain XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
&gt; 235 2.0.0 OK Authenticated
</pre>

<p>
OK, so it looks like you've got the authentication part nailed down.
What remains is for you to snoop the bits going down the wire when you
connect from an outside host, just as Ren&eacute; suggested. 'tcpdump' or
anything similar should help.
</p>


<pre>
&gt; It will authenticate on the local network but should every where and I
&gt; have tried 3 e-mail clients in numerous configurations to try to get it
&gt; working and still cant send but from the local network?
</pre>

<p>
Years ago, I used to do PC hardware repair seminars. We used a very
simple technique to figure out where the problem was: basically, we
disconnected everything (cards, drives, memory, etc.) from the
motherboard, then plugged it back in one item at a time (obviously,
powering down in between) and listening for the POST error beeps.
</p>

<p>
Stripping the problem down to its essentials is still an excellent
approach - so don't create problems for yourself by adding too much
stuff at once. Mail clients aren't the tool you need when you're still
having timeout issues.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Sun, 06 Jul 2008 19:58:48 -0700</b>
</p>

<p>
Ben Okopnik wrote:
</p>


<pre>
&gt; Stripping the problem down to its essentials is still an excellent
&gt; approach - so don't create problems for yourself by adding too much
&gt; stuff at once. Mail clients aren't the tool you need when you're still
&gt; having timeout issues.
&gt; 
&gt; 
</pre>

<p>
Yes you are right I  tried swaks and it worked from the lan but not
anywhere else as you can see below
</p>


<pre>
[root@station1 ~]#  perl swaks -a -tls -q HELO -s linuxamd.com -au joey
  -ap xxxxxxxx
=== Trying linuxamd.com:25...
<strong>*</strong> Error connecting 0.0.0.0 to linuxamd.com:25:
<strong>*</strong>     IO::Socket::INET: connect: timeout
</pre>

<p>
 From what I am seeing I am wondering what I am missing its obviously
something at the network level restricting me from authenticating from
anywhere else my sendmail.mc is nothing unusual all I changed were the
lines:
</p>

<pre>
define(`confAUTH_OPTIONS', `A p')dnl
TRUST_AUTH_MECH(`EXTERNAL DIGEST-MD5 CRAM-MD5 LOGIN PLAIN')dnl
define(`confAUTH_MECHANISMS', `EXTERNAL GSSAPI DIGEST-MD5 CRAM-MD5 LOGIN
PLAIN')dnl
define(`CERT_DIR', `/etc/pki/tls/certs')dnl
define(`confCACERT_PATH', `CERT_DIR')dnl
define(`confCACERT', `CERT_DIR/sendmail.pem')dnl
define(`confSERVER_CERT', `CERT_DIR/sendmail.pem')dnl
define(`confSERVER_KEY', `CERT_DIR/sendmail.pem')dnl
define(`confCLIENT_CERT', `CERT_DIR/sendmail.pem')dnl
define(`confCLIENT_KEY', `CERT_DIR/sendmail.pem')dnl
dnl #DAEMON_OPTIONS(`Port=smtp,Addr=127.0.0.1, Name=MTA')dnl
</pre>

<p>
my access contains only these lines from what I've been reading I am not
sure I really need a relay line for anything else in there some sendmail
doc says I may need a relay for auth users but my failure seems to be at
the authentication level.
</p>

<pre>
Connect:localhost.localdomain           RELAY
Connect:localhost                       RELAY
Connect:127.0.0.1                       RELAY
</pre>



<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Mon, 7 Jul 2008 09:17:20 -0400</b>
</p>

<p>
On Sun, Jul 06, 2008 at 07:58:48PM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; 
&gt; Yes you are right I  tried swaks and it worked from the lan but not
&gt; anywhere else as you can see below
&gt; 
&gt; [root@station1 ~]#  perl swaks -a -tls -q HELO -s linuxamd.com -au joey
&gt;   -ap xxxxxxxx
&gt; === Trying linuxamd.com:25...
&gt; <strong>*</strong> Error connecting 0.0.0.0 to linuxamd.com:25:
&gt; <strong>*</strong>     IO::Socket::INET: connect: timeout
</pre>

<p>
That's <em>really</em> interesting. Why is it saying '0.0.0.0' in the error
line? Is your remote host misconfigured? The above connection works just
fine for me when I try it.
</p>

<p>
<pre class='code'>
ben@Tyr:~$ swaks -a -tls -q HELO -s linuxamd.com -au joey -ap '&lt;&gt;'
=== Trying linuxamd.com:25...
=== Connected to linuxamd.com.
&lt;-  220 linuxamd.com ESMTP Sendmail 8.13.8/8.13.8; Mon, 7 Jul 2008 06:13:24 -0700
 -&gt; EHLO localhost
&lt;-  250-linuxamd.com Hello 190.sub-70-220-252.myvzw.com [70.220.252.190], pleased to meet you
&lt;-  250-ENHANCEDSTATUSCODES
&lt;-  250-PIPELINING
&lt;-  250-8BITMIME
&lt;-  250-SIZE
&lt;-  250-DSN
&lt;-  250-ETRN
&lt;-  250-STARTTLS
&lt;-  250-DELIVERBY
&lt;-  250 HELP
 -&gt; STARTTLS
&lt;-  220 2.0.0 Ready to start TLS
=== TLS started w/ cipher DHE-RSA-AES256-SHA
 ~&gt; EHLO localhost
&lt;~  250-linuxamd.com Hello 190.sub-70-220-252.myvzw.com [70.220.252.190], pleased to meet you
&lt;~  250-ENHANCEDSTATUSCODES
&lt;~  250-PIPELINING
&lt;~  250-8BITMIME
&lt;~  250-SIZE
&lt;~  250-DSN
&lt;~  250-ETRN
&lt;~  250-AUTH LOGIN PLAIN
&lt;~  250-DELIVERBY
&lt;~  250 HELP
 ~&gt; QUIT
&lt;~  221 2.0.0 linuxamd.com closing connection
=== Connection closed with remote host.
</pre>


<pre>
&gt;  From what I am seeing I am wondering what I am missing its obviously
&gt; something at the network level restricting me from authenticating from
&gt; anywhere else my sendmail.mc is nothing unusual all I changed were the
&gt; lines:
</pre>

<p>
Again, since this is at the network level, it doesn't have anything to
do with your mail system. I can connect to linuxamd.com and send mail
via telnet (you'll see a test message from me in your in-box); that's
not the issue. Again, it may be your remote host - especially if you've 
been using the same "outside" machine for all your testing.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Mon, 07 Jul 2008 06:45:57 -0700</b>
</p>

<p>
Ben Okopnik wrote:
</p>

<p>
 
</p>

<pre>
&gt; Again, since this is at the network level, it doesn't have anything to
&gt; do with your mail system. I can connect to linuxamd.com and send mail
&gt; via telnet (you'll see a test message from me in your in-box); that's
&gt; not the issue. Again, it may be your remote host - especially if you've 
&gt; been using the same "outside" machine for all your testing.
</pre>

<p>
 
</p>

<p>
That must be it I have been using the same system here I will be able to
use a different machine in a couple of hours. The system I have been
using is my laptop and it does have a rather strange adaptive firewall
enabled on it. I have seen your telnet email in my inbox. I never
suspected it to be my laptop. Although I will test it further at the
college. Thanks you have been a great help. I will let you know what 
happens both when from a different machine and with my firewall rules 
flushed.
</p>

<p>
Best,
</p>

<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Mon, 7 Jul 2008 12:33:01 -0400</b>
</p>

<p>
On Mon, Jul 07, 2008 at 06:45:57AM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; Ben Okopnik wrote:
&gt; 
&gt; &gt; 
&gt; &gt; Again, since this is at the network level, it doesn't have anything to
&gt; &gt; do with your mail system. I can connect to linuxamd.com and send mail
&gt; &gt; via telnet (you'll see a test message from me in your in-box); that's
&gt; &gt; not the issue. Again, it may be your remote host - especially if you've 
&gt; &gt; been using the same "outside" machine for all your testing.
&gt; 
&gt; That must be it I have been using the same system here I will be able to
&gt; use a different machine in a couple of hours. The system I have been
&gt; using is my laptop and it does have a rather strange adaptive firewall
&gt; enabled on it. I have seen your telnet email in my inbox. I never
&gt; suspected it to be my laptop. Although I will test it further at the
&gt; college. Thanks you have been a great help. I will let you know what 
&gt; happens both when from a different machine and with my firewall rules 
&gt; flushed.
</pre>

<p>
I'd also look very carefully at what your laptop uses as its IP address;
that '0.0.0.0' as the source address made me very suspicious.
</p>

<p>
Glad to have been of help, Joey!
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Joey Prestia [joey at linuxamd.com]

</p>
</b><br />
<b>Mon, 07 Jul 2008 10:21:45 -0700</b>
</p>

<p>
Ben Okopnik wrote:
</p>

<pre>
&gt; On Mon, Jul 07, 2008 at 06:45:57AM -0700, Joey Prestia wrote:
&gt;&gt; Ben Okopnik wrote:
&gt;&gt;
&gt;&gt;&gt; Again, since this is at the network level, it doesn't have anything to
&gt;&gt;&gt; do with your mail system. I can connect to linuxamd.com and send mail
&gt;&gt;&gt; via telnet (you'll see a test message from me in your in-box); that's
&gt;&gt;&gt; not the issue. Again, it may be your remote host - especially if you've 
&gt;&gt;&gt; been using the same "outside" machine for all your testing.
&gt;&gt; That must be it I have been using the same system here I will be able to
&gt;&gt; use a different machine in a couple of hours. The system I have been
&gt;&gt; using is my laptop and it does have a rather strange adaptive firewall
&gt;&gt; enabled on it. I have seen your telnet email in my inbox. I never
&gt;&gt; suspected it to be my laptop. Although I will test it further at the
&gt;&gt; college. Thanks you have been a great help. I will let you know what 
&gt;&gt; happens both when from a different machine and with my firewall rules 
&gt;&gt; flushed.
&gt; 
&gt; I'd also look very carefully at what your laptop uses as its IP address;
&gt; that '0.0.0.0' as the source address made me very suspicious.
&gt; 
&gt; Glad to have been of help, Joey!
</pre>

<p>
 
</p>

<p>
Well I'm wondering if this is due to 
<a href="http://www.sendmail.org/tips/pathmtu">http://www.sendmail.org/tips/pathmtu</a> the MTU packet size being a 
possible problem. Here at the school we have a real rack mount router 
and the wireless networks at home are all on those linksys wrt54G's 
plastic toys the wireless access points we use here are the same but we 
use them buy plugging them in as a switch to utilize our own DHCP server 
to hand out IP's so they're not doing any routing. So I am having no 
problem relaying from here and telnet works fine again. I'm still 
intrigued by what would cause such a thing. Thanks again.
</p>

<p>
Best,
</p>


<pre>-- 
Joey Prestia
L. G. Mirror Coordinator
<a href="http://linuxamd.com">http://linuxamd.com</a>
Main Site <a href="http://linuxgazette.net">http://linuxgazette.net</a>
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ren&eacute; Pfeiffer [lynx at luchs.at]

</p>
</b><br />
<b>Mon, 7 Jul 2008 20:28:39 +0200</b>
</p>

<p>
On Jul 07, 2008 at 1021 -0700, Joey Prestia appeared and said:
</p>

<pre>
&gt; [...]
&gt; Well I'm wondering if this is due to=20
&gt; <a href="http://www.sendmail.org/tips/pathmtu">http://www.sendmail.org/tips/pathmtu</a> the MTU packet size being a=20
&gt; possible problem.
</pre>

<p>
You can check this (or look for MTUs on a specific path) by using the
tracepath tool.
</p>

<pre>
nightfall:~# tracepath -h
Usage: tracepath [-n] &lt;destination&gt;[/&lt;port&gt;]
nightfall:~#
</pre>

<p>
On Debian-based systems it's the iputils-tracepath package. However TCP
usually detects the path MTU and adapts accordingly.
</p>

<p>
Best,
Ren&eacute;.
</p>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Mon, 7 Jul 2008 15:06:52 -0400</b>
</p>

<p>
On Mon, Jul 07, 2008 at 10:21:45AM -0700, Joey Prestia wrote:
</p>

<pre>
&gt; 
&gt; Well I'm wondering if this is due to 
&gt; <a href="http://www.sendmail.org/tips/pathmtu">http://www.sendmail.org/tips/pathmtu</a> the MTU packet size being a 
&gt; possible problem. 
</pre>

<p>
Unless you have a specific reason for suspecting the MTU, I'd stick with
tracking down and solving the problems you already know about. Besides,
here's what MTU discovery looks like for your host:
</p>

<p>
<pre class='code'>
ben@Tyr:~$ sudo hping2 --icmp --count 5 --data 1472 --dontfrag linuxamd.com
HPING linuxamd.com (ppp0 70.167.208.132): icmp mode set, 28 headers + 1472 data bytes
1500 bytes from 70.167.208.132: icmp_seq=0 ttl=48 id=17868 rtt=449.6 ms
1500 bytes from 70.167.208.132: icmp_seq=1 ttl=48 id=17870 rtt=452.2 ms
1500 bytes from 70.167.208.132: icmp_seq=2 ttl=48 id=17872 rtt=509.1 ms
1500 bytes from 70.167.208.132: icmp_seq=3 ttl=48 id=17874 rtt=506.1 ms
1500 bytes from 70.167.208.132: icmp_seq=4 ttl=48 id=17876 rtt=498.0 ms
 
--- linuxamd.com hping statistic ---
5 packets tramitted, 5 packets received, 0% packet loss
round-trip min/avg/max = 449.6/483.0/509.1 ms
Press any key to continue...
ben@Tyr:~$ sudo hping2 --icmp --count 5 --data 1473 --dontfrag linuxamd.com
HPING linuxamd.com (ppp0 70.167.208.132): icmp mode set, 28 headers + 1473 data bytes
 
--- linuxamd.com hping statistic ---
5 packets tramitted, 0 packets received, 100% packet loss
round-trip min/avg/max = 0.0/0.0/0.0 ms
</pre>

<p>
Your routers pass 1500-byte packets - which is a standard MTU. Don't go
chasing ghosts. <img src="../gx/smile.png" alt=":)">
</p>


<pre>
&gt; Here at the school we have a real rack mount router 
&gt; and the wireless networks at home are all on those linksys wrt54G's 
&gt; plastic toys the wireless access points we use here are the same but we 
&gt; use them buy plugging them in as a switch to utilize our own DHCP server 
&gt; to hand out IP's so they're not doing any routing. So I am having no 
&gt; problem relaying from here and telnet works fine again. I'm still 
&gt; intrigued by what would cause such a thing. Thanks again.
</pre>

<p>
Perhaps misconfigured network settings on the laptop? Sounding more and
more like it all the time.
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p><p>
<b><p>
Ben Okopnik [ben at linuxgazette.net]

</p>
</b><br />
<b>Mon, 7 Jul 2008 15:24:24 -0400</b>
</p>

<p>
On Mon, Jul 07, 2008 at 08:28:39PM +0200, Ren&eacute; Pfeiffer wrote:
</p>

<pre>
&gt; On Jul 07, 2008 at 1021 -0700, Joey Prestia appeared and said:
&gt; &gt; [...]
&gt; &gt; Well I'm wondering if this is due to 
&gt; &gt; <a href="http://www.sendmail.org/tips/pathmtu">http://www.sendmail.org/tips/pathmtu</a> the MTU packet size being a 
&gt; &gt; possible problem.
&gt; 
&gt; You can check this (or look for MTUs on a specific path) by using the
&gt; tracepath tool.
&gt; 
&gt; nightfall:~# tracepath -h
&gt; Usage: tracepath [-n] &lt;destination&gt;[/&lt;port&gt;]
&gt; nightfall:~# 
&gt; 
&gt; On Debian-based systems it's the iputils-tracepath package. However TCP
&gt; usually detects the path MTU and adapts accordingly.
</pre>

<p>
As I recall, MTU discovery 1) is done via ICMP and 2) uses the "don't
fragment" flag. The problems appear when intermediate routers have a
too-small MTU set. The only reason I remember this is because I ran into
it just as cheap user-end routers started appearing on the market - and
one of them (Cisco, maybe? I don't recall exactly) gave me a
nightmarishly-hard time at a client's place. I could ping between the
two hosts, I could telnet from one to the other... but their security
camera feed wouldn't work. I thought I was going to lose my mind on that
job.
</p>

<p>
(I realize that there will be the inevitable "So when <strong>did</strong> it happen?"
questions, but I'll save that story for another day.)
</p>


<pre>-- 
* Ben Okopnik * Editor-in-Chief, Linux Gazette * <a href="http://LinuxGazette.NET">http://LinuxGazette.NET</a> *
</pre>

<p>

</p>
<br /><a href="#top">Top</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="../../lg_mail.html#mb-smtp_auth_problem">Back</a><hr width="50%" align="left" /><p><br /></p></div>
</body>
</html>
