<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="utf-8" xml:lang="utf-8">
<head>
<title>Sending and Receiving SMS from your Linux Computer LG #164</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../lg.css" type="text/css" media="screen, projection"  />
<link rel="alternate" type="application/rss+xml" title="LG RSS" href="lg.rss" />
<link rel="alternate" type="application/rdf+xml" title="LG RDF" href="lg.rdf" />
<!-- link rel="alternate" type="application/atom+xml" title="LG Atom" href="lg.atom.xml" / -->
<link rel="shortcut icon" href="../favicon.ico" />

<style type="text/css" media="screen, projection">
<!--

-->
</style>

</head>
<body>

<a href="../">
<img src="../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
</a>
<p id="fun">...making Linux just a little more fun!</p>

<div id="navigation">
<table summary="masthead" width="100%">
<tr>
<td align="center" colspan="3" style="font-size: 10px; font-weight: bold">
<a href="../index.html">Home</a>
<a href="http://linuxgazette.net">Main Site</a>
<a href="../faq/index.html">FAQ</a>

<a href="../lg_index.html">Site Map</a>
<a href="../mirrors.html">Mirrors</a>
<a href="../mirrors.html">Translations</a>
<a href="../search.html">Search</a>
<a href="../archives.html">Archives</a>
<a href="../authors/index.html">Authors</a>
<a href="http://lists.linuxgazette.net/mailman/listinfo/">Mailing Lists</a>
<a href="../jobs.html">Join Us!</a>
<a href="../contact.html">Contact Us</a>

<hr width="99%" style="border: 1px inset #000033">
</td>
</tr>
<tr>
<td width="40%" align="left" style="font-size: 10px; font-weight: bold">
The Free International Online Linux Monthly
</td>
<td width="20%" align="center" style="font-size: 10px; font-weight: bold">
ISSN: 1934-371X
</td>
<td width="40%" align="right" style="font-size: 10px; font-weight: bold">
Main site: <a href="http://linuxgazette.net">http://linuxgazette.net</a> 
</td>
</table>
</div>


<div id="breadcrumbs1">

<a href="../index.html">Home</a> &gt; 
<a href="index.html">July 2009 (#164)</a> &gt; 
Article

</div>

<div class="articlecontent1">
<div class="content">

<div id="previousnexttop">
<A HREF="silva.html" >&lt;-- prev</A> | <A HREF="ecol.html" >next --&gt;</A>
</div>

<h1>Sending and Receiving SMS from your Linux Computer</h1>
<p id="by"><b>By <a href="../authors/tomar.html">Suramya Tomar</a></b></p>


<p>What
is SMS? SMS stands for Short Message Service and is used to send text
messages from one GSM enabled cell phone to another. But sometimes
you might want to send an SMS message using your computer. Now there
are three ways that you can send an SMS from a computer: 

<OL>
	<LI>Use
	a SMS gateway service that allows your computer to connect to it
	using an API and send messages. There are a lot of these services
	available on the web but most are not free and require subscriptions</li>
	<LI>Use
	a cell-phone/GPRS Modem connected to the computer.</li>
	
	<LI>Some service providers allow you to send SMS to a number by sending an
	email to a specifically formated email address. </li>
	
</OL>


<p>I
choose to use the second option because my
provider doesn't support the last option and I think its cheaper than option one. All you need for this to
work is an extra phone and a cheap phone plan that allows you to send
and receive SMS's. In my case I had an old Sony Ericsson T610 lying
in my desk gathering dust so I got a pre-paid SIM card and I was
ready to proceed.


</p><h3>Pre-Installation
Steps </h3>



<p>The
first thing you need is to connect your cellphone to your computer. I
recommend using Bluetooth for it because that way there is one less
cable you have to worry about on your desk but you can use a USB
cable to connect if your phone doesn't support Bluetooth. 



</p><p>If
you are using Bluetooth to connect then you will need to Pair the
phone and the computer and  configure the phone to allow your
computer to connect to it without authorization. The steps for this
differ from phone to phone so you will have to check the manual for
the exact steps to follow.


</p><p>Once
we have the phone configured to auto-accept connections we are ready
to proceed. Now in order to allow your computer to talk to your phone
you will have to install a modem driver for mobile phones on your
computer called gnokii. The steps for this are explained below

</p><h3>Installing
gnokii</h3>

<p>
To install gnokii on a
Debian system run the following command as root:

<pre class='code'>apt-get install gnokii
</pre>


<p>
This will download and
install gnokii on your computer. Most of the other distributions
should also have  an installer package available for download but
in-case your distribution doesn't then you can always compile and
install it from source.

</p><p>
To install from source you will need to download the latest version of gnokii from the
project website( <A HREF="http://www.gnokii.org/download/gnokii/">http://www.gnokii.org/download/gnokii/</A>). 

</p><p>
Once we have the latest
version of the source we can install it on our system. To do that we
must first uncompress the archive so issue the following command: 


<pre class='code'>tar -zxf gnokii-0.6.27.tar.gz</PRE>

<p>
Once tar finishes
uncompressing the archive change to the gnokii directory using the
following command: 

<PRE class='code'>cd gnokii-0.6.27/</PRE>

<p>
Now if you are connecting your phone to your computer using Bluetooth you will need
to install the libbluetooth-dev library first by issuing the following command as root:</p>

<PRE class='code'>apt-get install libbluetooth-dev</pre>

<p>Once the library is installed you can configure the gnokii installer using the following
command: </p>

<PRE class='code'>./configure --with-bluetooth=/usr/include/bluetooth</pre>

<p>If you are not using Bluetooth then you will have to use the following command instead:
</p>

<PRE class='code'>./configure </pre>

<p>Once the configuration is complete and you donâ€™t see any errors compile
gnokii by running the following command: 

<PRE class='code'>make</PRE>

<p>If the compile finishes
without errors install gnokii by running the following command as
root:  

<PRE class='code'>make install</PRE>

<p>After gnokii finishes installing you will have to configure it before you can start using it.</p>

<h3>Configuring gnokii</h3>

<p>A
sample configuration file for gnokii is provided in the source file
under the <i>Docs/sample/</i> subdirectory in the directory where you
extracted the gnokii source. If you installed gnokii using apt-get
then the sample file is installed at <i>/etc/gnokiirc</i>

</p><p>The
easiest way to configure gnokii is to modify the sample configuration
file so we start by copying the sample configuration to your home
directory using the following command:
<PRE class='code'>cp gnokii-0.6.27/Docs/sample/gnokiirc ~/.gnokiirc</pre>

<p>and open it in your favorite text editor for editing. The first thing you
need to do is tell gnokii what phone you are using by setting the
'model' variable according to the matrix below:</p>

<UL>
	<LI>Set
	model = series40, if you have Nokia non-Symbian Series60 phone</LI>
	<LI>Set
	model = gnapplet, if you have Nokia Symbian Series60 prior to 3rd
	Edition phone</LI>
	<LI>Set
	model = AT, for all other phones. </LI>
</UL>

<p>In
my case I set it to AT.

</p><p>Next,
you need to tell gnokii how your phone is connected to the computer.
For this you will have to change the 'connection', 'port' and
'rfcomm_channel' variables.
</p><p>If
you are using Bluetooth to connect then set the connection variable
to 'bluetooth' and the port variable to your phone's Bluetooth
address as shown below:
<PRE class='code'>
connection = bluetooth
port = 00:1e:3a:7e:a5:1f
</pre>

<p>
According to the manual
the 'rfcomm_channel' can be omitted as its auto-detected but I had to
explicitly set it to get gnokii to connect. 

</p><p>
Most of the phones use
rfcomm_channel=1 but for my Nokia N95 8GB I had to set it to 2 while
the Sony Ericsson T610 used rfcomm_channel=1. If you are not sure
then you can use '<CODE>sdptool search SP'</CODE> or '<CODE>sdptool
search DUN'</CODE> or '<CODE>sdptool browse'</CODE> to find the right
channel for your phone. 

</p><p>
If you are using USB to
connect then the connection name depends on the type of cable you are
using and the phone model. Some values you can try are 'connection =
serial' to use the AT protocol and 'connection = dku2libusb' to use
the FBUS protocol (if supported by cable and phone).  

</p><p>
The port name also
depends on the type of the cable: some cables create a /dev/ttyACM0,
others create a /dev/ttyUSB0. When using connection = dku2libusb,
port = 1 chooses the first phone, port = 2 the second, and so on. See
/var/log/messages to identify the port the phone connects on.

</p><p>
After you make the
changes and save the file you are ready to test the connection.

<h3>Testing gnokii
connection to phone</h3> 

<p>
At a command prompt run
the following command:

<pre class='code'>
gnokii --identify
</pre>


<p>
If you have configured
everything correctly then you will see an output listing your phone
model like the following:

<PRE class='code'>
suramya@Wyrm:~$ gnokii --identify
GNOKII Version 0.6.9
IMEI         : 35954XXXXXXXXXX
Manufacturer : Nokia
Model        : Nokia N95 8GB
Revision     : V06wk41v46.1
</PRE>
	
<p>
If you don't see this
output then gnokii wasn't able to connect to your phone. Make sure
that your phone is accepting bluetooth connections, you have the
correct model specified and that you are trying to connect to the
correct address using the correct protocol.

</p><p>
If you still are not
able to connect then you should enable the debug mode in gnokii by
setting <code>'debug = on'</code> (Without the quotes) in ~/.gnokiirc. Looking at the debug output will
let you identify the problem and rectify it.

<h3>Sending
an SMS from your computer</h3>

<p>
Once you have
configured gnokii correctly and get the above output you are ready to
send SMS's from your computer.  The command to send an SMS is:

<Pre class='code'>
	gnokii --sendsms <I>destination_number</I>
</pre>

<p>
This command will take the SMS content from the standard input. For example the transcript
of sending a SMS to 555-123-4567 will look something like this:
</p><p>

<Pre class='code'>
suramya@Wyrm:~$ gnokii --sendsms  5551234567
GNOKII Version 0.6.9
Please enter SMS text.
End your input with &lt;cr&gt;&lt;control-D&gt;:This is a test message

Send succeeded!
suramya@Wyrm:~$
</PRE>

<p>
gnokii has loads of
other functionality. Use gnokii --help to get a list of parameters
and functionality.

</p><p>
Now that you have the
connection working you are only limited by your imagination as to how
you use this. I built a gateway that allows me to send an SMS by
sending an email to a specific email address. This program is
described in more detail below.

<h3>Sending SMS using specially formated Emails</h3>

<p>
To send an SMS when I
receive a specifically formated email I needed to write a program
that checks for new emails and then processes them. I used Perl for
this as its great for text processing and I had already written part
of the code for another project (sending/receiving IM's as email.)

</p><p>
The first thing I
needed was a new email account that I could access using POP3. Since
I have my own domain I logged on to my domains admin section and
created a new email address but you can use gmail if you want.

</p><p>
In my code I assume
that the phone # to which I am sending an SMS to is in the subject of
the email sent and the body of the SMS is the actual body of the
email. 

</p><p>
The code to connect and download the email is simple:

<PRE class='code'>
    $pop3 = Net::POP3-&gt;new($ServerName);                # Connect to email server
       die "Couldn't log on to server" unless $pop3;

    $Num_Messages = $pop3-&gt;login($UserName, $Password); # Login to the server and get No of messages
      die "Couldn't log on to server" unless $pop3;

    $Messages = $pop3-&gt;list();                          # Get message list
     
    foreach $msg_id (keys(%$Messages))
    {
        $MsgContent = $pop3-&gt;top($msg_id, 40);
        ProcessEmail(@$MsgContent);
        $pop3-&gt;delete ($msg_id);
    }
</PRE>

<p>
In the code above we connect to the email server, download the list of new emails and then download each email in
a loop, process them and then delete the message. 

</p><p>
All the processing work is done in the ProcessEmail(). In this function we first extract the 'From'
name from the email (this is appended to the SMS so that the recipient knows who sent it).

<pre class='code'>
  my (@lines) = @_;
  my $body_start =FALSE;
  $sms_body = "";

  # Declare local variables
  my ($from, $line, $sms_to  );

  # Check each line in the header
  foreach $line (@lines)
  {
    if($line =~ m/^From: (.*)/)
    {
       # We found the "From" field, so let's get what we need
       $from = $1;
       $from =~ s/"|<.*>//g;
       $from = substr($from, 0, 39);				# This gives us the 'From' Name
   }
</pre>

<p>
Once we have the 'From'
field we extract the subject from the email and make sure its a phone number
(This number can be prefixed with a + for country codes). If its not a number then we ignore the email and
abort. The code for this is shown below:

<pre class='code'>
   elsif( $line =~ m/^Subject: (.*)/)
   {
       # We found the "Subject" field. This contains the No to send the SMS to.

       $sms_to   = $1;
       $sms_to = substr($sms_to, 0, 29);

       if ($sms_to =~ /^[+]?\d+$/ )   # here we check if the subject is a no. If so we proceed.
       {
           print "Got email. Subject is a number. Processing further\n";
       }
       else                           # Otherwise we delete the message and ignore it.
       {
            print "Got email. Subject is NOT a number. Ignoring it. \n";
            return;
       }
   }
</pre>

<p>
Finally we extract the body from the email. This becomes the body of the SMS message

<PRE class='code'>
   # This is the last line in the email header; after this the body starts
   elsif(( $line =~ m/^Envelope-To:/)||($body_start eq TRUE)) 
   { 
	   if($body_start ne FALSE)
	   {
		   $sms_body = $sms_body . $line;
	   }

	   $body_start=TRUE;
   }
</pre>

<p>
Now we have all the
required components for sending the SMS: Destination Number, SMS Body
and the From address so we are ready to send the SMS. However since we can only
send a max of 160 chars in one message we need to make sure that the SMS body is broken down into 160 char chunks before we 
can send the SMS

<pre class='code'>
  my @stringChunksArray = ($sms_body =~ m/(.{1,160})/gs);
  for($i=0;$i&lt;@stringChunksArray;$i++)
  {
   # Start gnokii and wait for the SMS body
   open(GNOKII, "| gnokii --sendsms $sms_to") || die "Error starting gnokii failed: $!\n";
   print GNOKII $stringChunksArray[$i];      # Print the SMS body in 160 Char chunks
   close(GNOKII);
   # This is there so that the phone gets time to reset after each message;
   # otherwise the send fails
   sleep(10);
  }
</pre>

<p>
The complete source code for Email2SMS is available for download <a href='misc/tomar/Email2SMS.pl'>here</a>.

<h3>Receiving
SMS messages on your computer</h3>

</p><p>
The ability to receive
messages on your computer depends on the phone you are using as not
all phones are completely supported by gnokii. According to the
project website most Nokia phones from the 3110/3180, 5110/6110,
7110/6210 and 6510/6310 series are supported well. Unfortunately the
AT support in the Symbian OS is very limited so very basic
functionality is supported on these phones. More details on supported
phone models is available at the <a href='http://wiki.gnokii.org/index.php/Config'>project site</a>.

</p><p>
To my sorrow I was
unable to read SMS messages from both my Nokia N95 and T610 phones using gnokii. I
only managed to get the system to send SMS messages from these
phones. 

</p><p>
If your phone is
supported then you can read a SMS message on the phone by issuing the
following command:

<PRE class='code'>
gnokii --getsms <I>MemoryType</I> <I>Start</I> [end]       
</pre>

<p>
Memory type tells
gnokii where to read the SMS from. Most phones support only a limited
subset of memory types. To get a list of supported memory types use
the following command:


<pre class='code'>gnokii --showsmsfolderstatus</pre>

<p>
Some Possible values
are:
<UL>
	
	<LI>
	ME:	Internal Phone
	memory 
	</li>
	<LI>
	SM:	SIM card 
	</li>
	<LI>
	MT:     Combined ME
	and SIM phonebook 
	</li>
	<LI>
	CB:     Currently
	selected memory 
	</li>
</UL>

<p>
To read all the SMS's
on the phones internal memory to the standard display issue the
following command:

<PRE class='code'>
gnokii --getsms ME 1 end       
</pre>

<p>Another
interesting option for reading SMS is --smsreader which will wait for
incoming messages and saves them into a mailbox under /tmp/sms/*
(actual filename varies). In this case the messages are never saved on the phone. 



<h3>Conclusions</h3>

<p>Now
that you have your phone connected to your computer you can have your
computer SMS you when a certain criteria like a particular incoming email, or when you have an important appointment coming up.
You can have it wait for a message and then initiate a call to a specific number and play a wave file to the
phone. All you are limited by now is your imagination and the capabilities of your phone. 

</p><p>I am interested in hearing about any projects that you might build
based on this article so if you have an interesting project idea do
contact me.


<br clear="all" />

<script type='text/javascript'>
digg_url = 'http://linuxgazette.net/164/tomar.html';
digg_title = 'Sending and Receiving SMS from your Linux Computer';
digg_bodytext = '<p>What is SMS? SMS stands for Short Message Service and is used to send text messages from one GSM enabled cell phone to another. But sometimes you might want to send an SMS message using your computer.</p>';
digg_topic = 'linux_unix';
</script>
<script src="http://digg.com/tools/diggthis.js" type="text/javascript"></script>


<p class="talkback">
Talkback: <a
href="mailto:tag@lists.linuxgazette.net?subject=Talkback:164/tomar.html">Discuss this article with The Answer Gang</a>
</p>

<!-- *** BEGIN author bio *** -->
<!-- *** BEGIN bio *** -->
<hr>
<p>
<img align="left" alt="Bio picture" src="../gx/2002/note.png" class="bio">

<!-- 
If the author has sent his pic, save it to the right directory
and enable the line below.

<img align="left" alt="Bio picture" src="../gx/authors/pic.jpg" class="bio">

-->

<em>

<p> I was born in 1980 in a small Air Force hospital in Hashimara, India. I
then spent the next 18 years of my life all over India during which I had
the pleasure of attending 7 schools to complete 12 years of schooling.

<p> I started using Linux in late 1999 when a friend lent me a Redhat 7.1
installation CD and another friend 'donated' a 6GB harddisk. This was right
after my Win98 had crashed for the nth time so I decided to give Linux a
shot. I tried it and got hooked almost instantly. Over the next 2 years I
upgraded to Redhat 7.3 but when Redhat decided to stop support for RH 7.3 I
switched to Debian and have been living happily ever since.

<p> I like to program a lot and have recently figured out how to decipher 
the jumble of characters some people like to call Perl and found that I
actually like it. For websites I like using PHP with MySQL backends and can
program with C, C++, VB and .Net. I am also very interested in computer
security and Artificial Intelligence and try to read as much on
these topics as I can.

<p> Other than working on the computer I like reading (mainly Fantasy and
Science Fiction but I will read anything except romance novels), listening
to music (fav singers include: Shania Twain, In-Grid, Crystal Waters) and
taking stuff apart to see how it works.

<p> If you are really bored and want to learn more about me then feel free to
visit my website at: <a 
href="http://www.suramya.com">http://www.suramya.com</a> where you will find 
more info about me than you ever wanted to know.

</em>
<br clear="all">
<!-- *** END bio *** -->

<!-- *** END author bio *** -->

<div id="articlefooter">

<p>
Copyright &copy; 2009, Suramya Tomar. Released under the <a
href="http://linuxgazette.net/copying.html">Open Publication License</a>
unless otherwise noted in the body of the article. Linux Gazette is not
produced, sponsored, or endorsed by its prior host, SSC, Inc.
</p>

<p>
Published in Issue 164 of Linux Gazette, July 2009
</p>

</div>

<div id="previousnextbottom">
<A HREF="silva.html" >&lt;-- prev</A> | <A HREF="ecol.html" >next --&gt;</A>
</div>

</div>
</div>

<script src="http://www.google-analytics.com/urchin.js"
type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-1204316-1";
urchinTracker();
</script>







<img src="../gx/tux_86x95_indexed.png" id="tux" alt="Tux"/>

</body>
</html>

