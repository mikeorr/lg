<html>
<head>
<link href="../../lg.css" rel="stylesheet" type="text/css" media="screen, projection"  />
<title>The Answer Gang: LG 106: Parent and Child</title>

<style type="text/css" media="screen, projection">
<!--
.articlecontent {
        position:absolute;
        top:143px;
}
-->
</style>
</head>
<body>
<img src="../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
<p id="fun">...making Linux just a little more fun!</p>


<div class="content articlecontent">

<div id="previousnexttop">
<A HREF="../lg_tips.html" >&lt;-- 2c Tips</A> 
| <A HREF="../lg_answer.html">TAG Index</a> | <A HREF="1.html">1</a> | <A HREF="2.html">2</a> | <A HREF="3.html">3</a> | <A HREF="4.html">4</a>
| <a href="../../tag/kb.html">Knowledge Base</a>
| <A HREF="../lg_bytes.html" >News Bytes --&gt;</A>
</div>



<h1 align="center"><IMG SRC="../../gx/dennis/qbubble.gif" align="left"> The Answer Gang <IMG SRC="../../gx/dennis/bbubble.gif" align="right"></h1>

<p align="center">By Jim Dennis, Karl-Heinz Herrmann, Breen, Chris, and... 
	(<A HREF="../../tag/bios.html">meet the Gang</A>) ... 
	the Editors of <I>Linux Gazette</I>... and 
	<a href="../../tag/members-faq.html">You</a>!</p>
<br clear="both">
<HR>
<!-- begin 3 -->
<H3 align="left"><img src="../../gx/dennis/bbubble.gif" 
	height="50" width="60" alt="(!) " border="0"
	>Parent and Child</H3>
<H4 ALIGN="center">The birth and death of linux processes</H4>


<p><strong>From tag
</strong></p> 
<p></strong></p>
<!-- ::
Parent and Child
~~~~~~~~~~~~~~~~
The birth and death of linux processes
:: -->

<p align="right"><strong>Answered By:  Jim Dennis, Heather Stern
</strong></p>

<font color="#000066"><blockquote><IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Heather] Jim handed me a rough sketch earlier this month, and I figured the
resulting discussion would be worthy of our readers.
</blockquote></font>
<P><STRONG>
Once again, I'm teaching a class on shell and Linux basics to a group
and after many years of doing it I'm really getting tired of drawing the
same old pictures on the whiteboard or flipsheets.
</STRONG></P>
<P><STRONG>
What we need is a nice drawing of this, something animated.  Maybe you
could whip something up in Flash, and tuck yet another feather in the
webmastery cap?
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Heather] 
Well, poking around for Flash on <A HREF="http://www.freshmeat.net/">Freshmeat</A>.net finds a few zillion apps,
(Ha, only 120. I've gotten worse from single keyword searches before.)
Some have nothing to do with a certain media format at all... flash
cards, flash RAM 
<IMG SRC="../../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle">
</blockQuote>
<blockQuote>
Now tossing out all the things that are apps written in Flash, libraries
to make it work at all, and front-ends for the Flash viewer
we have... ahhh... Generators won't do, I want this to have our images
in it. Dancing text alone is worse than the old MARQUEE and BLINK tags.
Oh, there we go.  Some alpha quality sourceforge projects to convert
various formats into flash.
</blockQuote>
<blockQuote>
Package system search time.  <EM>bzzzt</EM>   Hmm, guess I'll have to fetch the
sources and debug why they don't just '<TT>./configure;</TT> make; make install'
in my copious spare time.
</blockQuote>
<blockQuote>
<TT>/me</TT> buys Wilbur the GIMP some coffee, munches on a few doughnuts, and
jumps merrily back into the world of animated GIFs.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Ok.  So here's what I envision,  About 12 slides, on a roughly square
picture, as follows.
</STRONG></P>
<P><STRONG>
1) initial process.
A rectangle somewhat toward the mid-upper left, saying "process"
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> [Heather] 
Well, if it's going to be a little mini movie, it needs a title, so
let's start of with "The Process Model" and have the word "process"
wander up there.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
2) system call.
</STRONG></P>
<P><STRONG>
The giant word <TT> fork()</TT> appears over the process.
Transition: process memory map.
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
System calls look nice in a monospace font so we'll have that pop out at
the viewer, then fade out again as it highlights the edge of the
process.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
3) fork results.
</STRONG></P>
<P><STRONG>
Show the child - a similar sized process - seperating from the parent
and the two being labelled, parent and child.
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
The copying process shows a thinner dark blue rectangle moving to its
new location, then growing another process of the same size.  Looks very
spiffy.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
4) zoom!
</STRONG></P>
<P><STRONG>
Make the parent smaller and give the child most of the right hand
side of the picture.
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Zooming's a little more work, but I can do that.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
5) details.
</STRONG></P>
<P><STRONG>
The parent just says "parent", the child shows a memory map
breakdown. From bottom to top... environment, text (code),  BSS,
and sharing a space where each grows toward center - heap and stack.
</STRONG></P>
<P><STRONG>
6) system call.
The giant word <TT> exec()</TT> floats up...
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
I have a bit of fun with setting up the memory map, and this doodle you
offered me has the <TT> exec()</TT> coming off the stack/heap area.  I made it
come out of the text (code) area and it looks better as well as not
bumping into things.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
7) result point 1.
</STRONG></P>
<P><STRONG>
The process space is cleared entirely, except the environment. This
is, of course, the space which bash' "export" command moves variables
into so they will be inherited, just to bring up one clear example.
</STRONG></P>
<P><STRONG>
<IMG SRC="../../gx/dennis/smily.gif" ALT="8)" 
		height="24" width="20" align="middle"> result point 2.
</STRONG></P>
<P><STRONG>
The child now has its own fresh copies of the other parts, but
highlight the inherited environment.
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
I show a wash of green as the child process replaces the forked clone
with new material.  For you readers, in Linux the <TT> fork()</TT> is really just
a special case of the <TT> clone()</TT> system call, which can clone things a
number of ways.  Anyways, it's an easy highlight for the environment
this way, at least assuming the viewer isn't color blind.  Oops. I
didn't think of how to handle that.  I'll have to test with
desaturation... but let me finish the pictures first.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
9) zoom back out.
Bring the parent and child back to their previous sizes.
</STRONG></P>
<P><STRONG>
10) meanwhile...
</STRONG></P>
<P><STRONG>
The parent exhibits the <TT> wait()</TT> system call.  Now this could be
blocking, or not blocking, I can spend quite a while on this part,
but let's just make the drawing assume a blocking wait.
</STRONG></P>
<P><STRONG>
11) which waits until...
The child does an <TT> exit()</TT> call.
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
The <TT> wait()</TT> call actually needs to hang around while the child lives
since you're blocking, so <EM>scribble scribble</EM> that'll really read:
 <TT>wait()</TT> blocked.  I'll have to make the child do something brief and cute
(goodness knows what) then <TT> exit()</TT> leaving... uhh...
</blockQuote>
<blockQuote>
12) the child dies.
Highlight the parent, which unblocks as it catches a SIGCHLD signal.
</blockQuote>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
My first shot at this shows <TT> exit()</TT> turning into SIGCHLD, and the child
process' border fading out.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
That's not really right; init generates SIGCHLD after cleaning up most of
the mess.  And the dead child shouldn't hang around.  We'll need to show
the remaining process table, too.  Make the kernel float in from offside
so we can see that, perhaps.
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
My second shot (good enough for your first of several classes) shows the
child process decaying to a partial border, the word "child" becoming SIGCHLD,
and going into the <TT> wait()</TT> which clears.
</blockQuote>
<blockQuote>
Here's where the doodle breaks down, so time to re-doodle it, using
the facts.  The exit leaves a return code.  But as you and I know,
return codes aren't stored in the "dead body" of the child process.
It only exists as a zombie - an entry in the process table, which is
the only thing left of it after init sweeps away the main process. The
process table itself is in the kernel somewhere.  So I'm going to need to
plot where to sneak in a kernel page. (I imagine a bag of popcorn... 
<IMG SRC="../../gx/dennis/smily.gif" ALT=":D" 
		height="24" width="20" align="middle">
)  Doing that suggests having it show while the <TT> fork()</TT> is spawning the
child too, so I can show the process id changing, and the parent's id
assigned into ppid.
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Yes, that will work much better.  Let's get the animation between slides
in, then fix up the last part and it's good to go.  I found you a nice
gif to flash translator, which we can try on the resulting file for
grins.
</STRONG></P>
<P><STRONG>
I don't suppose GIMP can output flash yet?
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Oooh, I will need to google for that 
<IMG SRC="../../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle">   Probably not.  The GIMP's a
raster image editor, and SWF is a vector based format.  OTOH if the
converter you're talking about is any good, maybe it can be merged onto
the GIMP.
</blockQuote>
<blockQuote>
I'm sure there are more aspects of the process creation and lifecycle that
can be drawn.  I'm juggling a few things, but I'll post the drawing in
progress...
</blockQuote>
<P><STRONG>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Just stuff them in SysadMoin on the page TaosLinuxTraining, at least
at the moment.  When I'm happier with the parts you can split them up
into several images - one per stopping point in our final form. We'll
split the Process Model commentary onto a new page, and the world can
have some fun with it.
</STRONG></P>
<blockQuote>
<IMG SRC="../../gx/dennis/bbub.gif" ALT="(!)"
	HEIGHT="28" WIDTH="50" BORDER="0"
	> 
Wiki rocks.  Chalkboards and whiteboards of the world, unite!
</blockQuote>
<blockQuote>
Sysadmoin is our house wiki, used for our system administration natter.
(<A HREF="http://www.starshine.org/sysadmoin"
	>http://www.starshine.org/sysadmoin</A>) It's based on moinmoin, and I'm
pleased to say that our dark theme is actually part of the upstream
sources.  Very pleased, after all the trouble I went to in order to
<a href="MakeMoinMoinDark">http://www.starshine.org/sysadmoin/MakeMoinMoinDark</a>
in older revisions.  The moin people are very active in development,
so for this project at least, it's worth popping into #moin on freenode.
Helps to show up on European hours though.
</blockQuote>
<blockQuote>
Maybe I'll even post the xcf file and let people enjoy paging around in
it.  I realize xcf isn't readable by anythign but gimp, but that's where
the real animation lies, in the seperated frames.  
<IMG SRC="../../gx/dennis/smily.gif" ALT=":)" 
		height="24" width="20" align="middle">
</blockQuote>
<blockQuote>
For you dithering vidiots out there, frames of about 50 milliseconds distances
seem to be fairly smooth going, slower's a little more obvious but
somewhere between that and 140 ms are good for skidding to a halt.
Anything slower is painful.  Your eyeballs may vary, but recall that
american TV is about 24 or 28 frames a second, and more is better. 50ms
is a mere 20 frames per.  I just don't want my file to get too big.
</blockQuote>
<blockQuote>
For gimp folk specifically, adding (50ms)(replace) to the end of the
name of your frame gives fine grain control on the animation.  You could
use (combine) instead when you need it.  And gimp does let you resize
layers down again (it's tricky) which might save space in the result.
The last tip is that (50 ms) with a space doesn't do.  Leave the space
out.  (50ms) (replace) spaced does work though.
</blockQuote>
<blockQuote>
Share and enjoy...
</blockQuote>

<!-- end 3 -->
<hr>
<p><CENTER><Font face="Helvetica"><STRONG>
This page edited and maintained by the Editors of <I>Linux Gazette</I>
<br>HTML script maintained by
        <A HREF="mailto:star@starshine.org">Heather Stern</a> of
        Starshine Technical Services,
<A HREF="http://www.starshine.org/">http://www.starshine.org/</A></STRONG></Font></CENTER></p>
<hr>

<div id="articlefooter">
<p>
Each TAG thread <a href="http://linuxgazette.net/copying.html"
        >Copyright &copy;</a> its authors, 2004
</p>
<p>
Published in issue 106 of <I>Linux Gazette</I> September 2004
</p>
</div>


<div id="previousnextbottom">
<A HREF="../lg_tips.html" >&lt;-- 2c Tips</A> 
| <A HREF="../lg_answer.html">TAG Index</a> | <A HREF="1.html">1</a> | <A HREF="2.html">2</a> | <A HREF="3.html">3</a> | <A HREF="4.html">4</a>
| <a href="../../tag/kb.html">Knowledge Base</a>
| <A HREF="../lg_bytes.html" >News Bytes --&gt;</A>
</div>
</div>

<div id="navigation">
<a href="../../index.html">Home</a>
<a href="../../faq/index.html">FAQ</a>
<a href="../../lg_index.html">Site Map</a>
<a href="../../mirrors.html">Mirrors</a>
<a href="../../mirrors.html">Translations</a>
<a href="http://linuxgazette.net/search.html">Search</a>
<a href="../../archives.html">Archives</a>
<a href="../../authors/index.html">Authors</a>
<a href="../../contact.html">Contact Us</a>
</div>

<div id="breadcrumbs">
<a href="../../index.html">Home</a> &gt; 
<a href="../index.html">September 2004 (106)</a> &gt; 
<a href="../lg_answer.html">The Answer Gang</a> &gt; 
Thread
</div>

<img src="../../gx/2003/sit3-shine.7-2.gif" id="tux" alt="Tux"/>

</body>
</html>
