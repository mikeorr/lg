<html>
<head>
<link href="../../lg.css" rel="stylesheet" type="text/css" media="screen, projection"  />
<title>The Answer Gang: LG 122: DirectPad Joystick</title>

<style type="text/css" media="screen, projection">
<!--
.articlecontent {
        position:absolute;
        top:143px;
}
-->
</style>
</head>
<body>
<img src="../../gx/2003/newlogo-blank-200-gold2.jpg" id="logo" alt="Linux Gazette"/>
<p id="fun">...making Linux just a little more fun!</p>


<div class="content articlecontent">

<div id="previousnexttop">
<A HREF="../lg_tips.html" >&lt;-- 2c Tips</A> 
| <A HREF="../lg_answer.html">TAG Index</a> 
| <A HREF="1.html">1</a> | <A HREF="2.html">2</a> | <A HREF="3.html">3</a>
| <A HREF="4.html">4</a> 
| <a href="../../tag/kb.html">Knowledge Base --&gt;</A>
</div>



<h1 align="center">
<img src="../../gx/dennis/qbubble.gif" align="left"> The Answer Gang <img src="../../gx/dennis/bbubble.gif" align="right"></h1>

<p align="center">By Jim Dennis, Jason Creighton, Chris G, Karl-Heinz, and... 
	(<a href="../../tag/bios.html">meet the Gang</a>) ... 
	the Editors of <i>Linux Gazette</i>... and 
	<a href="../../tag/members-faq.html">You</a>!</p>
<br clear="all">
<hr>
<!-- begin 1 -->
<h3 align="left"><img src="../../gx/dennis/qbubble.gif" 
	height="50" width="60" alt="(?) " border="0"
	>DirectPad Joystick</h3>


<p><strong>From Triyan W. Nugroho 
</strong></p> 
<p><strong></strong></p>

<p align="right"><strong>Answered By:  Peter Knaggs
</strong></p>
<p><strong>
Hello Gang,
</strong></p>
<p><strong>
Here in Indonesia we have very cheap joystick using DirectPad Pro driver (it's
actually just a modified Playstation joystick).
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Does it connect to the parallel port of your
Linux machine? If so, you might find the
README and README-parport in the following
are helpful to get an understanding:
<a href="ftp://atrey.karlin.mff.cuni.cz/pub/linux/joystick/joystick-1.2.15.tar.gz"
	>ftp://atrey.karlin.mff.cuni.cz/pub/linux/joystick/joystick-1.2.15.tar.gz</a>
</blockquote>
<blockquote>
If on the other hand, it connects to the
game port of your sound card, don't use
the parallel port driver, of course :)
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
Yes, it does connect to parallel port.
</strong></p>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
I have use it for a long time in Windows, but still have no idea how to use it
with Linux.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Did you read these pages?<br>
<a href="http://atrey.karlin.mff.cuni.cz/~vojtech/input"
	>http://atrey.karlin.mff.cuni.cz/~vojtech/input</a><br>
<a href="http://www.linuxgames.com/joystick"
	>http://www.linuxgames.com/joystick</a>
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
Yes. But the documentation in the Linux kernel says that the kernel has
support for DirectPad joysticks, using gamecon module.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Yes, "gamecon" is likely the right module to use.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
So I think I don't
have to compile the package provided in the abovementioned pages..
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
True. Still, they're useful in that they combine
the userland tools and the kernel drivers all in
one place with some guides and FAQ and other such.
It gives a good starting point, and from there you
can work on the specific issues of the 2.6 kernel,
once you know how to get the device to work correctly
in a plain 2.4 kernel.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
And I'm still confused, because the package in these pages use different
filename.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Yes, well filenames change over time, code hardly
changes all that much.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
For example, Linux kernel uses joydev.c, but in these pages it is
joystick.c. And for DirectPad joysticks, Linux kernel uses gamecon.c, while
in these pages it is joy-console.c.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Those would have been the names during
the 2.4 series kernel.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
I have been Googling and found that the Linux kernel actually
have support on it. And then I found several documentation in the Linux
kernel, but I always fail :(
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
What did you try, and how did it fail,
specifically?
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	>
</strong></p>

<pre><strong>cd /dev
rm js*
mkdir input
mknod input/js0 c 13 0
mknod input/js1 c 13 1
mknod input/js2 c 13 2
mknod input/js3 c 13 3
ln -s input/js0 js0
ln -s input/js1 js1
ln -s input/js2 js2
ln -s input/js3 js3
</strong></pre>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Well, those entries would be created by udev
if you were using a 2.6.12 or later kernel,
once the module was loaded correctly.
</blockquote>
<blockquote>
It seems, though, that the module "gamecon" isn't
loading for some reason. Perhaps because it isn't
finding the parallel port device? Or because the
parallel port is being used by another module
(have you checked that "lp" module isn't loaded)?
</blockquote>
<blockquote>
Are you sure the parallel port is enabled in the
BIOS? Do you happen to have a parallel port printer
and test that printing works OK, or some other way
to know if the parallel port is actually enabled?
You mentioned the joystick worked in Microsoft but
it wasn't clear if it was on the same machine.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
But every reboot, my js* is always gone
<img SRC="../../gx/dennis/unsmily.gif" alt=" :( " 
		height="24" width="20" align="middle"> How can I fix it?
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Not sure about that, could be many reasons.
It's no harm to create the devices manually,
but unless the module is loaded successfully
they will just give ENODEV when you try to use them.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	>
</strong></p>

<pre><strong>root@devel:/home/i2c# modprobe joydev
root@devel:/home/i2c# modprobe gamecon
FATAL: Error inserting gamecon
(/lib/modules/2.6.8-2-386/kernel/drivers/input/joystick/gamecon.ko): No such
device
</strong></pre>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Have a look in "dmesg" to see if there's any
other messages.
Also, can you see anything mentioning "parport"
in your boot messages, if so can you send it,
e.g.:
</blockquote>

<blockquote><pre>parport: PnPBIOS parport detected.
parport0: PC-style at 0x378 (0x778), irq 7, using FIFO
[PCSPP,TRISTATE,COMPAT,ECP]
</pre></blockquote>
<blockquote>
That would tell you the IRQ line to look for in
<tt>/proc/interrupts</tt> corresponding to the parallel port.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
I've tested on 2.4 and 2.6 series, but no difference...
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Hmm, so it looks like more debugging will be needed.
Have a look in the sources, you can add in some
printk(KERN_INFO along the path from module_init(gc_init);
so add in some tracing of gc_init and see why
the gc_probe function isn't happy. You should see
your debug additions come out in "dmesg" when
you modprobe gamecon and you can keep adding
more debug tracing and doing rmmod gamecon and
modprobe gamecon to try again. Be careful though
with your code, as you're likely to crash your
kernel sometimes doing this sort of thing.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
Can you explain step-by-step how to configure the kernel to work with this
joystick? I use <a href="http://www.debian.org/">Debian</a> 3.1 and kernel 2.6.18.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
I wouldn't have the same hardware as you,
so I couldn't provide a step-by-step guide.
My guess woiuld be that the joystick stuff
might be easier to get to work using a 2.4
series kernel rather than 2.6 series.
I haven't been following the development in
the 2.6 series much on joysticks.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
My sound card (Intel i810 onboard) doesn't work on 2.4, so I have to use the
2.6 series :(
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Well, it is still worthwhile to learn how (or even
if) the device will work with the 2.4 kernel driver,
even if you can't listen to music while you're
doing the investigation :)
But sounds like it doesn't work in 2.4 as you say,
so easiest to debug what's going on using 2.6 for
now.
</blockquote>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Could you try instead:
</blockquote>

<blockquote><pre>modprobe gamecon map=0,1
</pre></blockquote>
<blockquote>
Looking in <tt>./drivers/input/joystick/gamecon.c</tt>
it seems it needs the parallel port number and
the pad number. I'm guessing that would be
counting from 1, but maybe it should be map=0,0
</blockquote>

<blockquote><pre>module_param_array_named(map, gc, int, &amp;gc_nargs, 0);
MODULE_PARM_DESC(map, "Describers first set of devices
(&lt;parport#&gt;,&lt;pad1&gt;,&lt;pad2&gt;,..&lt;pad5&gt;)");
</pre></blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
Solved!
</strong></p>
<p><strong>
First I had to remove lp module. I also stopped CUPS services because my
printer is connected via parallel port.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Thanks, I didn't think of stopping CUPS :)
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
In 2.4 kernel, I try:
</strong></p>

<pre><strong>#modprobe gamecon gc=0,7
</strong></pre>
<p><strong>
where 0 means parallel port 0, and 7 means that it is a Playstation joystick.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
the "map=0,7" would be what to use for 2.6,
judging from the sources they mention that
the "gc=" parameter is deprecated.
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
When I tried to play xgalaga using my joystick, the ships did some strange
movement.
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Instead of tying a game directly, could you
try to build the "jstest" and "jcal" programs
if you don't have them already. From the README in the download
mentioned before:
</blockquote>

<table width="95%" border="1" bgcolor="#FFFFCC"><tr><td>
<p align="center">...............</p>
<blockquote><blockquote>
2.5 Verifying that it works
</blockquote></blockquote>
<blockquote>
For testing the joystick driver functionality, there is the jstest
program. You run it by typing:
</blockquote>

<blockquote><pre>       jstest /dev/js0
</pre></blockquote>
<blockquote>
And it should show a line with the joystick values, which update as you
move the stick, and press its buttons. The axes should all be zero when the
joystick is in the center position. They should not jitter by themselves to
other close values, and they also should be steady in any other position of
the stick. They should have the full range from -32767 to 32767. If all this
is met, then it's all fine, and you can play the games. :)
</blockquote>
<blockquote>
If it's not, then there might be a problem. Try to calibrate the joystick,
and if it still doesn't work, read the drivers section of this file, the
troubleshooting section, and the FAQ.
</blockquote>
<blockquote>
2.6. Calibration
</blockquote>
<blockquote>
For most joysticks you won't need any manual calibration, since the
joystick should be autocalibrated by the driver automagically. However, with
some analog joysticks, that either do not use linear resistors, or if you
want better precision, you can use the jscal program
</blockquote>

<blockquote><pre>       jscal -c /dev/js0
</pre></blockquote>
<p align="center">...............</p>
</td>
</tr>
</table><p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
Maybe it still need some configuration or it's a bug in the kernel
(the documentation in 2.4 kernel says that support for Playstation joystick
is still under development).
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Well, to debug we'd need a better description
of the symptoms than "ships did some strange
movement in xgalaga", I mean any kernel
developer would probably find that quite
insuffuicient :)
</blockquote>
<p><strong>
<img src="../../gx/dennis/qbub.gif" alt="(?)"
	height="28" width="50" border="0"
	> 
But I'm quite happy to see that my Linux box is now more fun with joystick
support :)
</strong></p>
<p><strong>
I haven't had time to try this on 2.6 kernel. Anyway thanks very much for the
help :)
</strong></p>
<blockquote>
<img src="../../gx/dennis/bbub.gif" alt="(!)"
	height="28" width="50" border="0"
	> [Peter] 
Could be that in 2.6 the driver would read
more frequently from the parport than in
2.4, resulting in a more responsive joystick,
so it could be worth a try. Especially to
get sound to work at the same time, as you
mentioned.
</blockquote>

<!-- end 1 -->
<hr>
<p><center><font face="Helvetica"><strong>
This page edited and maintained by the Editors of <i>Linux Gazette</i>
<br>HTML script maintained by
        <a href="mailto:star@starshine.org">Heather Stern</a> of
        Starshine Technical Services,
<a href="http://www.starshine.org/">http://www.starshine.org/</a></strong></font></center></p>
<hr>

<div id="articlefooter">
<p>
Each TAG thread <a href="http://linuxgazette.net/copying.html">
        Copyright &copy;</a> its authors, 2006
</p>
<p>
Published in issue 122 of <i>Linux Gazette</i> January 2006
</p>
</div>

<div id="previousnextbottom">
<A HREF="../lg_tips.html" >&lt;-- 2c Tips</A> 
| <A HREF="../lg_answer.html">TAG Index</a>
 | <A HREF="1.html">1</a> | <A HREF="2.html">2</a> | <A HREF="3.html">3</a> | <A HREF="4.html">4</a>
| <a href="../../tag/kb.html">Knowledge Base --&gt;</A>
</div>
</div>

<div id="navigation">
<a href="../../index.html">Home</a>
<a href="../../faq/index.html">FAQ</a>
<a href="../../lg_index.html">Site Map</a>
<a href="../../mirrors.html">Mirrors</a>
<a href="../../mirrors.html">Translations</a>
<a href="http://linuxgazette.net/search.html">Search</a>
<a href="../../archives.html">Archives</a>
<a href="../../authors/index.html">Authors</a>
<a href="../../contact.html">Contact Us</a>
</div>

<div id="breadcrumbs">
<a href="../../index.html">Home</a> &gt; 
<a href="../index.html">October 2006 (122)</a> &gt; 
<a href="../lg_answer.html">The Answer Gang</a> &gt; 
Thread
</div>

<img src="../../gx/2003/sit3-shine.7-2.gif" id="tux" alt="Tux"/>

</body>
</html>
